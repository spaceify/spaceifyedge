
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fs"),require("minimist"),require("net"),require("websocket"),require("http"),require("https"),require("path"),require("url"),require("wrtc")):"function"==typeof define&&define.amd?define("sp",["fs","minimist","net","websocket","http","https","path","url","wrtc"],e):"object"==typeof exports?exports.sp=e(require("fs"),require("minimist"),require("net"),require("websocket"),require("http"),require("https"),require("path"),require("url"),require("wrtc")):n.sp=e(n.fs,n.minimist,n.net,n.websocket,n.http,n.https,n.path,n.url,n.wrtc)}(this,function(__WEBPACK_EXTERNAL_MODULE_15__,__WEBPACK_EXTERNAL_MODULE_16__,__WEBPACK_EXTERNAL_MODULE_17__,__WEBPACK_EXTERNAL_MODULE_18__,__WEBPACK_EXTERNAL_MODULE_28__,__WEBPACK_EXTERNAL_MODULE_29__,__WEBPACK_EXTERNAL_MODULE_30__,__WEBPACK_EXTERNAL_MODULE_31__,__WEBPACK_EXTERNAL_MODULE_32__){return function(n){function e(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return n[t].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var o={};return e.m=n,e.c=o,e.i=function(n){return n},e.d=function(n,o,t){e.o(n,o)||Object.defineProperty(n,o,{configurable:!1,enumerable:!0,get:t})},e.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(o,"a",o),o},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=23)}([function(n,e,o){"use strict";function t(n,e){var o=this,t="undefined"==typeof window;o.RETURN=1;var i="log",c="dir",r="info";o.ERROR="error";var l=o.ERROR,a="warn";o.FORCE="force";var s=o.FORCE,u={};u[i]="[i] ",u[c]="[d] ",u[r]="[i] ",u[l]="[e] ",u[a]="[w] ",u[s]="",u.stdout="";var d=!0,f=n||{};f[i]=void 0===f[i]||f[i],f[c]=void 0===f[c]||f[c],f[r]=void 0===f[r]||f[r],f[l]=void 0===f[l]||f[l],f[a]=void 0===f[a]||f[a],f[s]=!0,f.stdout=!0,o.log=function(){p(i,!1,arguments)},o.dir=function(){p(c,!1,arguments)},o.info=function(){p(r,!1,arguments)},o.error=function(){p(l,!1,arguments)},o.warn=function(){p(a,!1,arguments)},o.force=function(){p(s,!1,arguments)},o.stdout=function(){p("stdout",!0,arguments)};var p=function(n,i){if(f[n]||n==s){for(var p="",g=o.convertArguments(arguments[2]),C=null,w=0;w<g.length;w++)C="string"==typeof g[w]?g[w]:JSON.stringify(g[w]),p+=(""!=p&&"\n"!=p&&"\r"!=p&&"\r\n"!=p?" ":"")+C;if(n==l&&(p+=(new Error).stack),p=p.replace(/[\x00-\x09\x0b-\x0c\x0e-\x1f]/g,""),!i&&d){p=(new Date).toISOString().replace(/T/," ").replace(/\..+/,"")+" "+u[n]+"["+e+"] "+p}t?i?process.stdout.write(p):console.log(p):n==c&&console.dir?console.dir(p):n==l&&console.error?console.error(p):n==r&&console.info?console.info(p):n==a&&console.warn?console.warn(p):console.log(p)}};o.setOptions=function(n){if(void 0!==n.enabled)for(var e in n.enabled)f[e]=n.enabled[e];void 0!==n.showLabels&&(d=n.showLabels)},o.clone=function(n){var e=n.getEnabled();f[i]=e[i],f[c]=e[c],f[r]=e[r],f[l]=e[l],f[a]=e[a]},o.getEnabled=function(){return f},o.cloneInstanceToBaseConfiguration=function(){var n,o="undefined"==typeof window?global:window;if(o.spBaseConfig_&&o.spBaseConfig_.logger){n=o.spBaseConfig_.logger;for(var t in n)t!=e&&(n[t][i]=f[i],n[t][c]=f[c],n[t][r]=f[r],n[t][l]=f[l],n[t][a]=f[a])}},o.convertArguments=function(){return 0==Object.keys(arguments[0]).length?[""]:Array.prototype.slice.call(arguments[0])}}t.createLogger_=function(n){var e,i;if("undefined"==typeof window)try{i=o(1)}catch(n){i=o(27)("/var/lib/spaceify/code/config.js")}else"undefined"!=typeof window&&(e=window.sp?window.sp:window,i=e.Config?e.Config:null);var c=i.getConfig(),r={};i.overrideConfigValues(r,c.logger.defaultLoggerConfig),c.logger.hasOwnProperty(n)&&i.overrideConfigValues(r,c.logger[n]),i.overrideConfigValues(r,c.logger.globalConfigOverride);var l=void 0!==r.all?r.all:null;return null!==l&&(r.log=l,r.dir=l,r.info=l,r.error=l,r.warn=l),new t(r,n)},t.getLogger=function(n){n||(n="mainlog");var e=null;return e="undefined"==typeof window?global:window,e.hasOwnProperty("spLoggerInstances_")||(e.spLoggerInstances_=new Object),e.spLoggerInstances_.hasOwnProperty(n)||(e.spLoggerInstances_[n]=t.createLogger_(n)),e.spLoggerInstances_[n]},n.exports=t},function(module,exports,__webpack_require__){"use strict";(function(module){function Config(){var self=this,baseConfig=null,overridingConfig=null,config=null,path=null,doRequire=function(module){return eval("require")(module)},globalObj="undefined"==typeof window?global:window;if(globalObj.spBaseConfig_,baseConfig=globalObj.spBaseConfig_,"undefined"==typeof window){if(path=__webpack_require__(30),!baseConfig)try{var apipath="/var/lib/spaceify/code/";baseConfig=doRequire(path.resolve("/var/lib/spaceify/code/","spbaseconfig.js"))}catch(n){baseConfig=__webpack_require__(5)}baseConfig||process.exit(1);try{overridingConfig=doRequire(module.parent.spconfig),Config.overrideConfigValues(baseConfig,overridingConfig)}catch(n){}finally{try{overridingConfig=doRequire("spconfig"),Config.overrideConfigValues(baseConfig,overridingConfig)}catch(n){}finally{try{overridingConfig=doRequire(path.resolve(process.cwd(),"spconfig.js")),Config.overrideConfigValues(baseConfig,overridingConfig)}catch(n){}}}}else if("undefined"!=typeof window){var lib=window;window.sp&&(lib=window.sp),baseConfig||(baseConfig=lib.SpBaseConfig),lib.SpConfig&&Config.overrideConfigValues(baseConfig,lib.SpConfig)}globalObj.spBaseConfig_=baseConfig,self.getConfig=function(){return baseConfig}}Config.overrideConfigValues=function(n,e){for(var o in e)try{e[o].constructor==Object?n[o]=Config.overrideConfigValues(n[o],e[o]):n[o]=e[o]}catch(t){n[o]=e[o]}return n},Config.destroySingleton=function(){var n=null;n="undefined"==typeof window?global:window,n.spConfigInstance_=null},Config.getConfig=function(){var n=null;return n="undefined"==typeof window?global:window,n.spConfigInstance_||(n.spConfigInstance_=new Config,Object.freeze(n.spConfigInstance_)),n.spConfigInstance_.getConfig()},module.exports=Config}).call(exports,__webpack_require__(7)(module))},function(n,e,o){"use strict";function t(n){var e=this,t=null,i=null,c=null,r=null,l=null;"undefined"==typeof window?(i=o(0),c=o(8),n&&(r=o(10)),l=o(12)):(t=window.sp?window.sp:window,i=t.Logger,c=t.CallbackBuffer,n&&(r=t.ConnectionGuard),l=t.Reconnector);var a=1,s=new Object,u=null,d=null,f=null,p=new c,g=new Object,C=0,w=null,h=i.getLogger("RpcCommunicator"),b=null;n&&(b=new r(e,g,p),b.run());var m=new l(e,g),y=function(n,e){try{g[e].send(JSON.stringify(n))}catch(n){h.log(n)}};e.sendMessage=y;var R=function(n,e,o,t){try{if(n){y({jsonrpc:"2.0",error:n,id:o},t);var i=void 0!==n.code?n.code:"",c=void 0!==n.path?n.path:"",r=void 0!==n.message?n.message:"";h.log("Exception in executing a RPC method: "+i+" RpcCommunicator::onMessage() >> "+c+" "+r)}else y({jsonrpc:"2.0",result:e,id:o},t)}catch(n){h.log(n)}},v=function(n,e){try{if(!n.jsonrpc||"2.0"!=n.jsonrpc||!n.method)return void y({jsonrpc:"2.0",error:{code:-32600,message:"Invalid JSON-RPC."},id:null},e);if("[object Array]"!==Object.prototype.toString.call(n.params))return void y({jsonrpc:"2.0",error:{code:-32602,message:"Parameters must be sent inside an array."},id:n.id},e);if(!s.hasOwnProperty(n.method))return null!=n.id?void y({jsonrpc:"2.0",error:{code:-32601,message:"Method "+n.method+" not found."},id:n.id},e):void y({jsonrpc:"2.0",error:{code:-32601,message:"Method "+n.method+" not found."},id:null},e);var o=s[n.method];void 0===n.params&&(n.params=new Array),null!=n.id?(n.params.push(e),n.params.push(function(o,t){R(o,t,n.id,e)}),o.method.apply(o.object,n.params)):(n.params.push(e),n.params.push(function(n,e){}),o.method.apply(o.object,n.params))}catch(n){h.log(n)}},O=function(n,e){try{var o=null,t=null;void 0!==n.error&&(o=n.error),void 0!==n.result&&(t=n.result),n.id?p.callMethodAndPop(e,n.id,o,t):h.log("RpcCommunicator::handleReturnValue() error: "+JSON.stringify(o))}catch(n){h.log(n)}},P=function(n,e){try{n.method?v(n,e):O(n,e)}catch(n){h.log(n)}},I=function(){C++;for(var n=C;;)if(n=Math.floor(4294967296*Math.random()),!g.hasOwnProperty(n))break;return n};e.exposeRpcMethod=function(n,e,o){try{s[n]={object:e,method:o}}catch(n){h.log(n)}},e.setConnectionListener=function(n,e){u={object:n,listener:e}},e.setDisconnectionListener=function(n,e){d={object:n,listener:e}},e.setBinaryListener=function(n){f=n},e.connectionExists=function(n){return!(void 0===n||!g.hasOwnProperty(n))||!(void 0!==n||!g.hasOwnProperty(w))},e.getConnection=function(n){return g[n]},e.callRpc=function(n,o,t,i,c){if(e.connectionExists(c))try{"function"==typeof i?(void 0!==c?(p.pushBack(c,a,t,i),y({jsonrpc:"2.0",method:n,params:o,id:""+a},c)):(p.pushBack(w,a,t,i),y({jsonrpc:"2.0",method:n,params:o,id:""+a},w)),a++):void 0!==c?y({jsonrpc:"2.0",method:n,params:o},c):y({jsonrpc:"2.0",method:n,params:o},w)}catch(n){h.log(n)}},e.notifyAll=function(n,e){try{for(var o in g)y({jsonrpc:"2.0",method:n,params:e,id:null},o)}catch(n){h.log(n)}},e.getBufferedAmount=function(n){return g[n].getBufferedAmount()},e.sendBinary=function(n,e){try{g[e].sendBinary(n)}catch(n){h.log(n)}},e.setupPipe=function(n,e){g.hasOwnProperty(n)&&g.hasOwnProperty(e)&&(g[n].setPipedTo(e),g[e].setPipedTo(n))},e.closeConnection=function(n){try{if(h.log("RpcCommunicator::closeConnection()"),p.deleteConnectionCallbacks(n),g.hasOwnProperty(n)){h.log("RpcCommunicator::closeConnection() calling close on connection");var e=g[n].getPipedTo();h.log("RpcCommunicator::closeConnection() pipeTarget was "+e),g[n].close(),delete g[n],null!=e&&g.hasOwnProperty(e)&&(h.log("RpcCommunicator::closeConnection() the connection was piped, also closing the other end of the pipe"),g[e].close(),delete g[pipetarget]),d&&d.listener.call(d.object,n)}}catch(n){h.log(n)}},e.onMessage=function(n,e){try{var o=e.getPipedTo();if(null!=o)return void g[o].send(n);if(n instanceof ArrayBuffer)return void(f&&f.onBinary(n,e.getId()));var t;try{t=JSON.parse(n)}catch(n){return void y({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},e.getId())}P(t,e.getId())}catch(n){h.log(n)}},e.addConnection=function(n,o){try{return n.getId()||n.setId(I()),g[n.getId()]=n,w=n.getId(),n.setListener(e),u&&u.listener.call(u.object,n.getId()),o&&m.keepConnected(n),n.getId()}catch(n){h.log(n)}},e.onDisconnected=function(n){h.log("RpcCommunicator::onDisconnected()");try{e.closeConnection(n)}catch(n){h.log(n)}},e.closeAllConnections=function(){h.log("RpcCommunicator::closeAllConnections(), there were this many: "+Object.keys(g).length);for(var n in g)try{e.closeConnection(n)}catch(n){h.log(n)}h.log("RpcCommunicator::closeAllConnections() at end")},e.destroy=function(){h.log("RpcCommunicator::destroy()"),m&&(m.destroy(),m=null),b&&(b.destroy(),b=null),e.closeAllConnections(),h.log("RpcCommunicator::destroy() in end")}}n.exports=t},function(n,e,o){"use strict";function t(){var n=this,e=null,t=null,i=null;"undefined"==typeof window?(t=o(0),i=o(18)):(e=window.sp?window.sp:window,t=e.Logger),i="undefined"!=typeof window?window.WebSocket:i.w3cwebsocket;var c=t.getLogger("WebSocketConnection"),r=null,l=null,a=null,s=null,u=null,d=null,f=null,p=null,g=Object(),C=Object();n.connect=function(e,o){if(r&&(r.readyState==i.CONNECTING||r.readyState==i.OPEN))return void c.warn("WebSocketConnection::connect() tried to re-connect a WebSocket that was in state: "+r.readyState);e&&(p=e),p.protocol=p.isSsl?"wss":"ws";try{var t=p.protocol+"://"+p.host+":"+p.port+"/json-rpc";p.url&&(t=p.url,t.startsWith("wss")?(p.protocol="wss",p.isSsl=!0):p.protocol="ws"),l?t+="?id="+l:p.id&&(t+="?id="+p.id,l=p.id),c.log("WebSocketConnection::connect() "+t),r=new i(t,"json-rpc",null,null,p.isSsl?{rejectUnauthorized:!1}:null),r.binaryType="arraybuffer",r.onopen=function(){for(var n in g)g[n].listener.call(g[n].object,l);o&&o()},r.onerror=function(n){c.error("WebSocketConnection::connect() "+n),o&&o(n)},r.onmessage=h,r.onclose=function(e,o){b(e,o,n)}}catch(n){c.log(n)}},n.setSocket=function(e){c.log("WebSocketConnection::setSocket()");try{r=e,r.on("message",w),r.on("close",function(e,o){b(e,o,n)})}catch(n){c.log(n)}},n.setId=function(n){l=n},n.setPipedTo=function(n){f=n},n.getPipedTo=function(){return f},n.setRemoteAddress=function(n){a=n},n.setRemotePort=function(n){s=n},n.setOrigin=function(n){u=n},n.addConnectionListener=function(n,e){g[e]={object:n,listener:e}},n.removeConnectionListener=function(n){g.hasOwnProperty(n)&&delete g[n]},n.addDisconnectionListener=function(n,e){C[e]={object:n,listener:e}},n.removeDisconnectionListener=function(n){C.hasOwnProperty(n)&&delete C[n]},n.setListener=function(n){d=n},n.getId=function(){return l},n.getRemoteAddress=function(){return a},n.getRemotePort=function(){return s},n.getOrigin=function(){return u};var w=function(e){try{d&&("utf8"==e.type&&d.onMessage(e.utf8Data,n),"binary"==e.type&&d.onMessage(e.binaryData,n))}catch(n){c.log(n)}},h=function(e){try{d&&d.onMessage(e.data,n)}catch(n){c.log(n)}},b=function(n,e,o){try{d&&(d.onDisconnected(o.getId()),d=null);for(var t in C)C[t].listener.call(C[t].object,o.getId())}catch(n){c.log(n)}};n.send=function(n){try{r.send(n)}catch(n){c.log(n)}},n.sendBinary=n.send,n.close=function(){try{r.close(),d=null}catch(n){c.log(n)}}}n.exports=t},function(n,e,o){"use strict";function t(n,e){var t=this,i=null,c=null,r=null,l=null,a=null,s=null,u=null;"undefined"==typeof window?(l=o(1),c=o(0),r=o(9),null,a=o(6),s=o(2),u=o(3)):(i=window.sp?window.sp:window,l=i.Config,c=i.Logger,r=i.ClientInfo,a=i.WebRtcConnector,s=i.RpcCommunicator,u=i.WebSocketConnection);var d=c.getLogger("CommunicationClient"),f=l.getConfig(),p=null,g=null,C=null,w=new u,h=new Object,b=!1,m=!1,y=null,R=null,v=null,O=null,P=null,I=null,L=null,_=null,D=new s(n),S=new Object,T=new Object,A=new Object,W=null;t.callRpcOnClient=function(n,e,o,t,i){d.log("CommunicationClient::callRpcOnClient(clientId: "+n+", methodName: "+e+")\n"),S.hasOwnProperty(n)&&(S[n].isWebRtc()?(d.log("CommunicationClient::callRpcOnClient - Calling client RPC through WebRtc, preferredConnectionId was: "+S[n].getPreferredConnectionId()+"\n"),o.push(y),D.callRpc(e,o,t,i,S[n].getPreferredConnectionId())):S[n].isLocalHub()?(d.log("CommunicationClient::callRpcOnClient - Calling client RPC through local hub\n"),D.callRpc("callClientRpc",[n,e,o],t,i,S[n].getPreferredConnectionId())):(d.log("CommunicationClient::callRpcOnClient - Notifying client RPC through the global hub, globalHubId: "+_+"\n"),D.callRpc("callClientRpc",[n,e,o],t,i,_)))},t.callRpcOnConnection=function(n,e,o,t,i){d.log("CommunicationClient::callRpcOnConnection(connectionId: "+n+", methodName: "+e+")\n"),d.log("CommunicationClient::callRpcOnConnection - Making a RPC call over direct connection\n"),o.push(y),D.callRpc(e,o,t,i,n)},t.notifyClient=function(n,e,o){d.log("CommunicationClient::notifyClient(clientId: "+n+", methodName: "+e+")\n"),S.hasOwnProperty(n)&&(S[n].isWebRtc()?(d.log("CommunicationClient::notifyClient - Notifying client through WebRtc\n"),o.push(y),D.callRpc(e,o,null,null,S[n].getPreferredConnectionId())):S[n].isLocalHub()?(d.log("CommunicationClient::notifyClient - Notifying client through local hub\n"),D.callRpc("callClientRpc",[n,e,o],null,null,S[n].getPreferredConnectionId())):(d.log("CommunicationClient::notifyClient - Notifying client through the global hub, globalHubId: "+_+"\n"),D.callRpc("callClientRpc",[n,e,o],null,null,_)))},t.sendBinaryOnConnection=function(n,e){D.sendBinary(e,n)},t.getClientsByType=function(n){return T[n]},t.getConnectionType=function(n){return S[n].getConnectionType()},t.upgradeToWebRtc=function(n,e){d.log("CommunicationClient::upgradeToWebRtc(clientId: "+n+")\n"),S[n].isWebRtc()||W.connectToPeer(n,e)},t.getBufferedAmount=function(n){return D.getConnection(n).getBufferedAmount()},t.createDirectConnection=function(n,e){d.log("CommunicationClient::createDirectConnection(clientId: "+n+")\n"),S[n].isWebRtc()?W.createDataChannelConnection(n,function(o){d.log("CommunicationClient::createDirectConnection - Callback returned connectionId: "+o+"\n"),A[o]=n,e(o)}):t.createPipe(n,e)},t.closeDirectConnection=function(n){A.hasOwnProperty(n)&&delete A[n],D.closeConnection(n)},t.onWebRtcConnected=function(n,e){d.log("CommunicationClient::onWebRtcConnected(clientId: "+n+", connectionId: "+e+")\n"),S.hasOwnProperty(n)&&(S[n].setWebRtc(!0),S[n].setPreferredConnectionId(e)),v&&v.onConnectionTypeUpdated(S[n],S[n].getConnectionType())},t.onWebRtcDisconnected=function(n){d.log("CommunicationClient::onWebRtcDisconnected(partnerId: "+n+")\n")},t.onAdditionalDataChannelOpen=function(n,e){d.log("CommunicationClient::onAdditionalDataChannelOpen(clientId: "+n+", connectionId: "+e+")\n"),A[e]=n},t.createPipe=function(n,e){d.log("CommunicationClient::createPipe(clientId: "+n+")\n");var o,i=new u;i.connect(p,function(){o=D.addConnection(i),d.log("CommunicationClient::createPipe - Pipe connected to the WebSocket server, pipeId: "+o+"\n"),D.callRpc("constructPipe",[n,y],t,function(){d.log("CommunicationClient::createPipe - Pipe construction ready\n"),S.hasOwnProperty(n)&&(S[n].addPipeId(o),A[o]=n),e(o)},o)})},t.requestPipe=function(n,e,o,i){d.log("CommunicationClient::requestPipe(targetId: "+n+", originatorId: "+e+", connectionId: "+o+")\n");var c=null,r=new u;r.connect(p,function(){c=D.addConnection(r),d.log("CommunicationClient::requestPipe - Pipe connected to the WebSocket server, pipeId: "+c+"\n"),D.callRpc("registerAsPipe",[n],t,function(n,o){d.log("CommunicationClient::requestPipe - registerAsPipe returned\n"),S.hasOwnProperty(e)&&(S[e].addPipeId(c),A[c]=e),i(null,"Ok")},c)})},t.pipeToExternalConnection=function(n,e){var o=D.addConnection(e);d.log("CommunicationClient::pipeToExternalConnection(), connectionId: "+n+", externalId: "+o+"\n"),D.setupPipe(n,o)},t.onBinary=function(n,e){O&&(A.hasOwnProperty(e)?O.onBinary(n,A[e],e):O.onBinary(n,e))},t.setClientListener=function(n){R=n},t.setConnectionTypeListener=function(n){v=n},t.setBinaryListener=function(n){O=n},t.setGlobalHubConnectionListener=function(n,e){P={obj:n,listener:e}},t.setGlobalHubDisconnectionListener=function(n,e){I={obj:n,listener:e}},t.setDirectConnectionDisconnectionListener=function(n,e){L={obj:n,listener:e}};var E=function(n,e,o){d.log("CommunicationClient::addClient(clientId: "+n+", clientType: "+e+", arrivedBeforeUs: "+o+")\n");var t=null;return S.hasOwnProperty(n)?t=S[n]:(t=new r(n,e,o),S[n]=t),T.hasOwnProperty(e)||(T[e]=new Object),T[e][n]=t,t},k=function(n){delete T[S[n].getClientType()][n],delete S[n]},j=function(n,e){d.log("CommunicationClient::updateConnectedClients(hubId: "+n+")\n");var o=_;n&&(o=n),D.callRpc("getConnectedClients",[C],t,function(t,i){d.log("CommunicationClient::updateConnectedClients got answer from hub: "+JSON.stringify(i)+"\n");var c=null;for(var r in i)S.hasOwnProperty(r)||i[r].clientId==y?n&&(S[r].setLocalHub(!0),S[r].setPreferredConnectionId(o)):(c=null==n?E(i[r].clientId,i[r].clientType,!0):E(i[r].clientId,i[r].clientType,!1),!n&&R&&c.getClientId()!=y&&R.onClientConnected(c));e()},o)},H=function(n,e){if(d.log("CommunicationCLient::connectToLocalHubs(hubs: "+JSON.stringify(n)+")\n"),null!=n){var o=null,i=null,c=null;for(var r in n){o=n[r].port;for(var l=0;l<n[r].localIps.length;l++){i=n[r].localIps[l];var a={host:i,port:o,id:y},s=null;c=new u,c.connect(a,function(){d.log("CommunicationClient::connectToLocalHubs - Connected to local hub at ip: "+i+" port: "+o+"\n"),s=D.addConnection(c),h[s]=s,j(s,function(){D.callRpc("registerAsClient",[y,g,C],t,function(n,e){d.log("CommunicationClient::connectToLocalHubs - Registered as client at local hub at ip: "+i+", port: "+o+"\n")})})})}}e()}},M=function(n){d.log("CommunicationClient::updateLocalHubs() - Getting list of local hubs from the server\n"),D.callRpc("getLocalHubs",[],t,function(e,o){d.log("CommunicationClient::updateLocalHubs - Following local hubs are available: "+JSON.stringify(o)+"\n"),o?H(o,n):n()},_)};t.exposeRpcMethod=function(n,e,o){D.exposeRpcMethod(n,e,o)},t.isConnectedToGlobalHub=function(){return m},t.onConnectionDisconnected=function(n){d.log("CommunicationClient::onConnectionDisconnected()"),n==_?(d.log("CommunicationClient::onConnectionDisconnected() global hub disconnected"),m=!1,I&&I.listener.call(I.obj)):A.hasOwnProperty(n)&&(d.log("CommunicationClient::onConnectionDisconnected() pipe disconnected"),delete A[n],L&&L.listener.call(L.obj,n))},t.onConnectionConnected=function(n){d.log("CommunicationClient::onConnectionConnected()"),n==_&&(d.log("CommunicationClient::onConnectionConnected() global HUB connected"),t.onConnectedToGlobalHub(function(){m=!0,P&&P.listener.call(P.obj)}))},t.onConnectedToGlobalHub=function(n){var e=null;y&&(e=y),D.callRpc("registerAsClient",[e,g,C],t,function(e,o){d.log("CommunicationClient::connectToHubsWithOptions - Server replied to registerAsClient call, ownId: "+o+"\n"),y=o,m=!0,j(null,function(){M(function(){n&&n(null,o)})})},_)},t.connectToHubsWithOptions=function(n,o,i,c){if(d.log("CommunicationClient::connectToHubsWithOptions(options: "+JSON.stringify(n)+", clientType: "+o+", groupId: "+i+")\n"),b)throw new Error("CommunicationHub::connectToHubsWithOptions() called more than once!");b=!0,g=o,C=i,D.setBinaryListener(t),D.setDisconnectionListener(t,t.onConnectionDisconnected),D.setConnectionListener(t,t.onConnectionConnected),n.hasOwnProperty("id")||(n.id=null),p=n,w.connect(p,function(n){if(n)return d.error("CommunicationHub::connectWithOptions() error: "+n),void c(n);_=D.addConnection(w,e),d.log("CommunicationClient::connectToHubsWithOptions - Connected to the GlobalHub, globalHubId: "+_+"\n"),W=new a(D,_,f.WEBRTC_CONFIG),W.setConnectionListener(t),t.onConnectedToGlobalHub(c)})},t.connectWithOptions=function(n,e,o,i){return t.connectToHubsWithOptions(n,e,o,i)},t.connectToHubs=function(n,e,o,i,c){return p={host:n,port:e,id:null},t.connectToHubsWithOptions(p,o,i,c)},t.connect=function(n,e,o,i,c){return t.connectToHubs(n,e,o,i,c)},t.onClientConnected=function(n,e,o){if(d.log("CommunicationClient::onClientConnected(clientData: "+JSON.stringify(n)+", connectionId: "+e+") - ownId: "+y+"\n"),n.clientId!=y){if(h.hasOwnProperty(e))return d.log("CommunicationClient::onClientConnected - Client connected through localhub, clientId: "+n.clientId+"\n"),S[n.clientId].setLocalHub(!0),void S[n.clientId].setPreferredConnectionId(e);if(S.hasOwnProperty(n.clientId))R&&n.clientId!=y&&R.onClientConnected(t,!0);else{d.log("CommunicationClient::onClientConnected - addClient clientId: "+n.clientId+"\n");var t=E(n.clientId,n.clientType,!1);R&&t.getClientId()!=y&&R.onClientConnected(t,!1)}}},t.onClientDisconnected=function(n,e,o){d.log("CommunicationClient::onClientDisconnected(connectionId: "+e+", clientData: "+JSON.stringify(n)+")\n"),n.clientId!=y&&S.hasOwnProperty(n.clientId)&&(R&&R.onClientDisconnected(S[n.clientId]),k(n.clientId),d.log("CommunicationClient::onClientDisconnected() ClientInfo found and deleted"))},t.onHubConnected=function(n,e,o){d.log("CommunicationClient::onHubConnected(hubData: "+JSON.stringify(n)+")\n")},t.onHubDisconnected=function(n,e,o){d.log("CommunicationClient::onHubDisconnected(hubData: "+JSON.stringify(n)+")\n")},t.getConnectedClients=function(){return S},t.getOwnId=function(){return y},t.destroy=function(){d.log("CommunicationClient::destroy()"),D.destroy(),D=null,d.log("CommunicationClient::destroy() at end")},D.exposeRpcMethod("onClientConnected",t,t.onClientConnected),D.exposeRpcMethod("onClientDisconnected",t,t.onClientDisconnected),D.exposeRpcMethod("onHubConnected",t,t.onHubConnected),D.exposeRpcMethod("onHubDisconnected",t,t.onHubDisconnected),D.exposeRpcMethod("requestPipe",t,t.requestPipe)}n.exports=t},function(n,e,o){"use strict";var t={WEBRTC_CONFIG:{iceServers:[{url:"stun:kandela.tv"},{url:"turn:kandela.tv",username:"webrtcuser",credential:"jeejeejee"}]},connection:{MAINURL:"http://spaceify.net/games/"},connectionGuard:{GUARDING_INTERVAL:2e3,MAXIMUM_UNANSWERED_CALLBACKS:20},reconnector:{INITIAL_DELAY:500,DELAY_INCREMENT:1e3,MAXIMUM_DELAY:32e3},spaceifyPiper:{DEFAULT_GROUP:"testgroup",HTTP_ADDRESS:{host:"localhost",port:80},SERVER_ADDRESS:{host:"spaceify.net",port:1979}},logger:{loggerConfigOverride:{all:!0,myoverride:123,mydefault2:3},defaultLoggerConfig:{log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null,mydefault1:1,mydefault2:2},CallbackBuffer:{log:!0,dir:!0,info:!0,error:!0,warn:!0},Client:{log:!0,dir:!0,info:!0,error:!0,warn:!0},CommunicationClient:{log:!0,dir:!0,info:!0,error:!0,warn:!0},CommunicationHub:{log:!0,dir:!0,info:!0,error:!0,warn:!0},DataChannelConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},RpcCommunicator:{log:!0,dir:!0,info:!0,error:!0,warn:!0},SpaceifyPiper:{log:!0,dir:!0,info:!0,error:!0,warn:!0},TcpSocket:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebRtcConnector:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebRtcPeerConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebSocketConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebSocketRpcConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebSocketServer:{log:!0,dir:!0,info:!0,error:!0,warn:!0}},testValue:"TestValueFromBaseConfig"};n.exports=t},function(n,e,o){"use strict";function t(n,e,t){var i=this,c=null,r=null,l=null;"undefined"==typeof window?(r=o(0),l=o(13)):(c=window.sp?window.sp:window,r=c.Logger,l=c.WebRtcPeerConnection);var a=r.getLogger("WebRtcConnector"),s=new Object,u=new Object,d=null;i.setConnectionListener=function(n){d=n},i.onIceCandidate=function(o,t){a.log("iceCandidate got, sending it to the other client"),n.callRpc("callClientRpc",[t,"handleIceCandidate",[o]],i,null,e)};var f=function(n){s[n]=new l(t),s[n].setPartnerId(n),s[n].setIceListener(i),s[n].setStreamListener(i),s[n].setConnectionListener(i),s[n].setDataChannelListener(i)};i.shutdown=function(n){a.log("WebRtcConnector::onbeforeunload");for(var e in s)s.hasOwnProperty(e)&&(s[e].close(),delete s[e])},i.handleRtcOffer=function(o,t,c){a.log("WebRtcConnector::handleRtcOffer() descriptor: "+o),s.hasOwnProperty(t)||f(t),s[t].onConnectionOfferReceived(o,t,function(o){a.log("WebRtcConnector::handleRtcOffer() onConnectionOfferReceived returned"),a.log("Trying to call handleRtcAnswer on partner "+t),n.callRpc("callClientRpc",[t,"handleRtcAnswer",[o]],i,null,e),a.log("handleRtcAnswer call done on partner "+t)})},i.handleRtcAnswer=function(n,e,o){a.log("WebRtcConnector::handleRtcAnswer()"),s[e].onConnectionAnswerReceived(n)},i.handleIceCandidate=function(n,e,o){a.log("WebRtcConnector::handleIceCandidate()"),s.hasOwnProperty(e)||f(e),s[e].onIceCandidateReceived(n)},i.onDisconnected=function(e){if(a.log("WebRtcConnector::onDisconnected() "),s.hasOwnProperty(e)){for(var o=s[e],t=o.getDataChannelConnections(),i=0;i<t.length;i++)n.onDisconnected(t[i]);d.onWebRtcDisconnected(e),o.close(),delete s[e]}},i.onPrimaryDataChannelOpen=function(e,o){a.log("WebRtcConnector::onPrimaryDataChannelOpen() ");var t=n.addConnection(o);d&&d.onWebRtcConnected(e,t),u.hasOwnProperty(e)&&u[e].apply()},i.onAdditionalDataChannelOpen=function(e,o){a.log("WebRtcConnector::onAdditionalDataChannelOpen() ");var t=n.addConnection(o);d&&d.onAdditionalDataChannelOpen(e,t)},i.onStream=function(n,e){a.log("WebRtcConnector::onStream()")},i.onRemoveStream=function(n,e){a.log("WebRtcConnector::onRemoveStream()"),i.onDisconnected(e)},i.connectToPeer=function(o,t){if(a.log("WebRtcConnector::connectToPeer() partnerId: "+o),s.hasOwnProperty(o))return void a.log("WebRtcConnector::connectToPeer() connection to partnerId: "+o+" already exists or is under construction, not connecting again");f(o),t&&(u[o]=t),s[o].createConnectionOffer(function(t){a.log("Offer created, sending it to the other client "+o),n.callRpc("callClientRpc",[o,"handleRtcOffer",[t]],i,null,e)})},i.createDataChannelConnection=function(e,o){s[e].createDataChannelConnection(function(e){a.log("WebRtcConnector::createDataChannelConnection() callback returned");var t=n.addConnection(e);o(t)})},"undefined"!=typeof window&&(window.onbeforeunload=i.shutdown),n.exposeRpcMethod("handleRtcOffer",i,i.handleRtcOffer),n.exposeRpcMethod("handleRtcAnswer",i,i.handleRtcAnswer),n.exposeRpcMethod("handleIceCandidate",i,i.handleIceCandidate)}"undefined"!=typeof window&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),n.exports=t},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e,o){"use strict";function t(n){var e=this,o=new Object;e.pushBack=function(n,e,t,i){o.hasOwnProperty(n)||(o[n]=new Object),o[n][e]=[t,i]},e.callMethodAndPop=function(n,e,t,i){if(!o.hasOwnProperty(n)||!o[n].hasOwnProperty(e))throw{error:"CallbackBuffer::callMethodAndPop(). Callback not found"};o[n][e][1].call(o[n][e][0],t,i,e,n),delete o[n][e]},e.deleteConnectionCallbacks=function(n){if(o.hasOwnProperty(n)){for(var e in o[n])delete o[n][e];delete o[n]}},e.getNumberOfConnectionCallbacks=function(n){return o.hasOwnProperty(n)?Object.keys(o[n]).length:0}}n.exports=t},function(n,e,o){"use strict";function t(n,e,o){var t=this,i=n,c=e,r=!1,l=!1,a=null,s=new Array;t.toJSON=function(){return{clientId:i,clientType:c,webRtc:r,localHub:l,preferredConnectionId:a}},t.isArrivedBeforeUs=function(){return o},t.setClientId=function(n){i=n},t.setClientType=function(n){c=n},t.setWebRtc=function(n){r=n},t.setPreferredConnectionId=function(n){a=n},t.getClientId=function(){return i},t.getClientType=function(){return c},t.isWebRtc=function(){return r},t.getPreferredConnectionId=function(){return a},t.isLocalHub=function(){return l},t.setLocalHub=function(n){l=n},t.addPipeId=function(n){s.push(n)},t.getBinaryConnectionId=function(){return pipeId},t.getConnectionType=function(){return r?"WebRtc":l?"Local Hub":"Cloud"}}n.exports=t},function(n,e,o){"use strict";function t(n,e,t){var i=this,c=null,r=null,l=null;"undefined"==typeof window?(r=o(1),l=o(0)):(c=window.sp?window.sp:window,r=c.Config,l=c.Logger);var a=r.getConfig(),s=l.getLogger("ConnectionGuard"),u=a.connectionGuard.GUARDING_INTERVAL,d=a.connectionGuard.MAXIMUM_UNANSWERED_CALLBACKS,f=new Object,p=-1,g=function(){Date.now();for(var o in e)f.hasOwnProperty(o)&&0!=f[o]&&(s.log("ConnectionGuard::checkExpiredPings() closing connection"),n.closeConnection(o),delete f[o])},C=function(){for(var o in e)t.getNumberOfConnectionCallbacks(o)>d&&(s.warn("ConnectionGuard::checkNumberOfUnansweredCallbacks() disconnecting connection "+o+" because of "+d+" unanswered callbacks."),n.closeConnection(o))},w=function(){var o=Date.now();for(var t in e)f.hasOwnProperty(t)&&0!=f[t]||(f[t]=o,s.log("ConnectionGuard::doPinging() ping sent (id="+t+")"),n.callRpc("ping",[],i,function(n,e,o,t){s.log("ConnectionGuard::doPinging() ping returned (id="+t+")"),f[t]=0},t))},h=function(){C(),g(),w()};i.run=function(){s.log("ConnectionGuard::run()"),p=setInterval(h,u)},i.destroy=function(){s.log("ConnectionGuard::destroy()"),-1!=p&&(clearInterval(p),p=-1);for(var n in f)delete f[n];s.log("ConnectionGuard::destroy() at end")}}n.exports=t},function(n,e,o){"use strict";function t(n){var e=this,t=null,i=null;"undefined"==typeof window?i=o(0):(t=window.sp?window.sp:window,i=t.Logger);var c=n,r=i.getLogger("DataChannelConnection"),l=null,a=null;e.send=function(n){r.log("DataChannelConnection::send()"+n);try{"open"==c.readyState&&c.send(n)}catch(n){r.log(n)}},e.close=function(){r.log("DataChannelConnection::close")},e.sendBinary=function(n){try{"open"==c.readyState&&c.send(n)}catch(n){r.log(n)}},e.getBufferedAmount=function(){return c.bufferedAmount},e.setId=function(n){l=n},e.getId=function(){return l},e.setListener=function(n){a=n},e.onMessage=function(n){try{a&&a.onMessage(n.data,e)}catch(n){r.log(n)}},e.setPipedTo=function(n){},e.getPipedTo=function(){return null},c.onmessage=e.onMessage}n.exports=t},function(n,e,o){"use strict";function t(n){var e=this,t=null,i=null,c=null;"undefined"==typeof window?(i=o(1),c=o(0)):(t=window.sp?window.sp:window,i=t.Config,c=t.Logger);var r=i.getConfig(),l=c.getLogger("Reconnector"),a=r.reconnector.INITIAL_DELAY,s=r.reconnector.DELAY_INCREMENT,u=r.reconnector.MAXIMUM_DELAY,d=a,f=-1,p=new Object,g=new Object,C=function(){l.log("Reconnector::doReconnect() "+d);for(var n in g)l.log("Reconnector::doReconnect() looping throught disconnectedIds"),p[n].connect(null,null);f=setTimeout(function(){d<u&&(d+=s),C()},d)};e.onConnected=function(e){g.hasOwnProperty(e)&&delete g[e],0==Object.keys(g).length&&-1!=f&&(clearTimeout(f),f=-1,d=a),n.addConnection(p[e])},e.onDisconnected=function(n){l.log("Reconnector::onDisconnected()"),g.hasOwnProperty(n)||(g[n]=n),-1==f&&C()},e.keepConnected=function(n){p[n.getId()]=n,n.addConnectionListener(e,e.onConnected),n.addDisconnectionListener(e,e.onDisconnected)},e.destroy=function(){l.log("Reconnector::destroy()"),-1!=f&&(clearTimeout(f),f=-1);for(var n in g)delete g[n];for(var o in p)p[o].removeConnectionListener(e.onConnected),p[o].removeDisconnectionListener(e.onDisconnected),delete p[o];l.log("Reconnector::destroy() at end")}}n.exports=t},function(n,e,o){"use strict";function t(n){var e=this,t=null,i=null,c=null,r=null,l=null,a=null;if("undefined"==typeof window){i=o(0),a=o(11);var s=o(32);c=s.RTCPeerConnection,r=s.RTCSessionDescription,l=s.RTCIceCandidate}else t=window.sp?window.sp:window,i=t.Logger,a=t.DataChannelConnection,c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,l=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate;var u=null,d=null,f=null,p=null,g=null,C=null,w=i.getLogger("WebRtcPeerConnection"),h=new Array,b={optional:[{DtlsSrtpKeyAgreement:!0}]},m=new c(n,b),y=null,R=0;e.createDataChannelConnection=function(n){R++;var e=m.createDataChannel(R,{reliable:!0});e.onopen=function(){w.log("WebRtcPeerConnection::channel.onopen")},e.binaryType="arraybuffer",e.onmessage=function(){var o=new a(e);h.push(o),n(o)}},m.ondatachannel=function(n){var o=n.channel||n;if(w.log("WebRtcPeerConnection::ondatachannel() "+o),o.binaryType="arraybuffer",null==y)y=new a(o),o.onopen=e.onPrimaryDataChannelOpen;else{var t=new a(o);o.onopen=function(){w.log("WebRtcPeerConnection::temp.onopen"),o.send("OK"),h.push(t),p&&p.onAdditionalDataChannelOpen(u,t)}}},e.onPrimaryDataChannelOpen=function(n){w.log("WebRtcPeerConnection::onPrimaryDataChannelOpen "+n),h.push(y),p&&p.onPrimaryDataChannelOpen(u,y)},e.onAdditionalDataChannelOpen=function(n){w.log("WebRtcPeerConnection::onAdditionalDataChannelOpen "+n)},e.getDataChannelConnections=function(){return h},e.onPrimaryDataChannelClosed=function(n){w.log("WebRtcPeerConnectiononDataChannelClosed "+n),g.onDisconnected(u)},e.setDataChannelListener=function(n){p=n};var v=function(n){w.info("signaling state change:",n)},O=function(n){w.info("ice connection state change:",n),!g||"disconnected"!=m.iceConnectionState&&"closed"!=m.iceConnectionState||g.onDisconnected(u)},P=function(n){w.info("ice gathering state change:",n)},I=function(n){w.log("WebRtcPeerConnectiononIceCanditate() partnerId: "+u+" event: "+n),w.log("iceListener was "+d),null==n.candidate?w.log("All Ice candidates listed"):d.onIceCandidate(n.candidate,u)};m.onsignalingstatechange=v,m.oniceconnectionstatechange=O,m.onicegatheringstatechange=P,m.onicecandidate=I,e.close=function(){w.log("WebRtcPeerConnectionclose"),"closed"==m.signalingState&&"closing"==m.signalingState||m.close()},e.getPartnerId=function(){return u},e.setPartnerId=function(n){u=n},e.setIceListener=function(n){d=n,w.log("WebRtcPeerConnectionsetIceListener()"+n)},e.setStreamListener=function(n){f=n,m.onaddstream=function(n){e.onStream(n)},m.onremovestream=function(n){e.onRemoveStream(n)}},e.setConnectionListener=function(n){g=n},e.onStream=function(n){w.log("WebRtcPeerConnectiononStream"+n),f.onStream(n.stream,u)},e.onRemoveStream=function(n){w.log("WebRtcPeerConnectiononStream"+n),f.onRemoveStream(n.stream,u)},e.addStream=function(n){C=n,m.addStream(n)},e.createConnectionOffer=function(n){var o=null,t=m.createDataChannel("jsonrpcchannel",{reliable:!0});t.binaryType="arraybuffer",t.onopen=e.onPrimaryDataChannelOpen,y=new a(t),m.createOffer(function(e){w.log("peerConnection::createOffer called its callback: "+e),o=e,m.setLocalDescription(e,function(){n(m.localDescription,u)},function(n){w.log("WebRtcPeerConnectioncreateConnectionOffer() setLocalDescription error")},{})},function(n){w.log(n)})},e.onConnectionAnswerReceived=function(n){w.log("WebRtcPeerConnectiononConnectionAnswerReceived(), descriptor: "+n),m.setRemoteDescription(new r(n),function(){w.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned OK")},function(n){w.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned error "+n)})},e.onConnectionOfferReceived=function(n,e,o){w.log("WebRtcPeerConnectiononConnectionOfferReceived"),w.log("WebRtcPeerConnectiononConnectionOfferReceived trying to set remote description");var t=new r(n);m.setRemoteDescription(t,function(){w.log("WebRtcPeerConnectiononConnectionOfferReceived remote description set"),m.createAnswer(function(n){m.setLocalDescription(n,function(){o(m.localDescription)},function(n){w.log(n)})},function(n){w.log(n)})},function(n){w.log("WebRtcPeerConnectiononConnectionOfferReceived setting remote description failed "+n)})},e.onIceCandidateReceived=function(n){m.addIceCandidate(new l(n),function(){w.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate succeeded")},function(n){w.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate failed "+n)})}}n.exports=t},function(n,e,o){"use strict";function t(n,e){var t=this,i=null,c=null,r=null,l=null;"undefined"==typeof window?(c=o(0),r=o(2),l=o(3)):(i=window.sp?window.sp:window,c=i.Logger,r=i.RpcCommunicator,l=i.WebSocketConnection);var a=null,s=null,u=new r(n),d=new l,f=null,p=c.getLogger("WebSocketRpcConnection");t.setConnectionListener=function(n,e){s={object:n,listener:e}},t.setDisconnectionListener=function(n,e){a={object:n,listener:e}},t.onConnected=function(n){p.log("WebsocketRpcConnection::onConnected()"),s&&s.listener.call(s.object,n)},t.onDisconnected=function(n){p.log("WebSocketRpcConnection::onDisconnected()"),a&&a.listener.call(a.object,n)},t.callRpc=function(n,e,o,t){return u.callRpc(n,e,o,t)},t.connect=function(n,e){p.log("WebSocketRpcConnection::connect()"),u.setDisconnectionListener(t,t.onDisconnected),u.setConnectionListener(t,t.onConnected),d.connect(n,function(n){n&&e(n),f=u.addConnection(d,!0)})},t.close=function(){},t.getCommunicator=function(){return u}}n.exports=t},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_15__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_16__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_17__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_18__},function(n,e,o){"use strict";(function(n){function e(){var e=this,t=null,i=null,c=null,r=null,l=null,a=null,s=null,u=!1;"undefined"==typeof window?(c=o(0),l=o(2),a=o(26),s=o(14),r=o(16),i=o(22)):(t=window.sp?window.sp:window,c=t.Logger,l=t.RpcCommunicator,a=t.WebSocketServer,s=t.WebSocketRpcConnection);var d=c.getLogger("CommunicationHub"),f={host:"",port:"1979"},p=null,g=null,C=null,w=new Object,h=new Object,b=new Object,m=new Object,y=(new Object,null),R=null,v=null,O=new Array,P={listening:!1,connectedToParent:!1,localIps:[],localPort:"",parentHost:"",parentPort:"",clients:w},I=function(){g=null,P.localIps=null,P.localIps=[],w=null,w=new Object,h=null,h=new Object,P.clients=w},L=function(){if(C)return C;var n=new Array,e=i.networkInterfaces();return Object.keys(e).forEach(function(o){e[o].forEach(function(e){"IPv4"===e.family&&!1===e.internal&&n.push(e.address)})}),n};e.addStatusListener=function(n){O.push(n)};var _=function(){for(var n=0;n<O.length;n++)O[n].call(null,P)};e.onDisconnected=function(n){d.log("CommunicationHub::onDisconnected(connectionId: "+n+")\n"),w.hasOwnProperty(n)&&(e.notifyAllClientsInGroup(w[n].groupId,"onClientDisconnected",[w[n]]),delete h[w[n].groupId][n],delete w[n]),b.hasOwnProperty(n)&&(delete m[b[n].ip][n],delete b[n]),_()},e.registerAsHub=function(n,e,o,t){var i=y.getConnection(o).getRemoteAddress();d.log("CommunicationHub::registerAsHub(localIps: "+JSON.stringify(n)+" port: "+e+" connectionId: "+o+"), from: "+i+"\n"),b[o]={connectionId:o,ip:i,localIps:n,port:e},m.hasOwnProperty(i)||(m[i]=new Object),m[i][o]={connectionId:o,ip:i,localIps:n,port:e},t(null,"OK")},e.notifyAllClientsInGroup=function(n,e,o){if(h.hasOwnProperty(n))for(var t in h[n])y.callRpc(e,o,null,null,t)},e.registerAsClient=function(n,o,t,i,c){d.log("CommunicationHub::registerAsClient(clientId: "+n+", clientType: "+o+", groupId: "+t+", connectionId: "+i+")\n"),h.hasOwnProperty(t)||(h[t]=new Object),w[i]={clientId:i,clientType:o,groupId:t},h[t][i]={clientId:i,clientType:o,groupId:t},_(),c(null,i),e.notifyAllClientsInGroup(t,"onClientConnected",[{clientId:i,clientType:o,groupId:t}])},e.constructPipe=function(n,o,t,i){d.log("CommunicationHub::constructPipe(targetId: "+n+", originatorId: "+o+", connectionId: "+t+")\n"),y.callRpc("requestPipe",[t,o],e,function(){i(null,"Ok")},n)},e.registerAsPipe=function(n,e,o){d.log("CommunicationHub::registerAsPipe(targetId: "+n+", connectionId: "+e+")\n"),y.setupPipe(n,e),o(null,"Ok")},e.callClientRpc=function(n,o,t,i,c){d.log("CommunicationHub::callClientRpc(clientId: "+n+", method: '"+o+"', connectionId: "+i+")\n"),t.push(i),y.callRpc(o,t,e,c,n)},e.notifyAll=function(n,e,o){d.log("CommunicationHub::notifyAll(groupid: "+n+")\n")},e.getConnectedClients=function(n,e,o){d.log("CommunicationHub::getConnectedClients(groupId: "+n+", connectionId: "+e+")\n"),o(null,h[n])},e.getLocalHubs=function(n,e){d.log("CommunicationHub::getLocalHubs(connectionId: "+n+")\n");var o=y.getConnection(n).getRemoteAddress();e(null,m.hasOwnProperty(o)?m[o]:null)},e.onDisconnectedFromParent=function(){d.log("CommunicationHub::onDisconnectedFromParent()"),P.connectedToParent=!1,I(),_()},e.onConnectedToParent=function(){d.log("CommunicationHub::onConnectedToParent()"),d.log("CommunicationHub::connectToParent - Connected to the Parent Hub, now registering\n");var n=null;n=null==g||""==g?L():[g],P.localIps=n,d.log("CommunicationHub::onConnectedToParent() - calling registerAsHub()\n"),v.callRpc("registerAsHub",[n,p],e,function(n,e){d.log("CommunicationHub::connectToParent - Parent Hub replied to registerAsHub call: "+e+0),u=!0,P.connectedToParent=!0,_()}),P.connectedToParent=!0,_()};var D=function(n,o,t){d.log("connectToParent(host: "+n+", port: "+o+")\n"),v=new s(!0,!0),v.setDisconnectionListener(e,e.onDisconnectedFromParent),v.setConnectionListener(e,e.onConnectedToParent);var i={host:n,port:o};P.parentHost=n,P.parentPort=o,v.connect(i)};e.run=function(t,i){var c=null;if(t&&t.knownInterfaces&&(C=t.knownInterfaces),t)c=t;else{if(o.c[o.s]!==n)throw d.error("Communicationhub::run() Wrong parameters given to Communicationhub::run()"),new Error("Wrong parameters given to Communicationhub::run()");c=r(process.argv.slice(2),{string:["host","port","parenthost","parentport","sslcert","sslkey","sslauth"],default:{host:f.host,port:f.port}})}p=c.port,g=c.host,P.localPort=p,y=new l,R=c.webSocketServer?c.webSocketServer:new a,y.exposeRpcMethod("registerAsHub",e,e.registerAsHub),y.exposeRpcMethod("registerAsClient",e,e.registerAsClient),y.exposeRpcMethod("registerAsPipe",e,e.registerAsPipe),y.exposeRpcMethod("constructPipe",e,e.constructPipe),y.exposeRpcMethod("callClientRpc",e,e.callClientRpc),y.exposeRpcMethod("notifyAll",e,e.notifyAll),y.exposeRpcMethod("getConnectedClients",e,e.getConnectedClients),y.exposeRpcMethod("getLocalHubs",e,e.getLocalHubs),y.setDisconnectionListener(e,e.onDisconnected),R.setConnectionListener(y);var s={host:c.host,port:c.port};c.hasOwnProperty("sslcert")&&c.hasOwnProperty("sslkey")&&c.hasOwnProperty("sslauth")&&(s.isSsl=!0,s.sslCert=c.sslcert,s.sslKey=c.sslkey,s.sslAuthCert=c.sslauth),d.log("CommunicationHub::run - Trying to call listen() on the WebSocket server\n"),R.listen(s,function(n,e){n?(d.error("CommunicationHub::run()"+n),i&&i(n)):(d.log("CommunicationHub::run() - WebSocket server started\n"),P.listening=!0,_(),c.parenthost&&c.parentport?D(c.parenthost,c.parentport):i&&i())})}}if(n.exports=e,o.c[o.s]===n){(new e).run()}}).call(e,o(7)(n))},function(n,e,o){"use strict";function t(n){var e=null,o=[];return location.search.substr(1).split("&").forEach(function(t){o=t.split("="),o[0]===n&&(e=decodeURIComponent(o[1]))}),e}function i(n){for(var e=n+"=",o=document.cookie.split(";"),t=0;t<o.length;t++){for(var i=o[t];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return null}function c(n){var e=this,c=null,r=null,l=void 0!==n&&n;if("undefined"==typeof window)c=o(1),o(0),r=o(4);else{var a=window.sp?window.sp:window;c=a.Config,a.Logger,r=a.CommunicationClient}var s=c.getConfig(),u=s.connection.MAINURL,d=console,f=new Array,p=!1,g=null,C=-1,w=1,h=1e3,b=null,m=null,y=new r(!0,!0),R=null,v=null,O=null,P=null,I=null,L=null,_=null;e.connectToHubsWithOptions=function(n,o,t,i){y.exposeRpcMethod("getRtt",e,e.getRtt),y.connectToHubsWithOptions(n,o,t,function(n,e){n?(d.error("GameClient::connectWithOptions() "+n),i(n)):(m=e,i())})},e.connect=function(n,o,t,i,c){y.exposeRpcMethod("getRtt",e,e.getRtt),y.connect(n,o,t,i,function(n,e){n?(d.error("GameClient::connect() "+n),c&&c(n)):(m=e,c&&c())})},e.connectAsScreen=function(n,o,t,c){var r=u+n+"/connectiondetails",l=i(n+"_groupid");null!=l&&(r+="/"+l);var a=new XMLHttpRequest;d.log("Trying to make a xmlhttprequest to "+r),a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){d.log("Received from xhmlhttprequest: "+a.responseText);var n=JSON.parse(a.responseText);p=n.logging,g=n.loggerUrl,C=n.loggerMeasurementInterval,h=n.loggerBatchSize,o.innerHTML=n.controllerUrl,t.src=n.qrCodeUrl,e.connect(n.hubHost,n.hubPort,"screen",n.groupId,c)}},a.open("GET",r,!0),a.send()},e.connectAsController=function(n){var o=t("id"),c=t("host"),r=t("port");w=i("loggingId"),d.log("GameClient::loggingId "+w),w||(w=Math.floor(1e4*Math.random())),e.connect(c,r,"controller",o,n)},e.notifyScreens=function(n,e){var o=y.getClientsByType("screen");d.log("GameClient::notifyScreens(), screens were: "+JSON.stringify(o));for(var t in o)y.notifyClient(t,n,e)},e.callClientRpc=function(n,e,o,t,i){y.callRpcOnClient(n,e,o,t,i)},e.notifyController=function(n,e,o){d.log("GameClient::notifyController(), id: "+n),y.notifyClient(n,e,o)},e.exposeRpcMethod=function(n,e,o){y.exposeRpcMethod(n,e,o)},e.sendLogs=function(){var n=new XMLHttpRequest;d.log("Trying to send logs to "+g);var e=JSON.stringify(f);f.splice(0,f.length),n.open("POST",g,!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(e)},e.getRtt=function(n,e,o,t){w&&t(null,[w,n,y.getConnectionType(e)])},e.getRttReturned=function(n,o){d.log("GameClient::getRttReturned() loggingId: "+o[0]+" rtt: "+(Date.now()-o[1])+" connectionType: "+o[2]),f.push({loggingId:o[0],timestamp:o[1],rtt:Date.now()-o[1],connectionType:o[2]}),f.length>=h&&e.sendLogs()},e.measureRtts=function(){d.log("GameClient::measureRtts");var n=y.getClientsByType("controller");for(var o in n)d.log("GameClient::measureRtts "+o),y.callRpcOnClient(o,"getRtt",[Date.now()],e,e.getRttReturned)},e.onClientConnected=function(n,o,t){d.log("GameClient::onClientConnected() "+n.getClientId()+" "+n.getClientType()),!b&&p&&(b=setInterval(e.measureRtts,C)),"screen"==n.getClientType()&&(O&&O.listener.call(O.object,n.getClientId()),"undefined"!=typeof RTCPeerConnection&&0==l&&y.upgradeToWebRtc(n.getClientId())),"controller"==n.getClientType()&&R&&R.listener.call(R.object,n.getClientId())},e.onClientDisconnected=function(n,e,o){d.log("GameClient::onClientDisconnected() '"+n.getClientId()+"'"),"screen"==n.getClientType()&&P&&P.listener.call(P.object,n.getClientId()),"controller"==n.getClientType()&&v&&v.listener.call(v.object,n.getClientId())},e.onConnectionTypeUpdated=function(n,e){d.log("GameClient::onConnectionTypeUpdated() clientType: "+n.getClientType()),null!=I&&"screen"==n.getClientType()&&I.listener.call(I.object,e,n.getClientId())},e.onHubConnected=function(){L&&L.listener.call(L.object)},e.onHubDisconnected=function(){_&&_.listener.call(_.object)},e.setControllerConnectionListener=function(n,e){R={object:n,listener:e}},e.setControllerDisconnectionListener=function(n,e){v={object:n,listener:e}},e.setScreenConnectionListener=function(n,e){O={object:n,listener:e}},e.setScreenDisconnectionListener=function(n,e){P={object:n,listener:e}},e.setScreenConnectionTypeListener=function(n,e){I={object:n,listener:e}},e.setHubConnectionListener=function(n,e){L={object:n,listener:e}},e.setHubDisconnectionListener=function(n,e){_={object:n,listener:e}},e.destroy=function(){y.destroy(),y=null},y.setClientListener(e),y.setConnectionTypeListener(e),y.setGlobalHubConnectionListener(e,e.onHubConnected),y.setGlobalHubDisconnectionListener(e,e.onHubDisconnected)}n.exports=c},function(n,e,o){"use strict";(function(n){function e(){var n=this,e=null,t=null,i=null,c=null,r=null,l=null,a=null,s=null;"undefined"==typeof window?(t=o(15),o(17),i=o(16),c=o(1),r=o(0),l=o(25),o(2),o(6),a=o(3),s=o(4)):(e=window.sp?window.sp:window,c=e.Config,r=e.Logger);var u=c.getConfig(),d=r.getLogger("SpaceifyPiper"),f=u.spaceifyPiper.DEFAULT_GROUP,p=(u.spaceifyPiper.HTTP_ADDRESS,u.spaceifyPiper.SERVER_ADDRESS),g=new Object,C=new Object,w=(new Object,new s);n.onTunnelDisconnected=function(n){d.log("SpaceifyPiper::onTunnelDisconnected() "+n),g.hasOwnProperty(n)&&(g[n].close(),delete g[n]),C.hasOwnProperty(n)&&(C[n].close(),delete C[n])},n.onBinary=function(n,e,o){g.hasOwnProperty(o)&&g[o].send(n)},n.onTcpSocketDisconnected=function(n){d.log("SpaceifyPiper::onTcpSocketDisconnected()"),w.closeDirectConnection(n)},n.tunnelTcp=function(e,o,t,i,c){d.log("SpaceifyPiper::tunnelTcp(host: "+e+", port: "+o+", callerId: "+t+", connectionId: "+i+")\n");g.hasOwnProperty(i)||(g[i]=new l(e,o,function(n){w.sendBinaryOnConnection(i,h(n))}),g[i].setId(i),g[i].setDisconnectionListener(n,n.onTcpSocketDisconnected),d.log("Calling connect on TCP socket"),g[i].connect(function(){d.log("TCPSocket connect returned"),console.log("typeof callback oli "+typeof c),c(null,"Ok")}))},n.tunnelWebSocket=function(n,e,o,t){d.log("SpaceifyPiper::tunnelWebSocket(options: "+JSON.stringify(n)+", callerId: "+e+"), connectionId: "+o+"\n");var i=new a;i.connect(n,function(){d.log("SpaceifyPiper::tunnelWebSocket - Connected to host: "+n.host+", port: "+n.port+"\n"),w.pipeToExternalConnection(o,i),t(null,"Ok")})},n.closeAllTcpTunnels=function(){for(var n in g)g[n].close(),delete g[n]},n.run=function(e,o){var c,r,l,a=!0;if(w.exposeRpcMethod("tunnelTcp",n,n.tunnelTcp),w.exposeRpcMethod("tunnelWebSocket",n,n.tunnelWebSocket),r=e||i(process.argv.slice(2),{string:["groupId"]}),r.groupId)l=r.groupId;else{try{t.accessSync("/var/lib/spaceify/data/db/edge.id",t.F_OK)}catch(n){a=!1}a&&(c=t.readFileSync("/var/lib/spaceify/data/db/edge.id","utf8"),c=c.split(","),l=6==c.length?c[1]:f)}r.hasOwnProperty("host")||(r.host=p.host),r.hasOwnProperty("port")||(r.port=p.port),w.setDirectConnectionDisconnectionListener(n,n.onTunnelDisconnected),w.setBinaryListener(n),w.connectWithOptions({host:r.host,port:r.port,isSsl:!1},"piper",l,function(n,e){d.log("SpaceifyPiper::connect - Connected to the CommunicationHub, givenId: "+e+"\n"),o&&o(n,e)})};var h=function(n){for(var e=new ArrayBuffer(n.length),o=new Uint8Array(e),t=0;t<n.length;++t)o[t]=n[t];return o}}if(n.exports=e,o.c[o.s]===n){(new e).run()}}).call(e,o(7)(n))},function(n,e){e.endianness=function(){return"LE"},e.hostname=function(){return"undefined"!=typeof location?location.hostname:""},e.loadavg=function(){return[]},e.uptime=function(){return 0},e.freemem=function(){return Number.MAX_VALUE},e.totalmem=function(){return Number.MAX_VALUE},e.cpus=function(){return[]},e.type=function(){return"Browser"},e.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},e.networkInterfaces=e.getNetworkInterfaces=function(){return{}},e.arch=function(){return"javascript"},e.platform=function(){return"browser"},e.tmpdir=e.tmpDir=function(){return"/tmp"},e.EOL="\n"},function(n,e,o){n.exports={ClientInfo:o(9),WebRtcConnector:o(6),CommunicationClient:o(4),GameClient:o(20),RpcCommunicator:o(2),WebRtcPeerConnection:o(13),WebSocketRpcConnection:o(14),CallbackBuffer:o(8),WebSocketConnection:o(3),DataChannelConnection:o(11),Config:o(1),SpBaseConfig:o(5),Logger:o(0),Reconnector:o(12),ConnectionGuard:o(10),CommunicationHub:o(19),SpaceifyPiper:o(21)}},function(n,e,o){"use strict";var t={logger:{loggerConfigOverride:{all:!0,myoverride:123,mydefault2:3},defaultLoggerConfig:{log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null,mydefault1:1,mydefault2:2},CallbackBuffer:{log:!0,dir:!0,info:!0,error:!0,warn:!0},Client:{log:!0,dir:!0,info:!0,error:!0,warn:!0},CommunicationClient:{log:!0,dir:!0,info:!0,error:!0,warn:!0},CommunicationHub:{log:!0,dir:!0,info:!0,error:!0,warn:!0},DataChannelConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},RpcCommunicator:{log:!0,dir:!0,info:!0,error:!0,warn:!0},SpaceifyPiper:{log:!0,dir:!0,info:!0,error:!0,warn:!0},TcpSocket:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebRtcConnector:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebRtcPeerConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebSocketConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebSocketRpcConnection:{log:!0,dir:!0,info:!0,error:!0,warn:!0},WebSocketServer:{log:!0,dir:!0,info:!0,error:!0,warn:!0}},testValue:"TestValueFromSpConfig"};Object.freeze(t),n.exports=t},function(n,e,o){"use strict";function t(n,e,t){var i=this,c=null,r=null,l=null,a=null;"undefined"==typeof window?(l=o(17),a=o(0)):(r=window.sp?window.sp:window,a=r.Logger);var s=a.getLogger("TcpSocket"),u=n,d=e,f="created",p=new Array,g=null,C=null;i.setId=function(n){c=n},i.setDisconnectionListener=function(n,e){C={obj:n,listener:e}},i.connect=function(n){f="connecting",null==g&&(g=new l.Socket,g.setNoDelay(!0),g.on("data",function(n){t(n)}),g.on("close",function(){"open"==f&&(f="closed"),C&&C.listener.call(C.obj,c)}),g.on("end",function(){"open"==f&&(f="closed")}),g.on("error",function(n){s.log("!!!!!!!!!!!!! oError !!!!!!!!!!!!"),"open"==f&&(f="closed",i.connect(function(){}))}));try{g.connect(d,u,function(){f="open",n(null,"Ok")})}catch(n){s.log(n)}},i.close=function(){g.destroy(),s.log("TcpSocket::close() destroy() called on socket")},i.send=function(n){p.push(n),"open"!=f?"closed"==f&&i.connect(function(){w(n)}):w(n)};var w=function(n){g.write(h(n),null,function(){})},h=function(n){for(var e=new Buffer(n.byteLength),o=new Uint8Array(n),t=0;t<e.length;++t)e[t]=o[t];return e}}n.exports=t},function(n,e,o){"use strict";function t(){var n=this,e=null,t=null,i=null,c=null,r=null,l=null,a=null,s=null;"undefined"==typeof window?(t=o(15),e=o(31),i=o(28),c=o(29),l=o(18).server,r=o(0),a=o(3)):(s=window.sp?window.sp:window,r=s.Logger);var u=r.getLogger("WebSocketServer"),d={},f=null,p=null,g=null;n.setConnectionListener=function(n){f=n},n.listen=function(n,o){try{if(u.log("WebSocketServer::listen()"),d.host=n.host||null,d.port=n.port||"",d.isSsl=n.isSsl||!1,d.sslKey=n.sslKey||"",d.sslCert=n.sslCert||"",d.sslAuthCert=n.sslAuthCert||"",d.owner=n.owner||"-",d.connectionListener=n.connectionListener||null,d.unknMethodListener=n.unknownMethodListener||null,d.protocol=d.isSsl?"wss":"ws",d.class="WebSocketServer",d.isSsl){u.log("Trying to start https server: "+JSON.stringify({key:d.sslKey,cert:d.sslCert,ca:d.sslAuthCert}));var r=t.readFileSync(d.sslKey),s=t.readFileSync(d.sslCert),C=t.readFileSync(d.sslAuthCert,"utf8");g=c.createServer({key:r,cert:s,ca:C},function(n,e){e.writeHead(501),e.end("Not implemented")})}else g=i.createServer(function(n,e){e.writeHead(501),e.end("Not implemented")});u.log("WebSocketServer::listen() trying to call webServer.listen() options.host: "+d.host+" options.port: "+d.port),g.listen(d.port,d.host,511,function(){u.log("webserver of websocketserver listening"),o(null,!0)}),g.on("error",function(n){u.error("WebSocketServer::listen() failed to listen "+n),o(n,null)}),u.log("Creating WSServer"),p=new l({httpServer:g,autoAcceptConnections:!1,keepalive:!0,keepaliveInterval:6e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4}),p.on("request",function(n){try{var o=new a;o.setSocket(n.accept("json-rpc",n.origin)),o.setRemoteAddress(n.remoteAddress),o.setRemotePort(n.remotePort),o.setOrigin(n.origin);var t=e.parse(n.resourceURL,!0).query;u.log("WebSocketServer::listen() accepting connection, given id was "+t.id),t&&t.id&&o.setId(t.id),f.addConnection(o)}catch(n){return void u.log(n)}}),p.on("close",function(n,e,o){})}catch(n){u.log(n)}},n.close=function(){try{p&&(p.shutDown(),p=null),g&&(g.close(),g=null)}catch(n){u.log(n)}}}n.exports=t},function(n,e,o){function t(n){return o(i(n))}function i(n){var e=c[n];if(!(e+1))throw new Error("Cannot find module '"+n+"'.");return e}var c={"./config.js":1,"./spbaseconfig.js":5,"./spconfig.js":24};t.keys=function(){return Object.keys(c)},t.resolve=i,n.exports=t,t.id=27},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_28__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_29__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_30__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_31__},function(n,e){n.exports=__WEBPACK_EXTERNAL_MODULE_32__}])});
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("path"),require("sessionstorage"),require("urlutils")):"function"==typeof define&&define.amd?define("spl",["path","sessionstorage","urlutils"],n):"object"==typeof exports?exports.spl=n(require("path"),require("sessionstorage"),require("urlutils")):e.spl=n(e.path,e.sessionstorage,e.urlutils)}(this,function(__WEBPACK_EXTERNAL_MODULE_19__,__WEBPACK_EXTERNAL_MODULE_20__,__WEBPACK_EXTERNAL_MODULE_21__){return function(e){function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=13)}([function(e,n,t){"use strict";(function(n,o){function r(e,t){var r=this,i="undefined"==typeof window;r.RETURN=1;var s="log",a="dir",l="info";r.ERROR="error";var u=r.ERROR,c="warn";r.FORCE="force";var d=r.FORCE,f={};f[s]="[i] ",f[a]="[d] ",f[l]="[i] ",f[u]="[e] ",f[c]="[w] ",f[d]="",f.stdout="";var p=!0,g=e||{};g[s]=void 0===g[s]||g[s],g[a]=void 0===g[a]||g[a],g[l]=void 0===g[l]||g[l],g[u]=void 0===g[u]||g[u],g[c]=void 0===g[c]||g[c],g[d]=!0,g.stdout=!0,r.log=function(){w(s,!1,arguments)},r.dir=function(){w(a,!1,arguments)},r.info=function(){w(l,!1,arguments)},r.error=function(){w(u,!1,arguments)},r.warn=function(){w(c,!1,arguments)},r.force=function(){w(d,!1,arguments)},r.stdout=function(){w("stdout",!0,arguments)},r.log=function(){},r.dir=function(){},r.info=function(){},r.error=function(){},r.warn=function(){},r.force=function(){},r.stdout=function(){};var w=function(e,o){if(g[e]||e==d){for(var s="",w=r.convertArguments(arguments[2]),h=null,y=0;y<w.length;y++)h="string"==typeof w[y]?w[y]:JSON.stringify(w[y]),s+=(""!=s&&"\n"!=s&&"\r"!=s&&"\r\n"!=s?" ":"")+h;if(e==u&&(s+=(new Error).stack),s=s.replace(/[\x00-\x09\x0b-\x0c\x0e-\x1f]/g,""),!o&&p){s=(new Date).toISOString().replace(/T/," ").replace(/\..+/,"")+" "+f[e]+"["+t+"] "+s}i?o?n.stdout.write(s):console.log(s):e==a&&console.dir?console.dir(s):e==u&&console.error?console.error(s):e==l&&console.info?console.info(s):e==c&&console.warn?console.warn(s):console.log(s)}};r.setOptions=function(e){if(void 0!==e.enabled)for(var n in e.enabled)g[n]=e.enabled[n];void 0!==e.showLabels&&(p=e.showLabels)},r.clone=function(e){var n=e.getEnabled();g[s]=n[s],g[a]=n[a],g[l]=n[l],g[u]=n[u],g[c]=n[c]},r.getEnabled=function(){return g},r.cloneInstanceToBaseConfiguration=function(){var e,n="undefined"==typeof window?o:window;if(n.splBaseConfig_&&n.splBaseConfig_.logger){e=n.splBaseConfig_.logger;for(var r in e)r!=t&&(e[r][s]=g[s],e[r][a]=g[a],e[r][l]=g[l],e[r][u]=g[u],e[r][c]=g[c])}},r.convertArguments=function(){return 0==Object.keys(arguments[0]).length?[""]:Array.prototype.slice.call(arguments[0])}}r.createLogger_=function(e){var n,o;if("undefined"==typeof window)try{o=t(1)}catch(e){o=t(16)("./src/config.js")}else"undefined"!=typeof window&&(n=window.spl?window.spl:window,o=n.Config?n.Config:null);var i=o.getConfig(),s={};o.overrideConfigValues(s,i.logger.defaultLoggerConfig),i.logger.hasOwnProperty(e)&&o.overrideConfigValues(s,i.logger[e]),o.overrideConfigValues(s,i.logger.globalConfigOverride);var a=void 0!==s.all?s.all:null;return null!==a&&(s.log=a,s.dir=a,s.info=a,s.error=a,s.warn=a),new r(s,e)},r.getLogger=function(e){e||(e="mainlog");var n=null;return n="undefined"==typeof window?o:window,n.hasOwnProperty("splLoggerInstances_")||(n.splLoggerInstances_=new Object),n.splLoggerInstances_.hasOwnProperty(e)||(n.splLoggerInstances_[e]=r.createLogger_(e)),n.splLoggerInstances_[e]},e.exports=r}).call(n,t(9),t(5))},function(module,exports,__webpack_require__){"use strict";(function(global,process,module){function Config(){var self=this,baseConfig=null,overridingConfig=null,config=null,path=null,doRequire=function(module){return eval("require")(module)},globalObj="undefined"==typeof window?global:window;if(globalObj.splBaseConfig_,baseConfig=globalObj.splBaseConfig_,"undefined"==typeof window){if(path=__webpack_require__(19),!baseConfig)try{var apipath="./src";baseConfig=doRequire(path.resolve("./src","splbaseconfig.js"))}catch(e){baseConfig=__webpack_require__(4)}baseConfig||process.exit(1);try{overridingConfig=doRequire(module.parent.splconfig),Config.overrideConfigValues(baseConfig,overridingConfig)}catch(e){}finally{try{overridingConfig=doRequire("splconfig"),Config.overrideConfigValues(baseConfig,overridingConfig)}catch(e){}finally{try{overridingConfig=doRequire(path.resolve(process.cwd(),"splconfig.js")),Config.overrideConfigValues(baseConfig,overridingConfig)}catch(e){}}}}else if("undefined"!=typeof window){var lib=window;window.spl&&(lib=window.spl),baseConfig||(baseConfig=lib.SplBaseConfig),lib.SplConfig&&Config.overrideConfigValues(baseConfig,lib.SplConfig)}globalObj.splBaseConfig_=baseConfig,self.getConfig=function(){return baseConfig}}Config.overrideConfigValues=function(e,n){for(var t in n)try{n[t].constructor==Object?e[t]=Config.overrideConfigValues(e[t],n[t]):e[t]=n[t]}catch(o){e[t]=n[t]}return e},Config.destroySingleton=function(){var e=null;e="undefined"==typeof window?global:window,e.splConfigInstance_=null},Config.getConfig=function(){var e=null;return e="undefined"==typeof window?global:window,e.splConfigInstance_||(e.splConfigInstance_=new Config,Object.freeze(e.splConfigInstance_)),e.splConfigInstance_.getConfig()},module.exports=Config}).call(exports,__webpack_require__(5),__webpack_require__(9),__webpack_require__(12)(module))},function(e,n,t){"use strict";(function(n){function o(){var e=this,n=null,o=null,r=null;"undefined"==typeof window?(o=t(7),r=t(20)):(n=window.spl?window.spl:window,window.spe?window.spe:window,o=n.PiperClient,r=window.sessionStorage);var i=null;e.Utf8ArrayToStr=function(e){var n,t,o,r,i,s;for(n="",o=e.length||e.byteLength,t=0;t<o;)switch((r=e[t++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(r);break;case 12:case 13:i=e[t++],n+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[t++],s=e[t++],n+=String.fromCharCode((15&r)<<12|(63&i)<<6|(63&s)<<0)}return n},e.ab2str=function(n){return e.Utf8ArrayToStr(n)},e.str2ab=function(e){for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),o=0,r=e.length;o<r;o++)t[o]=e.charCodeAt(o);return n},e.toab=function(e){for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),o=0,r=e.length;o<r;o++)t[o]=e.charCodeAt(o);return n},e.getSession=function(e){return r.getItem(e)?r.getItem(e):""},e.setSession=function(e,n){n||(n=""),r.setItem(e,n.trim())},e.open=function(e,n,t,o,r){var i,s,a,l,u,c,d,f=new window.SpaceifyCore,p=new window.SpaceifyNetwork;f.getApplicationURL(e,function(f,g){if(f)return void("function"==typeof r&&r(null));a=p.isSecure()?g.securePort:g.port,u=p.getEdgeURL({forceSecureProtocol:!1,withEndSlash:!0}),g.implementsWebServer&&a?(s=u,l=u):(s=p.externalResourceURL(e,{forceSecureProtocol:!1,withEndSlash:!0}),l=s),i=p.parseQuery(n),i.sp_port=a,i.sp_host=encodeURIComponent(l),i.sp_path=encodeURIComponent(n),i.spe_host=encodeURIComponent(u),c=s+"remote.html"+p.remakeQueryString(i,[],{},"",!0),d=window.openOriginal(c,t||"_blank",o||""),d.addEventListener("load",function(){"function"==typeof r&&r(this)})})},e.getPiperClient=function(){return null===i&&(i=new o),i}}n._loaderUtil=null,o.getLoaderUtil=function(){return null===_loaderUtil&&(_loaderUtil=new o),_loaderUtil},o.prototype.SERVER_ADDRESS=function(){var e="testgroup";if("undefined"!=typeof window){var n=window.location.hostname.split(".");3==n.length&&"edge"!=n[0]&&(e=n[0])}return{host:"spaceify.net",port:1979,groupId:e,isSsl:!1}}(),o.prototype.WEBRTC_CONFIG=function(){return{iceServers:[{url:"stun:kandela.tv"},{url:"turn:kandela.tv",username:"webrtcuser",credential:"jeejeejee"}]}}(),"undefined"!=typeof window&&(window.openOriginal=window.open,window.open=function(e,n,t,r,i){o.getLoaderUtil().open(e,n,t,r,i)}),e.exports=o,n.SERVER_ADDRESS=e.exports.SERVER_ADDRESS,n.WEBRTC_CONFIG=e.exports.WEBRTC_CONFIG}).call(n,t(5))},function(e,n,t){"use strict";function o(e){var n=this;n.path=e&&e.path?e.path:"",n.code=e&&e.code?e.code:"",n.message=e&&e.message?e.message:"";n.set=function(e){n.path=e.path||"",n.code=e.code||"",n.message=e.message||""},n.getAsObject=function(){return{code:n.code,codes:[n.code],message:n.message,messages:[n.message],path:n.path,paths:[n.path]}},n.getMessage=function(){return n.message},n.getCode=function(){return n.code},n.getPath=function(){return n.path},n.pre=function(e){n.path=e;var t=Array.prototype.slice.call(arguments);return t[0]=n.getAsObject(),n.make.apply(this,t)},n.preFmt=function(e,t){return n.path=e,n.makeFmt(n.getAsObject(),t)},n.make=function(){var e,n="",t=[],o="",r=[],i="",s=[];for(e=0;e<arguments.length;e++){var a=arguments[e];a.messages?(t=t.concat(a.paths),r=r.concat(a.codes),s=s.concat(a.messages)):(t.push(a.path?a.path:""),r.push(a.code?a.code:""),s.push(a.message?a.message:a.toString()))}for(e=0;e<s.length;e++)r[e]&&(o+=(""!=o?", ":"")+r[e]),t[e]&&(n+=(""!=n?", ":"")+t[e]),i+=(""!=i?" ":"")+s[e];return{code:o,message:i,path:n,codes:r,paths:t,messages:s}},n.makeFmt=function(e,t){return e.message=n.replace(e.message,t),e.messages&&e.messages.length>0&&(e.messages[0]=e.message),n.make(e)},n.makeErrorObject=function(e,n,t){var o=void 0!==e?e:"",r=void 0!==t?t:"",i=void 0!==n?n:"";return{code:o,codes:[o],message:i,messages:[i],path:r,paths:[r]}},n.errorFromObject=function(e){return"string"==typeof e&&(e=JSON.parse(e)),n.make(n.makeErrorObject(e.code,e.message,e.path))},n.typeToErrorObject=function(e){return e?"string"==typeof e?e=n.makeErrorObject("",e,""):e.codes||e.messages||e.paths||(e=n.make(e)):e=n.makeErrorObject("###","###","###"),e},n.errorToString=function(e,t,o){var r="",i="",s="",a="";if("string"==typeof e)r+=e;else if(e.message&&!e.messages)r+=e.message;else if(e.pop)for(;e.length>0;)r+=(""!=r?" ":"")+n.errorToString(e.shift());else if(e.messages)for(var l=0;l<e.messages.length;l++)i=o&&e.codes[l]?e.codes[l]:null,s=t&&e.paths[l]?e.paths[l]:null,a=n.ucfirst(e.messages[l]),a=n.endWithDot(a),r+=""!=r?" ":"",r+=s||"",r+=i?(s?" - ":"")+i:"",r+=(i||s?" ":"")+a;return r},n.replace=function(e,n,t){var o=t||"";for(var r in n)void 0!==n[r]&&(e=e.replace(r,n[r]));return e=e.replace(/\s~[a-zA-Z0-9]*\s/g," "+o+" "),e=e.replace(/~[a-zA-Z0-9]*\s/g," "+o+" "),e=e.replace(/\s~[a-zA-Z0-9]*/g,o),e=e.replace(/~[a-zA-Z0-9]+/g,o)},n.ucfirst=function(e){return e=e.trim(),e.charAt(0).toUpperCase()+e.slice(1)},n.endWithDot=function(e){return e=e.trim(),"."!=e.charAt(e.length-1)&&(e+="."),e}}e.exports=o},function(e,n,t){"use strict";var o={logger:{loggerConfigOverride:{all:!0,myoverride:123,mydefault2:3},defaultLoggerConfig:{log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null,mydefault1:1,mydefault2:2},SpXMLHttpRequest:{log:!0,dir:!0,info:!0,error:!0,warn:!0},SpaceifyLoader:{log:!0,dir:!0,info:!0,error:!0,warn:!0},PiperClient:{log:!1,dir:!1,info:!1,error:!0,warn:!1},LoaderUtil:{log:!0,dir:!0,info:!0,error:!0,warn:!0},HttpParser:{log:!0,dir:!0,info:!0,error:!0,warn:!0}},testValue:"TestValueFromBaseConfig"};e.exports=o},function(e,n){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(e,n,t){"use strict";function o(){var e=this,n=null,o=0,r=null,i="",s={},a=null,l=null,u=null,c=null;"undefined"==typeof window?c=t(0):(u=window.spl?window.spl:window,c=u.Logger);c.getLogger("HttpParser");e.getStatusCode=function(){return parseInt(a)},e.getStatusText=function(){return l},e.getContentBegin=function(){return r},e.getHeaderSize=function(){return o},e.getHeaderValueAsInt=function(e){return e=e.toLowerCase(),s.hasOwnProperty(e)?parseInt(s[e]):null},e.getHeaderValue=function(e){if(e=e.toLowerCase(),s.hasOwnProperty(e))return s[e]},e.getHeaders=function(){return s},e.getRawHeaders=function(){return i};var d=function(e){for(var n=0;n<e.byteLength;n+=1)if(n+4<e.byteLength&&13==e[n]&&10==e[n+1]&&13==e[n+2]&&10==e[n+3]){r=n+4;break}o=r||e.byteLength},f=function(e){i="",s={},n=r?String.fromCharCode.apply(null,e.subarray(0,r)):String.fromCharCode.apply(null,e);var t=n.split("\n"),o=t[0].split(" ");a=o[1],l=o.length>=3?o[2]:"OK";for(var u=1;u<t.length;u++){var c=t[u].indexOf(":");if(c>-1){var d=t[u].substring(0,c);d=d.toLowerCase();var f="";t[u].length>c&&(f=t[u].substring(c+1).trim()),s[d]=d in s?s[d]+", "+f:f,i+=(""!=i?"\r\n":"")+d+": "+f}}};e.parse=function(e){d(e),f(e)}}e.exports=o},function(e,n,t){"use strict";function o(){var e=this,n=null,o=null,r=null,i=null,s=null;"undefined"==typeof window?(n="../libs/spaceifyconnect.bundle.js",o=!function(){var e=new Error('Cannot find module "."');throw e.code="MODULE_NOT_FOUND",e}(),s=o.CommunicationClient,r=t(0),i=o.Logger):(n=window.spl?window.spl:window,o=window.sp?window.sp:window,r=n.Logger,i=o.Logger,s=o.CommunicationClient);var a=r.getLogger("PiperClient");a.cloneInstanceToBaseConfiguration();var l=i.getLogger("CommunicationClient");l.setOptions({enabled:{log:!1,dir:!1,info:!1,error:!1,warn:!1},showLabels:!1}),l.cloneInstanceToBaseConfiguration();var u=new s,c=new Object,d=new Object,f=null,p=null,g=null,w=null;e.setCookies=function(e){w=e},e.getCookies=function(){return w},e.sendTcpBinary=function(e,n){u.sendBinaryOnConnection(e,n)},e.createTcpTunnel=function(n,t,o,r){a.log("PiperClient::createTcpTunnel(host: "+n+", port: "+t+")\n");var i=n+t;for(var s in c)if(c[s].hostnameAndPort==i)return c[s].listeners.push(o),void r(s);u.createDirectConnection(p,function(s){a.log("PiperClient::createTcpTunnel - Direct Connection Ready for TCP tunnel\n"),u.callRpcOnConnection(s,"tunnelTcp",[n,t],e,function(){a.log("PiperClient::createTcpTunnel - Tunnel pipe ready to host: "+n+", port: "+t+"\n"),c[s]={listeners:[o],hostnameAndPort:i},r(s)})})},e.closeTunnel=function(e,n){c.hasOwnProperty(e)?(c[e].listeners.shift(),n&&c[e].listeners.length>0&&(console.log("There was unhandled binary of "+n.byteLength+" bytes"),c[e].listeners[0](n))):u.closeDirectConnection(e)},e.createWebSocketTunnel=function(n,t,o){a.log("PiperClient::createWebSocketTunnel(options: "+JSON.stringify(n)+")\n"),u.createDirectConnection(p,function(r){a.log("PiperClient::createWebSocketTunnel - Pipe ready for WebSocket, tunnelId: "+r+"\n"),u.callRpcOnConnection(r,"tunnelWebSocket",[n],e,function(){a.log("PiperClient::createWebSocketTunnel - WebSocket pipe ready to host: "+n.host+", port: "+n.port+"\n"),d[r]=t,o(r)})})},e.exposeRpcMethod=function(e,n,t){u.exposeRpcMethod(e,n,t)},e.callClientRpc=function(e,n,t,o,r){u.callRpcOnConnection(e,n,t,o,r)},e.setBinaryListener=function(e){g=e},e.onBinary=function(e,n,t){c.hasOwnProperty(t)&&c[t].listeners.length>0&&c[t].listeners[0](e)},e.onClientDisconnected=function(e){},e.onClientConnected=function(e){e&&(a.log("PiperClient::onClientConnected - "+JSON.stringify(e)+"\n"),"piper"==e.getClientType()&&(a.log("PiperClient::onClientConnected - clientType is 'piper', trying to build a direct connection to it\n"),u.createDirectConnection(e.getClientId(),function(n){a.log("PiperClient::onClientConnected - Direct connection ready, pipeId: "+n+"\n"),p=e.getClientId(),f&&f()})))},e.upgradeToWebRtc=function(e){u.upgradeToWebRtc(p,function(){a.log("PiperClient::upgradeToWebRtc - targetId: "+p+" - Completed\n"),e()})},e.sendBinary=function(e){u.sendBinaryToClient(p,e)},e.connect=function(n,t,o,r,i){a.log("PiperClient::connect(host: "+n+", port: "+t+", isSsl: "+o+", groupId: "+r+")\n"),f=i,u.setClientListener(e),u.setBinaryListener(e),u.connectWithOptions({host:n,port:t,isSsl:!1},"piperclient",r,function(e){a.log("PiperClient::connect - Hub Connection succeeded, givenId: "+e+"\n")})};var h=0;e.testPing=function(e){u.createDirectConnection(p,function(n){y(0,n,e)})};var y=function(n,t,o){if(1001==++n)return void o(h,1e3);var r=Date.now();u.callRpcOnConnection(t,"hello",[],e,function(e,i){h+=Date.now()-r,a.log("index: "+n+", time: "+(Date.now()-r)/1e3+", length: "+i.length+"\n"),y(n,t,o)})}}e.exports=o},function(e,n,t){"use strict";function o(e){var n=this,o="undefined"==typeof window,r=null,i=null;if(o){var s="/var/lib/spaceify/code/";try{r=t(0)}catch(e){r=t(17)(s+"logger")}try{i=t(3)}catch(e){i=t(18)(s+"spaceifyerror")}}else"undefined"!=typeof window&&(r=window.Logger?window.Logger:null,i=window.SpaceifyError?window.SpaceifyError:null);var a=new i,l=r.getLogger(e);n.log=function(e){l.log(e)},n.dir=function(e){l.dir(e)},n.info=function(e){l.info(e)},n.error=function(e,n,t,o){var r=a?a.errorToString(e,n,t):e;return o==l.ERROR?l.error(l.ERROR,!1,[r]):o==l.FORCE&&l.force(r),r},n.warn=function(e){l.warn(e)},n.force=function(e){l.force(e)},n.stdout=function(e){l.stdout(e)}}e.exports=o},function(e,n){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(c===setTimeout)return setTimeout(e,0);if((c===t||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(n){try{return c.call(null,e,0)}catch(n){return c.call(this,e,0)}}}function i(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(n){try{return d.call(null,e)}catch(n){return d.call(this,e)}}}function s(){w&&p&&(w=!1,p.length?g=p.concat(g):h=-1,g.length&&a())}function a(){if(!w){var e=r(s);w=!0;for(var n=g.length;n;){for(p=g,g=[];++h<n;)p&&p[h].run();h=-1,n=g.length}p=null,w=!1,i(e)}}function l(e,n){this.fun=e,this.array=n}function u(){}var c,d,f=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:t}catch(e){c=t}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}}();var p,g=[],w=!1,h=-1;f.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];g.push(new l(e,n)),1!==g.length||w||r(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,n,t){"use strict";function o(){var e=this,n=null,o=null,r=null,i=null,s=null,a=0,l=null,u=null,c=null;"undefined"==typeof window?(u=t(0),c=t(2)):(l=window.spl?window.spl:window,u=l.Logger,c=l.LoaderUtil);var d=u.getLogger("SpaceifyLoader");c=c.getLoaderUtil();var f=c.getPiperClient();e.loadData=function(e,t,i){var s,a,l,u,c,d,f=new XMLHttpRequest;return l=t.port?t.port:n,e.getAttribute("sp_src")?(s="sp_src",c="src"):e.getAttribute("spe_src")?(s="spe_src",c="src"):e.getAttribute("sp_href")?(s="sp_href",c="href"):e.getAttribute("spe_href")?(s="spe_href",c="href"):e.getAttribute("sp_bgnd")&&(s="sp_bgnd",c=""),"-"==(d=e.getAttribute(s))?void("function"==typeof i&&i()):(u="spe_src"==s||"spe_href"==s,a=u?r:o,"80"==l||"443"==l||u||("/"==a.charAt(a.length-1)?a=a.substr(0,a.length-1)+":"+l+"/":a+=":"+l),-1==d.indexOf("//")&&a&&(d=new URL(d,a).toString()),d?(f.addEventListener("loadend",function(n){if(4==f.readyState){var t=f.response;if(e.onload=function(n){"sp_bgnd"!=s&&window.URL.revokeObjectURL(e[c]),"function"==typeof i&&i()},"sp_bgnd"==s){var o=new window.FileReader;o.readAsDataURL(t),o.onloadend=function(){e.style.backgroundImage="url("+o.result+")"}}else e[c]=window.URL.createObjectURL(t);e.removeAttribute(s)}}),u||(f.port=l),f.open("GET",d,!0),f.responseType="blob",void f.send()):void("function"==typeof i&&i()))},e.postData=function(e,t,o,r){var i,s=new XMLHttpRequest;s.addEventListener("loadend",function(e){if(4==s.readyState)if(c.setSession("sessionCookies",s.getResponseHeader("Set-Cookie")),(i=s.getResponseHeader("x-edge-session"))&&c.setSession("x-edge-session",i),200!=s.status)"function"==typeof r&&r(s.status,null);else if(s.response instanceof Blob){var n=new FileReader;n.onload=function(e){"function"==typeof r&&r(null,n.result)},n.readAsText(s.response.data,"UTF-8")}else"function"==typeof r&&r(null,JSON.stringify(s.response))});for(var a="---------------------------"+Date.now().toString(16),l="",u=0;u<t.length;u++)l+="\r\n--"+a+"\r\n",l+=t[u].content,l+="\r\n\r\n"+t[u].data+"\r\n";l+="\r\n--"+a+"--",s.port=n,s.withCredentials=!0,s.open("POST",e,!0),s.responseType=o||"text","undefined"==typeof window||window.isSpaceifyNetwork||s.setRequestHeader("Cookie",c.getSession("sessionCookies")),s.setRequestHeader("x-edge-session",c.getSession("x-edge-session")),s.setRequestHeader("Content-Type","multipart/form-data; boundary="+a),s.send(l)},e.loadPage=function(e,t,o,r){var i,s,a=new XMLHttpRequest;a.addEventListener("loadend",function(e){if(4==a.readyState){c.setSession("sessionCookies",a.getResponseHeader("Set-Cookie")),(i=a.getResponseHeader("x-edge-session"))&&c.setSession("x-edge-session",i);var n=document.open("text/html","replace");n.write(a.responseText),n.close(),n.loadPageSpPort=t,n.loadPageSpHost=o,n.loadPageSpeHost=r}}),s="80"!=t&&"443"!=t?"/"==o.charAt(o.length-1)?o.substr(0,o.length-1)+":"+t+"/":o+":"+t+"/":o,a.port=n,a.withCredentials=!0,a.open("GET",s+e,!0),"undefined"==typeof window||window.isSpaceifyNetwork||a.setRequestHeader("Cookie",c.getSession("sessionCookies")),a.setRequestHeader("x-edge-session",c.getSession("x-edge-session")),a.send(null)},e.getAllElements=function(){var e=Array.prototype.slice.call(document.querySelectorAll("[sp_src]")),n=Array.prototype.slice.call(document.querySelectorAll("[spe_src]")),t=Array.prototype.slice.call(document.querySelectorAll("[sp_href]")),o=Array.prototype.slice.call(document.querySelectorAll("[spe_href]")),r=Array.prototype.slice.call(document.querySelectorAll("[sp_bgnd]"));s=o.concat(t,n,e,r),d.log("SpaceifyLoader::getAllElements() :: Number of elements with sp_src: "+e.length+", spe_src: "+n.length+", sp_href: "+t.length+", spe_href: "+o.length+", sp_bgnd: "+r.length)},e.hasElements=function(){return!!(s&&s.length>0)},e.recurseElements=function(){if(a<s.length)e.loadData(s[a],{},function(){a++,e.recurseElements()});else{var n=document.createEvent("Event");n.initEvent("spaceifyReady",!0,!0),window.dispatchEvent(n)}},e.parseQuery=function(e){var n,t,o,r={};if(e=decodeURIComponent(e),e=e.replace(/#.*$/,""),n=e.split("?"),1==n.length&&"?"!=e.charAt(0))return r;n=n.length<2?n[0]:n[1],o=n.split("&");for(var i=0,s=o.length;i<s;i++)o[i]&&(t=o[i].split("="),r[t[0]]=2==t.length?t[1]:null);return r},e.remakeQueryString=function(e,n,t,o,r){var i,s,a,l="";for(i=0;i<n.length;i++)n[i]in e&&delete e[n[i]];for(i in t)e[i]=t[i];for(i in e)r?(a=decodeURIComponent(e[i]),a=encodeURIComponent(a)):a=e[i],l+=(""!=l?"&":"")+i+"="+a;return o?(o=decodeURIComponent(o),(s=o.match(/(?:#.*)/,""))&&(s=s[0]),o=o.replace(/\?.*$/,"")):(s="",o=""),o=o+(l?"?"+l:"")+(s||"")},e.connectToHub=function(e,n,t,o,r){d.log("SpaceifyLoader::connectToHub(host: "+e+", port: "+n+")"),f.connect(e,n,t,o,function(){i&&i(),r()})},e.setConnectionListener=function(e){i=e},e.testNetworkLocation=function(e,n){var t=!1;if("undefined"==typeof window)return void n(!1);var o=new window.spl.SpXMLHttpRequest.OriginalXMLHttpRequest;o.addEventListener("loadend",function(e){4==o.readyState&&(o.status>=200&&o.status<304&&(t=-1!=o.response.indexOf("local")),n(t))}),o.timeout=e,o.overrideMimeType("text/plain"),o.open("GET",window.location.protocol+"//"+window.location.hostname+"/location.conf"),o.send()},e.prepareLoader=function(t){n=t.sp_port,o=t.sp_host,r=t.spe_host,window.isSpaceifyNetwork?window.XMLHttpRequest=window.spl.SpXMLHttpRequest.OriginalXMLHttpRequest:(window.isSpaceifyNetwork=!1,window.XMLHttpRequest=window.spl.SpXMLHttpRequest,e.connectToHub(c.SERVER_ADDRESS.host,c.SERVER_ADDRESS.port,c.SERVER_ADDRESS.isSsl,c.SERVER_ADDRESS.groupId,function(){}))},e.loadPageOrElements=function(n){e.getAllElements(),e.hasElements()?(a=0,e.recurseElements()):e.loadPage(n.sp_path,n.sp_port,n.sp_host,n.spe_host)}}e.exports=o},function(e,n,t){"use strict";function o(){var e=this,n=null,r=null,i=null,s=null,a=null,l=null;"undefined"==typeof window?(i=t(21),s=t(0),a=t(6),l=t(2)):(r=window.spl?window.spl:window,i=window.URL,s=r.Logger,a=r.HttpParser,l=r.LoaderUtil);var u=new a,c=s.getLogger("SpXMLHttpRequest");l=l.getLoaderUtil();var d=l.getPiperClient(),f="",p="",g="GET",w=null,h=null,y=!1,C=!1,v=!1,b=!1,m=!1,E=!1,R=!1,_=null,S=0,T=null,L=null,O=null,A=null,x=null,H=null,P=null,k=null,D=0,U=null,q=[],I=["GET","HEAD","POST","PUT","DELETE","OPTIONS","PATCH"],N=["CONNECT","TRACE","TRACK"];e.port="80";var M="localhost",B="localhost",j="",X={none:"",abort:"end-user abort",fatal:"fatal",timeout:"timeout"},V={basic:"basic",cors:"cors",default:"default",error:"error",opaque:"opaque",opaqueredirect:"opaqueredirect"},F={type:V.default,terminationReason:X.none,url:null,urlList:[],status:200,statusText:"OK",headers:{},body:null,trailer:{},httpsState:"none",CSPList:[],CORSExposedHeaderNameList:[],locationURL:null},W=0,$=0,G={DOMSTRING:"",BLOB:"blob",JSON:"json",TEXT:"text",DOCUMENT:"document",ARRAYBUFFER:"arraybuffer",MOZ_BLOB:"moz-blob",MOZ_CHUNKED_TEXT:"moz-chunked-text",MOZ_CHUNKED_ARRAYBUFFER:"moz-chunked-arraybuffer",MS_STREAM:"ms-stream"},K="^(Accept-Charset)$|^(Accept-Encoding)$|^(Access-Control-Request-Headers)$|^(Access-Control-Request-Method)$|";K+="^(Connection)$|^(Content-Length)$|^(Cookie)$|^(Cookie2)$|^(Date)$|^(DNT)$|^(Expect)$|^(Host)$|^(Keep-Alive)$|",K+="^(Origin)$|^(Referer)$|^(TE)$|^(Trailer)$|^(Transfer-Encoding)$|^(Upgrade)$|^(Via)$|^(Proxy-.*)|^(Sec-.*)",K=new RegExp(K,"i"),e.readyState=o.UNSENT,e.response="",e.responseText=null,e.responseURL="",e.responseXML=null,e.responseType=G.DOMSTRING,e.status=0,e.statusText="",e.timeout=0,e.withCredentials=!1,e.upload={onabort:null,onerror:null,ontimeout:null,onprogress:null,onloadstart:null,onload:null,onloadend:null},e.onabort=null,e.onerror=null,e.ontimeout=null,e.onprogress=null,e.onloadstart=null,e.onload=null,e.onloadend=null;var z={},J=["abort","error","timeout","progress","loadstart","load","loadend","readystatechange"],Z=function(e){he(),ue(e)},Q=function(e){he(),ue(e)},Y=function(e){he(),ue(e)},ee=function(e){he(),ue(e)},ne=function(e){he(),ue(e)},te=function(e){he(),ue(e)},oe=function(e){he(),ue(e)},re=function(e){he(),ue(e)};n&&(n.ontimeout=Z,n.onprogress=Q,n.onabort=Y,n.onerror=ee,n.onloadstart=ne,n.onload=te,n.onloadend=oe,n.onreadystatechange=re),e.open=function(e,t,o,r,i){c.log("SpXMLHttpRequest::open() on URL "+t),n?ie(e,t,o,r,i):se(e,t,o,r,i)};var ie=function(e,t,o,r,i){g=e,isAsync="undefined"===o||o,w="undefined"!==r?r:null,h="undefined"!==i?i:null,n.open(e,t,isAsync,w,h)},se=function(e,n,t,r,i){if(!y&&(e=e.toUpperCase(),-1!=I.indexOf(e)&&-1==N.indexOf(e))){if(g=e,we(n),"undefined"===t&&(t=!0,r=null,i=null),w=r||null,h=i||null,M){var s="";w&&(s=w),h&&s&&(s+=":"+h),s&&(M=s+"@"+M)}C=!1,m=!1,E=!1,b=!t,q=[],F.type=V.error,F.status=0,F.statusText="",F.headers={},F.body=null,F.trailer={},O=null,A=null,x=null,H=null,y=!0,ge(o.OPENED)}};e.send=function(e){n?ae(e):le(e)};var ae=function(t){return isAsync&&(n.responseType=e.responseType),n.send(t)},le=function(n){if(n&&(T=n),D=0,y&&(!C||v)){"GET"!=g&&"HEAD"!=g||(T=null),(e.upload.onabort||e.upload.onerror||e.upload.ontimeout||e.upload.onprogress||e.upload.onloadstart||e.upload.onload||e.upload.onloadend)&&(E=!0),j=g+" "+p+" HTTP/1.1\r\nHost: "+M;for(var t=0;t<q.length;t++)j+="\r\n"+q[t].header+": "+q[t].value;T&&(j+="\r\nContent-Length: "+T.length+"\r\n",j+=T),j+="\r\n\r\n";var o=l.toab(j);W=o.byteLength,R=!1,T||(R=!0),C=!0,b||(v||ue({type:"loadstart",loaded:0,total:0,lengthComputable:!1,target:e}),!R&&E&&("function"!=typeof e.upload.onloadstart||v||e.upload.onloadstart({type:"loadstart",loaded:0,total:j.length,lengthComputable:!0,target:e})),_&&clearInterval(_),_=null,S=0,e.timeout>0&&(_=setInterval(function(){m?clearInterval(_):++S>=e.timeout&&clearInterval(_)},1))),$=0,d.createTcpTunnel(B,e.port,ce,function(e){L=e,d.sendTcpBinary(L,o),$=W,fe(),v=!1})}};e.setRequestHeader=function(e,t){if(n)n.setRequestHeader(e,t);else{if(!y)return;if(C)return;if(!(e=e.trim().toLowerCase())||!t)return;if(e.match(K))return;q.push({header:e,value:t})}},e.abort=function(){n&&(e.readyState=o.UNSENT,n.abort())},e.getResponseHeader=function(e){return n?n.getResponseHeader(e):u.getHeaderValue(e)},e.getAllResponseHeaders=function(){return n?n.getAllResponseHeaders():u.getRawHeaders()},e.overrideMimeType=function(t){if(n)return n.overrideMimeType(t);e.readyState!=o.LOADING&&e.readyState!=o.DONE&&(t=t.toLowerCase(),U=t)},e.addEventListener=function(e,t,o){var r=o;if(n)n.addEventListener(e,t,o);else{if(-1===J.indexOf(e))return;"boolean"==typeof o&&(r={capture:o,once:!1,passive:!1}),e in z||(z[e]=[]),z[e].push({listener:t,options:r})}},e.removeEventListener=function(e,t,o){if(n)n.removeEventListener(e,t,o);else{if(-1===J.indexOf(e)||!(e in z))return;"boolean"==typeof o&&{capture:o,passive:!1};for(var r=z[e],i=r.length-1;i>=0;i--)r[i].listener==t&&r[i].splice(i,1);0==z[e].length&&delete z[e]}},e.dispatchEvent=function(e){if(n)n.dispatchEvent(e);else{if(!(e.type in z))return;e.target=this;for(var t=z[e.type],o=0,r=t.length;o<r;o++)t[o].listener.call(this,e)}};var ue=function(n){"timeout"==n.type&&("function"==typeof e.ontimeout&&e.ontimeout(n),e.dispatchEvent(n)),"progress"==n.type&&("function"==typeof e.onprogress&&e.onprogress(n),e.dispatchEvent(n)),"abort"==n.type&&("function"==typeof e.onabort&&e.onabort(n),e.dispatchEvent(n)),"error"==n.type&&("function"==typeof e.onerror&&e.onerror(n),e.dispatchEvent(n)),"loadstart"==n.type&&("function"==typeof e.onloadstart&&e.onloadstart(n),e.dispatchEvent(n)),"load"==n.type&&("function"==typeof e.onload&&e.onload(n),e.dispatchEvent(n)),"loadend"==n.type&&("function"==typeof e.onloadend&&e.onloadend(n),e.dispatchEvent(n)),"readystatechange"==n.type&&("function"==typeof e.onreadystatechange&&e.onreadystatechange(n),e.dispatchEvent(n))},ce=function(n){m=!0;var t=new Uint8Array(n),r=-1;if(k)r=de(t);else{if(u.parse(t),301==u.getStatusCode()||302==u.getStatusCode())return v=!0,we(u.getHeaderValue("Location")),void("undefined"!=typeof window?window.location.replace(u.getHeaderValue("Location")):e.send());P=u.getHeaderValue("Content-Type"),k=u.getHeaderValueAsInt("Content-Length"),F.headers=u.getHeaders(),F.body=[],ge(o.HEADERS_RECEIVED),k?-1!=(r=de(t.subarray(u.getContentBegin())))&&(r+=u.getContentBegin()):pe(!0)}if(k&&k==D){if(e.responseType==G.BLOB)"undefined"!=typeof window?e.response=new Blob(F.body,{type:U||P}):ye();else if(e.responseType==G.ARRAYBUFFER)ye();else if(e.responseType==G.DOMSTRING||e.responseType==G.JSON||e.responseType==G.TEXT){e.response="",e.responseText="";for(var i=0;i<F.body.length;i++)F.body[i]&&(e.response+=l.ab2str(F.body[i]));e.responseText=e.response}-1!=r?pe(!1,t.subArray(r)):pe(!1)}},de=function(n){var t=-1;if(D+n.byteLength>k){t=k-D;var r=n.subarray(0,t);respose.body.push(n.subarray(0,t)),D+=r.byteLength}else F.body.push(n),D+=n.byteLength;return ge(o.LOADING,!0),ue({type:"progress",loaded:D,total:k,lengthComputable:!0,target:e}),t},fe=function(){R=!0,E&&!v&&("function"==typeof e.upload.onprogress&&e.upload.onprogress({type:"progress",loaded:$,total:W,lengthComputable:!0,target:e}),"function"==typeof e.upload.onload&&e.upload.onload({type:"load",loaded:$,total:W,lengthComputable:!0,target:e}),"function"==typeof e.upload.onloadend&&e.upload.onloadend({type:"loadend",loaded:$,total:W,lengthComputable:!0,target:e}))},pe=function(n,t){e.status=u.getStatusCode(),e.statusText=u.getStatusText(),n&&ue({type:"progress",loaded:0,total:0,lengthComputable:!0,target:e}),C=!1,ge(o.DONE),d.closeTunnel(L,t),ue({type:"load",loaded:D,total:k||0,lengthComputable:!0,target:e}),ue({type:"loadend",loaded:D,total:k||0,lengthComputable:!0,target:e}),F.body=null},ge=function(n,t){(e.readyState!=n||t)&&(e.readyState=n,ue({type:"readystatechange",target:e}))},we=function(n){var t;-1!=n.indexOf("//")?(t=new i(n),"10.0.0.1"==t.hostname&&(t.hostname="localhost"),M=t.host,t.hostname&&(B=t.hostname),p=t.toString()):(t=n,"/"!=t.charAt(0)&&(t="/"+t),p=t),f=n,e.responseURL=n},he=function(){e.status=n.status,e.statusText=n.statusText,e.response=n.response,e.readyState=n.readyState,e.responseURL=n.responseURL,e.responseType=n.responseType,e.responseType!=G.DOMSTRING&&e.responseType!=G.TEXT||(e.responseText=n.responseText),e.responseType==G.DOCUMENT&&isAsync&&(e.responseXML=n.responseXML),e.upload=n.upload,e.timeout=n.timeout,e.withCredentials=n.withCredentials},ye=function(){var n=0;e.response=new ArrayBuffer(D);for(var t=new Uint8Array(e.response),o=0;o<F.body.length;o++)t.set(F.body[o],n),n+=F.body[o].length};e.isSpXMLHttpRequest=!0}o.UNSENT=0,o.OPENED=1,o.HEADERS_RECEIVED=2,o.LOADING=3,o.DONE=4,o.OriginalXMLHttpRequest=function(){return"undefined"!=typeof window?(void 0===window.OriginalXMLHttpRequest&&(window.OriginalXMLHttpRequest=window.XMLHttpRequest),window.OriginalXMLHttpRequest):null}(),e.exports=o},function(e,n){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,n,t){e.exports={HttpParser:t(6),PiperClient:t(7),SpXMLHttpRequest:t(11),LoaderUtil:t(2),SpaceifyLoader:t(10),Config:t(1),SplBaseConfig:t(4),Logger:t(0),SpaceifyLogger:t(8),SpaceifyError:t(3)}},function(e,n,t){"use strict";var o={logger:{loggerConfigOverride:{all:!0},defaultLoggerConfig:{log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null,mydefault1:1,mydefault2:2}},testValue:"TestValueFromSplConfig"};Object.freeze(o),e.exports=o},function(e,n){function t(e){throw new Error("Cannot find module '"+e+"'.")}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=15},function(e,n,t){function o(e){return t(r(e))}function r(e){var n=i[e];if(!(n+1))throw new Error("Cannot find module '"+e+"'.");return n}var i={"./config.js":1,"./splbaseconfig.js":4,"./splconfig.js":14};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=16},function(e,n,t){function o(e){return t(r(e))}function r(e){var n=i[e];if(!(n+1))throw new Error("Cannot find module '"+e+"'.");return n}var i={"./logger":0,"./spaceifylogger":8};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=17},function(e,n,t){function o(e){return t(r(e))}function r(e){var n=i[e];if(!(n+1))throw new Error("Cannot find module '"+e+"'.");return n}var i={"./spaceifyerror":3};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=18},function(e,n){e.exports=__WEBPACK_EXTERNAL_MODULE_19__},function(e,n){e.exports=__WEBPACK_EXTERNAL_MODULE_20__},function(e,n){e.exports=__WEBPACK_EXTERNAL_MODULE_21__}])});

/**
 * Spaceifyloader initialization after window.onload event
 *
 * Spaceify Oy, 9.2.2017
 */

window.isSpaceifyNetwork = false;

var spaceifyLoader = new window.spl.SpaceifyLoader();

window.onload = function()
	{
	var sp_port, sp_host, spe_host;

	var hosts = spaceifyLoader.parseQuery(window.location.href);

	if (!hosts.sp_host)
		{
		sp_port = "80";

		spe_host = window.location.protocol + "//" + window.location.hostname + "/";

		sp_host = spe_host;

		if (typeof document.loadPageSpPort != "undefined")
			sp_port = document.loadPageSpPort;

		if (typeof document.loadPageSpHost != "undefined")
			sp_host = document.loadPageSpHost;

		if (typeof document.loadPageSpeHost != "undefined")
			spe_host = document.loadPageSpeHost;

		hosts = { sp_port: sp_port, sp_host: sp_host, spe_host: spe_host, sp_path: spaceifyLoader.remakeQueryString(hosts, [], {}, "index.html", true) };
		}

	spaceifyLoader.testNetworkLocation(1000, function(isn)
		{
		window.isSpaceifyNetwork = isn;

		if (!window.isSpaceifyNetwork)
			{
			spaceifyLoader.setConnectionListener(function()
				{
				spaceifyLoader.loadPageOrElements(hosts);
				});

			spaceifyLoader.prepareLoader(hosts);
			}
		else
			{
			spaceifyLoader.prepareLoader(hosts);
			spaceifyLoader.loadPageOrElements(hosts);
			}
		});
	};
