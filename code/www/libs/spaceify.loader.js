
!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(function(){try{return require("fs")}catch(n){}}(),require("websocket"),require("wrtc")):"function"==typeof define&&define.amd?define("sp",["fs","websocket","wrtc"],e):"object"==typeof exports?exports.sp=e(function(){try{return require("fs")}catch(n){}}(),require("websocket"),require("wrtc")):n.sp=e(n.fs,n.websocket,n.wrtc)}(this,function(n,e,t){return function(n){function e(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return n[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t={};return e.m=n,e.c=t,e.i=function(n){return n},e.d=function(n,t,o){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:o})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=18)}([function(n,e,t){"use strict";(function(e,o){function i(n){var o=this,c=null,r="undefined"==typeof window;if(r){var l="/var/lib/spaceify/code/spaceifyerror";i.ifFileExists("./spaceifyerror.js")?c=t(12):i.ifFileExists(l)&&(c=!function(){var n=new Error('Cannot find module "."');throw n.code="MODULE_NOT_FOUND",n}())}else"undefined"!=typeof window&&(c=window.SpaceifyError?window.SpaceifyError:null);c&&(c=new c),o.RETURN=1;var a="log",u="dir",s="info";o.ERROR="error";var d=o.ERROR,f="warn";o.FORCE="force";var p=o.FORCE,g="stdout",C={};C[a]="[i] ",C[u]="[d] ",C[s]="[i] ",C[d]="[e] ",C[f]="[w] ",C[p]="",C[g]="";var h=n?n:{};h[a]="undefined"==typeof h[a]||h[a],h[u]="undefined"==typeof h[u]||h[u],h[s]="undefined"==typeof h[s]||h[s],h[d]="undefined"==typeof h[d]||h[d],h[f]="undefined"==typeof h[f]||h[f],h[p]=!0,h[g]=!0,o.log=function(){m(a,!1,arguments)},o.dir=function(){m(u,!1,arguments)},o.info=function(){m(s,!1,arguments)},o.error=function(){w.apply(this,arguments)},o.warn=function(){m(f,!1,arguments)},o.force=function(){m(p,!1,arguments)},o.stdout=function(){m(g,!0,arguments)};var m=function(n,t){if(h[n]||n==p){var o,i="",c=arguments[2];if(r){for(var l=0;l<c.length;l++)o="string"==typeof c[l]?c[l]:JSON.stringify(c[l]),i+=(""!=i&&"\n"!=i&&"\r"!=i&&"\r\n"!=i?" ":"")+o;i=i.replace(/[\x00-\x09\x0b-\x0c\x0e-\x1f]/g,""),e.stdout.write(C[n]+i+(t?"":"\n"))}else n==u&&console.dir?console.dir.apply(this,arguments[2]):n==d&&console.error?console.error.apply(this,arguments[2]):n==s&&console.info?console.info.apply(this,arguments[2]):n==f&&console.warn?console.warn.apply(this,arguments[2]):console.log.apply(this,arguments[2])}},w=function(n,e,t,i){var r=c?c.errorToString(n,e,t):n;return i==d?m.call(o,d,!1,[r]):i==p&&o.force(r),r};o.setOptions=function(n){for(var e in n)h[e]=n[e]},o.clone=function(n){var e=n.getEnabled();h[a]=e[a],h[u]=e[u],h[s]=e[s],h[d]=e[d],h[f]=e[f]},o.getEnabled=function(){return h}}i.ifFileExists=function(n){try{var e=t(15);return e.accessSync(n,e.F_OK),!0}catch(n){return!1}},i.getLogger=function(n,e){var c,r,l=null,a=null,u=null;if("undefined"==typeof window){var s="/var/lib/spaceify/code/";i.ifFileExists(o+"/loggerconfig.js")?u=t(1):i.ifFileExists(s+"loggerconfig.js")&&(u=t(14)(s+"loggerconfig.js"))}else"undefined"!=typeof window&&(l=window.sp?window.sp:window,u=l.LoggerConfig?l.LoggerConfig:null);if(a=u?u.getConfig():null){if(r=a[n]?a[n]:a.default_?a.default_:{},c="undefined"!=typeof r.all?r.all:null,null!==c)for(var d in r)r[d]=c;if(a.global_){c="undefined"!=typeof a.global_.all?a.global_.all:null;for(var d in a.global_)null===a.global_[d]&&null===c||(r[d]=c?c:a.global_[d])}if(e){c="undefined"!=typeof override.all?override.all:null;for(var d in e)null===e[d]&&null===c||(r[d]=c?c:a.global_[d])}}else r={};return new i(r)},n.exports=i}).call(e,t(11),"/")},function(n,e,t){"use strict";function o(){var n=this;n.global_={log:null,dir:null,info:null,error:null,warn:null,all:null},n.default_={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.CallbackBuffer={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.Client={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.CommunicationClient={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.CommunicationHub={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.DataChannelConnection={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.RpcCommunicator={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.SpaceifyPiper={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.TcpSocket={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.WebRtcConnector={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.WebRtcPeerConnection={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.WebSocketConnection={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.WebSocketRpcConnection={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},n.WebSocketServer={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null}}o.getConfig=function(){return new o},n.exports=o},function(n,e,t){"use strict";function o(){var n=this,e=null,o=null,i=null;"undefined"==typeof window?(o=t(0),i=t(4)):(e=window.sp?window.sp:window,o=e.Logger,i=e.CallbackBuffer);var c=1,r=new Object,l=null,a=null,u=null,s=new i,d=new Object,f=0,p=null,g=o.getLogger("RpcCommunicator"),C=function(n,e){try{d[e].send(JSON.stringify(n))}catch(n){g.log(n)}};n.sendMessage=C;var h=function(n,e,t,o){try{if(n){C({jsonrpc:"2.0",error:n,id:t},o);var i="undefined"!=typeof n.code?n.code:"",c="undefined"!=typeof n.path?n.path:"",r="undefined"!=typeof n.message?n.message:"";g.log("Exception in executing a RPC method: "+i+" RpcCommunicator::onMessage() >> "+c+" "+r)}else C({jsonrpc:"2.0",result:e,id:t},o)}catch(n){g.log(n)}},m=function(n,e){try{if(!n.jsonrpc||"2.0"!=n.jsonrpc||!n.method)return void C({jsonrpc:"2.0",error:{code:-32600,message:"Invalid JSON-RPC."},id:null},e);if("[object Array]"!==Object.prototype.toString.call(n.params))return void C({jsonrpc:"2.0",error:{code:-32602,message:"Parameters must be sent inside an array."},id:n.id},e);if(!r.hasOwnProperty(n.method))return null!=n.id?void C({jsonrpc:"2.0",error:{code:-32601,message:"Method "+n.method+" not found."},id:n.id},e):void C({jsonrpc:"2.0",error:{code:-32601,message:"Method "+n.method+" not found."},id:null},e);var t=r[n.method];"undefined"==typeof n.params&&(n.params=new Array),null!=n.id?(n.params.push(e),n.params.push(function(t,o){h(t,o,n.id,e)}),t.method.apply(t.object,n.params)):(n.params.push(e),n.params.push(function(n,e){}),t.method.apply(t.object,n.params))}catch(n){g.log(n)}},w=function(n){try{var e=null,t=null;"undefined"!=typeof n.error&&(e=n.error),"undefined"!=typeof n.result&&(t=n.result),n.id?s.callMethodAndPop(n.id,e,t):g.log("RpcCommunicator::handleReturnValue() error: "+JSON.stringify(e))}catch(n){g.log(n)}},y=function(n,e){try{n.method?m(n,e):w(n)}catch(n){g.log(n)}},b=function(){f++;for(var n=f;;)if(n=Math.floor(4294967296*Math.random()),!d.hasOwnProperty(n))break;return n};n.exposeRpcMethod=function(n,e,t){try{r[n]={object:e,method:t}}catch(n){g.log(n)}},n.setConnectionListener=function(n,e){l={object:n,listener:e}},n.setDisconnectionListener=function(n,e){a={object:n,listener:e}},n.setBinaryListener=function(n){u=n},n.connectionExists=function(n){return!("undefined"==typeof n||!d.hasOwnProperty(n))||!("undefined"!=typeof n||!d.hasOwnProperty(p))},n.getConnection=function(n){return d[n]},n.callRpc=function(e,t,o,i,r){if(n.connectionExists(r))try{"function"==typeof i?(s.pushBack(c,o,i),"undefined"!=typeof r?C({jsonrpc:"2.0",method:e,params:t,id:""+c},r):C({jsonrpc:"2.0",method:e,params:t,id:""+c},p),c++):"undefined"!=typeof r?C({jsonrpc:"2.0",method:e,params:t},r):C({jsonrpc:"2.0",method:e,params:t},p)}catch(n){g.log(n)}},n.notifyAll=function(n,e){try{for(var t in d)C({jsonrpc:"2.0",method:n,params:e,id:null},t)}catch(n){g.log(n)}},n.getBufferedAmount=function(n){return d[n].getBufferedAmount()},n.sendBinary=function(n,e){try{d[e].sendBinary(n)}catch(n){g.log(n)}},n.setupPipe=function(n,e){d.hasOwnProperty(n)&&d.hasOwnProperty(e)&&(d[n].setPipedTo(e),d[e].setPipedTo(n))},n.closeConnection=function(n){try{n in d&&(d[n].close(),delete d[n])}catch(n){g.log(n)}},n.onMessage=function(n,e){try{var t=e.getPipedTo();if(null!=t)return void d[t].send(n);if(n instanceof ArrayBuffer)return void(u&&u.onBinary(n,e.getId()));var o;try{o=JSON.parse(n)}catch(n){return void C({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},e.getId())}y(o,e.getId())}catch(n){g.log(n)}},n.addConnection=function(e){try{return e.getId()||e.setId(b()),d[e.getId()]=e,e.setListener(n),l&&l.listener.call(l.object,e.getId()),p=e.getId(),e.getId()}catch(n){g.log(n)}},n.onDisconnected=function(e){try{n.closeConnection(e),a&&a.listener.call(a.object,e)}catch(n){g.log(n)}}}n.exports=o},function(n,e,t){"use strict";function o(){var n=this,e=null,o=null,i=null;"undefined"==typeof window?(o=t(0),i=t(16)):(e=window.sp?window.sp:window,o=e.Logger),i="undefined"!=typeof window?window.WebSocket:i.w3cwebsocket;var c=o.getLogger("WebSocketConnection"),r=null,l=null,a=null,u=null,s=null,d=null,f=null;n.connect=function(e,t){e.protocol=e.isSsl?"wss":"ws";try{var o=e.protocol+"://"+e.host+":"+e.port+"/json-rpc";e.id&&(o+="?id="+e.id),c.log("WebSocketConnection::connect() "+o),r=new i(o,"json-rpc",null,null,e.isSsl?{rejectUnauthorized:!1}:null),r.binaryType="arraybuffer",r.onopen=function(){t(null)},r.onmessage=g,r.onclose=function(e,t){C(e,t,n)}}catch(n){c.log(n)}},n.setSocket=function(e){c.log("WebSocketConnection::setSocket()");try{r=e,r.on("message",p),r.on("close",function(e,t){C(e,t,n)})}catch(n){c.log(n)}},n.setId=function(n){l=n},n.setPipedTo=function(n){f=n},n.getPipedTo=function(){return f},n.setRemoteAddress=function(n){a=n},n.setRemotePort=function(n){u=n},n.setOrigin=function(n){s=n},n.setListener=function(n){d=n},n.getId=function(){return l},n.getRemoteAddress=function(){return a},n.getRemotePort=function(){return u},n.getOrigin=function(){return s};var p=function(e){try{d&&("utf8"==e.type&&d.onMessage(e.utf8Data,n),"binary"==e.type&&d.onMessage(e.binaryData,n))}catch(n){c.log(n)}},g=function(e){try{d&&d.onMessage(e.data,n)}catch(n){c.log(n)}},C=function(n,e,t){try{d&&d.onDisconnected(t.getId())}catch(n){c.log(n)}};n.send=function(n){try{r.send(n)}catch(n){c.log(n)}},n.sendBinary=n.send,n.close=function(){try{r.close()}catch(n){c.log(n)}}}n.exports=o},function(n,e,t){"use strict";function o(n){var e=this,t=new Object;e.pushBack=function(n,e,o){t[n]=[e,o]},e.callMethodAndPop=function(n,e,o){if(!t.hasOwnProperty(n))throw{error:"CallbackBuffer::callMethodAndPop(). Callback not found"};t[n][1].call(t[n][0],e,o,n),delete t[n]}}n.exports=o},function(n,e,t){"use strict";function o(n,e,t){var o=this,i=n,c=e,r=!1,l=!1,a=null,u=new Array;o.toJSON=function(){var n={clientId:i,clientType:c,webRtc:r,localHub:l,preferredConnectionId:a};return n},o.isArrivedBeforeUs=function(){return t},o.setClientId=function(n){i=n},o.setClientType=function(n){c=n},o.setWebRtc=function(n){r=n},o.setPreferredConnectionId=function(n){a=n},o.getClientId=function(){return i},o.getClientType=function(){return c},o.isWebRtc=function(){return r},o.getPreferredConnectionId=function(){return a},o.isLocalHub=function(){return l},o.setLocalHub=function(n){l=n},o.addPipeId=function(n){u.push(n)},o.getBinaryConnectionId=function(){return pipeId},o.getConnectionType=function(){return r?"WebRtc":l?"Local Hub":"Cloud"}}n.exports=o},function(n,e,t){"use strict";function o(n){var e=this,o=null,i=null;"undefined"==typeof window?i=t(0):(o=window.sp?window.sp:window,i=o.Logger);var c=n,r=i.getLogger("DataChannelConnection"),l=null,a=null;e.send=function(n){r.log("DataChannelConnection::send()"+n);try{"open"==c.readyState&&c.send(n)}catch(n){r.log(n)}},e.close=function(){r.log("DataChannelConnection::close")},e.sendBinary=function(n){try{"open"==c.readyState&&c.send(n)}catch(n){r.log(n)}},e.getBufferedAmount=function(){return c.bufferedAmount},e.setId=function(n){l=n},e.getId=function(){return l},e.setListener=function(n){a=n},e.onMessage=function(n){try{a&&a.onMessage(n.data,e)}catch(n){r.log(n)}},e.setPipedTo=function(n){},e.getPipedTo=function(){return null},c.onmessage=e.onMessage}n.exports=o},function(n,e,t){"use strict";function o(n,e,o){var i=this,c=null,r=null,l=null;"undefined"==typeof window?(r=t(0),l=t(8)):(c=window.sp?window.sp:window,r=c.Logger,l=c.WebRtcPeerConnection);var a=r.getLogger("WebRtcConnector"),u=new Object,s=new Object,d=null;i.setConnectionListener=function(n){d=n},i.onIceCandidate=function(t,o){a.log("iceCandidate got, sending it to the other client"),n.callRpc("callClientRpc",[o,"handleIceCandidate",[t]],i,null,e)};var f=function(n){u[n]=new l(o),u[n].setPartnerId(n),u[n].setIceListener(i),u[n].setStreamListener(i),u[n].setConnectionListener(i),u[n].setDataChannelListener(i)};i.shutdown=function(n){a.log("WebRtcConnector::onbeforeunload");for(var e in u)u.hasOwnProperty(e)&&(u[e].close(),delete u[e])},i.handleRtcOffer=function(t,o,c){a.log("WebRtcConnector::handleRtcOffer() descriptor: "+t),u.hasOwnProperty(o)||f(o),u[o].onConnectionOfferReceived(t,o,function(t){a.log("WebRtcConnector::handleRtcOffer() onConnectionOfferReceived returned"),a.log("Trying to call handleRtcAnswer on partner "+o),n.callRpc("callClientRpc",[o,"handleRtcAnswer",[t]],i,null,e),a.log("handleRtcAnswer call done on partner "+o)})},i.handleRtcAnswer=function(n,e,t){a.log("WebRtcConnector::handleRtcAnswer()"),u[e].onConnectionAnswerReceived(n)},i.handleIceCandidate=function(n,e,t){a.log("WebRtcConnector::handleIceCandidate()"),u.hasOwnProperty(e)||f(e),u[e].onIceCandidateReceived(n)},i.onDisconnected=function(e){if(a.log("WebRtcConnector::onDisconnected() "),u.hasOwnProperty(e)){for(var t=u[e],o=t.getDataChannelConnections(),i=0;i<o.length;i++)n.onDisconnected(o[i]);d.onWebRtcDisconnected(e),t.close(),delete u[e]}},i.onPrimaryDataChannelOpen=function(e,t){a.log("WebRtcConnector::onPrimaryDataChannelOpen() ");var o=n.addConnection(t);d&&d.onWebRtcConnected(e,o),s.hasOwnProperty(e)&&s[e].apply()},i.onAdditionalDataChannelOpen=function(e,t){a.log("WebRtcConnector::onAdditionalDataChannelOpen() ");var o=n.addConnection(t);d&&d.onAdditionalDataChannelOpen(e,o)},i.onStream=function(n,e){a.log("WebRtcConnector::onStream()")},i.onRemoveStream=function(n,e){a.log("WebRtcConnector::onRemoveStream()"),i.onDisconnected(e)},i.connectToPeer=function(t,o){return a.log("WebRtcConnector::connectToPeer() partnerId: "+t),u.hasOwnProperty(t)?void a.log("WebRtcConnector::connectToPeer() connection to partnerId: "+t+" already exists or is under construction, not connecting again"):(f(t),o&&(s[t]=o),void u[t].createConnectionOffer(function(o){a.log("Offer created, sending it to the other client "+t),n.callRpc("callClientRpc",[t,"handleRtcOffer",[o]],i,null,e)}))},i.createDataChannelConnection=function(e,t){u[e].createDataChannelConnection(function(e){a.log("WebRtcConnector::createDataChannelConnection() callback returned");var o=n.addConnection(e);t(o)})},"undefined"!=typeof window&&(window.onbeforeunload=i.shutdown),n.exposeRpcMethod("handleRtcOffer",i,i.handleRtcOffer),n.exposeRpcMethod("handleRtcAnswer",i,i.handleRtcAnswer),n.exposeRpcMethod("handleIceCandidate",i,i.handleIceCandidate)}"undefined"!=typeof window&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),n.exports=o},function(n,e,t){"use strict";function o(n){var e=this,o=null,i=null,c=null,r=null,l=null,a=null;if("undefined"==typeof window){i=t(0),a=t(6);var u=t(17);c=u.RTCPeerConnection,r=u.RTCSessionDescription,l=u.RTCIceCandidate}else o=window.sp?window.sp:window,i=o.Logger,a=o.DataChannelConnection,c=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,l=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate;var s=null,d=null,f=null,p=null,g=null,C=null,h=i.getLogger("WebRtcPeerConnection"),m=new Array,w={optional:[{DtlsSrtpKeyAgreement:!0}]},y=new c(n,w),b=null,R=0;e.createDataChannelConnection=function(n){R++;var e=y.createDataChannel(R,{reliable:!0});e.onopen=function(){h.log("WebRtcPeerConnection::channel.onopen")},e.binaryType="arraybuffer",e.onmessage=function(){var t=new a(e);m.push(t),n(t)}},y.ondatachannel=function(n){var t=n.channel||n;if(h.log("WebRtcPeerConnection::ondatachannel() "+t),t.binaryType="arraybuffer",null==b)b=new a(t),t.onopen=e.onPrimaryDataChannelOpen;else{var o=new a(t);t.onopen=function(){h.log("WebRtcPeerConnection::temp.onopen"),t.send("OK"),m.push(o),p&&p.onAdditionalDataChannelOpen(s,o)}}},e.onPrimaryDataChannelOpen=function(n){h.log("WebRtcPeerConnection::onPrimaryDataChannelOpen "+n),m.push(b),p&&p.onPrimaryDataChannelOpen(s,b)},e.onAdditionalDataChannelOpen=function(n){h.log("WebRtcPeerConnection::onAdditionalDataChannelOpen "+n)},e.getDataChannelConnections=function(){return m},e.onPrimaryDataChannelClosed=function(n){h.log("WebRtcPeerConnectiononDataChannelClosed "+n),g.onDisconnected(s)},e.setDataChannelListener=function(n){p=n};var v=function(n){h.info("signaling state change:",n)},O=function(n){h.info("ice connection state change:",n),!g||"disconnected"!=y.iceConnectionState&&"closed"!=y.iceConnectionState||g.onDisconnected(s)},P=function(n){h.info("ice gathering state change:",n)},I=function(n){h.log("WebRtcPeerConnectiononIceCanditate() partnerId: "+s+" event: "+n),h.log("iceListener was "+d),null==n.candidate?h.log("All Ice candidates listed"):d.onIceCandidate(n.candidate,s)};y.onsignalingstatechange=v,y.oniceconnectionstatechange=O,y.onicegatheringstatechange=P,y.onicecandidate=I,e.close=function(){h.log("WebRtcPeerConnectionclose"),"closed"==y.signalingState&&"closing"==y.signalingState||y.close()},e.getPartnerId=function(){return s},e.setPartnerId=function(n){s=n},e.setIceListener=function(n){d=n,h.log("WebRtcPeerConnectionsetIceListener()"+n)},e.setStreamListener=function(n){f=n,y.onaddstream=function(n){e.onStream(n)},y.onremovestream=function(n){e.onRemoveStream(n)}},e.setConnectionListener=function(n){g=n},e.onStream=function(n){h.log("WebRtcPeerConnectiononStream"+n),f.onStream(n.stream,s)},e.onRemoveStream=function(n){h.log("WebRtcPeerConnectiononStream"+n),f.onRemoveStream(n.stream,s)},e.addStream=function(n){C=n,y.addStream(n)},e.createConnectionOffer=function(n){var t=null,o=y.createDataChannel("jsonrpcchannel",{reliable:!0});o.binaryType="arraybuffer",o.onopen=e.onPrimaryDataChannelOpen,b=new a(o),y.createOffer(function(e){h.log("peerConnection::createOffer called its callback: "+e),t=e,y.setLocalDescription(e,function(){n(y.localDescription,s)},function(n){h.log("WebRtcPeerConnectioncreateConnectionOffer() setLocalDescription error")},{})},function(n){h.log(n)})},e.onConnectionAnswerReceived=function(n){h.log("WebRtcPeerConnectiononConnectionAnswerReceived(), descriptor: "+n),y.setRemoteDescription(new r(n),function(){h.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned OK")},function(n){h.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned error "+n)})},e.onConnectionOfferReceived=function(n,e,t){h.log("WebRtcPeerConnectiononConnectionOfferReceived"),h.log("WebRtcPeerConnectiononConnectionOfferReceived trying to set remote description");var o=new r(n);y.setRemoteDescription(o,function(){h.log("WebRtcPeerConnectiononConnectionOfferReceived remote description set"),y.createAnswer(function(n){y.setLocalDescription(n,function(){t(y.localDescription)},function(n){h.log(n)})},function(n){h.log(n)})},function(n){h.log("WebRtcPeerConnectiononConnectionOfferReceived setting remote description failed "+n)})},e.onIceCandidateReceived=function(n){y.addIceCandidate(new l(n),function(){h.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate succeeded")},function(n){h.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate failed "+n)})}}n.exports=o},function(n,e,t){"use strict";function o(){var n=this,e=null,o=null,i=null,c=null,r=null,l=null,a=null,u=null;"undefined"==typeof window?(i=t(0),c=t(5),r=null,l=t(7),a=t(2),u=t(3)):(e=window.sp?window.sp:window,o=window.spl?window.spl:window,i=e.Logger,c=e.Client,r=o.LoaderUtil.getLoaderUtil(),l=e.WebRtcConnector,a=e.RpcCommunicator,u=e.WebSocketConnection);var s=i.getLogger("CommunicationClient"),d=null,f=null,p=null,g=new Object,C=null,h=null,m=null,w=null,y=null,b=new a,R=new u,v=new Object,O=new Object,P=new Object,I=(new a,null);n.callRpcOnClient=function(n,e,t,o,i){s.log("CommunicationClient::callRpcOnClient(clientId: "+n+", methodName: "+e+")\n"),v.hasOwnProperty(n)&&(v[n].isWebRtc()?(s.log("CommunicationClient::callRpcOnClient - Calling client RPC through WebRtc, preferredConnectionId was: "+v[n].getPreferredConnectionId()+"\n"),t.push(C),b.callRpc(e,t,o,i,v[n].getPreferredConnectionId())):v[n].isLocalHub()?(s.log("CommunicationClient::callRpcOnClient - Calling client RPC through local hub\n"),b.callRpc("callClientRpc",[n,e,t],o,i,v[n].getPreferredConnectionId())):(s.log("CommunicationClient::callRpcOnClient - Notifying client RPC through the server, serverId: "+y+"\n"),b.callRpc("callClientRpc",[n,e,t],o,i,y)))},n.callRpcOnConnection=function(n,e,t,o,i){s.log("CommunicationClient::callRpcOnConnection(connectionId: "+n+", methodName: "+e+")\n"),s.log("CommunicationClient::callRpcOnConnection - Making a RPC call over direct connection\n"),t.push(C),b.callRpc(e,t,o,i,n)},n.notifyClient=function(n,e,t){s.log("CommunicationClient::notifyClient(clientId: "+n+", methodName: "+e+")\n"),v.hasOwnProperty(n)&&(v[n].isWebRtc()?(s.log("CommunicationClient::notifyClient - Notifying client through WebRtc\n"),t.push(C),b.callRpc(e,t,null,null,v[n].getPreferredConnectionId())):v[n].isLocalHub()?(s.log("CommunicationClient::notifyClient - Notifying client through local hub\n"),b.callRpc("callClientRpc",[n,e,t],null,null,v[n].getPreferredConnectionId())):(s.log("CommunicationClient::notifyClient - Notifying client through the server, serverId: "+y+"\n"),b.callRpc("callClientRpc",[n,e,t],null,null,y)))},n.sendBinaryOnConnection=function(n,e){b.sendBinary(e,n)},n.getClientsByType=function(n){return O[n]},n.getConnectionType=function(n){return v[n].getConnectionType()},n.upgradeToWebRtc=function(n,e){s.log("CommunicationClient::upgradeToWebRtc(clientId: "+n+")\n"),v[n].isWebRtc()||I.connectToPeer(n,e)},n.getBufferedAmount=function(n){return b.getConnection(n).getBufferedAmount()},n.createDirectConnection=function(e,t){s.log("CommunicationClient::createDirectConnection(clientId: "+e+")\n"),v[e].isWebRtc()?I.createDataChannelConnection(e,function(n){s.log("CommunicationClient::createDirectConnection - Callback returned connectionId: "+n+"\n"),P[n]=e,t(n)}):n.createPipe(e,t)},n.onWebRtcConnected=function(n,e){s.log("CommunicationClient::onWebRtcConnected(clientId: "+n+", connectionId: "+e+")\n"),v.hasOwnProperty(n)&&(v[n].setWebRtc(!0),v[n].setPreferredConnectionId(e)),m&&m.onConnectionTypeUpdated(v[n],v[n].getConnectionType())},n.onWebRtcDisconnected=function(n){s.log("CommunicationClient::onWebRtcDisconnected(partnerId: "+n+")\n")},n.onAdditionalDataChannelOpen=function(n,e){s.log("CommunicationClient::onAdditionalDataChannelOpen(clientId: "+n+", connectionId: "+e+")\n"),P[e]=n},n.createPipe=function(e,t){s.log("CommunicationClient::createPipe(clientId: "+e+")\n");var o,i=new u;i.connect(d,function(){o=b.addConnection(i),s.log("CommunicationClient::createPipe - Pipe connected to the WebSocket server, pipeId: "+o+"\n"),b.callRpc("constructPipe",[e,C],n,function(){s.log("CommunicationClient::createPipe - Pipe construction ready\n"),v.hasOwnProperty(e)&&(v[e].addPipeId(o),P[o]=e),t(o)},o)})},n.requestPipe=function(e,t,o,i){s.log("CommunicationClient::requestPipe(targetId: "+e+", originatorId: "+t+", connectionId: "+o+")\n");var c=null,r=new u;r.connect(d,function(){c=b.addConnection(r),s.log("CommunicationClient::requestPipe - Pipe connected to the WebSocket server, pipeId: "+c+"\n"),b.callRpc("registerAsPipe",[e],n,function(n,e){s.log("CommunicationClient::requestPipe - registerAsPipe returned\n"),v.hasOwnProperty(t)&&(v[t].addPipeId(c),P[c]=t),i(null,"Ok")},c)})},n.pipeToExternalConnection=function(n,e){var t=b.addConnection(e);s.log("CommunicationClient::pipeToExternalConnection(), connectionId: "+n+", externalId: "+t+"\n"),b.setupPipe(n,t)},n.onBinary=function(n,e){w&&(P.hasOwnProperty(e)?w.onBinary(n,P[e],e):w.onBinary(n,e))},n.setClientListener=function(n){h=n},n.setConnectionTypeListener=function(n){m=n},n.setBinaryListener=function(n){w=n};var W=function(n,e,t){s.log("CommunicationClient::addClient(clientId: "+n+", clientType: "+e+", arrivedBeforeUs: "+t+")\n");var o=null;return v.hasOwnProperty(n)?o=v[n]:(o=new c(n,e,t),v[n]=o),O.hasOwnProperty(e)||(O[e]=new Object),O[e][n]=o,o},D=function(n){delete O[v[n].getClientType()][n],delete v[n]},T=function(e,t){s.log("CommunicationClient::updateConnectedClients(hubId: "+e+")\n");var o=y;e&&(o=e),b.callRpc("getConnectedClients",[p],n,function(n,i){s.log("CommunicationClient::updateConnectedClients got answer from hub: "+JSON.stringify(i)+"\n");var c=null;for(var r in i)v.hasOwnProperty(r)||i[r].clientId==C?e&&(v[r].setLocalHub(!0),v[r].setPreferredConnectionId(o)):(c=null==e?W(i[r].clientId,i[r].clientType,!0):W(i[r].clientId,i[r].clientType,!1),!e&&h&&c.getClientId()!=C&&h.onClientConnected(c));t()},o)},S=function(e,t){if(s.log("CommunicationCLient::connectToLocalHubs(hubs: "+JSON.stringify(e)+")\n"),null!=e){var o=null,i=null,c=null;for(var r in e){o=e[r].port;for(var l=0;l<e[r].localIps.length;l++){i=e[r].localIps[l];var a={host:i,port:o,id:C},d=null;c=new u,c.connect(a,function(){s.log("CommunicationClient::connectToLocalHubs - Connected to local hub at ip: "+i+" port: "+o+"\n"),d=b.addConnection(c),g[d]=d,T(d,function(){b.callRpc("registerAsClient",[C,f,p],n,function(n,e){s.log("CommunicationClient::connectToLocalHubs - Registered as client at local hub at ip: "+i+", port: "+o+"\n")})})})}}t()}},L=function(e){s.log("CommunicationClient::updateLocalHubs() - Getting list of local hubs from the server\n"),b.callRpc("getLocalHubs",[],n,function(n,t){s.log("CommunicationClient::updateLocalHubs - Following local hubs are available: "+JSON.stringify(t)+"\n"),t?S(t,e):e()},y)};n.exposeRpcMethod=function(n,e,t){b.exposeRpcMethod(n,e,t)},n.connectWithOptions=function(e,t,o,i){s.log("CommunicationClient::connectWithOptions(options: "+JSON.stringify(e)+", clientType: "+t+", groupId: "+o+")\n"),f=t,p=o,b.setBinaryListener(n),e.hasOwnProperty("id")||(e.id=null),d=e,R.connect(d,function(){y=b.addConnection(R),s.log("CommunicationClient::connectWithOptions - Connected to the WebSocket server, serverId: "+y+"\n"),I=new l(b,y,null!==r?r.WEBRTC_CONFIG:WEBRTC_CONFIG),I.setConnectionListener(n),b.callRpc("registerAsClient",[null,f,p],n,function(n,e){s.log("CommunicationClient::connectWithOptions - Server replied to registerAsClient call, ownId: "+e+"\n"),C=e,T(null,function(){L(function(){i(e)})})},y)})},n.connect=function(e,t,o,i,c){return d={host:e,port:t,id:null},n.connectWithOptions(d,o,i,c)},n.onClientConnected=function(n,e,t){if(s.log("CommunicationClient::onClientConnected(clientData: "+JSON.stringify(n)+", connectionId: "+e+") - ownId: "+C+"\n"),n.clientId!=C){if(g.hasOwnProperty(e))return s.log("CommunicationClient::onClientConnected - Client connected through localhub, clientId: "+n.clientId+"\n"),v[n.clientId].setLocalHub(!0),void v[n.clientId].setPreferredConnectionId(e);if(!v.hasOwnProperty(n.clientId)){s.log("CommunicationClient::onClientConnected - addClient clientId: "+n.clientId+"\n");var o=W(n.clientId,n.clientType,!1);h&&o.getClientId()!=C&&h.onClientConnected(o)}}},n.onClientDisconnected=function(n,e,t){s.log("CommunicationClient::onClientDisconnected(connectionId: "+e+", clientData: "+JSON.stringify(n)+")\n"),v.hasOwnProperty(n.clientId)&&h&&n.clientId!=C&&(h.onClientDisconnected(v[n.clientId]),D(n.clientId))},n.onHubConnected=function(n,e,t){s.log("CommunicationClient::onHubConnected(hubData: "+JSON.stringify(n)+")\n")},n.onHubDisconnected=function(n,e,t){s.log("CommunicationClient::onHubDisconnected(hubData: "+JSON.stringify(n)+")\n")},n.getConnectedClients=function(){return v},n.getOwnId=function(){return C},b.exposeRpcMethod("onClientConnected",n,n.onClientConnected),b.exposeRpcMethod("onClientDisconnected",n,n.onClientDisconnected),b.exposeRpcMethod("onHubConnected",n,n.onHubConnected),b.exposeRpcMethod("onHubDisconnected",n,n.onHubDisconnected),b.exposeRpcMethod("requestPipe",n,n.requestPipe)}n.exports=o},function(n,e,t){"use strict";function o(){var n=this,e=null,o=null,i=null,c=null;"undefined"==typeof window?(o=t(0),i=t(2),c=t(3)):(e=window.sp?window.sp:window,o=e.Logger,i=e.RpcCommunicator,c=e.WebSocketConnection);var r=new i,l=new c,a=o.getLogger("WebSocketRpcConnection");n.callRpc=function(n,e,t,o){return r.callRpc(n,e,t,o)},n.connect=function(n,e){a.log("WebSocketRpcConnection::connect()"),l.connect(n,function(){a.log("WebsocketRpcConnection Connected"),r.addConnection(l),a.log("WebsocketRpcConnection added to communicator"),e(null,null)})},n.close=function(){},n.getCommunicator=function(){return r}}n.exports=o},function(n,e){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(n){if(s===setTimeout)return setTimeout(n,0);if((s===t||!s)&&setTimeout)return s=setTimeout,setTimeout(n,0);try{return s(n,0)}catch(e){try{return s.call(null,n,0)}catch(e){return s.call(this,n,0)}}}function c(n){if(d===clearTimeout)return clearTimeout(n);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(n);try{return d(n)}catch(e){try{return d.call(null,n)}catch(e){return d.call(this,n)}}}function r(){C&&p&&(C=!1,p.length?g=p.concat(g):h=-1,g.length&&l())}function l(){if(!C){var n=i(r);C=!0;for(var e=g.length;e;){for(p=g,g=[];++h<e;)p&&p[h].run();h=-1,e=g.length}p=null,C=!1,c(n)}}function a(n,e){this.fun=n,this.array=e}function u(){}var s,d,f=n.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:t}catch(n){s=t}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(n){d=o}}();var p,g=[],C=!1,h=-1;f.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];g.push(new a(n,e)),1!==g.length||C||i(l)},a.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(n){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(n){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(n,e,t){"use strict";function o(n){var e=this;e.path=n&&n.path?n.path:"",e.code=n&&n.code?n.code:"",e.message=n&&n.message?n.message:"";var t=", ",o=", ",i=" ";e.set=function(n){e.path=n.path||"",e.code=n.code||"",e.message=n.message||""},e.getAsObject=function(){return{code:e.code,codes:[e.code],message:e.message,messages:[e.message],path:e.path,paths:[e.path]}},e.getMessage=function(){return e.message},e.getCode=function(){return e.code},e.getPath=function(){return e.path},e.pre=function(n){e.path=n;var t=Array.prototype.slice.call(arguments);return t[0]=e.getAsObject(),e.make.apply(this,t)},e.preFmt=function(n,t){return e.path=n,e.makeFmt(e.getAsObject(),t)},e.make=function(){var n,e="",c=[],r="",l=[],a="",u=[];for(n=0;n<arguments.length;n++){var s=arguments[n];s.messages?(c=c.concat(s.paths),l=l.concat(s.codes),u=u.concat(s.messages)):(c.push(s.path?s.path:""),l.push(s.code?s.code:""),u.push(s.message?s.message:s.toString()))}for(n=0;n<u.length;n++)l[n]&&(r+=(""!=r?t:"")+l[n]),c[n]&&(e+=(""!=e?o:"")+c[n]),a+=(""!=a?i:"")+u[n];return{code:r,message:a,path:e,codes:l,paths:c,messages:u}},e.makeFmt=function(n,t){return n.message=e.replace(n.message,t),n.messages&&n.messages.length>0&&(n.messages[0]=n.message),e.make(n);
},e.makeErrorObject=function(n,e,t){var o="undefined"!=typeof n?n:"",i="undefined"!=typeof t?t:"",c="undefined"!=typeof e?e:"";return{code:o,codes:[o],message:c,messages:[c],path:i,paths:[i]}},e.errorFromObject=function(n){return"string"==typeof n&&(n=JSON.parse(n)),e.make(e.makeErrorObject(n.code,n.message,n.path))},e.typeToErrorObject=function(n){return n?"string"==typeof n?n=e.makeErrorObject("",n,""):n.codes||n.messages||n.paths||(n=e.make(n)):n=e.makeErrorObject("###","###","###"),n},e.errorToString=function(n,t,o){var c="",r="",l="",a="";if("string"==typeof n)c+=n;else if(n.message&&!n.messages)c+=n.message;else if(n.pop)for(;n.length>0;)c+=(""!=c?i:"")+e.errorToString(n.shift());else if(n.messages)for(var u=0;u<n.messages.length;u++)r=o&&n.codes[u]?n.codes[u]:null,l=t&&n.paths[u]?n.paths[u]:null,a=e.ucfirst(n.messages[u]),a=e.endWithDot(a),c+=""!=c?" ":"",c+=l?l:"",c+=r?(l?" - ":"")+r:"",c+=(r||l?" ":"")+a;return c},e.replace=function(n,e,t){var o=t?t:"";for(var i in e)"undefined"!=typeof e[i]&&(n=n.replace(i,e[i]));return n=n.replace(/\s~[a-zA-Z0-9]*\s/g," "+o+" "),n=n.replace(/~[a-zA-Z0-9]*\s/g," "+o+" "),n=n.replace(/\s~[a-zA-Z0-9]*/g,o),n=n.replace(/~[a-zA-Z0-9]+/g,o)},e.ucfirst=function(n){return n=n.trim(),n.charAt(0).toUpperCase()+n.slice(1)},e.endWithDot=function(n){return n=n.trim(),"."!=n.charAt(n.length-1)&&(n+="."),n}}n.exports=o},function(n,e){function t(n){throw new Error("Cannot find module '"+n+"'.")}t.keys=function(){return[]},t.resolve=t,n.exports=t,t.id=13},function(n,e,t){function o(n){return t(i(n))}function i(n){var e=c[n];if(!(e+1))throw new Error("Cannot find module '"+n+"'.");return e}var c={"./loggerconfig.js":1};o.keys=function(){return Object.keys(c)},o.resolve=i,n.exports=o,o.id=14},function(e,t){if("undefined"==typeof n){var o=new Error('Cannot find module "fs"');throw o.code="MODULE_NOT_FOUND",o}e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=t},function(n,e,t){n.exports={Client:t(5),WebRtcConnector:t(7),CommunicationClient:t(9),RpcCommunicator:t(2),WebRtcPeerConnection:t(8),WebSocketRpcConnection:t(10),CallbackBuffer:t(4),WebSocketConnection:t(3),DataChannelConnection:t(6),LoggerConfig:t(1),Logger:t(0)}}])});
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(function(){try{return require("fs")}catch(e){}}(),require("sessionstorage"),require("urlutils")):"function"==typeof define&&define.amd?define("spl",["fs","sessionstorage","urlutils"],n):"object"==typeof exports?exports.spl=n(function(){try{return require("fs")}catch(e){}}(),require("sessionstorage"),require("urlutils")):e.spl=n(e.fs,e.sessionstorage,e.urlutils)}(this,function(e,n,t){return function(e){function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=15)}([function(e,n,t){"use strict";(function(n,o){function r(e){var o=this,i=null,s="undefined"==typeof window;if(s){var l="/var/lib/spaceify/code/spaceifyerror";r.ifFileExists("./spaceifyerror.js")?i=t(5):r.ifFileExists(l)&&(i=!function(){var e=new Error('Cannot find module "."');throw e.code="MODULE_NOT_FOUND",e}())}else"undefined"!=typeof window&&(i=window.SpaceifyError?window.SpaceifyError:null);i&&(i=new i),o.RETURN=1;var a="log",u="dir",c="info";o.ERROR="error";var p=o.ERROR,d="warn";o.FORCE="force";var f=o.FORCE,g="stdout",y={};y[a]="[i] ",y[u]="[d] ",y[c]="[i] ",y[p]="[e] ",y[d]="[w] ",y[f]="",y[g]="";var h=e?e:{};h[a]="undefined"==typeof h[a]||h[a],h[u]="undefined"==typeof h[u]||h[u],h[c]="undefined"==typeof h[c]||h[c],h[p]="undefined"==typeof h[p]||h[p],h[d]="undefined"==typeof h[d]||h[d],h[f]=!0,h[g]=!0,o.log=function(){w(a,!1,arguments)},o.dir=function(){w(u,!1,arguments)},o.info=function(){w(c,!1,arguments)},o.error=function(){m.apply(this,arguments)},o.warn=function(){w(d,!1,arguments)},o.force=function(){w(f,!1,arguments)},o.stdout=function(){w(g,!0,arguments)};var w=function(e,t){if(h[e]||e==f){var o,r="",i=arguments[2];if(s){for(var l=0;l<i.length;l++)o="string"==typeof i[l]?i[l]:JSON.stringify(i[l]),r+=(""!=r&&"\n"!=r&&"\r"!=r&&"\r\n"!=r?" ":"")+o;r=r.replace(/[\x00-\x09\x0b-\x0c\x0e-\x1f]/g,""),n.stdout.write(y[e]+r+(t?"":"\n"))}else e==u&&console.dir?console.dir.apply(this,arguments[2]):e==p&&console.error?console.error.apply(this,arguments[2]):e==c&&console.info?console.info.apply(this,arguments[2]):e==d&&console.warn?console.warn.apply(this,arguments[2]):console.log.apply(this,arguments[2])}},m=function(e,n,t,r){var s=i?i.errorToString(e,n,t):e;return r==p?w.call(o,p,!1,[s]):r==f&&o.force(s),s};o.setOptions=function(e){for(var n in e)h[n]=e[n]},o.clone=function(e){var n=e.getEnabled();h[a]=n[a],h[u]=n[u],h[c]=n[c],h[p]=n[p],h[d]=n[d]},o.getEnabled=function(){return h}}r.ifFileExists=function(e){try{var n=t(12);return n.accessSync(e,n.F_OK),!0}catch(e){return!1}},r.getLogger=function(e,n){var i,s,l=null,a=null,u=null;if("undefined"==typeof window){var c="/var/lib/spaceify/code/";r.ifFileExists(o+"/loggerconfig.js")?u=t(2):r.ifFileExists(c+"loggerconfig.js")&&(u=t(11)(c+"loggerconfig.js"))}else"undefined"!=typeof window&&(l=window.spl?window.spl:window,u=l.LoggerConfig?l.LoggerConfig:null);if(a=u?u.getConfig():null){if(s=a[e]?a[e]:a.default_?a.default_:{},i="undefined"!=typeof s.all?s.all:null,null!==i)for(var p in s)s[p]=i;if(a.global_){i="undefined"!=typeof a.global_.all?a.global_.all:null;for(var p in a.global_)null===a.global_[p]&&null===i||(s[p]=i?i:a.global_[p])}if(n){i="undefined"!=typeof override.all?override.all:null;for(var p in n)null===n[p]&&null===i||(s[p]=i?i:a.global_[p])}}else s={};return new r(s)},e.exports=r}).call(n,t(9),"/")},function(e,n,t){"use strict";(function(n){function o(){var e=this,n=null,o=null,r=null,i=null;"undefined"==typeof window?(r=t(4),i=t(13)):(n=window.spl?window.spl:window,o=window.spe?window.spe:window,r=n.PiperClient,i=window.sessionStorage);var s=null;e.Utf8ArrayToStr=function(e){var n,t,o,r,i,s;for(n="",o=e.length||e.byteLength,t=0;t<o;)switch(r=e[t++],r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(r);break;case 12:case 13:i=e[t++],n+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[t++],s=e[t++],n+=String.fromCharCode((15&r)<<12|(63&i)<<6|(63&s)<<0)}return n},e.ab2str=function(n){return e.Utf8ArrayToStr(n)},e.str2ab=function(e){for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),o=0,r=e.length;o<r;o++)t[o]=e.charCodeAt(o);return n},e.toab=function(e){for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),o=0,r=e.length;o<r;o++)t[o]=e.charCodeAt(o);return n},e.getSession=function(e){return i.getItem(e)?i.getItem(e):""},e.setSession=function(e,n){n||(n=""),i.setItem(e,n.trim())},e.open=function(e,n,t,o,r){var i,s,l,a,u,c;console.log("======================",window,typeof window.spl);var p=new window.SpaceifyCore,d=new window.SpaceifyNetwork;p.getApplicationURL(e,function(p,f){return p?void("function"==typeof r&&r(null)):(i=d.isSecure()?f.securePort:f.port,a=d.getEdgeURL({forceSecureProtocol:!1,ownProtocol:null,port:null,withEndSlash:!0}),l=f.implementsWebServer&&i?d.getEdgeURL({forceSecureProtocol:!1,ownProtocol:null,port:i,withEndSlash:!0}):d.externalResourceURL(e,{forceSecureProtocol:!1,ownProtocol:null,port:null,withEndSlash:!0}),s=d.parseQuery(n),s.sp_host=encodeURIComponent(l),s.sp_path=encodeURIComponent(n),s.spe_host=encodeURIComponent(a),u=a+"remote.html/"+d.remakeQueryString(s,{},{},"",!0),c=window.openOriginal(u,t?t:"_blank",o?o:""),void c.addEventListener("load",function(){"function"==typeof r&&r(this)}))})},e.getPiperClient=function(){return null===s&&(s=new r),s}}n._loaderUtil=null,o.getLoaderUtil=function(){return null===_loaderUtil&&(_loaderUtil=new o),_loaderUtil},o.prototype.SERVER_ADDRESS=function(){var e="testgroup";if("undefined"!=typeof window){var n=window.location.hostname.split(".");3==n.length&&"edge"!=n[0]&&(e=n[0])}return{host:"spaceify.net",port:1979,groupId:e,isSsl:!1}}(),o.prototype.WEBRTC_CONFIG=function(){return{iceServers:[{url:"stun:kandela.tv"},{url:"turn:kandela.tv",username:"webrtcuser",credential:"jeejeejee"}]}}(),window&&(window.openOriginal=window.open,window.open=function(e,n,t,r,i){o.getLoaderUtil().open(e,n,t,r,i)}),e.exports=o,n.SERVER_ADDRESS=e.exports.SERVER_ADDRESS,n.WEBRTC_CONFIG=e.exports.WEBRTC_CONFIG}).call(n,t(10))},function(e,n,t){"use strict";function o(){var e=this;e.globale={log:null,dir:null,info:null,error:null,warn:null,all:null},e.default_={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},e.SpXMLHttpRequest={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},e.SpaceifyLoader={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},e.PiperClient={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},e.LoaderUtil={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:null},e.HttpParser={log:!0,dir:!0,info:!0,error:!0,warn:!0,all:!1}}o.getConfig=function(){return new o},e.exports=o},function(e,n,t){"use strict";function o(){var e=this,n=null,o=0,r=null,i="",s={},l=null,a=null,u=null,c=null;"undefined"==typeof window?c=t(0):(u=window.spl?window.spl:window,c=u.Logger);c.getLogger("HttpParser");e.getStatusCode=function(){return parseInt(l)},e.getStatusText=function(){return a},e.getContentBegin=function(){return r},e.getHeaderSize=function(){return o},e.getHeaderValueAsInt=function(e){return e=e.toLowerCase(),s.hasOwnProperty(e)?parseInt(s[e]):null},e.getHeaderValue=function(e){if(e=e.toLowerCase(),s.hasOwnProperty(e))return s[e]},e.getHeaders=function(){return s},e.getRawHeaders=function(){return i};var p=function(e){for(var n=0;n<e.byteLength;n+=1)if(n+4<e.byteLength&&13==e[n]&&10==e[n+1]&&13==e[n+2]&&10==e[n+3]){r=n+4;break}o=r?r:e.byteLength},d=function(e){i="",s={},n=r?String.fromCharCode.apply(null,e.subarray(0,r)):String.fromCharCode.apply(null,e);var t=n.split("\n"),o=t[0].split(" ");l=o[1],a=o.length>=3?o[2]:"OK";for(var u=1;u<t.length;u++){var c=t[u].indexOf(":");if(c>-1){var p=t[u].substring(0,c);p=p.toLowerCase();var d="";t[u].length>c&&(d=t[u].substring(c+1).trim()),s[p]=p in s?s[p]+", "+d:d,i+=(""!=i?"\r\n":"")+p+": "+d}}};e.parse=function(e){p(e),d(e)}}e.exports=o},function(e,n,t){"use strict";function o(){var e=this,n=null,t=null,o=null,r=null;"undefined"==typeof window?(n="../libs/spaceifyconnect.bundle.js",t=!function(){var e=new Error('Cannot find module "."');throw e.code="MODULE_NOT_FOUND",e}(),r=t.CommunicationClient):(n=window.spl?window.spl:window,t=window.sp?window.sp:window,o=n.Logger,r=t.CommunicationClient);var i=o.getLogger("PiperClient"),s=new r,l=new Object,a=new Object,u=null,c=null,p=null,d=null;e.setCookies=function(e){d=e},e.getCookies=function(){return d},e.sendTcpBinary=function(e,n){s.sendBinaryOnConnection(e,n)},e.createTcpTunnel=function(n,t,o,r){i.log("PiperClient::createTcpTunnel(host: "+n+", port: "+t+")\n");var a=n+t;for(var u in l)if(l[u].hostnameAndPort==a)return l[u].listener=o,void r(u);s.createDirectConnection(c,function(u){i.log("PiperClient::createTcpTunnel - Direct Connection Ready for TCP tunnel\n"),s.callRpcOnConnection(u,"tunnelTcp",[n,t],e,function(){i.log("PiperClient::createTcpTunnel - Tunnel pipe ready to host: "+n+", port: "+t+"\n"),l[u]={listener:o,hostnameAndPort:a},r(u)})})},e.createWebSocketTunnel=function(n,t,o){i.log("PiperClient::createWebSocketTunnel(options: "+JSON.stringify(n)+")\n"),s.createDirectConnection(c,function(r){i.log("PiperClient::createWebSocketTunnel - Pipe ready for WebSocket, tunnelId: "+r+"\n"),s.callRpcOnConnection(r,"tunnelWebSocket",[n],e,function(){i.log("PiperClient::createWebSocketTunnel - WebSocket pipe ready to host: "+n.host+", port: "+n.port+"\n"),a[r]=t,o(r)})})},e.exposeRpcMethod=function(e,n,t){s.exposeRpcMethod(e,n,t)},e.callClientRpc=function(e,n,t,o,r){s.callRpcOnConnection(e,n,t,o,r)},e.setBinaryListener=function(e){p=e},e.onBinary=function(e,n,t){l.hasOwnProperty(t)&&l[t].listener(e)},e.onClientDisconnected=function(e){},e.onClientConnected=function(e){e&&(i.log("PiperClient::onClientConnected - "+JSON.stringify(e)+"\n"),"piper"==e.getClientType()&&(i.log("PiperClient::onClientConnected - clientType is 'piper', trying to build a direct connection to it\n"),s.createDirectConnection(e.getClientId(),function(n){i.log("PiperClient::onClientConnected - Direct connection ready, pipeId: "+n+"\n"),c=e.getClientId(),u&&u()})))},e.upgradeToWebRtc=function(e){s.upgradeToWebRtc(c,function(){i.log("PiperClient::upgradeToWebRtc - targetId: "+c+" - Completed\n"),e()})},e.sendBinary=function(e){s.sendBinaryToClient(c,e)},e.connect=function(n,t,o,r,l){i.log("PiperClient::connect(host: "+n+", port: "+t+", isSsl: "+o+", groupId: "+r+")\n"),u=l,s.setClientListener(e),s.setBinaryListener(e),s.connectWithOptions({host:n,port:t,isSsl:!1},"piperclient",r,function(e){i.log("PiperClient::connect - Hub Connection succeeded, givenId: "+e+"\n")})};var f=0,g=1e3;e.testPing=function(e){s.createDirectConnection(c,function(n){y(0,n,e)})};var y=function(n,t,o){if(++n==g+1)return void o(f,g);var r=Date.now();s.callRpcOnConnection(t,"hello",[],e,function(e,s){f+=Date.now()-r,i.log("index: "+n+", time: "+(Date.now()-r)/1e3+", length: "+s.length+"\n"),y(n,t,o)})}}e.exports=o},function(e,n,t){"use strict";function o(e){var n=this;n.path=e&&e.path?e.path:"",n.code=e&&e.code?e.code:"",n.message=e&&e.message?e.message:"";var t=", ",o=", ",r=" ";n.set=function(e){n.path=e.path||"",n.code=e.code||"",n.message=e.message||""},n.getAsObject=function(){return{code:n.code,codes:[n.code],message:n.message,messages:[n.message],path:n.path,paths:[n.path]}},n.getMessage=function(){return n.message},n.getCode=function(){return n.code},n.getPath=function(){return n.path},n.pre=function(e){n.path=e;var t=Array.prototype.slice.call(arguments);return t[0]=n.getAsObject(),n.make.apply(this,t)},n.preFmt=function(e,t){return n.path=e,n.makeFmt(n.getAsObject(),t)},n.make=function(){var e,n="",i=[],s="",l=[],a="",u=[];for(e=0;e<arguments.length;e++){var c=arguments[e];c.messages?(i=i.concat(c.paths),l=l.concat(c.codes),u=u.concat(c.messages)):(i.push(c.path?c.path:""),l.push(c.code?c.code:""),u.push(c.message?c.message:c.toString()))}for(e=0;e<u.length;e++)l[e]&&(s+=(""!=s?t:"")+l[e]),i[e]&&(n+=(""!=n?o:"")+i[e]),a+=(""!=a?r:"")+u[e];return{code:s,message:a,path:n,codes:l,paths:i,messages:u}},n.makeFmt=function(e,t){return e.message=n.replace(e.message,t),e.messages&&e.messages.length>0&&(e.messages[0]=e.message),n.make(e)},n.makeErrorObject=function(e,n,t){var o="undefined"!=typeof e?e:"",r="undefined"!=typeof t?t:"",i="undefined"!=typeof n?n:"";return{code:o,codes:[o],message:i,messages:[i],path:r,paths:[r]}},n.errorFromObject=function(e){return"string"==typeof e&&(e=JSON.parse(e)),n.make(n.makeErrorObject(e.code,e.message,e.path))},n.typeToErrorObject=function(e){return e?"string"==typeof e?e=n.makeErrorObject("",e,""):e.codes||e.messages||e.paths||(e=n.make(e)):e=n.makeErrorObject("###","###","###"),e},n.errorToString=function(e,t,o){var i="",s="",l="",a="";if("string"==typeof e)i+=e;else if(e.message&&!e.messages)i+=e.message;else if(e.pop)for(;e.length>0;)i+=(""!=i?r:"")+n.errorToString(e.shift());else if(e.messages)for(var u=0;u<e.messages.length;u++)s=o&&e.codes[u]?e.codes[u]:null,l=t&&e.paths[u]?e.paths[u]:null,a=n.ucfirst(e.messages[u]),a=n.endWithDot(a),i+=""!=i?" ":"",i+=l?l:"",i+=s?(l?" - ":"")+s:"",i+=(s||l?" ":"")+a;return i},n.replace=function(e,n,t){var o=t?t:"";for(var r in n)"undefined"!=typeof n[r]&&(e=e.replace(r,n[r]));return e=e.replace(/\s~[a-zA-Z0-9]*\s/g," "+o+" "),e=e.replace(/~[a-zA-Z0-9]*\s/g," "+o+" "),e=e.replace(/\s~[a-zA-Z0-9]*/g,o),e=e.replace(/~[a-zA-Z0-9]+/g,o)},n.ucfirst=function(e){return e=e.trim(),e.charAt(0).toUpperCase()+e.slice(1)},n.endWithDot=function(e){return e=e.trim(),"."!=e.charAt(e.length-1)&&(e+="."),e}}e.exports=o},function(e,n){function t(e){throw new Error("Cannot find module '"+e+"'.")}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=6},function(e,n,t){"use strict";function o(){var e=this,n=null,o=null,r=!1,i=null,s=null,l=0,a="x-edge-session",u=null,c=null,p=null;"undefined"==typeof window?(c=t(0),p=t(1)):(u=window.spl?window.spl:window,c=u.Logger,p=u.LoaderUtil);var d=c.getLogger("SpaceifyLoader");p=p.getLoaderUtil();var f=p.getPiperClient();e.loadData=function(e,t){var r,i,s,l,a=new XMLHttpRequest;return e.getAttribute("sp_src")?(r="sp_src",s="src"):e.getAttribute("spe_src")?(r="spe_src",s="src"):e.getAttribute("sp_href")?(r="sp_href",s="href"):e.getAttribute("spe_href")?(r="spe_href",s="href"):e.getAttribute("sp_bgnd")&&(r="sp_bgnd",s=""),l=e.getAttribute(r),i="spe_src"==r||"spe_href"==r?o:n,l.indexOf("//")==-1&&i&&(l=new URL(l,i).toString()),l?(a.addEventListener("loadend",function(n){if(4==a.readyState){var o=a.response;if(e.onload=function(n){"sp_bgnd"!=r&&window.URL.revokeObjectURL(e[s]),"function"==typeof t&&t()},"sp_bgnd"==r){var i=new window.FileReader;i.readAsDataURL(o),i.onloadend=function(){e.style.backgroundImage="url("+i.result+")"}}else e[s]=window.URL.createObjectURL(o);e.removeAttribute(r)}}),a.open("GET",l,!0),a.responseType="blob",void a.send()):void("function"==typeof t&&t())},e.postData=function(e,n,t,o){var r,i=new XMLHttpRequest;i.addEventListener("loadend",function(e){if(4==i.readyState)if(p.setSession("sessionCookies",i.getResponseHeader("Set-Cookie")),(r=i.getResponseHeader(a))&&p.setSession(a,r),200!=i.status)"function"==typeof o&&o(i.status,null);else if(i.response instanceof Blob){var n=new FileReader;n.onload=function(e){"function"==typeof o&&o(null,n.result)},n.readAsText(i.response.data,"UTF-8")}else"function"==typeof o&&o(null,JSON.stringify(i.response))});for(var s="---------------------------"+Date.now().toString(16),l="",u=0;u<n.length;u++)l+="\r\n--"+s+"\r\n",l+=n[u].content,l+="\r\n\r\n"+n[u].data+"\r\n";l+="\r\n--"+s+"--",i.withCredentials=!0,i.open("POST",e,!0),i.responseType=t?t:"text",i.setRequestHeader("Cookie",p.getSession("sessionCookies")),i.setRequestHeader(a,p.getSession(a)),i.setRequestHeader("Content-Type","multipart/form-data; boundary="+s),i.send(l)},e.loadPage=function(e,n,t){var o,r=new XMLHttpRequest;r.addEventListener("loadend",function(e){if(4==r.readyState){p.setSession("sessionCookies",r.getResponseHeader("Set-Cookie")),(o=r.getResponseHeader(a))&&p.setSession(a,o);var i=document.open("text/html","replace");i.write(r.responseText),i.close(),i.loadPageSpHost=n,i.loadPageSpeHost=t}}),r.withCredentials=!0,r.open("GET",e,!0),r.setRequestHeader("Cookie",p.getSession("sessionCookies")),r.setRequestHeader(a,p.getSession(a)),r.send(null)},e.getAllElements=function(){var e=Array.prototype.slice.call(document.querySelectorAll("[sp_src]")),n=Array.prototype.slice.call(document.querySelectorAll("[spe_src]")),t=Array.prototype.slice.call(document.querySelectorAll("[sp_href]")),o=Array.prototype.slice.call(document.querySelectorAll("[spe_href]")),r=Array.prototype.slice.call(document.querySelectorAll("[sp_bgnd]"));s=o.concat(t,n,e,r),d.log("SpaceifyLoader::getAllElements() :: Number of elements with sp_src: "+e.length+", spe_src: "+n.length+", sp_href: "+t.length+", spe_href: "+o.length+", sp_bgnd: "+r.length)},e.hasElements=function(){return!!(s&&s.length>0)},e.recurseElements=function(){if(l<s.length)e.loadData(s[l],function(){l++,e.recurseElements()});else{var n=document.createEvent("Event");n.initEvent("spaceifyReady",!0,!0),window.dispatchEvent(n)}},e.parseQuery=function(e){var n,t,o,r={};e=decodeURIComponent(e),e=e.replace(/#.*$/,""),n=e.split("?"),n=n.length<2?n[0]:n[1],o=n.split("&");for(var i=0,s=o.length;i<s;i++)o[i]&&(t=o[i].split("="),r[t[0]]=2==t.length?t[1]:null);return r},e.connect=function(e,n,t,o,r){d.log("SpaceifyLoader::connect(host: "+e+", port: "+n+")"),f.connect(e,n,t,o,function(){i&&i(),r()})},e.setConnectionListener=function(e){i=e,r&&e()},e.getNetworkInfo=function(e){window.isSpaceifyNetwork=!1;var n=new window.spl.SpXMLHttpRequest.OriginalXMLHttpRequest;n.open("HEAD",window.location.protocol+"//10.0.0.1/templates/test.txt",!0),n.timeout=1e3,n.addEventListener("loadend",function(t){4==n.readyState&&(window.isSpaceifyNetwork=n.status>=200&&n.status<304,e())}),n.send()},e.prepareLoader=function(t){n=t.sp_host,o=t.spe_host,window.isSpaceifyNetwork?window.XMLHttpRequest=window.spl.SpXMLHttpRequest.OriginalXMLHttpRequest:(window.isSpaceifyNetwork=!1,window.XMLHttpRequest=window.spl.SpXMLHttpRequest,e.connect(p.SERVER_ADDRESS.host,p.SERVER_ADDRESS.port,p.SERVER_ADDRESS.isSsl,p.SERVER_ADDRESS.groupId,function(){}))},e.loadPageOrElements=function(n){e.getAllElements(),e.hasElements()?(l=0,e.recurseElements()):e.loadPage(n.sp_host+n.sp_path,n.sp_host,n.spe_host)}}e.exports=o},function(e,n,t){"use strict";function o(){var e=this,n=null,r=null,i=null,s=null,l=null,a=null;"undefined"==typeof window?(i=t(14),s=t(0),l=t(3),a=t(1)):(r=window.spl?window.spl:window,i=window.URL,s=r.Logger,l=r.HttpParser,a=r.LoaderUtil);var u=new l;s.getLogger("SpXMLHttpRequest");a=a.getLoaderUtil();var c=a.getPiperClient(),p="",d="",f="GET",g=null,y=null,h=!1,w=!1,m=!1,v=!1,C=!1,E=!1,S=!1,b=null,R=0,T=null,L=null,O=null,A=null,x=null,_=null,H=null,D=0,U=null,P=[],k=["GET","HEAD","POST","PUT","DELETE","OPTIONS","PATCH"],N=["CONNECT","TRACE","TRACK"],M="80",q="localhost",I="localhost",j="",F={none:"",abort:"end-user abort",fatal:"fatal",timeout:"timeout"},B={basic:"basic",cors:"cors",default:"default",error:"error",opaque:"opaque",opaqueredirect:"opaqueredirect"},X={type:B.default,terminationReason:F.none,url:null,urlList:[],status:200,statusText:"OK",headers:{},body:null,trailer:{},httpsState:"none",CSPList:[],CORSExposedHeaderNameList:[],locationURL:null},$=0,W=0,V={DOMSTRING:"",BLOB:"blob",JSON:"json",TEXT:"text",DOCUMENT:"document",ARRAYBUFFER:"arraybuffer",MOZ_BLOB:"moz-blob",MOZ_CHUNKED_TEXT:"moz-chunked-text",MOZ_CHUNKED_ARRAYBUFFER:"moz-chunked-arraybuffer",MS_STREAM:"ms-stream"},G="^(Accept-Charset)$|^(Accept-Encoding)$|^(Access-Control-Request-Headers)$|^(Access-Control-Request-Method)$|";G+="^(Connection)$|^(Content-Length)$|^(Cookie)$|^(Cookie2)$|^(Date)$|^(DNT)$|^(Expect)$|^(Host)$|^(Keep-Alive)$|",G+="^(Origin)$|^(Referer)$|^(TE)$|^(Trailer)$|^(Transfer-Encoding)$|^(Upgrade)$|^(Via)$|^(Proxy-.*)|^(Sec-.*)",G=new RegExp(G,"i"),e.readyState=o.UNSENT,e.response="",e.responseText=null,e.responseURL="",e.responseXML=null,e.responseType=V.DOMSTRING,e.status=0,e.statusText="",e.timeout=0,e.withCredentials=!1,e.upload={onabort:null,onerror:null,ontimeout:null,onprogress:null,onloadstart:null,onload:null,onloadend:null},e.onabort=null,e.onerror=null,e.ontimeout=null,e.onprogress=null,e.onloadstart=null,e.onload=null,e.onloadend=null,e.onreadystatechange=null;var z={},J=["abort","error","timeout","progress","loadstart","load","loadend","readystatechange"],K=function(e){ye(),ae(e)},Z=function(e){ye(),ae(e)},Q=function(e){ye(),ae(e)},Y=function(e){ye(),ae(e)},ee=function(e){ye(),ae(e)},ne=function(e){ye(),ae(e)},te=function(e){ye(),ae(e)},oe=function(e){ye(),ae(e)};n&&(n.ontimeout=K,n.onprogress=Z,n.onabort=Q,n.onerror=Y,n.onloadstart=ee,n.onload=ne,n.onloadend=te,n.onreadystatechange=oe),e.open=function(e,t,o,r,i){n?re(e,t,o,r,i):ie(e,t,o,r,i)};var re=function(e,t,o,r,i){f=e,isAsync="undefined"===o||o,g="undefined"!==r?r:null,y="undefined"!==i?i:null,n.open(e,t,isAsync,g,y)},ie=function(e,n,t,r,i){if(!h&&(e=e.toUpperCase(),k.indexOf(e)!=-1&&N.indexOf(e)==-1)){if(f=e,ge(n),"undefined"===t&&(t=!0,r=null,i=null),g=r?r:null,y=i?i:null,q){var s="";g&&(s=g),y&&s&&(s+=":"+y),s&&(q=s+"@"+q)}w=!1,C=!1,E=!1,v=!t,P=[],X.type=B.error,X.status=0,X.statusText="",X.headers={},X.body=null,X.trailer={},L=null,O=null,A=null,x=null,h=!0,fe(o.OPENED)}};e.send=function(e){n?se(e):le(e)};var se=function(t){return isAsync&&(n.responseType=e.responseType),n.send(t)},le=function(n){if(n&&(T=n),D=0,h&&(!w||m)){"GET"!=f&&"HEAD"!=f||(T=null),(e.upload.onabort||e.upload.onerror||e.upload.ontimeout||e.upload.onprogress||e.upload.onloadstart||e.upload.onload||e.upload.onloadend)&&(E=!0),j=f+" "+d+" HTTP/1.1\r\nHost: "+q;for(var t=0;t<P.length;t++)j+="\r\n"+P[t].header+": "+P[t].value;T&&(j+="\r\nContent-Length: "+T.length+"\r\n",j+=T),j+="\r\n\r\n";var o=a.toab(j);$=o.byteLength,S=!1,T||(S=!0),w=!0,v||(m||ae({type:"loadstart",loaded:0,total:0,lengthComputable:!1,target:e}),!S&&E&&("function"!=typeof e.upload.onloadstart||m||e.upload.onloadstart({type:"loadstart",loaded:0,total:j.length,lengthComputable:!0,target:e})),b&&clearInterval(b),b=null,R=0,e.timeout>0&&(b=setInterval(function(){C?clearInterval(b):++R>=e.timeout&&clearInterval(b)},1))),W=0,c.createTcpTunnel(I,M,ue,function(e){c.sendTcpBinary(e,o),W=$,pe(),m=!1})}};e.setRequestHeader=function(e,t){if(n)n.setRequestHeader(e,t);else{if(!h)return;if(w)return;if(e=e.trim().toLowerCase(),!e||!t)return;if(e.match(G))return;P.push({header:e,value:t})}},e.abort=function(){n&&(e.readyState=o.UNSENT,n.abort())},e.getResponseHeader=function(e){return n?n.getResponseHeader(e):u.getHeaderValue(e)},e.getAllResponseHeaders=function(){return n?n.getAllResponseHeaders():u.getRawHeaders()},e.overrideMimeType=function(t){return n?n.overrideMimeType(t):void(e.readyState!=o.LOADING&&e.readyState!=o.DONE&&(t=t.toLowerCase(),U=t))},e.addEventListener=function(e,t,o){var r=o;if(n)n.addEventListener(e,t,o);else{if(J.indexOf(e)===-1)return;"boolean"==typeof o&&(r={capture:o,once:!1,passive:!1}),e in z||(z[e]=[]),z[e].push({listener:t,options:r})}},e.removeEventListener=function(e,t,o){var r=o;if(n)n.removeEventListener(e,t,o);else{if(J.indexOf(e)===-1||!(e in z))return;"boolean"==typeof o&&(r={capture:o,passive:!1});for(var i=z[e],s=i.length-1;s>=0;s--)i[s].listener==t&&i[s].splice(s,1);0==z[e].length&&delete z[e]}},e.dispatchEvent=function(e){if(n)n.dispatchEvent(e);else{if(!(e.type in z))return;e.target=this;for(var t=z[e.type],o=0,r=t.length;o<r;o++)t[o].listener.call(this,e)}};var ae=function(n){"timeout"==n.type&&("function"==typeof e.ontimeout&&e.ontimeout(n),e.dispatchEvent(n)),"progress"==n.type&&("function"==typeof e.onprogress&&e.onprogress(n),e.dispatchEvent(n)),"abort"==n.type&&("function"==typeof e.onabort&&e.onabort(n),e.dispatchEvent(n)),"error"==n.type&&("function"==typeof e.onerror&&e.onerror(n),e.dispatchEvent(n)),"loadstart"==n.type&&("function"==typeof e.onloadstart&&e.onloadstart(n),e.dispatchEvent(n)),"load"==n.type&&("function"==typeof e.onload&&e.onload(n),e.dispatchEvent(n)),"loadend"==n.type&&("function"==typeof e.onloadend&&e.onloadend(n),e.dispatchEvent(n)),"readystatechange"==n.type&&("function"==typeof e.onreadystatechange&&e.onreadystatechange(n),e.dispatchEvent(n))},ue=function(n){C=!0;var t=new Uint8Array(n);if(H)ce(t);else{if(u.parse(t),301==u.getStatusCode()||302==u.getStatusCode())return m=!0,ge(u.getHeaderValue("Location")),void e.send();_=u.getHeaderValue("Content-Type"),H=u.getHeaderValueAsInt("Content-Length"),X.headers=u.getHeaders(),X.body=[],fe(o.HEADERS_RECEIVED),H?ce(t.subarray(u.getContentBegin())):de(!0)}if(H&&H==D){var r=U?U:_;if(e.responseType==V.BLOB)"undefined"!=typeof window?e.response=new Blob(X.body,{type:U?U:_}):he();else if(e.responseType==V.ARRAYBUFFER)he();else if(e.responseType==V.DOMSTRING||e.responseType==V.JSON||e.responseType==V.TEXT){e.response="",e.responseText="";for(var i=0;i<X.body.length;i++)X.body[i]&&(e.response+=a.ab2str(X.body[i]),e.responseText+=a.ab2str(X.body[i]))}else r==V.DOCUMENT;de(!1)}},ce=function(n){X.body.push(n),D+=n.byteLength,fe(o.LOADING,!0),ae({type:"progress",loaded:D,total:H,lengthComputable:!0,target:e})},pe=function(){S=!0,E&&!m&&("function"==typeof e.upload.onprogress&&e.upload.onprogress({type:"progress",loaded:W,total:$,lengthComputable:!0,target:e}),"function"==typeof e.upload.onload&&e.upload.onload({type:"load",loaded:W,total:$,lengthComputable:!0,target:e}),"function"==typeof e.upload.onloadend&&e.upload.onloadend({type:"loadend",loaded:W,total:$,lengthComputable:!0,target:e}))},de=function(n){e.status=u.getStatusCode(),e.statusText=u.getStatusText(),n&&ae({type:"progress",loaded:0,total:0,lengthComputable:!0,target:e}),w=!1,fe(o.DONE),ae({type:"load",loaded:D,total:H?H:0,lengthComputable:!0,target:e}),ae({type:"loadend",loaded:D,total:H?H:0,lengthComputable:!0,target:e})},fe=function(n,t){(e.readyState!=n||t)&&(e.readyState=n,ae({type:"readystatechange",target:e}))},ge=function(e){var n;e.indexOf("//")!=-1?(n=new i(e),"10.0.0.1"==n.hostname&&(n.hostname="localhost"),q=n.host,n.hostname&&(I=n.hostname),n.port&&(M=n.port),d=n.toString()):(n=e,"/"!=n.charAt(0)&&(n="/"+n),d=n),p=e},ye=function(){e.status=n.status,e.statusText=n.statusText,e.response=n.response,e.readyState=n.readyState,e.responseURL=n.responseURL,e.responseType=n.responseType,e.responseType!=V.DOMSTRING&&e.responseType!=V.TEXT||(e.responseText=n.responseText),e.responseType==V.DOCUMENT&&isAsync&&(e.responseXML=n.responseXML),e.upload=n.upload,e.timeout=n.timeout,e.withCredentials=n.withCredentials},he=function(){var n=0;e.response=new ArrayBuffer(D);for(var t=new Uint8Array(e.response),o=0;o<X.body.length;o++)t.set(X.body[o],n),n+=X.body[o].length};e.isSpXMLHttpRequest=!0}o.UNSENT=0,o.OPENED=1,o.HEADERS_RECEIVED=2,o.LOADING=3,o.DONE=4,o.OriginalXMLHttpRequest=function(){return"undefined"!=typeof window?("undefined"==typeof window.OriginalXMLHttpRequest&&(window.OriginalXMLHttpRequest=window.XMLHttpRequest),window.OriginalXMLHttpRequest):null}(),e.exports=o},function(e,n){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(e){if(c===setTimeout)return setTimeout(e,0);if((c===t||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(n){try{return c.call(null,e,0)}catch(n){return c.call(this,e,0)}}}function i(e){if(p===clearTimeout)return clearTimeout(e);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(n){try{return p.call(null,e)}catch(n){return p.call(this,e)}}}function s(){y&&f&&(y=!1,f.length?g=f.concat(g):h=-1,g.length&&l())}function l(){if(!y){var e=r(s);y=!0;for(var n=g.length;n;){for(f=g,g=[];++h<n;)f&&f[h].run();h=-1,n=g.length}f=null,y=!1,i(e)}}function a(e,n){this.fun=e,this.array=n}function u(){}var c,p,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:t}catch(e){c=t}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(e){p=o}}();var f,g=[],y=!1,h=-1;d.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];g.push(new a(e,n)),1!==g.length||y||r(l)},a.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,n){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(e,n,t){function o(e){return t(r(e))}function r(e){var n=i[e];if(!(n+1))throw new Error("Cannot find module '"+e+"'.");return n}var i={"./loggerconfig.js":2};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=11},function(n,t){if("undefined"==typeof e){var o=new Error('Cannot find module "fs"');throw o.code="MODULE_NOT_FOUND",o}n.exports=e},function(e,t){e.exports=n},function(e,n){e.exports=t},function(e,n,t){e.exports={HttpParser:t(3),PiperClient:t(4),SpXMLHttpRequest:t(8),LoaderUtil:t(1),SpaceifyLoader:t(7),LoggerConfig:t(2),Logger:t(0),SpaceifyError:t(5)}}])});

/**
 * Spaceifyloader initialization after window.onload event
 *
 * Spaceify Oy, 9.2.2017
 */

var spaceifyLoader = new window.spl.SpaceifyLoader();

window.onload = function()
	{
	var sp_host, spe_host;

	var hosts = spaceifyLoader.parseQuery(window.location.href);
	if (!hosts.sp_host)
		{
		sp_host = spe_host = window.location.protocol + "//" + window.location.hostname + "/";

		if (typeof document.loadPageSpHost != "undefined")
			sp_host = document.loadPageSpHost;

		if (typeof document.loadPageSpeHost != "undefined")
			spe_host = document.loadPageSpeHost;

		hosts = { sp_host: sp_host, spe_host: spe_host, sp_path: "index.html" };
		}

	spaceifyLoader.getNetworkInfo(function()
		{
		if (!window.isSpaceifyNetwork)
			{
			spaceifyLoader.setConnectionListener(function()
				{
				spaceifyLoader.loadPageOrElements(hosts);
				});

			spaceifyLoader.prepareLoader(hosts);
			}
		else
			{
			spaceifyLoader.prepareLoader(hosts);
			spaceifyLoader.loadPageOrElements(hosts);
			}
		});
	};
