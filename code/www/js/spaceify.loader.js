function HttpParser(){var e=this,n=null,t=0,o=null,i="",r={},c=null,a=null;console;e.getStatusCode=function(){return parseInt(c)},e.getStatusText=function(){return a},e.getContentBegin=function(){return o},e.getHeaderSize=function(){return t},e.getHeaderValueAsInt=function(e){return e=e.toLowerCase(),r.hasOwnProperty(e)?parseInt(r[e]):null},e.getHeaderValue=function(e){if(e=e.toLowerCase(),r.hasOwnProperty(e))return r[e]},e.getHeaders=function(){return r},e.getRawHeaders=function(){return i};var l=function(e){for(var n=0;n<e.byteLength;n+=1)if(n+4<e.byteLength&&13==e[n]&&10==e[n+1]&&13==e[n+2]&&10==e[n+3]){o=n+4;break}t=o?o:e.byteLength},s=function(e){i="",r={},n=o?String.fromCharCode.apply(null,e.subarray(0,o)):String.fromCharCode.apply(null,e);var t=n.split("\n"),l=t[0].split(" ");c=l[1],a=l.length>=3?l[2]:"OK";for(var s=1;s<t.length;s++){var u=t[s].indexOf(":");if(u>-1){var d=t[s].substring(0,u);d=d.toLowerCase();var p="";t[s].length>u&&(p=t[s].substring(u+1).trim()),r[d]=d in r?r[d]+", "+p:p,i+=(""!=i?"\r\n":"")+d+": "+p}}};e.parse=function(e){l(e),s(e)}}function PiperClient(){var e=this,n=null;n="undefined"!=typeof exports?require("../libs/spaceifyconnect.bundle.js"):window.sp;var t=new Object,o=new Object,i=null,r=null,c=new n.CommunicationClient,a=null,l=null,s=console;e.setCookies=function(e){l=e},e.getCookies=function(){return l},e.sendTcpBinary=function(e,n){c.sendBinaryOnConnection(e,n)},e.createTcpTunnel=function(n,o,i,a){s.log("PiperClient::createTcpTunnel(host: "+n+", port: "+o+")\n");var l=n+o;for(var u in t)if(t[u].hostnameAndPort==l)return t[u].listener=i,void a(u);c.createDirectConnection(r,function(r){s.log("PiperClient::createTcpTunnel - Direct Connection Ready for TCP tunnel\n"),c.callRpcOnConnection(r,"tunnelTcp",[n,o],e,function(){s.log("PiperClient::createTcpTunnel - Tunnel pipe ready to host: "+n+", port: "+o+"\n"),t[r]={listener:i,hostnameAndPort:l},a(r)})})},e.createWebSocketTunnel=function(n,t,i){s.log("PiperClient::createWebSocketTunnel(options: "+JSON.stringify(n)+")\n"),c.createDirectConnection(r,function(r){s.log("PiperClient::createWebSocketTunnel - Pipe ready for WebSocket, tunnelId: "+r+"\n"),c.callRpcOnConnection(r,"tunnelWebSocket",[n],e,function(){s.log("PiperClient::createWebSocketTunnel - WebSocket pipe ready to host: "+n.host+", port: "+n.port+"\n"),o[r]=t,i(r)})})},e.exposeRpcMethod=function(e,n,t){c.exposeRpcMethod(e,n,t)},e.callClientRpc=function(e,n,t,o,i){c.callRpcOnConnection(e,n,t,o,i)},e.setBinaryListener=function(e){a=e},e.onBinary=function(e,n,o){t.hasOwnProperty(o)&&t[o].listener(e)},e.onClientDisconnected=function(e){},e.onClientConnected=function(e){e&&(s.log("PiperClient::onClientConnected - "+JSON.stringify(e)+"\n"),"piper"==e.getClientType()&&(s.log("PiperClient::onClientConnected - clientType is 'piper', trying to build a direct connection to it\n"),c.createDirectConnection(e.getClientId(),function(n){s.log("PiperClient::onClientConnected - Direct connection ready, pipeId: "+n+"\n"),r=e.getClientId(),i&&i()})))},e.upgradeToWebRtc=function(e){c.upgradeToWebRtc(r,function(){s.log("PiperClient::upgradeToWebRtc - targetId: "+r+" - Completed\n"),e()})},e.sendBinary=function(e){c.sendBinaryToClient(r,e)},e.connect=function(n,t,o,r,a){s.log("PiperClient::connect(host: "+n+", port: "+t+", isSsl: "+o+", groupId: "+r+")\n"),i=a,c.setClientListener(e),c.setBinaryListener(e),c.connectWithOptions({host:n,port:t,isSsl:!1},"piperclient",r,function(e){s.log("PiperClient::connect - Hub Connection succeeded, givenId: "+e+"\n")})};var u=0,d=1e3;e.testPing=function(e){c.createDirectConnection(r,function(n){p(0,n,e)})};var p=function(n,t,o){if(++n==d+1)return void o(u,d);var i=Date.now();c.callRpcOnConnection(t,"hello",[],e,function(e,r){u+=Date.now()-i,s.log("index: "+n+", time: "+(Date.now()-i)/1e3+", length: "+r.length+"\n"),p(n,t,o)})}}function SpXMLHttpRequest(){var e=this,n=null,t=(console,null),o=null,i=null;"undefined"!=typeof exports?(t=require("urlutils"),o=require("./httpparser"),LoaderUtil=require("./loaderutil"),i=LoaderUtil.piperClient):(t=window.URL,o=window.HttpParser,i=LoaderUtil.piperClient);var r=new o,c="",a="",l="GET",s=null,u=null,d=!1,p=!1,f=!1,C=!1,g=!1,h=!1,y=!1,m=null,R=0,b=null,w=null,v=null,S=null,O=null,L=null,P=null,I=0,T=null,D=[],A=["GET","HEAD","POST","PUT","DELETE","OPTIONS","PATCH"],E=["CONNECT","TRACE","TRACK"],H="80",x="localhost",W="localhost",M="",U={none:"",abort:"end-user abort",fatal:"fatal",timeout:"timeout"},k={basic:"basic",cors:"cors",default:"default",error:"error",opaque:"opaque",opaqueredirect:"opaqueredirect"},N={type:k.default,terminationReason:U.none,url:null,urlList:[],status:200,statusText:"OK",headers:{},body:null,trailer:{},httpsState:"none",CSPList:[],CORSExposedHeaderNameList:[],locationURL:null},q=0,_=0,B={DOMSTRING:"",BLOB:"blob",JSON:"json",TEXT:"text",DOCUMENT:"document",ARRAYBUFFER:"arraybuffer",MOZ_BLOB:"moz-blob",MOZ_CHUNKED_TEXT:"moz-chunked-text",MOZ_CHUNKED_ARRAYBUFFER:"moz-chunked-arraybuffer",MS_STREAM:"ms-stream"},j="^(Accept-Charset)$|^(Accept-Encoding)$|^(Access-Control-Request-Headers)$|^(Access-Control-Request-Method)$|";j+="^(Connection)$|^(Content-Length)$|^(Cookie)$|^(Cookie2)$|^(Date)$|^(DNT)$|^(Expect)$|^(Host)$|^(Keep-Alive)$|",j+="^(Origin)$|^(Referer)$|^(TE)$|^(Trailer)$|^(Transfer-Encoding)$|^(Upgrade)$|^(Via)$|^(Proxy-.*)|^(Sec-.*)",j=new RegExp(j,"i"),e.readyState=SpXMLHttpRequest.UNSENT,e.response="",e.responseText=null,e.responseType=B.DOMSTRING,e.responseURL="",e.responseXML=null,e.status=0,e.statusText="",e.timeout=0,e.withCredentials=!1,e.upload={onabort:null,onerror:null,ontimeout:null,onprogress:null,onloadstart:null,onload:null,onloadend:null},e.onabort=null,e.onerror=null,e.ontimeout=null,e.onprogress=null,e.onloadstart=null,e.onload=null,e.onloadend=null,e.onreadystatechange=null;var X={},G=["abort","error","timeout","progress","loadstart","load","loadend","readystatechange"],$=function(e){ue(),oe(e)},J=function(e){ue(),oe(e)},V=function(e){ue(),oe(e)},F=function(e){ue(),oe(e)},z=function(e){ue(),oe(e)},K=function(e){ue(),oe(e)},Q=function(e){ue(),oe(e)},Y=function(e){ue(),oe(e)};n&&(n.ontimeout=$,n.onprogress=J,n.onabort=V,n.onerror=F,n.onloadstart=z,n.onload=K,n.onloadend=Q,n.onreadystatechange=Y),e.open=function(e,t,o,i,r){n?Z(e,t,o,i,r):ee(e,t,o,i,r)};var Z=function(e,t,o,i,r){l=e,isAsync="undefined"===o||o,s="undefined"!==i?i:null,u="undefined"!==r?r:null,n.open(e,t,isAsync,s,u)},ee=function(e,n,t,o,i){if(!d&&(e=e.toUpperCase(),A.indexOf(e)!=-1&&E.indexOf(e)==-1)){if(l=e,se(n),"undefined"===t&&(t=!0,o=null,i=null),s=o?o:null,u=i?i:null,x){var r="";s&&(r=s),u&&r&&(r+=":"+u),r&&(x=r+"@"+x)}p=!1,g=!1,h=!1,C=!t,D=[],N.type=k.error,N.status=0,N.statusText="",N.headers={},N.body=null,N.trailer={},w=null,v=null,S=null,O=null,d=!0,le(SpXMLHttpRequest.OPENED)}};e.send=function(e){n?ne(e):te(e)};var ne=function(t){return isAsync&&(n.responseType=e.responseType),n.send(t)},te=function(n){if(n&&(b=n),I=0,d&&(!p||f)){"GET"!=l&&"HEAD"!=l||(b=null),(e.upload.onabort||e.upload.onerror||e.upload.ontimeout||e.upload.onprogress||e.upload.onloadstart||e.upload.onload||e.upload.onloadend)&&(h=!0),M=l+" "+a+" HTTP/1.1\r\nHost: "+x;for(var t=0;t<D.length;t++)M+="\r\n"+D[t].header+": "+D[t].value;b&&(M+="\r\nContent-Length: "+b.length+"\r\n",M+=b),M+="\r\n\r\n";var o=LoaderUtil.toab(M);q=o.byteLength,y=!1,b||(y=!0),p=!0,C||(f||oe({type:"loadstart",loaded:0,total:0,lengthComputable:!1,target:e}),!y&&h&&("function"!=typeof e.upload.onloadstart||f||e.upload.onloadstart({type:"loadstart",loaded:0,total:M.length,lengthComputable:!0,target:e})),m&&clearInterval(m),m=null,R=0,e.timeout>0&&(m=setInterval(function(){g?clearInterval(m):++R>=e.timeout&&clearInterval(m)},1))),_=0,i.createTcpTunnel(W,H,ie,function(e){i.sendTcpBinary(e,o),_=q,ce(),f=!1})}};e.setRequestHeader=function(e,t){if(n)n.setRequestHeader(e,t);else{if(!d)return;if(p)return;if(e=e.trim().toLowerCase(),!e||!t)return;if(e.match(j))return;D.push({header:e,value:t})}},e.abort=function(){n&&(e.readyState=SpXMLHttpRequest.UNSENT,n.abort())},e.getResponseHeader=function(e){return n?n.getResponseHeader(e):r.getHeaderValue(e)},e.getAllResponseHeaders=function(){return n?n.getAllResponseHeaders():r.getRawHeaders()},e.overrideMimeType=function(t){return n?n.overrideMimeType(t):void(e.readyState!=SpXMLHttpRequest.LOADING&&e.readyState!=SpXMLHttpRequest.DONE&&(t=t.toLowerCase(),T=t))},e.addEventListener=function(e,t,o){var i=o;if(n)n.addEventListener(e,t,o);else{if(G.indexOf(e)===-1)return;"boolean"==typeof o&&(i={capture:o,once:!1,passive:!1}),e in X||(X[e]=[]),X[e].push({listener:t,options:i})}},e.removeEventListener=function(e,t,o){var i=o;if(n)n.removeEventListener(e,t,o);else{if(G.indexOf(e)===-1||!(e in X))return;"boolean"==typeof o&&(i={capture:o,passive:!1});for(var r=X[e],c=r.length-1;c>=0;c--)r[c].listener==t&&r[c].splice(c,1);0==X[e].length&&delete X[e]}},e.dispatchEvent=function(e){if(n)n.dispatchEvent(e);else{if(!(e.type in X))return;e.target=this;for(var t=X[e.type],o=0,i=t.length;o<i;o++)t[o].listener.call(this,e)}};var oe=function(n){"timeout"==n.type&&("function"==typeof e.ontimeout&&e.ontimeout(n),e.dispatchEvent(n)),"progress"==n.type&&("function"==typeof e.onprogress&&e.onprogress(n),e.dispatchEvent(n)),"abort"==n.type&&("function"==typeof e.onabort&&e.onabort(n),e.dispatchEvent(n)),"error"==n.type&&("function"==typeof e.onerror&&e.onerror(n),e.dispatchEvent(n)),"loadstart"==n.type&&("function"==typeof e.onloadstart&&e.onloadstart(n),e.dispatchEvent(n)),"load"==n.type&&("function"==typeof e.onload&&e.onload(n),e.dispatchEvent(n)),"loadend"==n.type&&("function"==typeof e.onloadend&&e.onloadend(n),e.dispatchEvent(n)),"readystatechange"==n.type&&("function"==typeof e.onreadystatechange&&e.onreadystatechange(n),e.dispatchEvent(n))},ie=function(n){g=!0;var t=new Uint8Array(n);if(P)re(t);else{if(r.parse(t),301==r.getStatusCode()||302==r.getStatusCode())return f=!0,se(r.getHeaderValue("Location")),void e.send();L=r.getHeaderValue("Content-Type"),P=r.getHeaderValueAsInt("Content-Length"),N.headers=r.getHeaders(),N.body=[],le(SpXMLHttpRequest.HEADERS_RECEIVED),P?re(t.subarray(r.getContentBegin())):ae(!0)}if(P&&P==I){var o=T?T:L;if(e.responseType==B.BLOB)"undefined"!=typeof window?e.response=new Blob(N.body,{type:T?T:L}):de();else if(e.responseType==B.ARRAYBUFFER)de();else if(e.responseType==B.DOMSTRING||e.responseType==B.JSON||e.responseType==B.TEXT)for(var i=0;i<N.body.length;i++)N.body[i]&&(e.responseText+=LoaderUtil.ab2str(N.body[i]));else o==B.DOCUMENT;ae(!1)}},re=function(n){N.body.push(n),I+=n.byteLength,le(SpXMLHttpRequest.LOADING,!0),oe({type:"progress",loaded:I,total:P,lengthComputable:!0,target:e})},ce=function(){y=!0,h&&!f&&("function"==typeof e.upload.onprogress&&e.upload.onprogress({type:"progress",loaded:_,total:q,lengthComputable:!0,target:e}),"function"==typeof e.upload.onload&&e.upload.onload({type:"load",loaded:_,total:q,lengthComputable:!0,target:e}),"function"==typeof e.upload.onloadend&&e.upload.onloadend({type:"loadend",loaded:_,total:q,lengthComputable:!0,target:e}))},ae=function(n){e.status=r.getStatusCode(),e.statusText=r.getStatusText(),n&&oe({type:"progress",loaded:0,total:0,lengthComputable:!0,target:e}),p=!1,le(SpXMLHttpRequest.DONE),oe({type:"load",loaded:I,total:P?P:0,lengthComputable:!0,target:e}),oe({type:"loadend",loaded:I,total:P?P:0,lengthComputable:!0,target:e})},le=function(n,t){(e.readyState!=n||t)&&(e.readyState=n,oe({type:"readystatechange",target:e}))},se=function(e){var n;e.indexOf("//")!=-1?(n=new t(e),"10.0.0.1"==n.hostname&&(n.hostname="localhost"),x=n.host,n.hostname&&(W=n.hostname),n.port&&(H=n.port),a=n.toString()):(n=e,"/"!=n.charAt(0)&&(n="/"+n),a=n),c=e},ue=function(){e.status=n.status,e.statusText=n.statusText,e.response=n.response,e.readyState=n.readyState,e.responseURL=n.responseURL,e.responseType=n.responseType,e.responseType!=B.DOMSTRING&&e.responseType!=B.TEXT||(e.responseText=n.responseText),e.responseType==B.DOCUMENT&&isAsync&&(e.responseXML=n.responseXML),e.upload=n.upload,e.timeout=n.timeout,e.withCredentials=n.withCredentials},de=function(){var n=0;e.response=new ArrayBuffer(I);for(var t=new Uint8Array(e.response),o=0;o<N.body.length;o++)t.set(N.body[o],n),n+=N.body[o].length};e.isSpXMLHttpRequest=!0}function LoaderUtil(){var e=this,n=null;n="undefined"!=typeof exports?require("sessionstorage"):window.sessionStorage,e.Utf8ArrayToStr=function(e){var n,t,o,i,r,c;for(n="",o=e.length||e.byteLength,t=0;t<o;)switch(i=e[t++],i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(i);break;case 12:case 13:r=e[t++],n+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[t++],c=e[t++],n+=String.fromCharCode((15&i)<<12|(63&r)<<6|(63&c)<<0)}return n},e.ab2str=function(n){return e.Utf8ArrayToStr(n)},e.str2ab=function(e){for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),o=0,i=e.length;o<i;o++)t[o]=e.charCodeAt(o);return n},e.toab=function(e){for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),o=0,i=e.length;o<i;o++)t[o]=e.charCodeAt(o);return n},e.getSession=function(e){return n.getItem(e)?n.getItem(e):""},e.setSession=function(e,t){t||(t=""),n.setItem(e,t.trim())}}function SpaceifyLoader(){var e=this,n=null,t=null,o=!1,i=null,r=null,c=0,a="x-edge-session",l=console;e.loadData=function(e,o){var i,r,c,a,l=new XMLHttpRequest;return e.getAttribute("sp_src")?(i="sp_src",c="src"):e.getAttribute("spe_src")?(i="spe_src",c="src"):e.getAttribute("sp_href")?(i="sp_href",c="href"):e.getAttribute("spe_href")?(i="spe_href",c="href"):e.getAttribute("sp_bgnd")&&(i="sp_bgnd",c=""),a=e.getAttribute(i),r="spe_src"==i||"spe_href"==i?t:n,a.indexOf("//")==-1&&r&&(a=new URL(a,r).toString()),a?(l.addEventListener("loadend",function(n){if(4==l.readyState){var t=l.response;if(e.onload=function(n){"sp_bgnd"!=i&&window.URL.revokeObjectURL(e[c]),"function"==typeof o&&o()},"sp_bgnd"==i){var r=new window.FileReader;r.readAsDataURL(t),r.onloadend=function(){e.style.backgroundImage="url("+r.result+")"}}else e[c]=window.URL.createObjectURL(t);e.removeAttribute(i)}}),l.open("GET",a,!0),l.responseType="blob",void l.send()):void("function"==typeof o&&o())},e.postData=function(e,n,t,o){var i,r=new XMLHttpRequest;r.addEventListener("loadend",function(e){if(4==r.readyState)if(LoaderUtil.setSession("sessionCookies",r.getResponseHeader("Set-Cookie")),(i=r.getResponseHeader(a))&&LoaderUtil.setSession(a,i),200!=r.status)"function"==typeof o&&o(r.status,null);else if(r.response instanceof Blob){var n=new FileReader;n.onload=function(e){"function"==typeof o&&o(null,n.result)},n.readAsText(r.response.data,"UTF-8")}else"function"==typeof o&&o(null,JSON.stringify(r.response))});for(var c="---------------------------"+Date.now().toString(16),l="",s=0;s<n.length;s++)l+="\r\n--"+c+"\r\n",l+=n[s].content,l+="\r\n\r\n"+n[s].data+"\r\n";l+="\r\n--"+c+"--",r.withCredentials=!0,r.open("POST",e,!0),r.responseType=t?t:"text",r.setRequestHeader("Cookie",LoaderUtil.getSession("sessionCookies")),r.setRequestHeader(a,LoaderUtil.getSession(a)),r.setRequestHeader("Content-Type","multipart/form-data; boundary="+c),r.send(l)},e.loadPage=function(e,n,t){var o=new XMLHttpRequest;o.addEventListener("loadend",function(e){if(4==o.readyState){LoaderUtil.setSession("sessionCookies",o.getResponseHeader("Set-Cookie")),(hvalue=o.getResponseHeader(a))&&LoaderUtil.setSession(a,hvalue);var i=document.open("text/html","replace");i.write(o.responseText),i.close(),i.loadPageSpHost=n,i.loadPageSpeHost=t}}),o.withCredentials=!0,o.open("GET",e,!0),o.setRequestHeader("Cookie",LoaderUtil.getSession("sessionCookies")),o.setRequestHeader(a,LoaderUtil.getSession(a)),o.send(null)},e.getAllElements=function(){var e=Array.prototype.slice.call(document.querySelectorAll("[sp_src]")),n=Array.prototype.slice.call(document.querySelectorAll("[spe_src]")),t=Array.prototype.slice.call(document.querySelectorAll("[sp_href]")),o=Array.prototype.slice.call(document.querySelectorAll("[spe_href]")),i=Array.prototype.slice.call(document.querySelectorAll("[sp_bgnd]"));r=o.concat(t,n,e,i),l.log("SpaceifyLoader::loadAll() :: Number of elements with sp_src:",e.length,", spe_src:",n.length,", sp_href:",t.length,", spe_href:",o.length,", sp_bgnd:",i.length)},e.hasElements=function(){return!!(r&&r.length>0)},e.recurseElements=function(){if(c<r.length)e.loadData(r[c],function(){c++,e.recurseElements()});else{var n=document.createEvent("Event");n.initEvent("spaceifyReady",!0,!0),window.dispatchEvent(n)}},e.parseQuery=function(e){var n,t,o,i={};e=decodeURIComponent(e),e=e.replace(/#.*$/,""),n=e.split("?"),n=n.length<2?n[0]:n[1],o=n.split("&");for(var r=0,c=o.length;r<c;r++)o[r]&&(t=o[r].split("="),i[t[0]]=2==t.length?t[1]:null);return i},e.setSpHosts=function(e){n=e.sp_host,t=e.spe_host},e.connect=function(e,n,t,o,r){l.log("SpaceifyLoader::connect(host: "+e+", port: "+n+")"),LoaderUtil.piperClient.connect(e,n,t,o,function(){i&&i(),r()})},e.setConnectionListener=function(e){i=e,o&&e()}}function getNetworkInfo(e){window.isSpaceifyNetwork=!1;var n=new SpXMLHttpRequest.OriginalXMLHttpRequest;n.open("HEAD",window.location.protocol+"//10.0.0.1/templates/test.txt",!0),n.timeout=1e3,n.addEventListener("loadend",function(t){4==n.readyState&&(window.isSpaceifyNetwork=n.status>=200&&n.status<304,e())}),n.send()}function prepareLoader(e){spaceifyLoader.setSpHosts(e),window.isSpaceifyNetwork?window.XMLHttpRequest=SpXMLHttpRequest.OriginalXMLHttpRequest:(window.isSpaceifyNetwork=!1,window.XMLHttpRequest=SpXMLHttpRequest,spaceifyLoader.connect(LoaderUtil.SERVER_ADDRESS.host,LoaderUtil.SERVER_ADDRESS.port,LoaderUtil.SERVER_ADDRESS.isSsl,LoaderUtil.SERVER_ADDRESS.groupId,function(){}))}function loadPageOrElements(e){spaceifyLoader.getAllElements(),spaceifyLoader.hasElements()?(elementIndex=0,spaceifyLoader.recurseElements()):spaceifyLoader.loadPage(e.sp_host+e.sp_path,e.sp_host,e.spe_host)}if(function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("wrtc"),require("websocket")):"function"==typeof define&&define.amd?define(["wrtc","websocket"],n):"object"==typeof exports?exports.sp=n(require("wrtc"),require("websocket")):e.sp=n(e.wrtc,e.websocket)}(this,function(e,n){return function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){e.exports={Client:t(1),WebRtcConnector:t(2),CommunicationClient:t(6),RpcCommunicator:t(7),WebRtcPeerConnection:t(3),WebSocketRpcConnection:t(11),CallBackBuffer:t(8),WebSocketConnection:t(9),DataChannelConnection:t(4)}},function(e,n,t){function o(e,n,t){var o=this,i=e,r=n,c=!1,a=!1,l=null,s=new Array;o.toJSON=function(){var e={clientId:i,clientType:r,webRtc:c,localHub:a,preferredConnectionId:l};return e},o.isArrivedBeforeUs=function(){return t},o.setClientId=function(e){i=e},o.setClientType=function(e){r=e},o.setWebRtc=function(e){c=e},o.setPreferredConnectionId=function(e){l=e},o.getClientId=function(){return i},o.getClientType=function(){return r},o.isWebRtc=function(){return c},o.getPreferredConnectionId=function(){return l},o.isLocalHub=function(){return a},o.setLocalHub=function(e){a=e},o.addPipeId=function(e){s.push(e)},o.getBinaryConnectionId=function(){return pipeId},o.getConnectionType=function(){return c?"WebRtc":a?"Local Hub":"Cloud"}}e.exports=o},function(e,n,t){function o(e,n,o){var i=this,r=null;r=t(3);var c=console,a=new Object,l=new Object,s=null;i.setConnectionListener=function(e){s=e},i.onIceCandidate=function(t,o){c.log("iceCandidate got, sending it to the other client"),e.callRpc("callClientRpc",[o,"handleIceCandidate",[t]],i,null,n)};var u=function(e){a[e]=new r(o),a[e].setPartnerId(e),a[e].setIceListener(i),a[e].setStreamListener(i),a[e].setConnectionListener(i),a[e].setDataChannelListener(i)};i.shutdown=function(e){c.log("WebRtcConnector::onbeforeunload");for(var n in a)a.hasOwnProperty(n)&&(a[n].close(),delete a[n])},i.handleRtcOffer=function(t,o,r){c.log("WebRtcConnector::handleRtcOffer() descriptor: "+t),a.hasOwnProperty(o)||u(o),a[o].onConnectionOfferReceived(t,o,function(t){c.log("WebRtcConnector::handleRtcOffer() onConnectionOfferReceived returned"),c.log("Trying to call handleRtcAnswer on partner "+o),e.callRpc("callClientRpc",[o,"handleRtcAnswer",[t]],i,null,n),c.log("handleRtcAnswer call done on partner "+o)})},i.handleRtcAnswer=function(e,n,t){c.log("WebRtcConnector::handleRtcAnswer()"),a[n].onConnectionAnswerReceived(e)},i.handleIceCandidate=function(e,n,t){c.log("WebRtcConnector::handleIceCandidate()"),a.hasOwnProperty(n)||u(n),a[n].onIceCandidateReceived(e)},i.onDisconnected=function(n){if(c.log("WebRtcConnector::onDisconnected() "),a.hasOwnProperty(n)){for(var t=a[n],o=t.getDataChannelConnections(),i=0;i<o.length;i++)e.onDisconnected(o[i]);s.onWebRtcDisconnected(n),t.close(),delete a[n]}},i.onPrimaryDataChannelOpen=function(n,t){c.log("WebRtcConnector::onPrimaryDataChannelOpen() ");var o=e.addConnection(t);s&&s.onWebRtcConnected(n,o),l.hasOwnProperty(n)&&l[n].apply()},i.onAdditionalDataChannelOpen=function(n,t){c.log("WebRtcConnector::onAdditionalDataChannelOpen() ");var o=e.addConnection(t);s&&s.onAdditionalDataChannelOpen(n,o)},i.onStream=function(e,n){c.log("WebRtcConnector::onStream()")},i.onRemoveStream=function(e,n){c.log("WebRtcConnector::onRemoveStream()"),i.onDisconnected(n)},i.connectToPeer=function(t,o){return c.log("WebRtcConnector::connectToPeer() partnerId: "+t),a.hasOwnProperty(t)?void c.log("WebRtcConnector::connectToPeer() connection to partnerId: "+t+" already exists or is under construction, not connecting again"):(u(t),o&&(l[t]=o),void a[t].createConnectionOffer(function(o){c.log("Offer created, sending it to the other client "+t),e.callRpc("callClientRpc",[t,"handleRtcOffer",[o]],i,null,n)}))},i.createDataChannelConnection=function(n,t){a[n].createDataChannelConnection(function(n){c.log("WebRtcConnector::createDataChannelConnection() callback returned");var o=e.addConnection(n);t(o)})},"undefined"!=typeof window&&(window.onbeforeunload=i.shutdown),e.exposeRpcMethod("handleRtcOffer",i,i.handleRtcOffer),e.exposeRpcMethod("handleRtcAnswer",i,i.handleRtcAnswer),e.exposeRpcMethod("handleIceCandidate",i,i.handleIceCandidate)}"undefined"!=typeof window&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),e.exports=o},function(e,n,t){function o(e){var n=this,o=null,i=null,r=null,c=null;c=t(4);var a=t(5);o=a.RTCPeerConnection,i=a.RTCSessionDescription,r=a.RTCIceCandidate,"undefined"!=typeof window&&(o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,r=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate);var l=console,s=null,u=null,d=null,p=null,f=null,C=null,g=new Array,h={optional:[{DtlsSrtpKeyAgreement:!0}]},y=new o(e,h),m=null,R=0;n.createDataChannelConnection=function(e){R++;var n=y.createDataChannel(R,{reliable:!0});n.onopen=function(){l.log("WebRtcPeerConnection::channel.onopen")},n.binaryType="arraybuffer",n.onmessage=function(){var t=new c(n);g.push(t),e(t)}},y.ondatachannel=function(e){var t=e.channel||e;if(l.log("WebRtcPeerConnection::ondatachannel() "+t),t.binaryType="arraybuffer",null==m)m=new c(t),t.onopen=n.onPrimaryDataChannelOpen;else{var o=new c(t);t.onopen=function(){l.log("WebRtcPeerConnection::temp.onopen"),t.send("OK"),g.push(o),p&&p.onAdditionalDataChannelOpen(s,o)}}},n.onPrimaryDataChannelOpen=function(e){l.log("WebRtcPeerConnection::onPrimaryDataChannelOpen "+e),g.push(m),p&&p.onPrimaryDataChannelOpen(s,m)},n.onAdditionalDataChannelOpen=function(e){l.log("WebRtcPeerConnection::onAdditionalDataChannelOpen "+e)},n.getDataChannelConnections=function(){return g},n.onPrimaryDataChannelClosed=function(e){l.log("WebRtcPeerConnectiononDataChannelClosed "+e),f.onDisconnected(s)},n.setDataChannelListener=function(e){p=e};var b=function(e){l.info("signaling state change:",e)},w=function(e){l.info("ice connection state change:",e),!f||"disconnected"!=y.iceConnectionState&&"closed"!=y.iceConnectionState||f.onDisconnected(s)},v=function(e){l.info("ice gathering state change:",e)},S=function(e){l.log("WebRtcPeerConnectiononIceCanditate() partnerId: "+s+" event: "+e),l.log("iceListener was "+u),null==e.candidate?l.log("All Ice candidates listed"):u.onIceCandidate(e.candidate,s)};y.onsignalingstatechange=b,y.oniceconnectionstatechange=w,y.onicegatheringstatechange=v,y.onicecandidate=S,n.close=function(){l.log("WebRtcPeerConnectionclose"),"closed"==y.signalingState&&"closing"==y.signalingState||y.close()},n.getPartnerId=function(){return s},n.setPartnerId=function(e){s=e},n.setIceListener=function(e){u=e,l.log("WebRtcPeerConnectionsetIceListener()"+e)},n.setStreamListener=function(e){d=e,y.onaddstream=function(e){n.onStream(e)},y.onremovestream=function(e){n.onRemoveStream(e)}},n.setConnectionListener=function(e){f=e},n.onStream=function(e){l.log("WebRtcPeerConnectiononStream"+e),d.onStream(e.stream,s)},n.onRemoveStream=function(e){l.log("WebRtcPeerConnectiononStream"+e),d.onRemoveStream(e.stream,s)},n.addStream=function(e){C=e,y.addStream(e)},n.createConnectionOffer=function(e){var t=null,o=y.createDataChannel("jsonrpcchannel",{reliable:!0});o.binaryType="arraybuffer",o.onopen=n.onPrimaryDataChannelOpen,m=new c(o),y.createOffer(function(n){l.log("peerConnection::createOffer called its callback: "+n),t=n,y.setLocalDescription(n,function(){e(y.localDescription,s)},function(e){l.log("WebRtcPeerConnectioncreateConnectionOffer() setLocalDescription error")},{})},function(e){l.log(e)})},n.onConnectionAnswerReceived=function(e){l.log("WebRtcPeerConnectiononConnectionAnswerReceived(), descriptor: "+e),y.setRemoteDescription(new i(e),function(){l.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned OK")},function(e){l.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned error "+e)})},n.onConnectionOfferReceived=function(e,n,t){l.log("WebRtcPeerConnectiononConnectionOfferReceived"),l.log("WebRtcPeerConnectiononConnectionOfferReceived trying to set remote description");var o=new i(e);y.setRemoteDescription(o,function(){l.log("WebRtcPeerConnectiononConnectionOfferReceived remote description set"),y.createAnswer(function(e){y.setLocalDescription(e,function(){t(y.localDescription)},function(e){l.log(e)})},function(e){l.log(e)})},function(e){l.log("WebRtcPeerConnectiononConnectionOfferReceived setting remote description failed "+e)})},n.onIceCandidateReceived=function(e){y.addIceCandidate(new r(e),function(){l.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate succeeded")},function(e){l.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate failed "+e)})}}e.exports=o},function(e,n,t){function o(e){var n=this,t=e,o=console,i=null,r=null;n.send=function(e){o.log("DataChannelConnection::send()"+e);try{"open"==t.readyState&&t.send(e)}catch(e){o.log(e)}},n.close=function(){o.log("DataChannelConnection::close")},n.sendBinary=function(e){try{"open"==t.readyState&&t.send(e)}catch(e){o.log(e)}},n.getBufferedAmount=function(){return t.bufferedAmount},n.setId=function(e){i=e},n.getId=function(){return i},n.setListener=function(e){r=e},n.onMessage=function(e){try{r&&r.onMessage(e.data,n)}catch(e){o.log(e)}},n.setPipedTo=function(e){},n.getPipedTo=function(){return null},t.onmessage=n.onMessage}e.exports=o},function(n,t){n.exports=e},function(e,n,t){function o(){var e=this,n=null,o=null,i=null,r=null;n=t(7),o=t(9),i=t(1),r=t(2);var c=console,a=null,l=null,s=null,u=new Object,d=null,p=null,f=null,C=null,g=null,h=new n,y=new o,m=new Object,R=new Object,b=new Object,w=(new n,null);e.callRpcOnClient=function(e,n,t,o,i){c.log("CommunicationClient::callRpcOnClient(clientId: "+e+", methodName: "+n+")\n"),m.hasOwnProperty(e)&&(m[e].isWebRtc()?(c.log("CommunicationClient::callRpcOnClient - Calling client RPC through WebRtc, preferredConnectionId was: "+m[e].getPreferredConnectionId()+"\n"),t.push(d),h.callRpc(n,t,o,i,m[e].getPreferredConnectionId())):m[e].isLocalHub()?(c.log("CommunicationClient::callRpcOnClient - Calling client RPC through local hub\n"),h.callRpc("callClientRpc",[e,n,t],o,i,m[e].getPreferredConnectionId())):(c.log("CommunicationClient::callRpcOnClient - Notifying client RPC through the server, serverId: "+g+"\n"),h.callRpc("callClientRpc",[e,n,t],o,i,g)))},e.callRpcOnConnection=function(e,n,t,o,i){c.log("CommunicationClient::callRpcOnConnection(connectionId: "+e+", methodName: "+n+")\n"),c.log("CommunicationClient::callRpcOnConnection - Making a RPC call over direct connection\n"),t.push(d),h.callRpc(n,t,o,i,e)},e.notifyClient=function(e,n,t){c.log("CommunicationClient::notifyClient(clientId: "+e+", methodName: "+n+")\n"),m.hasOwnProperty(e)&&(m[e].isWebRtc()?(c.log("CommunicationClient::notifyClient - Notifying client through WebRtc\n"),t.push(d),h.callRpc(n,t,null,null,m[e].getPreferredConnectionId())):m[e].isLocalHub()?(c.log("CommunicationClient::notifyClient - Notifying client through local hub\n"),h.callRpc("callClientRpc",[e,n,t],null,null,m[e].getPreferredConnectionId())):(c.log("CommunicationClient::notifyClient - Notifying client through the server, serverId: "+g+"\n"),h.callRpc("callClientRpc",[e,n,t],null,null,g)))},e.sendBinaryOnConnection=function(e,n){h.sendBinary(n,e)},e.getClientsByType=function(e){return R[e]},e.getConnectionType=function(e){return m[e].getConnectionType()},e.upgradeToWebRtc=function(e,n){c.log("CommunicationClient::upgradeToWebRtc(clientId: "+e+")\n"),m[e].isWebRtc()||w.connectToPeer(e,n)},e.getBufferedAmount=function(e){return h.getConnection(e).getBufferedAmount()},e.createDirectConnection=function(n,t){c.log("CommunicationClient::createDirectConnection(clientId: "+n+")\n"),m[n].isWebRtc()?w.createDataChannelConnection(n,function(e){c.log("CommunicationClient::createDirectConnection - Callback returned connectionId: "+e+"\n"),b[e]=n,t(e)}):e.createPipe(n,t)},e.onWebRtcConnected=function(e,n){c.log("CommunicationClient::onWebRtcConnected(clientId: "+e+", connectionId: "+n+")\n"),m.hasOwnProperty(e)&&(m[e].setWebRtc(!0),m[e].setPreferredConnectionId(n)),f&&f.onConnectionTypeUpdated(m[e],m[e].getConnectionType())},e.onWebRtcDisconnected=function(e){c.log("CommunicationClient::onWebRtcDisconnected(partnerId: "+e+")\n")},e.onAdditionalDataChannelOpen=function(e,n){c.log("CommunicationClient::onAdditionalDataChannelOpen(clientId: "+e+", connectionId: "+n+")\n"),b[n]=e},e.createPipe=function(n,t){c.log("CommunicationClient::createPipe(clientId: "+n+")\n");var i,r=new o;r.connect(a,function(){i=h.addConnection(r),c.log("CommunicationClient::createPipe - Pipe connected to the WebSocket server, pipeId: "+i+"\n"),h.callRpc("constructPipe",[n,d],e,function(){c.log("CommunicationClient::createPipe - Pipe construction ready\n"),m.hasOwnProperty(n)&&(m[n].addPipeId(i),b[i]=n),t(i)},i)})},e.requestPipe=function(n,t,i,r){c.log("CommunicationClient::requestPipe(targetId: "+n+", originatorId: "+t+", connectionId: "+i+")\n");var l=null,s=new o;s.connect(a,function(){l=h.addConnection(s),c.log("CommunicationClient::requestPipe - Pipe connected to the WebSocket server, pipeId: "+l+"\n"),h.callRpc("registerAsPipe",[n],e,function(e,n){c.log("CommunicationClient::requestPipe - registerAsPipe returned\n"),m.hasOwnProperty(t)&&(m[t].addPipeId(l),b[l]=t),r(null,"Ok")},l)})},e.pipeToExternalConnection=function(e,n){var t=h.addConnection(n);c.log("CommunicationClient::pipeToExternalConnection(), connectionId: "+e+", externalId: "+t+"\n"),h.setupPipe(e,t)},e.onBinary=function(e,n){C&&(b.hasOwnProperty(n)?C.onBinary(e,b[n],n):C.onBinary(e,n))},e.setClientListener=function(e){p=e},e.setConnectionTypeListener=function(e){f=e},e.setBinaryListener=function(e){C=e};var v=function(e,n,t){c.log("CommunicationClient::addClient(clientId: "+e+", clientType: "+n+", arrivedBeforeUs: "+t+")\n");
var o=null;return m.hasOwnProperty(e)?o=m[e]:(o=new i(e,n,t),m[e]=o),R.hasOwnProperty(n)||(R[n]=new Object),R[n][e]=o,o},S=function(e){delete R[m[e].getClientType()][e],delete m[e]},O=function(n,t){c.log("CommunicationClient::updateConnectedClients(hubId: "+n+")\n");var o=g;n&&(o=n),h.callRpc("getConnectedClients",[s],e,function(e,i){c.log("CommunicationClient::updateConnectedClients got answer from hub: "+JSON.stringify(i)+"\n");var r=null;for(var a in i)m.hasOwnProperty(a)||i[a].clientId==d?n&&(m[a].setLocalHub(!0),m[a].setPreferredConnectionId(o)):(r=null==n?v(i[a].clientId,i[a].clientType,!0):v(i[a].clientId,i[a].clientType,!1),!n&&p&&r.getClientId()!=d&&p.onClientConnected(r));t()},o)},L=function(n,t){if(c.log("CommunicationCLient::connectToLocalHubs(hubs: "+JSON.stringify(n)+")\n"),null!=n){var i=null,r=null,a=null;for(var p in n){i=n[p].port;for(var f=0;f<n[p].localIps.length;f++){r=n[p].localIps[f];var C={host:r,port:i,id:d},g=null;a=new o,a.connect(C,function(){c.log("CommunicationClient::connectToLocalHubs - Connected to local hub at ip: "+r+" port: "+i+"\n"),g=h.addConnection(a),u[g]=g,O(g,function(){h.callRpc("registerAsClient",[d,l,s],e,function(e,n){c.log("CommunicationClient::connectToLocalHubs - Registered as client at local hub at ip: "+r+", port: "+i+"\n")})})})}}t()}},P=function(n){c.log("CommunicationClient::updateLocalHubs() - Getting list of local hubs from the server\n"),h.callRpc("getLocalHubs",[],e,function(e,t){c.log("CommunicationClient::updateLocalHubs - Following local hubs are available: "+JSON.stringify(t)+"\n"),t?L(t,n):n()},g)};e.exposeRpcMethod=function(e,n,t){h.exposeRpcMethod(e,n,t)},e.connectWithOptions=function(n,t,o,i){c.log("CommunicationClient::connectWithOptions(options: "+JSON.stringify(n)+", clientType: "+t+", groupId: "+o+")\n"),l=t,s=o,h.setBinaryListener(e),n.hasOwnProperty("id")||(n.id=null),a=n,y.connect(a,function(){g=h.addConnection(y),c.log("CommunicationClient::connectWithOptions - Connected to the WebSocket server, serverId: "+g+"\n"),w=new r(h,g,"undefined"!=typeof LoaderUtil?LoaderUtil.WEBRTC_CONFIG:WEBRTC_CONFIG),w.setConnectionListener(e),h.callRpc("registerAsClient",[null,l,s],e,function(e,n){c.log("CommunicationClient::connectWithOptions - Server replied to registerAsClient call, ownId: "+n+"\n"),d=n,O(null,function(){P(function(){i(n)})})},g)})},e.connect=function(n,t,o,i,r){return a={host:n,port:t,id:null},e.connectWithOptions(a,o,i,r)},e.onClientConnected=function(e,n,t){if(c.log("CommunicationClient::onClientConnected(clientData: "+JSON.stringify(e)+", connectionId: "+n+") - ownId: "+d+"\n"),e.clientId!=d){if(u.hasOwnProperty(n))return c.log("CommunicationClient::onClientConnected - Client connected through localhub, clientId: "+e.clientId+"\n"),m[e.clientId].setLocalHub(!0),void m[e.clientId].setPreferredConnectionId(n);if(!m.hasOwnProperty(e.clientId)){c.log("CommunicationClient::onClientConnected - addClient clientId: "+e.clientId+"\n");var o=v(e.clientId,e.clientType,!1);p&&o.getClientId()!=d&&p.onClientConnected(o)}}},e.onClientDisconnected=function(e,n,t){c.log("CommunicationClient::onClientDisconnected(connectionId: "+n+", clientData: "+JSON.stringify(e)+")\n"),m.hasOwnProperty(e.clientId)&&p&&e.clientId!=d&&(p.onClientDisconnected(m[e.clientId]),S(e.clientId))},e.onHubConnected=function(e,n,t){c.log("CommunicationClient::onHubConnected(hubData: "+JSON.stringify(e)+")\n")},e.onHubDisconnected=function(e,n,t){c.log("CommunicationClient::onHubDisconnected(hubData: "+JSON.stringify(e)+")\n")},e.getConnectedClients=function(){return m},e.getOwnId=function(){return d},h.exposeRpcMethod("onClientConnected",e,e.onClientConnected),h.exposeRpcMethod("onClientDisconnected",e,e.onClientDisconnected),h.exposeRpcMethod("onHubConnected",e,e.onHubConnected),h.exposeRpcMethod("onHubDisconnected",e,e.onHubDisconnected),h.exposeRpcMethod("requestPipe",e,e.requestPipe)}e.exports=o},function(e,n,t){function o(){var e=this,n=null;n=t(8);var o=1,i=new Object,r=null,c=null,a=null,l=new n,s=new Object,u=0,d=null,p=console,f=function(e,n){try{s[n].send(JSON.stringify(e))}catch(e){p.log(e)}};e.sendMessage=f;var C=function(e,n,t,o){try{if(e){f({jsonrpc:"2.0",error:e,id:t},o);var i="undefined"!=typeof e.code?e.code:"",r="undefined"!=typeof e.path?e.path:"",c="undefined"!=typeof e.message?e.message:"";p.log("Exception in executing a RPC method: "+i+" RpcCommunicator::onMessage() >> "+r+" "+c)}else f({jsonrpc:"2.0",result:n,id:t},o)}catch(e){p.log(e)}},g=function(e,n){try{if(!e.jsonrpc||"2.0"!=e.jsonrpc||!e.method)return void f({jsonrpc:"2.0",error:{code:-32600,message:"Invalid JSON-RPC."},id:null},n);if("[object Array]"!==Object.prototype.toString.call(e.params))return void f({jsonrpc:"2.0",error:{code:-32602,message:"Parameters must be sent inside an array."},id:e.id},n);if(!i.hasOwnProperty(e.method))return null!=e.id?void f({jsonrpc:"2.0",error:{code:-32601,message:"Method "+e.method+" not found."},id:e.id},n):void f({jsonrpc:"2.0",error:{code:-32601,message:"Method "+e.method+" not found."},id:null},n);var t=i[e.method];"undefined"==typeof e.params&&(e.params=new Array),null!=e.id?(e.params.push(n),e.params.push(function(t,o){C(t,o,e.id,n)}),t.method.apply(t.object,e.params)):(e.params.push(n),e.params.push(function(e,n){}),t.method.apply(t.object,e.params))}catch(e){p.log(e)}},h=function(e){try{var n=null,t=null;"undefined"!=typeof e.error&&(n=e.error),"undefined"!=typeof e.result&&(t=e.result),e.id?l.callMethodAndPop(e.id,n,t):p.log("RpcCommunicator::handleReturnValue() error: "+JSON.stringify(n))}catch(e){p.log(e)}},y=function(e,n){try{e.method?g(e,n):h(e)}catch(e){p.log(e)}},m=function(){u++;for(var e=u;;)if(e=Math.floor(4294967296*Math.random()),!s.hasOwnProperty(e))break;return e};e.exposeRpcMethod=function(e,n,t){try{i[e]={object:n,method:t}}catch(e){p.log(e)}},e.setConnectionListener=function(e,n){r={object:e,listener:n}},e.setDisconnectionListener=function(e,n){c={object:e,listener:n}},e.setBinaryListener=function(e){a=e},e.connectionExists=function(e){return!("undefined"==typeof e||!s.hasOwnProperty(e))||!("undefined"!=typeof e||!s.hasOwnProperty(d))},e.getConnection=function(e){return s[e]},e.callRpc=function(n,t,i,r,c){if(e.connectionExists(c))try{"function"==typeof r?(l.pushBack(o,i,r),"undefined"!=typeof c?f({jsonrpc:"2.0",method:n,params:t,id:""+o},c):f({jsonrpc:"2.0",method:n,params:t,id:""+o},d),o++):"undefined"!=typeof c?f({jsonrpc:"2.0",method:n,params:t},c):f({jsonrpc:"2.0",method:n,params:t},d)}catch(e){p.log(e)}},e.notifyAll=function(e,n){try{for(var t in s)f({jsonrpc:"2.0",method:e,params:n,id:null},t)}catch(e){p.log(e)}},e.getBufferedAmount=function(e){return s[e].getBufferedAmount()},e.sendBinary=function(e,n){try{s[n].sendBinary(e)}catch(e){p.log(e)}},e.setupPipe=function(e,n){s.hasOwnProperty(e)&&s.hasOwnProperty(n)&&(s[e].setPipedTo(n),s[n].setPipedTo(e))},e.closeConnection=function(e){try{e in s&&(s[e].close(),delete s[e])}catch(e){p.log(e)}},e.onMessage=function(e,n){try{var t=n.getPipedTo();if(null!=t)return void s[t].send(e);if(e instanceof ArrayBuffer)return void(a&&a.onBinary(e,n.getId()));var o;try{o=JSON.parse(e)}catch(e){return void f({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},n.getId())}y(o,n.getId())}catch(e){p.log(e)}},e.addConnection=function(n){try{return n.getId()||n.setId(m()),s[n.getId()]=n,n.setListener(e),r&&r.listener.call(r.object,n.getId()),d=n.getId(),n.getId()}catch(e){p.log(e)}},e.onDisconnected=function(n){try{e.closeConnection(n),c&&c.listener.call(c.object,n)}catch(e){p.log(e)}}}e.exports=o},function(e,n,t){function o(e){var n=this,t=new Object;n.pushBack=function(e,n,o){t[e]=[n,o]},n.callMethodAndPop=function(e,n,o){if(!t.hasOwnProperty(e))throw{error:"CallbackBuffer::callMethodAndPop(). Callback not found"};t[e][1].call(t[e][0],n,o,e),delete t[e]}}e.exports=o},function(e,n,t){function o(){var e=this,n=null;n=t(10),n="undefined"!=typeof window?window.WebSocket:n.w3cwebsocket;var o=console,i=null,r=null,c=null,a=null,l=null,s=null,u=null;e.connect=function(t,r){t.protocol=t.isSsl?"wss":"ws";try{var c=t.protocol+"://"+t.host+":"+t.port+"/json-rpc";t.id&&(c+="?id="+t.id),o.log("WebSocketConnection::connect() "+c),i=new n(c,"json-rpc",null,null,t.isSsl?{rejectUnauthorized:!1}:null),i.binaryType="arraybuffer",i.onopen=function(){r(null)},i.onmessage=p,i.onclose=function(n,t){f(n,t,e)}}catch(e){o.log(e)}},e.setSocket=function(n){o.log("WebSocketConnection::setSocket()");try{i=n,i.on("message",d),i.on("close",function(n,t){f(n,t,e)})}catch(e){o.log(e)}},e.setId=function(e){r=e},e.setPipedTo=function(e){u=e},e.getPipedTo=function(){return u},e.setRemoteAddress=function(e){c=e},e.setRemotePort=function(e){a=e},e.setOrigin=function(e){l=e},e.setListener=function(e){s=e},e.getId=function(){return r},e.getRemoteAddress=function(){return c},e.getRemotePort=function(){return a},e.getOrigin=function(){return l};var d=function(n){try{s&&("utf8"==n.type&&s.onMessage(n.utf8Data,e),"binary"==n.type&&s.onMessage(n.binaryData,e))}catch(e){o.log(e)}},p=function(n){try{s&&s.onMessage(n.data,e)}catch(e){o.log(e)}},f=function(e,n,t){try{s&&s.onDisconnected(t.getId())}catch(e){o.log(e)}};e.send=function(e){try{i.send(e)}catch(e){o.log(e)}},e.sendBinary=e.send,e.close=function(){try{i.close()}catch(e){o.log(e)}}}e.exports=o},function(e,t){e.exports=n},function(e,n,t){function o(){var e=this,n=null,o=null;n=t(7),o=t(9);var i=new o,r=new n,c=console;e.callRpc=function(e,n,t,o){return r.callRpc(e,n,t,o)},e.connect=function(e,n){c.log("WebSocketRpcConnection::connect()"),i.connect(e,function(){c.log("WebsocketRpcConnection Connected"),r.addConnection(i),c.log("WebsocketRpcConnection added to communicator"),n(null,null)})},e.close=function(){},e.getCommunicator=function(){return r}}e.exports=o}])}),"undefined"!=typeof exports&&(module.exports=HttpParser),"undefined"!=typeof exports&&(module.exports=PiperClient),SpXMLHttpRequest.UNSENT=0,SpXMLHttpRequest.OPENED=1,SpXMLHttpRequest.HEADERS_RECEIVED=2,SpXMLHttpRequest.LOADING=3,SpXMLHttpRequest.DONE=4,SpXMLHttpRequest.OriginalXMLHttpRequest=function(){return"undefined"!=typeof window?("undefined"==typeof window.OriginalXMLHttpRequest&&(window.OriginalXMLHttpRequest=window.XMLHttpRequest),window.OriginalXMLHttpRequest):null}(),"undefined"!=typeof exports&&(module.exports=SpXMLHttpRequest),"undefined"!=typeof exports)var PiperClient=require("./piperclient");LoaderUtil.prototype.SERVER_ADDRESS=function(){var e="testgroup";if("undefined"!=typeof window){var n=window.location.hostname.split(".");3==n.length&&"edge"!=n[0]&&(e=n[0])}return{host:"spaceify.net",port:1979,groupId:e,isSsl:!1}}(),LoaderUtil.prototype.WEBRTC_CONFIG=function(){return{iceServers:[{url:"stun:kandela.tv"},{url:"turn:kandela.tv",username:"webrtcuser",credential:"jeejeejee"}]}}(),LoaderUtil.prototype.piperClient=function(){return new PiperClient}(),window&&(window.openOriginal=window.open,window.open=function(e,n,t,o,i){var r,c,a,l,s,u,d=new SpaceifyCore,p=new SpaceifyNetwork;d.getApplicationURL(e,function(d,f){return d?void("function"==typeof i&&i(null)):(r=p.isSecure()?f.securePort:f.port,l=p.getEdgeURL(!1,!1,!0),a=f.implementsWebServer&&r?p.getEdgeURL(!1,r,!0):p.externalResourceURL(e),c=p.parseQuery(n),c.sp_host=encodeURIComponent(a),c.sp_path=encodeURIComponent(n),c.spe_host=encodeURIComponent(l),s=l+"remote.html/"+p.remakeQueryString(c,{},{},"",!0),u=window.openOriginal(s,t?t:"_blank",o?o:""),void u.addEventListener("load",function(){"function"==typeof i&&i(this)}))})}),"undefined"!=typeof exports?(module.exports=new LoaderUtil,global.SERVER_ADDRESS=module.exports.SERVER_ADDRESS,global.WEBRTC_CONFIG=module.exports.WEBRTC_CONFIG):LoaderUtil=new LoaderUtil;var spaceifyLoader=new SpaceifyLoader;window.onload=function(){var e,n,t=spaceifyLoader.parseQuery(window.location.href);t.sp_host||(e=n=window.location.protocol+"//"+window.location.hostname+"/","undefined"!=typeof document.loadPageSpHost&&(e=document.loadPageSpHost),"undefined"!=typeof document.loadPageSpeHost&&(n=document.loadPageSpeHost),t={sp_host:e,spe_host:n,sp_path:"index.html"}),getNetworkInfo(function(){window.isSpaceifyNetwork?(prepareLoader(t),loadPageOrElements(t)):(spaceifyLoader.setConnectionListener(function(){loadPageOrElements(t)}),prepareLoader(t))})};