window.spllogs={"global":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpXMLHttpRequest":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyLoader":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"PiperClient":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"LoaderUtil":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"HttpParser":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false}};

function HttpParser(){var e=this,n=null,t=0,o=null,i="",r={},c=null,a=null,l="undefined"==typeof window?require("../libs/spaceifyconnect.bundle.js"):window.sp;new l.Logger("HttpParser","spllogs");e.getStatusCode=function(){return parseInt(c)},e.getStatusText=function(){return a},e.getContentBegin=function(){return o},e.getHeaderSize=function(){return t},e.getHeaderValueAsInt=function(e){return e=e.toLowerCase(),r.hasOwnProperty(e)?parseInt(r[e]):null},e.getHeaderValue=function(e){if(e=e.toLowerCase(),r.hasOwnProperty(e))return r[e]},e.getHeaders=function(){return r},e.getRawHeaders=function(){return i};var s=function(e){for(var n=0;n<e.byteLength;n+=1)if(n+4<e.byteLength&&13==e[n]&&10==e[n+1]&&13==e[n+2]&&10==e[n+3]){o=n+4;break}t=o?o:e.byteLength},u=function(e){i="",r={},n=o?String.fromCharCode.apply(null,e.subarray(0,o)):String.fromCharCode.apply(null,e);var t=n.split("\n"),l=t[0].split(" ");c=l[1],a=l.length>=3?l[2]:"OK";for(var s=1;s<t.length;s++){var u=t[s].indexOf(":");if(u>-1){var d=t[s].substring(0,u);d=d.toLowerCase();var p="";t[s].length>u&&(p=t[s].substring(u+1).trim()),r[d]=d in r?r[d]+", "+p:p,i+=(""!=i?"\r\n":"")+d+": "+p}}};e.parse=function(e){s(e),u(e)}}function PiperClient(){var e=this,n="undefined"==typeof window?require("../libs/spaceifyconnect.bundle.js"):window.sp,t=new n.Logger("PiperClient","spllogs"),o=new n.CommunicationClient,i=new Object,r=new Object,c=null,a=null,l=null,s=null;e.setCookies=function(e){s=e},e.getCookies=function(){return s},e.sendTcpBinary=function(e,n){o.sendBinaryOnConnection(e,n)},e.createTcpTunnel=function(n,r,c,l){t.log("PiperClient::createTcpTunnel(host: "+n+", port: "+r+")\n");var s=n+r;for(var u in i)if(i[u].hostnameAndPort==s)return i[u].listener=c,void l(u);o.createDirectConnection(a,function(a){t.log("PiperClient::createTcpTunnel - Direct Connection Ready for TCP tunnel\n"),o.callRpcOnConnection(a,"tunnelTcp",[n,r],e,function(){t.log("PiperClient::createTcpTunnel - Tunnel pipe ready to host: "+n+", port: "+r+"\n"),i[a]={listener:c,hostnameAndPort:s},l(a)})})},e.createWebSocketTunnel=function(n,i,c){t.log("PiperClient::createWebSocketTunnel(options: "+JSON.stringify(n)+")\n"),o.createDirectConnection(a,function(a){t.log("PiperClient::createWebSocketTunnel - Pipe ready for WebSocket, tunnelId: "+a+"\n"),o.callRpcOnConnection(a,"tunnelWebSocket",[n],e,function(){t.log("PiperClient::createWebSocketTunnel - WebSocket pipe ready to host: "+n.host+", port: "+n.port+"\n"),r[a]=i,c(a)})})},e.exposeRpcMethod=function(e,n,t){o.exposeRpcMethod(e,n,t)},e.callClientRpc=function(e,n,t,i,r){o.callRpcOnConnection(e,n,t,i,r)},e.setBinaryListener=function(e){l=e},e.onBinary=function(e,n,t){i.hasOwnProperty(t)&&i[t].listener(e)},e.onClientDisconnected=function(e){},e.onClientConnected=function(e){e&&(t.log("PiperClient::onClientConnected - "+JSON.stringify(e)+"\n"),"piper"==e.getClientType()&&(t.log("PiperClient::onClientConnected - clientType is 'piper', trying to build a direct connection to it\n"),o.createDirectConnection(e.getClientId(),function(n){t.log("PiperClient::onClientConnected - Direct connection ready, pipeId: "+n+"\n"),a=e.getClientId(),c&&c()})))},e.upgradeToWebRtc=function(e){o.upgradeToWebRtc(a,function(){t.log("PiperClient::upgradeToWebRtc - targetId: "+a+" - Completed\n"),e()})},e.sendBinary=function(e){o.sendBinaryToClient(a,e)},e.connect=function(n,i,r,a,l){t.log("PiperClient::connect(host: "+n+", port: "+i+", isSsl: "+r+", groupId: "+a+")\n"),c=l,o.setClientListener(e),o.setBinaryListener(e),o.connectWithOptions({host:n,port:i,isSsl:!1},"piperclient",a,function(e){t.log("PiperClient::connect - Hub Connection succeeded, givenId: "+e+"\n")})};var u=0,d=1e3;e.testPing=function(e){o.createDirectConnection(a,function(n){p(0,n,e)})};var p=function(n,i,r){if(++n==d+1)return void r(u,d);var c=Date.now();o.callRpcOnConnection(i,"hello",[],e,function(e,o){u+=Date.now()-c,t.log("index: "+n+", time: "+(Date.now()-c)/1e3+", length: "+o.length+"\n"),p(n,i,r)})}}function SpXMLHttpRequest(){var e=this,n=null,t="undefined"==typeof window?require("../libs/spaceifyconnect.bundle.js"):window.sp,o=(new t.Logger("SpXMLHttpRequest","spllogs"),null),i=null,r=null;"undefined"==typeof window?(o=require("urlutils"),i=require("./httpparser"),LoaderUtil=require("./loaderutil"),r=LoaderUtil.piperClient):(o=window.URL,i=window.HttpParser,r=LoaderUtil.piperClient);var c=new i,a="",l="",s="GET",u=null,d=null,p=!1,f=!1,g=!1,C=!1,h=!1,y=!1,w=!1,m=null,R=0,b=null,v=null,S=null,O=null,L=null,T=null,P=null,I=0,D=null,E=[],A=["GET","HEAD","POST","PUT","DELETE","OPTIONS","PATCH"],H=["CONNECT","TRACE","TRACK"],W="80",x="localhost",M="localhost",k="",U={none:"",abort:"end-user abort",fatal:"fatal",timeout:"timeout"},N={basic:"basic",cors:"cors",default:"default",error:"error",opaque:"opaque",opaqueredirect:"opaqueredirect"},q={type:N.default,terminationReason:U.none,url:null,urlList:[],status:200,statusText:"OK",headers:{},body:null,trailer:{},httpsState:"none",CSPList:[],CORSExposedHeaderNameList:[],locationURL:null},_=0,j=0,B={DOMSTRING:"",BLOB:"blob",JSON:"json",TEXT:"text",DOCUMENT:"document",ARRAYBUFFER:"arraybuffer",MOZ_BLOB:"moz-blob",MOZ_CHUNKED_TEXT:"moz-chunked-text",MOZ_CHUNKED_ARRAYBUFFER:"moz-chunked-arraybuffer",MS_STREAM:"ms-stream"},X="^(Accept-Charset)$|^(Accept-Encoding)$|^(Access-Control-Request-Headers)$|^(Access-Control-Request-Method)$|";X+="^(Connection)$|^(Content-Length)$|^(Cookie)$|^(Cookie2)$|^(Date)$|^(DNT)$|^(Expect)$|^(Host)$|^(Keep-Alive)$|",X+="^(Origin)$|^(Referer)$|^(TE)$|^(Trailer)$|^(Transfer-Encoding)$|^(Upgrade)$|^(Via)$|^(Proxy-.*)|^(Sec-.*)",X=new RegExp(X,"i"),e.readyState=SpXMLHttpRequest.UNSENT,e.response="",e.responseText=null,e.responseType=B.DOMSTRING,e.responseURL="",e.responseXML=null,e.status=0,e.statusText="",e.timeout=0,e.withCredentials=!1,e.upload={onabort:null,onerror:null,ontimeout:null,onprogress:null,onloadstart:null,onload:null,onloadend:null},e.onabort=null,e.onerror=null,e.ontimeout=null,e.onprogress=null,e.onloadstart=null,e.onload=null,e.onloadend=null,e.onreadystatechange=null;var F={},G=["abort","error","timeout","progress","loadstart","load","loadend","readystatechange"],J=function(e){de(),ie(e)},$=function(e){de(),ie(e)},V=function(e){de(),ie(e)},K=function(e){de(),ie(e)},z=function(e){de(),ie(e)},Q=function(e){de(),ie(e)},Y=function(e){de(),ie(e)},Z=function(e){de(),ie(e)};n&&(n.ontimeout=J,n.onprogress=$,n.onabort=V,n.onerror=K,n.onloadstart=z,n.onload=Q,n.onloadend=Y,n.onreadystatechange=Z),e.open=function(e,t,o,i,r){n?ee(e,t,o,i,r):ne(e,t,o,i,r)};var ee=function(e,t,o,i,r){s=e,isAsync="undefined"===o||o,u="undefined"!==i?i:null,d="undefined"!==r?r:null,n.open(e,t,isAsync,u,d)},ne=function(e,n,t,o,i){if(!p&&(e=e.toUpperCase(),A.indexOf(e)!=-1&&H.indexOf(e)==-1)){if(s=e,ue(n),"undefined"===t&&(t=!0,o=null,i=null),u=o?o:null,d=i?i:null,x){var r="";u&&(r=u),d&&r&&(r+=":"+d),r&&(x=r+"@"+x)}f=!1,h=!1,y=!1,C=!t,E=[],q.type=N.error,q.status=0,q.statusText="",q.headers={},q.body=null,q.trailer={},v=null,S=null,O=null,L=null,p=!0,se(SpXMLHttpRequest.OPENED)}};e.send=function(e){n?te(e):oe(e)};var te=function(t){return isAsync&&(n.responseType=e.responseType),n.send(t)},oe=function(n){if(n&&(b=n),I=0,p&&(!f||g)){"GET"!=s&&"HEAD"!=s||(b=null),(e.upload.onabort||e.upload.onerror||e.upload.ontimeout||e.upload.onprogress||e.upload.onloadstart||e.upload.onload||e.upload.onloadend)&&(y=!0),k=s+" "+l+" HTTP/1.1\r\nHost: "+x;for(var t=0;t<E.length;t++)k+="\r\n"+E[t].header+": "+E[t].value;b&&(k+="\r\nContent-Length: "+b.length+"\r\n",k+=b),k+="\r\n\r\n";var o=LoaderUtil.toab(k);_=o.byteLength,w=!1,b||(w=!0),f=!0,C||(g||ie({type:"loadstart",loaded:0,total:0,lengthComputable:!1,target:e}),!w&&y&&("function"!=typeof e.upload.onloadstart||g||e.upload.onloadstart({type:"loadstart",loaded:0,total:k.length,lengthComputable:!0,target:e})),m&&clearInterval(m),m=null,R=0,e.timeout>0&&(m=setInterval(function(){h?clearInterval(m):++R>=e.timeout&&clearInterval(m)},1))),j=0,r.createTcpTunnel(M,W,re,function(e){r.sendTcpBinary(e,o),j=_,ae(),g=!1})}};e.setRequestHeader=function(e,t){if(n)n.setRequestHeader(e,t);else{if(!p)return;if(f)return;if(e=e.trim().toLowerCase(),!e||!t)return;if(e.match(X))return;E.push({header:e,value:t})}},e.abort=function(){n&&(e.readyState=SpXMLHttpRequest.UNSENT,n.abort())},e.getResponseHeader=function(e){return n?n.getResponseHeader(e):c.getHeaderValue(e)},e.getAllResponseHeaders=function(){return n?n.getAllResponseHeaders():c.getRawHeaders()},e.overrideMimeType=function(t){return n?n.overrideMimeType(t):void(e.readyState!=SpXMLHttpRequest.LOADING&&e.readyState!=SpXMLHttpRequest.DONE&&(t=t.toLowerCase(),D=t))},e.addEventListener=function(e,t,o){var i=o;if(n)n.addEventListener(e,t,o);else{if(G.indexOf(e)===-1)return;"boolean"==typeof o&&(i={capture:o,once:!1,passive:!1}),e in F||(F[e]=[]),F[e].push({listener:t,options:i})}},e.removeEventListener=function(e,t,o){var i=o;if(n)n.removeEventListener(e,t,o);else{if(G.indexOf(e)===-1||!(e in F))return;"boolean"==typeof o&&(i={capture:o,passive:!1});for(var r=F[e],c=r.length-1;c>=0;c--)r[c].listener==t&&r[c].splice(c,1);0==F[e].length&&delete F[e]}},e.dispatchEvent=function(e){if(n)n.dispatchEvent(e);else{if(!(e.type in F))return;e.target=this;for(var t=F[e.type],o=0,i=t.length;o<i;o++)t[o].listener.call(this,e)}};var ie=function(n){"timeout"==n.type&&("function"==typeof e.ontimeout&&e.ontimeout(n),e.dispatchEvent(n)),"progress"==n.type&&("function"==typeof e.onprogress&&e.onprogress(n),e.dispatchEvent(n)),"abort"==n.type&&("function"==typeof e.onabort&&e.onabort(n),e.dispatchEvent(n)),"error"==n.type&&("function"==typeof e.onerror&&e.onerror(n),e.dispatchEvent(n)),"loadstart"==n.type&&("function"==typeof e.onloadstart&&e.onloadstart(n),e.dispatchEvent(n)),"load"==n.type&&("function"==typeof e.onload&&e.onload(n),e.dispatchEvent(n)),"loadend"==n.type&&("function"==typeof e.onloadend&&e.onloadend(n),e.dispatchEvent(n)),"readystatechange"==n.type&&("function"==typeof e.onreadystatechange&&e.onreadystatechange(n),e.dispatchEvent(n))},re=function(n){h=!0;var t=new Uint8Array(n);if(P)ce(t);else{if(c.parse(t),301==c.getStatusCode()||302==c.getStatusCode())return g=!0,ue(c.getHeaderValue("Location")),void e.send();T=c.getHeaderValue("Content-Type"),P=c.getHeaderValueAsInt("Content-Length"),q.headers=c.getHeaders(),q.body=[],se(SpXMLHttpRequest.HEADERS_RECEIVED),P?ce(t.subarray(c.getContentBegin())):le(!0)}if(P&&P==I){var o=D?D:T;if(e.responseType==B.BLOB)"undefined"!=typeof window?e.response=new Blob(q.body,{type:D?D:T}):pe();else if(e.responseType==B.ARRAYBUFFER)pe();else if(e.responseType==B.DOMSTRING||e.responseType==B.JSON||e.responseType==B.TEXT)for(var i=0;i<q.body.length;i++)q.body[i]&&(e.responseText+=LoaderUtil.ab2str(q.body[i]));else o==B.DOCUMENT;le(!1)}},ce=function(n){q.body.push(n),I+=n.byteLength,se(SpXMLHttpRequest.LOADING,!0),ie({type:"progress",loaded:I,total:P,lengthComputable:!0,target:e})},ae=function(){w=!0,y&&!g&&("function"==typeof e.upload.onprogress&&e.upload.onprogress({type:"progress",loaded:j,total:_,lengthComputable:!0,target:e}),"function"==typeof e.upload.onload&&e.upload.onload({type:"load",loaded:j,total:_,lengthComputable:!0,target:e}),"function"==typeof e.upload.onloadend&&e.upload.onloadend({type:"loadend",loaded:j,total:_,lengthComputable:!0,target:e}))},le=function(n){e.status=c.getStatusCode(),e.statusText=c.getStatusText(),n&&ie({type:"progress",loaded:0,total:0,lengthComputable:!0,target:e}),f=!1,se(SpXMLHttpRequest.DONE),ie({type:"load",loaded:I,total:P?P:0,lengthComputable:!0,target:e}),ie({type:"loadend",loaded:I,total:P?P:0,lengthComputable:!0,target:e})},se=function(n,t){(e.readyState!=n||t)&&(e.readyState=n,ie({type:"readystatechange",target:e}))},ue=function(e){var n;e.indexOf("//")!=-1?(n=new o(e),"10.0.0.1"==n.hostname&&(n.hostname="localhost"),x=n.host,n.hostname&&(M=n.hostname),n.port&&(W=n.port),l=n.toString()):(n=e,"/"!=n.charAt(0)&&(n="/"+n),l=n),a=e},de=function(){e.status=n.status,e.statusText=n.statusText,e.response=n.response,e.readyState=n.readyState,e.responseURL=n.responseURL,e.responseType=n.responseType,e.responseType!=B.DOMSTRING&&e.responseType!=B.TEXT||(e.responseText=n.responseText),e.responseType==B.DOCUMENT&&isAsync&&(e.responseXML=n.responseXML),e.upload=n.upload,e.timeout=n.timeout,e.withCredentials=n.withCredentials},pe=function(){var n=0;e.response=new ArrayBuffer(I);for(var t=new Uint8Array(e.response),o=0;o<q.body.length;o++)t.set(q.body[o],n),n+=q.body[o].length};e.isSpXMLHttpRequest=!0}function LoaderUtil(){var e=this,n=null;n="undefined"==typeof window?require("sessionstorage"):window.sessionStorage,e.Utf8ArrayToStr=function(e){var n,t,o,i,r,c;for(n="",o=e.length||e.byteLength,t=0;t<o;)switch(i=e[t++],i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(i);break;case 12:case 13:r=e[t++],n+=String.fromCharCode((31&i)<<6|63&r);break;case 14:r=e[t++],c=e[t++],n+=String.fromCharCode((15&i)<<12|(63&r)<<6|(63&c)<<0)}return n},e.ab2str=function(n){return e.Utf8ArrayToStr(n)},e.str2ab=function(e){for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),o=0,i=e.length;o<i;o++)t[o]=e.charCodeAt(o);return n},e.toab=function(e){for(var n=new ArrayBuffer(e.length),t=new Uint8Array(n),o=0,i=e.length;o<i;o++)t[o]=e.charCodeAt(o);return n},e.getSession=function(e){return n.getItem(e)?n.getItem(e):""},e.setSession=function(e,t){t||(t=""),n.setItem(e,t.trim())}}function SpaceifyLoader(){var e=this,n=null,t=null,o=!1,i=null,r=null,c=0,a="x-edge-session",l="undefined"==typeof window?require("../libs/spaceifyconnect.bundle.js"):window.sp,s=new l.Logger("SpaceifyLoader","spllogs");e.loadData=function(e,o){var i,r,c,a,l=new XMLHttpRequest;return e.getAttribute("sp_src")?(i="sp_src",c="src"):e.getAttribute("spe_src")?(i="spe_src",c="src"):e.getAttribute("sp_href")?(i="sp_href",c="href"):e.getAttribute("spe_href")?(i="spe_href",c="href"):e.getAttribute("sp_bgnd")&&(i="sp_bgnd",c=""),a=e.getAttribute(i),r="spe_src"==i||"spe_href"==i?t:n,a.indexOf("//")==-1&&r&&(a=new URL(a,r).toString()),a?(l.addEventListener("loadend",function(n){if(4==l.readyState){var t=l.response;if(e.onload=function(n){"sp_bgnd"!=i&&window.URL.revokeObjectURL(e[c]),"function"==typeof o&&o()},"sp_bgnd"==i){var r=new window.FileReader;r.readAsDataURL(t),r.onloadend=function(){e.style.backgroundImage="url("+r.result+")"}}else e[c]=window.URL.createObjectURL(t);e.removeAttribute(i)}}),l.open("GET",a,!0),l.responseType="blob",void l.send()):void("function"==typeof o&&o())},e.postData=function(e,n,t,o){var i,r=new XMLHttpRequest;r.addEventListener("loadend",function(e){if(4==r.readyState)if(LoaderUtil.setSession("sessionCookies",r.getResponseHeader("Set-Cookie")),(i=r.getResponseHeader(a))&&LoaderUtil.setSession(a,i),200!=r.status)"function"==typeof o&&o(r.status,null);else if(r.response instanceof Blob){var n=new FileReader;n.onload=function(e){"function"==typeof o&&o(null,n.result)},n.readAsText(r.response.data,"UTF-8")}else"function"==typeof o&&o(null,JSON.stringify(r.response))});for(var c="---------------------------"+Date.now().toString(16),l="",s=0;s<n.length;s++)l+="\r\n--"+c+"\r\n",l+=n[s].content,l+="\r\n\r\n"+n[s].data+"\r\n";l+="\r\n--"+c+"--",r.withCredentials=!0,r.open("POST",e,!0),r.responseType=t?t:"text",r.setRequestHeader("Cookie",LoaderUtil.getSession("sessionCookies")),r.setRequestHeader(a,LoaderUtil.getSession(a)),r.setRequestHeader("Content-Type","multipart/form-data; boundary="+c),r.send(l)},e.loadPage=function(e,n,t){var o=new XMLHttpRequest;o.addEventListener("loadend",function(e){if(4==o.readyState){LoaderUtil.setSession("sessionCookies",o.getResponseHeader("Set-Cookie")),(hvalue=o.getResponseHeader(a))&&LoaderUtil.setSession(a,hvalue);var i=document.open("text/html","replace");i.write(o.responseText),i.close(),i.loadPageSpHost=n,i.loadPageSpeHost=t}}),o.withCredentials=!0,o.open("GET",e,!0),o.setRequestHeader("Cookie",LoaderUtil.getSession("sessionCookies")),o.setRequestHeader(a,LoaderUtil.getSession(a)),o.send(null)},e.getAllElements=function(){var e=Array.prototype.slice.call(document.querySelectorAll("[sp_src]")),n=Array.prototype.slice.call(document.querySelectorAll("[spe_src]")),t=Array.prototype.slice.call(document.querySelectorAll("[sp_href]")),o=Array.prototype.slice.call(document.querySelectorAll("[spe_href]")),i=Array.prototype.slice.call(document.querySelectorAll("[sp_bgnd]"));r=o.concat(t,n,e,i),s.log("SpaceifyLoader::loadAll() :: Number of elements with sp_src: "+e.length+", spe_src: "+n.length+", sp_href: "+t.length+", spe_href: "+o.length+", sp_bgnd: "+i.length)},e.hasElements=function(){return!!(r&&r.length>0)},e.recurseElements=function(){if(c<r.length)e.loadData(r[c],function(){c++,e.recurseElements()});else{var n=document.createEvent("Event");n.initEvent("spaceifyReady",!0,!0),window.dispatchEvent(n)}},e.parseQuery=function(e){var n,t,o,i={};e=decodeURIComponent(e),e=e.replace(/#.*$/,""),n=e.split("?"),n=n.length<2?n[0]:n[1],o=n.split("&");for(var r=0,c=o.length;r<c;r++)o[r]&&(t=o[r].split("="),i[t[0]]=2==t.length?t[1]:null);return i},e.setSpHosts=function(e){n=e.sp_host,t=e.spe_host},e.connect=function(e,n,t,o,r){s.log("SpaceifyLoader::connect(host: "+e+", port: "+n+")"),LoaderUtil.piperClient.connect(e,n,t,o,function(){i&&i(),r()})},e.setConnectionListener=function(e){i=e,o&&e()}}function getNetworkInfo(e){window.isSpaceifyNetwork=!1;var n=new SpXMLHttpRequest.OriginalXMLHttpRequest;n.open("HEAD",window.location.protocol+"//10.0.0.1/templates/test.txt",!0),n.timeout=1e3,n.addEventListener("loadend",function(t){4==n.readyState&&(window.isSpaceifyNetwork=n.status>=200&&n.status<304,e())}),n.send()}function prepareLoader(e){spaceifyLoader.setSpHosts(e),window.isSpaceifyNetwork?window.XMLHttpRequest=SpXMLHttpRequest.OriginalXMLHttpRequest:(window.isSpaceifyNetwork=!1,window.XMLHttpRequest=SpXMLHttpRequest,spaceifyLoader.connect(LoaderUtil.SERVER_ADDRESS.host,LoaderUtil.SERVER_ADDRESS.port,LoaderUtil.SERVER_ADDRESS.isSsl,LoaderUtil.SERVER_ADDRESS.groupId,function(){}))}function loadPageOrElements(e){spaceifyLoader.getAllElements(),spaceifyLoader.hasElements()?(elementIndex=0,spaceifyLoader.recurseElements()):spaceifyLoader.loadPage(e.sp_host+e.sp_path,e.sp_host,e.spe_host)}if(function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("fs"),require("websocket"),require("wrtc")):"function"==typeof define&&define.amd?define("sp",["fs","websocket","wrtc"],n):"object"==typeof exports?exports.sp=n(require("fs"),require("websocket"),require("wrtc")):e.sp=n(e.fs,e.websocket,e.wrtc)}(this,function(e,n,t){return function(e){function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=16)}([function(e,n,t){(function(n){function o(e,o,i){var r=this,c=null,a="undefined"==typeof window,l=function(e,n){try{return n.accessSync(e,n.F_OK),!0}catch(e){return!1}};if(a){var s,u=t(13),d="/var/lib/spaceify/code/";l(d+"spaceifyerror.js"),u&&(c=!function(){var e=new Error('Cannot find module "."');throw e.code="MODULE_NOT_FOUND",e}()),s=l("./"+o+".json",u)?u.readFileSync("./"+o+".json","utf8"):l(d+o+".json",u)?u.readFileSync(d+o+".json","utf8"):"{}",o=JSON.parse(s)}else"undefined"!=typeof window&&(c=window.SpaceifyError?window.SpaceifyError:null);c&&(c=new c),r.RETURN=1;var p="log",f="dir",g="info";r.ERROR="error";var C=r.ERROR,h="warn";r.FORCE="force";var y=r.FORCE,w="stdout",m="all",R={};R[p]="[i] ",R[f]="[d] ",R[g]="[i] ",R[C]="[e] ",R[h]="[w] ",R[y]="",R[w]="";var b=e&&o&&o[e]?o[e]:{};if(i)for(var v in i)b[v]=i[v];if(b[p]=!("undefined"==typeof b[p]||!b[p])&&b[p],b[f]=!("undefined"==typeof b[f]||!b[f])&&b[f],b[g]=!("undefined"==typeof b[g]||!b[g])&&b[g],b[C]=!("undefined"==typeof b[C]||!b[C])&&b[C],b[h]=!("undefined"==typeof b[h]||!b[h])&&b[h],b[m]=!("undefined"==typeof b[m]||!b[m])&&b[m],o.global){var S=o.global;b[p]="undefined"!=typeof S[p]&&S[p]?S[p]:b[p],b[f]="undefined"!=typeof S[f]&&S[f]?S[f]:b[f],b[g]="undefined"!=typeof S[g]&&S[g]?S[g]:b[g],b[C]="undefined"!=typeof S[C]&&S[C]?S[C]:b[C],b[h]="undefined"!=typeof S[h]&&S[h]?S[h]:b[h],b[m]="undefined"!=typeof S[m]&&S[m]?S[m]:b[m]}b[y]=!1,r.log=function(){O(p,!1,arguments)},r.dir=function(){O(f,!1,arguments)},r.info=function(){O(g,!1,arguments)},r.error=function(){L.apply(this,arguments)},r.warn=function(){O(h,!1,arguments)},r.force=function(){O(y,!1,arguments)},r.stdout=function(){O(w,!0,arguments)};var O=function(e,t){if(!b[m]&&!b[e]||e==y){var o,i,r="",c=arguments[2];if(a){for(var l=0;l<c.length;l++)o="string"==typeof c[l]?c[l]:JSON.stringify(c[l]),r+=(""!=r&&"\n"!=r&&"\r"!=r&&"\r\n"!=r?" ":"")+o;r=r.replace(/[\x00-\x09\x0b-\x0c\x0e-\x1f]/g,""),n.stdout.write(R[e]+r+(t?"":"\n"))}else i=Array.prototype.slice.call(arguments[2]),e==f&&console.dir?console.dir.apply(this,i):e==C&&console.error?console.error.apply(this,i):e==g&&console.info?console.info.apply(this,i):e==h&&console.warn?console.warn.apply(this,i):console.log.apply(this,i)}},L=function(e,n,t,o){var i=c?c.errorToString(e,n,t):e;return o==C?O.call(r,C,!1,[i]):o==y&&r.force(i),i};r.setOptions=function(e){for(var n in e)b[n]=e[n]}}e.exports=o}).call(n,t(11))},function(e,n,t){function o(){var e=this,n=null,o=null;"undefined"==typeof window?(n=t(0),o=t(3)):(n=window.sp.Logger,o=window.sp.CallbackBuffer);var i=1,r=new Object,c=null,a=null,l=null,s=new o,u=new Object,d=0,p=null,f=new n("RpcCommunicator","splogs"),g=function(e,n){try{u[n].send(JSON.stringify(e))}catch(e){f.log(e)}};e.sendMessage=g;var C=function(e,n,t,o){try{if(e){g({jsonrpc:"2.0",error:e,id:t},o);var i="undefined"!=typeof e.code?e.code:"",r="undefined"!=typeof e.path?e.path:"",c="undefined"!=typeof e.message?e.message:"";f.log("Exception in executing a RPC method: "+i+" RpcCommunicator::onMessage() >> "+r+" "+c)}else g({jsonrpc:"2.0",result:n,id:t},o)}catch(e){f.log(e)}},h=function(e,n){try{if(!e.jsonrpc||"2.0"!=e.jsonrpc||!e.method)return void g({jsonrpc:"2.0",error:{code:-32600,message:"Invalid JSON-RPC."},id:null},n);if("[object Array]"!==Object.prototype.toString.call(e.params))return void g({jsonrpc:"2.0",error:{code:-32602,message:"Parameters must be sent inside an array."},id:e.id},n);if(!r.hasOwnProperty(e.method))return null!=e.id?void g({jsonrpc:"2.0",error:{code:-32601,message:"Method "+e.method+" not found."},id:e.id},n):void g({jsonrpc:"2.0",error:{code:-32601,message:"Method "+e.method+" not found."},id:null},n);var t=r[e.method];"undefined"==typeof e.params&&(e.params=new Array),null!=e.id?(e.params.push(n),e.params.push(function(t,o){C(t,o,e.id,n)}),t.method.apply(t.object,e.params)):(e.params.push(n),e.params.push(function(e,n){}),t.method.apply(t.object,e.params))}catch(e){f.log(e)}},y=function(e){try{var n=null,t=null;"undefined"!=typeof e.error&&(n=e.error),"undefined"!=typeof e.result&&(t=e.result),e.id?s.callMethodAndPop(e.id,n,t):f.log("RpcCommunicator::handleReturnValue() error: "+JSON.stringify(n))}catch(e){f.log(e)}},w=function(e,n){try{e.method?h(e,n):y(e)}catch(e){f.log(e)}},m=function(){d++;for(var e=d;;)if(e=Math.floor(4294967296*Math.random()),!u.hasOwnProperty(e))break;return e};e.exposeRpcMethod=function(e,n,t){try{r[e]={object:n,method:t}}catch(e){f.log(e)}},e.setConnectionListener=function(e,n){c={object:e,listener:n}},e.setDisconnectionListener=function(e,n){a={object:e,listener:n}},e.setBinaryListener=function(e){l=e},e.connectionExists=function(e){return!("undefined"==typeof e||!u.hasOwnProperty(e))||!("undefined"!=typeof e||!u.hasOwnProperty(p))},e.getConnection=function(e){return u[e]},e.callRpc=function(n,t,o,r,c){if(e.connectionExists(c))try{"function"==typeof r?(s.pushBack(i,o,r),"undefined"!=typeof c?g({jsonrpc:"2.0",method:n,params:t,id:""+i},c):g({jsonrpc:"2.0",method:n,params:t,id:""+i},p),i++):"undefined"!=typeof c?g({jsonrpc:"2.0",method:n,params:t},c):g({jsonrpc:"2.0",method:n,params:t},p)}catch(e){f.log(e)}},e.notifyAll=function(e,n){try{for(var t in u)g({jsonrpc:"2.0",method:e,params:n,id:null},t)}catch(e){f.log(e)}},e.getBufferedAmount=function(e){return u[e].getBufferedAmount()},e.sendBinary=function(e,n){try{u[n].sendBinary(e)}catch(e){f.log(e)}},e.setupPipe=function(e,n){u.hasOwnProperty(e)&&u.hasOwnProperty(n)&&(u[e].setPipedTo(n),u[n].setPipedTo(e))},e.closeConnection=function(e){try{e in u&&(u[e].close(),delete u[e])}catch(e){f.log(e)}},e.onMessage=function(e,n){try{var t=n.getPipedTo();if(null!=t)return void u[t].send(e);if(e instanceof ArrayBuffer)return void(l&&l.onBinary(e,n.getId()));var o;try{o=JSON.parse(e)}catch(e){return void g({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},n.getId())}w(o,n.getId())}catch(e){f.log(e)}},e.addConnection=function(n){try{return n.getId()||n.setId(m()),u[n.getId()]=n,n.setListener(e),c&&c.listener.call(c.object,n.getId()),p=n.getId(),n.getId()}catch(e){f.log(e)}},e.onDisconnected=function(n){try{e.closeConnection(n),a&&a.listener.call(a.object,n)}catch(e){f.log(e)}}}e.exports=o},function(e,n,t){function o(){var e=this,n=null,o=null;"undefined"==typeof window?(n=t(0),o=t(14)):n=window.sp.Logger,o="undefined"!=typeof window?window.WebSocket:o.w3cwebsocket;var i=new n("WebSocketConnection","splogs"),r=null,c=null,a=null,l=null,s=null,u=null,d=null;e.connect=function(n,t){n.protocol=n.isSsl?"wss":"ws";try{var c=n.protocol+"://"+n.host+":"+n.port+"/json-rpc";n.id&&(c+="?id="+n.id),i.log("WebSocketConnection::connect() "+c),r=new o(c,"json-rpc",null,null,n.isSsl?{rejectUnauthorized:!1}:null),r.binaryType="arraybuffer",r.onopen=function(){t(null)},r.onmessage=f,r.onclose=function(n,t){g(n,t,e)}}catch(e){i.log(e)}},e.setSocket=function(n){i.log("WebSocketConnection::setSocket()");try{r=n,r.on("message",p),r.on("close",function(n,t){g(n,t,e)})}catch(e){i.log(e)}},e.setId=function(e){c=e},e.setPipedTo=function(e){d=e},e.getPipedTo=function(){return d},e.setRemoteAddress=function(e){a=e},e.setRemotePort=function(e){l=e},e.setOrigin=function(e){s=e},e.setListener=function(e){u=e},e.getId=function(){return c},e.getRemoteAddress=function(){return a},e.getRemotePort=function(){return l},e.getOrigin=function(){return s};var p=function(n){try{u&&("utf8"==n.type&&u.onMessage(n.utf8Data,e),"binary"==n.type&&u.onMessage(n.binaryData,e))}catch(e){i.log(e)}},f=function(n){try{u&&u.onMessage(n.data,e)}catch(e){i.log(e)}},g=function(e,n,t){try{u&&u.onDisconnected(t.getId())}catch(e){i.log(e)}};e.send=function(e){try{r.send(e)}catch(e){i.log(e)}},e.sendBinary=e.send,e.close=function(){try{r.close()}catch(e){i.log(e)}}}e.exports=o},function(e,n,t){function o(e){var n=this,t=new Object;n.pushBack=function(e,n,o){t[e]=[n,o]},n.callMethodAndPop=function(e,n,o){if(!t.hasOwnProperty(e))throw{error:"CallbackBuffer::callMethodAndPop(). Callback not found"};t[e][1].call(t[e][0],n,o,e),delete t[e]}}e.exports=o},function(e,n,t){function o(e,n,t){var o=this,i=e,r=n,c=!1,a=!1,l=null,s=new Array;o.toJSON=function(){var e={clientId:i,clientType:r,webRtc:c,localHub:a,preferredConnectionId:l};return e},o.isArrivedBeforeUs=function(){return t},o.setClientId=function(e){i=e},o.setClientType=function(e){r=e},o.setWebRtc=function(e){c=e},o.setPreferredConnectionId=function(e){l=e},o.getClientId=function(){return i},o.getClientType=function(){return r},o.isWebRtc=function(){return c},o.getPreferredConnectionId=function(){return l},o.isLocalHub=function(){return a},o.setLocalHub=function(e){a=e},o.addPipeId=function(e){s.push(e)},o.getBinaryConnectionId=function(){return pipeId},o.getConnectionType=function(){return c?"WebRtc":a?"Local Hub":"Cloud"}}e.exports=o},function(e,n,t){function o(e){var n=this,o=null;o="undefined"==typeof window?t(0):window.sp.Logger;var i=e,r=new o("DataChannelConnection","splogs"),c=null,a=null;n.send=function(e){r.log("DataChannelConnection::send()"+e);try{"open"==i.readyState&&i.send(e)}catch(e){r.log(e)}},n.close=function(){r.log("DataChannelConnection::close")},n.sendBinary=function(e){try{"open"==i.readyState&&i.send(e)}catch(e){r.log(e)}},n.getBufferedAmount=function(){return i.bufferedAmount},n.setId=function(e){c=e},n.getId=function(){return c},n.setListener=function(e){a=e},n.onMessage=function(e){try{a&&a.onMessage(e.data,n)}catch(e){r.log(e)}},n.setPipedTo=function(e){},n.getPipedTo=function(){return null},i.onmessage=n.onMessage}e.exports=o},function(e,n,t){function o(e,n,o){var i=this,r=null,c=null;"undefined"==typeof window?(r=t(0),c=t(7)):(r=window.sp.Logger,c=window.sp.WebRtcPeerConnection);var a=new r("WebRtcConnector","splogs"),l=new Object,s=new Object,u=null;i.setConnectionListener=function(e){u=e},i.onIceCandidate=function(t,o){a.log("iceCandidate got, sending it to the other client"),e.callRpc("callClientRpc",[o,"handleIceCandidate",[t]],i,null,n)};var d=function(e){l[e]=new c(o),l[e].setPartnerId(e),l[e].setIceListener(i),l[e].setStreamListener(i),l[e].setConnectionListener(i),l[e].setDataChannelListener(i)};i.shutdown=function(e){a.log("WebRtcConnector::onbeforeunload");for(var n in l)l.hasOwnProperty(n)&&(l[n].close(),delete l[n])},i.handleRtcOffer=function(t,o,r){a.log("WebRtcConnector::handleRtcOffer() descriptor: "+t),l.hasOwnProperty(o)||d(o),l[o].onConnectionOfferReceived(t,o,function(t){a.log("WebRtcConnector::handleRtcOffer() onConnectionOfferReceived returned"),a.log("Trying to call handleRtcAnswer on partner "+o),e.callRpc("callClientRpc",[o,"handleRtcAnswer",[t]],i,null,n),a.log("handleRtcAnswer call done on partner "+o)})},i.handleRtcAnswer=function(e,n,t){a.log("WebRtcConnector::handleRtcAnswer()"),l[n].onConnectionAnswerReceived(e)},i.handleIceCandidate=function(e,n,t){a.log("WebRtcConnector::handleIceCandidate()"),l.hasOwnProperty(n)||d(n),l[n].onIceCandidateReceived(e)},i.onDisconnected=function(n){if(a.log("WebRtcConnector::onDisconnected() "),l.hasOwnProperty(n)){for(var t=l[n],o=t.getDataChannelConnections(),i=0;i<o.length;i++)e.onDisconnected(o[i]);u.onWebRtcDisconnected(n),t.close(),delete l[n]}},i.onPrimaryDataChannelOpen=function(n,t){a.log("WebRtcConnector::onPrimaryDataChannelOpen() ");var o=e.addConnection(t);u&&u.onWebRtcConnected(n,o),s.hasOwnProperty(n)&&s[n].apply()},i.onAdditionalDataChannelOpen=function(n,t){a.log("WebRtcConnector::onAdditionalDataChannelOpen() ");var o=e.addConnection(t);u&&u.onAdditionalDataChannelOpen(n,o)},i.onStream=function(e,n){a.log("WebRtcConnector::onStream()")},i.onRemoveStream=function(e,n){a.log("WebRtcConnector::onRemoveStream()"),i.onDisconnected(n)},i.connectToPeer=function(t,o){return a.log("WebRtcConnector::connectToPeer() partnerId: "+t),l.hasOwnProperty(t)?void a.log("WebRtcConnector::connectToPeer() connection to partnerId: "+t+" already exists or is under construction, not connecting again"):(d(t),o&&(s[t]=o),void l[t].createConnectionOffer(function(o){a.log("Offer created, sending it to the other client "+t),e.callRpc("callClientRpc",[t,"handleRtcOffer",[o]],i,null,n)}))},i.createDataChannelConnection=function(n,t){l[n].createDataChannelConnection(function(n){a.log("WebRtcConnector::createDataChannelConnection() callback returned");var o=e.addConnection(n);t(o)})},"undefined"!=typeof window&&(window.onbeforeunload=i.shutdown),e.exposeRpcMethod("handleRtcOffer",i,i.handleRtcOffer),e.exposeRpcMethod("handleRtcAnswer",i,i.handleRtcAnswer),e.exposeRpcMethod("handleIceCandidate",i,i.handleIceCandidate)}"undefined"!=typeof window&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),e.exports=o},function(e,n,t){function o(e){var n=this,o=null,i=null,r=null,c=null,a=null;if("undefined"==typeof window){o=t(0),a=t(5);var l=t(15);i=l.RTCPeerConnection,r=l.RTCSessionDescription,c=l.RTCIceCandidate}else o=window.sp.Logger,
a=window.sp.DataChannelConnection;"undefined"!=typeof window&&(i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,c=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate);var s=null,u=null,d=null,p=null,f=null,g=null,C=new o("WebRtcPeerConnection","splogs"),h=new Array,y={optional:[{DtlsSrtpKeyAgreement:!0}]},w=new i(e,y),m=null,R=0;n.createDataChannelConnection=function(e){R++;var n=w.createDataChannel(R,{reliable:!0});n.onopen=function(){C.log("WebRtcPeerConnection::channel.onopen")},n.binaryType="arraybuffer",n.onmessage=function(){var t=new a(n);h.push(t),e(t)}},w.ondatachannel=function(e){var t=e.channel||e;if(C.log("WebRtcPeerConnection::ondatachannel() "+t),t.binaryType="arraybuffer",null==m)m=new a(t),t.onopen=n.onPrimaryDataChannelOpen;else{var o=new a(t);t.onopen=function(){C.log("WebRtcPeerConnection::temp.onopen"),t.send("OK"),h.push(o),p&&p.onAdditionalDataChannelOpen(s,o)}}},n.onPrimaryDataChannelOpen=function(e){C.log("WebRtcPeerConnection::onPrimaryDataChannelOpen "+e),h.push(m),p&&p.onPrimaryDataChannelOpen(s,m)},n.onAdditionalDataChannelOpen=function(e){C.log("WebRtcPeerConnection::onAdditionalDataChannelOpen "+e)},n.getDataChannelConnections=function(){return h},n.onPrimaryDataChannelClosed=function(e){C.log("WebRtcPeerConnectiononDataChannelClosed "+e),f.onDisconnected(s)},n.setDataChannelListener=function(e){p=e};var b=function(e){C.info("signaling state change:",e)},v=function(e){C.info("ice connection state change:",e),!f||"disconnected"!=w.iceConnectionState&&"closed"!=w.iceConnectionState||f.onDisconnected(s)},S=function(e){C.info("ice gathering state change:",e)},O=function(e){C.log("WebRtcPeerConnectiononIceCanditate() partnerId: "+s+" event: "+e),C.log("iceListener was "+u),null==e.candidate?C.log("All Ice candidates listed"):u.onIceCandidate(e.candidate,s)};w.onsignalingstatechange=b,w.oniceconnectionstatechange=v,w.onicegatheringstatechange=S,w.onicecandidate=O,n.close=function(){C.log("WebRtcPeerConnectionclose"),"closed"==w.signalingState&&"closing"==w.signalingState||w.close()},n.getPartnerId=function(){return s},n.setPartnerId=function(e){s=e},n.setIceListener=function(e){u=e,C.log("WebRtcPeerConnectionsetIceListener()"+e)},n.setStreamListener=function(e){d=e,w.onaddstream=function(e){n.onStream(e)},w.onremovestream=function(e){n.onRemoveStream(e)}},n.setConnectionListener=function(e){f=e},n.onStream=function(e){C.log("WebRtcPeerConnectiononStream"+e),d.onStream(e.stream,s)},n.onRemoveStream=function(e){C.log("WebRtcPeerConnectiononStream"+e),d.onRemoveStream(e.stream,s)},n.addStream=function(e){g=e,w.addStream(e)},n.createConnectionOffer=function(e){var t=null,o=w.createDataChannel("jsonrpcchannel",{reliable:!0});o.binaryType="arraybuffer",o.onopen=n.onPrimaryDataChannelOpen,m=new a(o),w.createOffer(function(n){C.log("peerConnection::createOffer called its callback: "+n),t=n,w.setLocalDescription(n,function(){e(w.localDescription,s)},function(e){C.log("WebRtcPeerConnectioncreateConnectionOffer() setLocalDescription error")},{})},function(e){C.log(e)})},n.onConnectionAnswerReceived=function(e){C.log("WebRtcPeerConnectiononConnectionAnswerReceived(), descriptor: "+e),w.setRemoteDescription(new r(e),function(){C.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned OK")},function(e){C.log("WebRtcPeerConnectiononConnectionAnswerReceived() setRemoteDescription returned error "+e)})},n.onConnectionOfferReceived=function(e,n,t){C.log("WebRtcPeerConnectiononConnectionOfferReceived"),C.log("WebRtcPeerConnectiononConnectionOfferReceived trying to set remote description");var o=new r(e);w.setRemoteDescription(o,function(){C.log("WebRtcPeerConnectiononConnectionOfferReceived remote description set"),w.createAnswer(function(e){w.setLocalDescription(e,function(){t(w.localDescription)},function(e){C.log(e)})},function(e){C.log(e)})},function(e){C.log("WebRtcPeerConnectiononConnectionOfferReceived setting remote description failed "+e)})},n.onIceCandidateReceived=function(e){w.addIceCandidate(new c(e),function(){C.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate succeeded")},function(e){C.log("WebRtcPeerConnectiononIceCandidateReceived adding Ice candidate failed "+e)})}}e.exports=o},function(e,n,t){function o(){var e=this,n=null,o=null,i=null,r=null,c=null;"undefined"==typeof window?(o=t(0),r=t(1),c=t(2),n=t(4),i=t(6)):(o=window.sp.Logger,r=window.sp.RpcCommunicator,c=window.sp.WebSocketConnection,n=window.sp.Client,i=window.sp.WebRtcConnector);var a=new o("CommunicationClient","splogs"),l=null,s=null,u=null,d=new Object,p=null,f=null,g=null,C=null,h=null,y=new r,w=new c,m=new Object,R=new Object,b=new Object,v=(new r,null);e.callRpcOnClient=function(e,n,t,o,i){a.log("CommunicationClient::callRpcOnClient(clientId: "+e+", methodName: "+n+")\n"),m.hasOwnProperty(e)&&(m[e].isWebRtc()?(a.log("CommunicationClient::callRpcOnClient - Calling client RPC through WebRtc, preferredConnectionId was: "+m[e].getPreferredConnectionId()+"\n"),t.push(p),y.callRpc(n,t,o,i,m[e].getPreferredConnectionId())):m[e].isLocalHub()?(a.log("CommunicationClient::callRpcOnClient - Calling client RPC through local hub\n"),y.callRpc("callClientRpc",[e,n,t],o,i,m[e].getPreferredConnectionId())):(a.log("CommunicationClient::callRpcOnClient - Notifying client RPC through the server, serverId: "+h+"\n"),y.callRpc("callClientRpc",[e,n,t],o,i,h)))},e.callRpcOnConnection=function(e,n,t,o,i){a.log("CommunicationClient::callRpcOnConnection(connectionId: "+e+", methodName: "+n+")\n"),a.log("CommunicationClient::callRpcOnConnection - Making a RPC call over direct connection\n"),t.push(p),y.callRpc(n,t,o,i,e)},e.notifyClient=function(e,n,t){a.log("CommunicationClient::notifyClient(clientId: "+e+", methodName: "+n+")\n"),m.hasOwnProperty(e)&&(m[e].isWebRtc()?(a.log("CommunicationClient::notifyClient - Notifying client through WebRtc\n"),t.push(p),y.callRpc(n,t,null,null,m[e].getPreferredConnectionId())):m[e].isLocalHub()?(a.log("CommunicationClient::notifyClient - Notifying client through local hub\n"),y.callRpc("callClientRpc",[e,n,t],null,null,m[e].getPreferredConnectionId())):(a.log("CommunicationClient::notifyClient - Notifying client through the server, serverId: "+h+"\n"),y.callRpc("callClientRpc",[e,n,t],null,null,h)))},e.sendBinaryOnConnection=function(e,n){y.sendBinary(n,e)},e.getClientsByType=function(e){return R[e]},e.getConnectionType=function(e){return m[e].getConnectionType()},e.upgradeToWebRtc=function(e,n){a.log("CommunicationClient::upgradeToWebRtc(clientId: "+e+")\n"),m[e].isWebRtc()||v.connectToPeer(e,n)},e.getBufferedAmount=function(e){return y.getConnection(e).getBufferedAmount()},e.createDirectConnection=function(n,t){a.log("CommunicationClient::createDirectConnection(clientId: "+n+")\n"),m[n].isWebRtc()?v.createDataChannelConnection(n,function(e){a.log("CommunicationClient::createDirectConnection - Callback returned connectionId: "+e+"\n"),b[e]=n,t(e)}):e.createPipe(n,t)},e.onWebRtcConnected=function(e,n){a.log("CommunicationClient::onWebRtcConnected(clientId: "+e+", connectionId: "+n+")\n"),m.hasOwnProperty(e)&&(m[e].setWebRtc(!0),m[e].setPreferredConnectionId(n)),g&&g.onConnectionTypeUpdated(m[e],m[e].getConnectionType())},e.onWebRtcDisconnected=function(e){a.log("CommunicationClient::onWebRtcDisconnected(partnerId: "+e+")\n")},e.onAdditionalDataChannelOpen=function(e,n){a.log("CommunicationClient::onAdditionalDataChannelOpen(clientId: "+e+", connectionId: "+n+")\n"),b[n]=e},e.createPipe=function(n,t){a.log("CommunicationClient::createPipe(clientId: "+n+")\n");var o,i=new c;i.connect(l,function(){o=y.addConnection(i),a.log("CommunicationClient::createPipe - Pipe connected to the WebSocket server, pipeId: "+o+"\n"),y.callRpc("constructPipe",[n,p],e,function(){a.log("CommunicationClient::createPipe - Pipe construction ready\n"),m.hasOwnProperty(n)&&(m[n].addPipeId(o),b[o]=n),t(o)},o)})},e.requestPipe=function(n,t,o,i){a.log("CommunicationClient::requestPipe(targetId: "+n+", originatorId: "+t+", connectionId: "+o+")\n");var r=null,s=new c;s.connect(l,function(){r=y.addConnection(s),a.log("CommunicationClient::requestPipe - Pipe connected to the WebSocket server, pipeId: "+r+"\n"),y.callRpc("registerAsPipe",[n],e,function(e,n){a.log("CommunicationClient::requestPipe - registerAsPipe returned\n"),m.hasOwnProperty(t)&&(m[t].addPipeId(r),b[r]=t),i(null,"Ok")},r)})},e.pipeToExternalConnection=function(e,n){var t=y.addConnection(n);a.log("CommunicationClient::pipeToExternalConnection(), connectionId: "+e+", externalId: "+t+"\n"),y.setupPipe(e,t)},e.onBinary=function(e,n){C&&(b.hasOwnProperty(n)?C.onBinary(e,b[n],n):C.onBinary(e,n))},e.setClientListener=function(e){f=e},e.setConnectionTypeListener=function(e){g=e},e.setBinaryListener=function(e){C=e};var S=function(e,t,o){a.log("CommunicationClient::addClient(clientId: "+e+", clientType: "+t+", arrivedBeforeUs: "+o+")\n");var i=null;return m.hasOwnProperty(e)?i=m[e]:(i=new n(e,t,o),m[e]=i),R.hasOwnProperty(t)||(R[t]=new Object),R[t][e]=i,i},O=function(e){delete R[m[e].getClientType()][e],delete m[e]},L=function(n,t){a.log("CommunicationClient::updateConnectedClients(hubId: "+n+")\n");var o=h;n&&(o=n),y.callRpc("getConnectedClients",[u],e,function(e,i){a.log("CommunicationClient::updateConnectedClients got answer from hub: "+JSON.stringify(i)+"\n");var r=null;for(var c in i)m.hasOwnProperty(c)||i[c].clientId==p?n&&(m[c].setLocalHub(!0),m[c].setPreferredConnectionId(o)):(r=null==n?S(i[c].clientId,i[c].clientType,!0):S(i[c].clientId,i[c].clientType,!1),!n&&f&&r.getClientId()!=p&&f.onClientConnected(r));t()},o)},T=function(n,t){if(a.log("CommunicationCLient::connectToLocalHubs(hubs: "+JSON.stringify(n)+")\n"),null!=n){var o=null,i=null,r=null;for(var l in n){o=n[l].port;for(var f=0;f<n[l].localIps.length;f++){i=n[l].localIps[f];var g={host:i,port:o,id:p},C=null;r=new c,r.connect(g,function(){a.log("CommunicationClient::connectToLocalHubs - Connected to local hub at ip: "+i+" port: "+o+"\n"),C=y.addConnection(r),d[C]=C,L(C,function(){y.callRpc("registerAsClient",[p,s,u],e,function(e,n){a.log("CommunicationClient::connectToLocalHubs - Registered as client at local hub at ip: "+i+", port: "+o+"\n")})})})}}t()}},P=function(n){a.log("CommunicationClient::updateLocalHubs() - Getting list of local hubs from the server\n"),y.callRpc("getLocalHubs",[],e,function(e,t){a.log("CommunicationClient::updateLocalHubs - Following local hubs are available: "+JSON.stringify(t)+"\n"),t?T(t,n):n()},h)};e.exposeRpcMethod=function(e,n,t){y.exposeRpcMethod(e,n,t)},e.connectWithOptions=function(n,t,o,r){a.log("CommunicationClient::connectWithOptions(options: "+JSON.stringify(n)+", clientType: "+t+", groupId: "+o+")\n"),s=t,u=o,y.setBinaryListener(e),n.hasOwnProperty("id")||(n.id=null),l=n,w.connect(l,function(){h=y.addConnection(w),a.log("CommunicationClient::connectWithOptions - Connected to the WebSocket server, serverId: "+h+"\n"),v=new i(y,h,"undefined"!=typeof LoaderUtil?LoaderUtil.WEBRTC_CONFIG:WEBRTC_CONFIG),v.setConnectionListener(e),y.callRpc("registerAsClient",[null,s,u],e,function(e,n){a.log("CommunicationClient::connectWithOptions - Server replied to registerAsClient call, ownId: "+n+"\n"),p=n,L(null,function(){P(function(){r(n)})})},h)})},e.connect=function(n,t,o,i,r){return l={host:n,port:t,id:null},e.connectWithOptions(l,o,i,r)},e.onClientConnected=function(e,n,t){if(a.log("CommunicationClient::onClientConnected(clientData: "+JSON.stringify(e)+", connectionId: "+n+") - ownId: "+p+"\n"),e.clientId!=p){if(d.hasOwnProperty(n))return a.log("CommunicationClient::onClientConnected - Client connected through localhub, clientId: "+e.clientId+"\n"),m[e.clientId].setLocalHub(!0),void m[e.clientId].setPreferredConnectionId(n);if(!m.hasOwnProperty(e.clientId)){a.log("CommunicationClient::onClientConnected - addClient clientId: "+e.clientId+"\n");var o=S(e.clientId,e.clientType,!1);f&&o.getClientId()!=p&&f.onClientConnected(o)}}},e.onClientDisconnected=function(e,n,t){a.log("CommunicationClient::onClientDisconnected(connectionId: "+n+", clientData: "+JSON.stringify(e)+")\n"),m.hasOwnProperty(e.clientId)&&f&&e.clientId!=p&&(f.onClientDisconnected(m[e.clientId]),O(e.clientId))},e.onHubConnected=function(e,n,t){a.log("CommunicationClient::onHubConnected(hubData: "+JSON.stringify(e)+")\n")},e.onHubDisconnected=function(e,n,t){a.log("CommunicationClient::onHubDisconnected(hubData: "+JSON.stringify(e)+")\n")},e.getConnectedClients=function(){return m},e.getOwnId=function(){return p},y.exposeRpcMethod("onClientConnected",e,e.onClientConnected),y.exposeRpcMethod("onClientDisconnected",e,e.onClientDisconnected),y.exposeRpcMethod("onHubConnected",e,e.onHubConnected),y.exposeRpcMethod("onHubDisconnected",e,e.onHubDisconnected),y.exposeRpcMethod("requestPipe",e,e.requestPipe)}e.exports=o},function(e,n){e.exports={global:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},CallbackBuffer:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},Client:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},CommunicationClient:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},CommunicationHub:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},DataChannelConnection:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},RpcCommunicator:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},SpaceifyPiper:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},TcpSocket:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},WebRtcConnector:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},WebRtcPeerConnection:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},WebSocketConnection:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},WebSocketRpcConnection:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1},WebSocketServer:{log:!1,dir:!1,info:!1,error:!1,warn:!1,all:!1}}},function(e,n,t){function o(){var e=this,n=null,o=null,i=null;"undefined"==typeof window?(n=t(0),o=t(1),i=t(2)):(n=window.sp.Logger,o=window.sp.RpcCommunicator,i=window.sp.WebSocketConnection);var r=new i,c=new o,a=new n("WebSocketRpcConnection","splogs");e.callRpc=function(e,n,t,o){return c.callRpc(e,n,t,o)},e.connect=function(e,n){a.log("WebSocketRpcConnection::connect()"),r.connect(e,function(){a.log("WebsocketRpcConnection Connected"),c.addConnection(r),a.log("WebsocketRpcConnection added to communicator"),n(null,null)})},e.close=function(){},e.getCommunicator=function(){return c}}e.exports=o},function(e,n){function t(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===t||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(n){try{return u.call(null,e,0)}catch(n){return u.call(this,e,0)}}}function r(e){if(d===clearTimeout)return clearTimeout(e);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(n){try{return d.call(null,e)}catch(n){return d.call(this,e)}}}function c(){C&&f&&(C=!1,f.length?g=f.concat(g):h=-1,g.length&&a())}function a(){if(!C){var e=i(c);C=!0;for(var n=g.length;n;){for(f=g,g=[];++h<n;)f&&f[h].run();h=-1,n=g.length}f=null,C=!1,r(e)}}function l(e,n){this.fun=e,this.array=n}function s(){}var u,d,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:t}catch(e){u=t}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(e){d=o}}();var f,g=[],C=!1,h=-1;p.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];g.push(new l(e,n)),1!==g.length||C||i(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=s,p.addListener=s,p.once=s,p.off=s,p.removeListener=s,p.removeAllListeners=s,p.emit=s,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,n){function t(e){throw new Error("Cannot find module '"+e+"'.")}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=12},function(n,t){n.exports=e},function(e,t){e.exports=n},function(e,n){e.exports=t},function(e,n,t){e.exports={Client:t(4),WebRtcConnector:t(6),CommunicationClient:t(8),RpcCommunicator:t(1),WebRtcPeerConnection:t(7),WebSocketRpcConnection:t(10),CallbackBuffer:t(3),WebSocketConnection:t(2),DataChannelConnection:t(5),splogs:t(9),Logger:t(0)}}])}),"undefined"!=typeof exports&&(module.exports=HttpParser),"undefined"!=typeof exports&&(module.exports=PiperClient),SpXMLHttpRequest.UNSENT=0,SpXMLHttpRequest.OPENED=1,SpXMLHttpRequest.HEADERS_RECEIVED=2,SpXMLHttpRequest.LOADING=3,SpXMLHttpRequest.DONE=4,SpXMLHttpRequest.OriginalXMLHttpRequest=function(){return"undefined"!=typeof window?("undefined"==typeof window.OriginalXMLHttpRequest&&(window.OriginalXMLHttpRequest=window.XMLHttpRequest),window.OriginalXMLHttpRequest):null}(),"undefined"!=typeof exports&&(module.exports=SpXMLHttpRequest),"undefined"==typeof window)var PiperClient=require("./piperclient");LoaderUtil.prototype.SERVER_ADDRESS=function(){var e="testgroup";if("undefined"!=typeof window){var n=window.location.hostname.split(".");3==n.length&&"edge"!=n[0]&&(e=n[0])}return{host:"spaceify.net",port:1979,groupId:e,isSsl:!1}}(),LoaderUtil.prototype.WEBRTC_CONFIG=function(){return{iceServers:[{url:"stun:kandela.tv"},{url:"turn:kandela.tv",username:"webrtcuser",credential:"jeejeejee"}]}}(),LoaderUtil.prototype.piperClient=function(){return new PiperClient}(),window&&(window.openOriginal=window.open,window.open=function(e,n,t,o,i){var r,c,a,l,s,u,d=new SpaceifyCore,p=new SpaceifyNetwork;d.getApplicationURL(e,function(d,f){return d?void("function"==typeof i&&i(null)):(r=p.isSecure()?f.securePort:f.port,l=p.getEdgeURL(!1,!1,!0),a=f.implementsWebServer&&r?p.getEdgeURL(!1,r,!0):p.externalResourceURL(e),c=p.parseQuery(n),c.sp_host=encodeURIComponent(a),c.sp_path=encodeURIComponent(n),c.spe_host=encodeURIComponent(l),s=l+"remote.html/"+p.remakeQueryString(c,{},{},"",!0),u=window.openOriginal(s,t?t:"_blank",o?o:""),void u.addEventListener("load",function(){"function"==typeof i&&i(this)}))})}),"undefined"==typeof window?(module.exports=new LoaderUtil,global.SERVER_ADDRESS=module.exports.SERVER_ADDRESS,global.WEBRTC_CONFIG=module.exports.WEBRTC_CONFIG):LoaderUtil=new LoaderUtil;var spaceifyLoader=new SpaceifyLoader;window.onload=function(){var e,n,t=spaceifyLoader.parseQuery(window.location.href);t.sp_host||(e=n=window.location.protocol+"//"+window.location.hostname+"/","undefined"!=typeof document.loadPageSpHost&&(e=document.loadPageSpHost),"undefined"!=typeof document.loadPageSpeHost&&(n=document.loadPageSpeHost),t={sp_host:e,spe_host:n,sp_path:"index.html"}),getNetworkInfo(function(){window.isSpaceifyNetwork?(prepareLoader(t),loadPageOrElements(t)):(spaceifyLoader.setConnectionListener(function(){loadPageOrElements(t)}),prepareLoader(t))})};