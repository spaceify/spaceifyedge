"use strict";

function Logger(e,n,t){var o=this,r=null,i="undefined"==typeof window,c=function(e,n){try{return n.accessSync(e,n.F_OK),!0}catch(e){return!1}};if(i){var a,s=require("fs"),u="/var/lib/spaceify/code/";c(u+"spaceifyerror.js"),s&&(r=require(u+"spaceifyerror")),a=c("./"+n+".json",s)?s.readFileSync("./"+n+".json","utf8"):c(u+n+".json",s)?s.readFileSync(u+n+".json","utf8"):"{}",n=JSON.parse(a)}else"undefined"!=typeof window&&(r=window.SpaceifyError?window.SpaceifyError:null);r&&(r=new r),o.RETURN=1;var l="log",f="dir",p="info";o.ERROR="error";var d=o.ERROR,y="warn";o.FORCE="force";var g=o.FORCE,h="stdout",R="all",S={};S[l]="[i] ",S[f]="[d] ",S[p]="[i] ",S[d]="[e] ",S[y]="[w] ",S[g]="",S[h]="";var m=e&&n&&n[e]?n[e]:{};if(t)for(var w in t)m[w]=t[w];if(m[l]=!("undefined"==typeof m[l]||!m[l])&&m[l],m[f]=!("undefined"==typeof m[f]||!m[f])&&m[f],m[p]=!("undefined"==typeof m[p]||!m[p])&&m[p],m[d]=!("undefined"==typeof m[d]||!m[d])&&m[d],m[y]=!("undefined"==typeof m[y]||!m[y])&&m[y],m[R]=!("undefined"==typeof m[R]||!m[R])&&m[R],n.global){var v=n.global;m[l]="undefined"!=typeof v[l]&&v[l]?v[l]:m[l],m[f]="undefined"!=typeof v[f]&&v[f]?v[f]:m[f],m[p]="undefined"!=typeof v[p]&&v[p]?v[p]:m[p],m[d]="undefined"!=typeof v[d]&&v[d]?v[d]:m[d],m[y]="undefined"!=typeof v[y]&&v[y]?v[y]:m[y],m[R]="undefined"!=typeof v[R]&&v[R]?v[R]:m[R]}m[g]=!1,o.log=function(){C(l,!1,arguments)},o.dir=function(){C(f,!1,arguments)},o.info=function(){C(p,!1,arguments)},o.error=function(){E.apply(this,arguments)},o.warn=function(){C(y,!1,arguments)},o.force=function(){C(g,!1,arguments)},o.stdout=function(){C(h,!0,arguments)};var C=function(e,n){if(!m[R]&&!m[e]||e==g){var t,o,r="",c=arguments[2];if(i){for(var a=0;a<c.length;a++)t="string"==typeof c[a]?c[a]:JSON.stringify(c[a]),r+=(""!=r&&"\n"!=r&&"\r"!=r&&"\r\n"!=r?" ":"")+t;r=r.replace(/[\x00-\x09\x0b-\x0c\x0e-\x1f]/g,""),process.stdout.write(S[e]+r+(n?"":"\n"))}else o=Array.prototype.slice.call(arguments[2]),e==f&&console.dir?console.dir.apply(this,o):e==d&&console.error?console.error.apply(this,o):e==p&&console.info?console.info.apply(this,o):e==y&&console.warn?console.warn.apply(this,o):console.log.apply(this,o)}},E=function(e,n,t,i){var c=r?r.errorToString(e,n,t):e;return i==d?C.call(o,d,!1,[c]):i==g&&o.force(c),c};o.setOptions=function(e){for(var n in e)m[n]=e[n]}}function BinaryRpcCommunicator(e){var n="/var/lib/spaceify/code/",t="undefined"==typeof window,o=!(!t||"undefined"==typeof process.env.IS_REAL_SPACEIFY),r=t?require(n+"logger"):window.Logger,i=t?require(n+"spaceifyerror"):window.SpaceifyError,c=t?require(n+"callbackbuffer"):window.CallbackBuffer,a=t?require(n+"spaceifyutility"):window.SpaceifyUtility,s=t?require(n+"fibrous"):function(e){return e},u=this,l=new i,f=new a,p=new c,d=new r("BinaryRpcCommunicator","selogs"),y=1,g={},h=null,R=[],S=[],m={},w=null,v=0,C=1;u.exposeRpcMethod=function(e,n,t){try{g[e]={type:C,method:t}}catch(e){d.error(e,!0,!0,d.ERROR)}},u.exposeRpcMethodSync=function(e,n,t){try{g[e]={type:v,method:t}}catch(e){d.error(e,!0,!0,d.ERROR)}},u.setConnectionListener=function(e){"function"==typeof e&&R.push(e)},u.setDisconnectionListener=function(e){"function"==typeof e&&S.push(e)},u.setBinaryListener=function(e){h="function"==typeof e?e:null},u.connectionExists=function(e){return!("undefined"==typeof e||!m.hasOwnProperty(e))||!("undefined"!=typeof e||!m.hasOwnProperty(w))},u.getConnection=function(e){return m[e]},u.callRpc=function(e,n,t,o,r){var i,c,a=[],s=!1,f="undefined"!=typeof r?r:w;if(d.log("BinaryRpcCommunicator::callRpc() connectionId: "+r),u.connectionExists(r)){try{e instanceof Array||(s=!1,n=[n],e=[e]),c=y;for(var g=0;g<e.length;g++)i="function"==typeof o?{jsonrpc:"2.0",method:e[g],params:n[g],id:y++}:{jsonrpc:"2.0",method:e[g],params:n[g]},a.push(i),d.log("  "+JSON.stringify(i));"function"==typeof o&&p.pushBack(c,t,o)}catch(e){return"function"==typeof o&&o(l.makeErrorObject(-32e3,"callRpc failed.","BinaryRpcCommunicator::callRpc"),null)}var h=s?a:a[0];E(h,f)}},u.notifyAll=function(e,n){try{for(var t in m)d.log("BinaryRpcCommunicator::notifyAll() sending message to "+t),E({jsonrpc:"2.0",method:e,params:n,id:null},t)}catch(e){d.error(e,!0,!0,d.ERROR)}},u.getBufferedAmount=function(e){return m[e].getBufferedAmount()},u.sendBinary=function(e,n){d.log("BinaryRpcCommunicator::sendBinary() "+e.byteLength);try{m[n].sendBinary(e)}catch(e){d.error(e,!0,!0,d.ERROR)}};var E=function(e,n){try{m[n].send(JSON.stringify(e))}catch(e){d.error(e,!0,!0,d.ERROR)}};u.sendMessage=E;var O=function(e,n){var r=!0;try{e instanceof Array||(e=[e],r=!1),e[0].method?(d.log("RpcCommunicator::handleRpcCall() connectionId: "+n),t&&!o?s.run(function(){b.sync(e,r,[],!0,n)},function(e,n){}):b(e,r,[],!0,n)):P(e,r)}catch(e){d.error(e,!0,!0,d.ERROR)}},b=function(e,n,t,r,i){var c,a=e.shift();if(a){var s=a.hasOwnProperty("id")?a.id:null,u=a.hasOwnProperty("params")?a.params:[];if(null!=s&&(r=!1),d.log((s?"   REQUEST -> ":"  NOTIFICATION -> ")+JSON.stringify(a)),!a.jsonrpc||"2.0"!=a.jsonrpc||!a.method)return A(s,{jsonrpc:"2.0",error:{code:-32600,message:"The JSON sent is not a valid Request object."},id:null},t),b(e,n,t,r,i);if("undefined"!==u&&u.constructor!==Array)return A(s,{jsonrpc:"2.0",error:{code:-32602,message:"Invalid method parameter(s). Parameters must be placed inside an array."},id:s},t),b(e,n,t,r,i);if(!g.hasOwnProperty(a.method))return A(s,{jsonrpc:"2.0",error:{code:-32601,message:"The method does not exist / is not available: "+a.method+"."},id:s},t),b(e,n,t,r,i);try{var l=g[a.method],f=u.length,p=l.type==v?(o?l.method.length:l.method.getLength())-1:l.method.length-2;if(p<f)u.splice(p-f,f-p);else if(p>f)for(p-=f;p--;)u.push(null);var y={requestId:s,connectionId:i,isSecure:m[i].getIsSecure()};o||(y.origin=m[i].getOrigin(),y.remotePort=m[i].getRemotePort(),y.remoteAddress=m[i].getRemoteAddress()),l.type!=v||o?l.type==v&&o?(u.push(y),c=l.method.apply(l.object,u),A(s,c,t),b(e,n,t,r,i)):null!=s?(u.push(y,function(o,c){I(o,c,s,e,n,t,r,i)}),l.method.apply(l.object,u)):(u.push(y),l.method.apply(l.object,u),b(e,n,t,r,i)):(u.push(y),c=l.method.sync.apply(l.object,u),A(s,c,t),b(e,n,t,r,i))}catch(o){_(s,o,t),b(e,n,t,r,i)}}else r||0!=t.length||t.push({jsonrpc:"2.0",error:{code:-32603,message:"Internal JSON-RPC error."},id:null}),t.length>0&&E(n?t:t[0],i)},I=function(e,n,t,o,r,i,c,a){e?(_(t,e,i),b(o,r,i,c,a)):(A(t,n,i),b(o,r,i,c,a))},A=function(e,n,t){null!=e&&(n="undefined"==typeof n?null:n,d.log("  RESPONSE <- "+JSON.stringify(n)),t.push({jsonrpc:"2.0",result:n,id:e}))},_=function(e,n,t){null!=e&&(n=l.make(n),d.log("  ERROR RESPONSE <- "+JSON.stringify(n)),t.push({jsonrpc:"2.0",error:n,id:e}))},P=function(e,n){d.log("BinaryRpcCommunicator::handleReturnValue()");var t=null,o=null;try{if(n){var r=T(e);p.callMethodAndPop(r.smallestId,r.errors,r.results)}else{if(d.log("  RESPONSE: "+JSON.stringify(e[0])),!e[0].jsonrpc||"2.0"!=e[0].jsonrpc||!e[0].id||e[0].result&&e[0].error)return;e[0].hasOwnProperty("error")?(t=e[0].error,o=null):e[0].hasOwnProperty("result")&&(t=null,results=e[0].result),p.callMethodAndPop(e[0].id,t,o)}}catch(e){d.error(e,!0,!0,d.ERROR)}},T=function(e){for(var n=-1,t={},o={},r=0;r<e.length;r++)d.log("  RESPONSE: "+JSON.stringify(e[r])),!e[r].jsonrpc||"2.0"!=e[r].jsonrpc||!e[r].id||e[r].result&&e[r].error||(n=Math.max(n,e[r].id),e[r].hasOwnProperty("error")?(t[e[r].id]=e[r].error,o[e[r].id]=null):e[r].hasOwnProperty("result")&&(t[e[r].id]=null,o[e[r].id]=o[r].result));return{smallestId:n,errors:t,results:o}},e=function(e,n){var t=new DataView(e),o=new Uint8Array(e),r=(t.getUint32(4),t.getUint32(8),t.getUint32(12)),i=o.subarray(16,16+r),c=(String.fromCharCode.apply(null,i),t.getUint32(16+r)),a=o.subarray(16+r+4,16+r+4+c),s=(String.fromCharCode.apply(null,a),t.getUint32(16+r+4+c+4));o.subarray(16+r+4+c+4+4,16+r+4+c+4+4+s)};u.setupPipe=function(e,n){d.log("BinaryRpcCommunicator::setupPipe() between: "+e+" and "+n),m.hasOwnProperty(e)&&m.hasOwnProperty(n)&&(m[e].setPipedTo(n),m[n].setPipedTo(e))},u.onMessage=function(n,t){d.log("BinaryRpcCommunicator::onMessage("+typeof n+") "+n);try{var o=t.getPipedTo();if(null!=o)return void m[o].send(n);if(n instanceof ArrayBuffer)return void e(n,t.getId());try{n=JSON.parse(n),O(n,t.getId())}catch(e){E({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},t.getId())}}catch(e){d.error(e,!0,!0,d.ERROR)}},u.addConnection=function(e){try{e.getId()||e.setId(f.generateRandomConnectionId(m)),m[e.getId()]=e,e.setEventListener(u);for(var n=0;n<R.length;n++)R[n](e.getId());return w=e.getId(),e.getId()}catch(e){d.error(e,!0,!0,d.ERROR)}},u.onDisconnected=function(e){try{u.closeConnection(e);for(var n=0;n<S.length;n++)S[n](e)}catch(e){d.error(e,!0,!0,d.ERROR)}},u.closeConnection=function(e){try{e in m&&(m[e].close(),delete m[e])}catch(e){d.error(e,!0,!0,d.ERROR)}}}function CallbackBuffer(e){var n=this,t=new Object;n.pushBack=function(e,n,o){t[e]=[n,o,Date.now()]},n.callMethodAndPop=function(e,n,o){if(!t.hasOwnProperty(e))throw{error:"CallbackBuffer::callMethodAndPop(). Callback not found"};t[e][1].call(t[e][0],n,o,e,Date.now()-t[e][2]),delete t[e]}}function RpcCommunicator(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=!(!n||"undefined"==typeof process.env.IS_REAL_SPACEIFY),o=n?require(e+"logger"):window.Logger,r=n?require(e+"spaceifyerror"):window.SpaceifyError,i=n?require(e+"callbackbuffer"):window.CallbackBuffer,c=n?require(e+"spaceifyutility"):window.SpaceifyUtility,a=n?require(e+"fibrous"):function(e){return e},s=this,u=new r,l=new c,f=new i,p=new o("RpcCommunicator","selogs"),d=1,y={},g=null,h=[],R=[],S={},m=null,w=0,v=1;s.exposeRpcMethod=function(e,n,t){try{y[e]={type:v,method:t}}catch(e){p.error(e,!0,!0,p.ERROR)}},s.exposeRpcMethodSync=function(e,n,t){try{y[e]={type:w,method:t}}catch(e){p.error(e,!0,!0,p.ERROR)}},s.setConnectionListener=function(e){"function"==typeof e&&h.push(e)},s.setDisconnectionListener=function(e){"function"==typeof e&&R.push(e)},s.setBinaryListener=function(e){g="function"==typeof e?e:null},s.connectionExists=function(e){return!("undefined"==typeof e||!S.hasOwnProperty(e))||!("undefined"!=typeof e||!S.hasOwnProperty(m))},s.getConnection=function(e){return S[e]},s.callRpc=function(e,n,t,o,r){var i,c,a=[],l=!1,y="undefined"!=typeof r?r:m;if(p.log("RpcCommunicator::callRpc() connectionId: "+r),s.connectionExists(r)){try{e instanceof Array||(l=!1,n=[n],e=[e]),c=d;for(var g=0;g<e.length;g++)i="function"==typeof o?{jsonrpc:"2.0",method:e[g],params:n[g],id:d++}:{jsonrpc:"2.0",method:e[g],params:n[g]},a.push(i),p.log("  "+JSON.stringify(i));"function"==typeof o&&f.pushBack(c,t,o)}catch(e){return"function"==typeof o&&o(u.makeErrorObject(-32e3,"callRpc failed.","RpcCommunicator::callRpc"),null)}C(l?a:a[0],y)}},s.notifyAll=function(e,n){try{for(var t in S)p.log("RpcCommunicator::notifyAll() sending message to "+t),C({jsonrpc:"2.0",method:e,params:n,id:null},t)}catch(e){p.error(e,!0,!0,p.ERROR)}},s.getBufferedAmount=function(e){return S[e].getBufferedAmount()},s.sendBinary=function(e,n){p.log("RPCCommunicator::sendBinary() "+e.byteLength);try{S[n].sendBinary(e)}catch(e){p.error(e,!0,!0,p.ERROR)}};var C=function(e,n){try{S[n].send(JSON.stringify(e))}catch(e){p.error(e,!0,!0,p.ERROR)}};s.sendMessage=C;var E=function(e,o){var r=!0;try{e instanceof Array||(e=[e],r=!1),e[0].method?(p.log("RpcCommunicator::handleRpcCall() connectionId: "+o),n&&!t?a.run(function(){O.sync(e,r,[],!0,o)},function(e,n){}):O(e,r,[],!0,o)):_(e,r)}catch(e){p.error(e,!0,!0,p.ERROR)}},O=function(e,n,o,r,i){var c,a=e.shift();if(a){var s=a.hasOwnProperty("id")?a.id:null,u=a.hasOwnProperty("params")?a.params:[];if(null!=s&&(r=!1),p.log((s?"   REQUEST -> ":"  NOTIFICATION -> ")+JSON.stringify(a)),!a.jsonrpc||"2.0"!=a.jsonrpc||!a.method)return I(s,{jsonrpc:"2.0",error:{code:-32600,message:"The JSON sent is not a valid Request object."},id:null},o),O(e,n,o,r,i);if("undefined"!==u&&u.constructor!==Array)return I(s,{jsonrpc:"2.0",error:{code:-32602,message:"Invalid method parameter(s). Parameters must be placed inside an array."},id:s},o),O(e,n,o,r,i);if(!y.hasOwnProperty(a.method))return I(s,{jsonrpc:"2.0",error:{code:-32601,message:"The method does not exist / is not available: "+a.method+"."},id:s},o),O(e,n,o,r,i);try{var l=y[a.method],f=u.length,d=l.type==w?(t?l.method.length:l.method.getLength())-1:l.method.length-2;if(d<f)u.splice(d-f,f-d);else if(d>f)for(d-=f;d--;)u.push(null);var g={requestId:s,connectionId:i,isSecure:S[i].getIsSecure()};t||(g.origin=S[i].getOrigin(),g.remotePort=S[i].getRemotePort(),g.remoteAddress=S[i].getRemoteAddress()),l.type!=w||t?l.type==w&&t?(u.push(g),c=l.method.apply(l.object,u),I(s,c,o),O(e,n,o,r,i)):null!=s?(u.push(g,function(t,c){b(t,c,s,e,n,o,r,i)}),l.method.apply(l.object,u)):(u.push(g),l.method.apply(l.object,u),O(e,n,o,r,i)):(u.push(g),c=l.method.sync.apply(l.object,u),I(s,c,o),O(e,n,o,r,i))}catch(t){A(s,t,o),O(e,n,o,r,i)}}else r||0!=o.length||o.push({jsonrpc:"2.0",error:{code:-32603,message:"Internal JSON-RPC error."},id:null}),o.length>0&&C(n?o:o[0],i)},b=function(e,n,t,o,r,i,c,a){e?(A(t,e,i),O(o,r,i,c,a)):(I(t,n,i),O(o,r,i,c,a))},I=function(e,n,t){null!=e&&(n="undefined"==typeof n?null:n,p.log("  RESPONSE <- "+JSON.stringify(n)),t.push({jsonrpc:"2.0",result:n,id:e}))},A=function(e,n,t){null!=e&&(n=u.make(n),p.log("  ERROR RESPONSE <- "+JSON.stringify(n)),t.push({jsonrpc:"2.0",error:n,id:e}))},_=function(e,n){p.log("RpcCommunicator::handleReturnValue()");var t=null,o=null;try{if(n){var r=P(e);f.callMethodAndPop(r.smallestId,r.errors,r.results)}else{if(p.log("  RETURN VALUE: "+JSON.stringify(e[0])),!e[0].jsonrpc||"2.0"!=e[0].jsonrpc||!e[0].id||e[0].result&&e[0].error)return;e[0].hasOwnProperty("error")?(t=e[0].error,o=null):e[0].hasOwnProperty("result")&&(t=null,o=e[0].result),f.callMethodAndPop(e[0].id,t,o)}}catch(e){p.error(e,!0,!0,p.ERROR)}},P=function(e){for(var n=-1,t={},o={},r=0;r<e.length;r++)p.log("  RETURN VALUE: "+JSON.stringify(e[r])),!e[r].jsonrpc||"2.0"!=e[r].jsonrpc||!e[r].id||e[r].result&&e[r].error||(n=Math.max(n,e[r].id),e[r].hasOwnProperty("error")?(t[e[r].id]=e[r].error,o[e[r].id]=null):e[r].hasOwnProperty("result")&&(t[e[r].id]=null,o[e[r].id]=o[r].result));return{smallestId:n,errors:t,results:o}};s.setupPipe=function(e,n){p.log("RpcCommunicator::setupPipe() between: "+e+" and "+n),S.hasOwnProperty(e)&&S.hasOwnProperty(n)&&(S[e].setPipedTo(n),S[n].setPipedTo(e))},s.onMessage=function(e,n){try{var t=n.getPipedTo();if(null!=t)return void S[t].send(e);if(e instanceof ArrayBuffer)return void("function"==typeof g&&g.onBinary(e,n.getId()));try{e=JSON.parse(e),E(e,n.getId())}catch(e){C({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},n.getId())}}catch(e){p.error(e,!0,!0,p.ERROR)}},s.addConnection=function(e){try{e.getId()||e.setId(l.generateRandomConnectionId(S)),S[e.getId()]=e,e.setEventListener(s);for(var n=0;n<h.length;n++)h[n](e.getId());return m=e.getId(),e.getId()}catch(e){p.error(e,!0,!0,p.ERROR)}},s.onDisconnected=function(e){try{s.closeConnection(e);for(var n=0;n<R.length;n++)R[n](e)}catch(e){p.error(e,!0,!0,p.ERROR)}},s.closeConnection=function(e){try{e in S&&(S[e].close(),delete S[e])}catch(e){p.error(e,!0,!0,p.ERROR)}}}function WebRtcClient(e){var n="/var/lib/spaceify/code/",t="undefined"==typeof window,o=t?require(n+"logger"):window.Logger,r=t?require(n+"spaceifyconfig"):window.SpaceifyConfig,i=t?require(n+"rpccommunicator"):window.RpcCommunicator,c=t?require(n+"websocketconnection"):window.WebSocketConnection,a=this,s=(new r,new i),u=new c,l=new o("WebRtcClient","selogs"),f=null,p=new Object;a.setConnectionListener=function(e){f=e},a.onIceCandidate=function(e,n){l.log("WebRtcClient::onIceCandidate - Got it, sending it to the other client"),s.callRpc("offerIce",[e,n])};var d=function(n){p[n]=new WebRtcConnection(e),p[n].setPartnerId(n),p[n].setIceListener(a),p[n].setStreamListener(a),p[n].setConnectionListener(a),p[n].setDataChannelListener(a)};a.shutdown=function(e){l.log("WebRtcClient::onbeforeunload");for(var n in p)p.hasOwnProperty(n)&&(p[n].close(),delete p[n])},a.handleRtcOffer=function(e,n,t){l.log("WebRtcClient::handleRtcOffer descriptor:",e),p.hasOwnProperty(n)||d(n),p[n].onConnectionOfferReceived(e,t,function(e){l.log("WebRtcClient::handleRtcOffer - onConnectionOfferReceived returned"),s.callRpc("acceptConnectionOffer",[e,n])})},a.handleRtcAnswer=function(e,n,t){l.log("WebRtcClient::handleRtcAnswer"),p[n].onConnectionAnswerReceived(e)},a.handleIceCandidate=function(e,n,t){l.log("WebRtcClient::handleIceCandidate"),p.hasOwnProperty(n)||d(n),p[n].onIceCandidateReceived(e)};var y=function(e,n){l.log("WebRtcClient::connectToCoordinator","> Websocket connecting to the coordinator"),u.connect(e,function(){l.log("WebRtcClient::connectToCoordinator - Websocket Connected to the Coordinator"),l.log("> Creating RPCCommunicator for the Websocket"),s.addConnection(u),n()})};a.onDisconnected=function(e){if(l.log("WebRtcClient::onDisconnected"),p.hasOwnProperty(e)){var n=p[e];f.onDisconnected(n.getId()),n.close(),delete p[e]}},a.onDataChannelOpen=function(e){l.log("WebRtcClient::onDataChannelOpen"),f.addConnection(e)},a.onStream=function(e,n){l.log("WebRtcClient::onStream")},a.onRemoveStream=function(e,n){l.log("WebRtcClient::onRemoveStream"),a.onDisconnected(n)};var g=function(e,n){l.log("WebRtcClient::connectToPeers - Announcing to the Coordinator"),s.callRpc("announce",[e],a,a.onPeerIdsArrived)};a.onPeerIdsArrived=function(e,n,t){l.log("WebRtcClient::onPeerIdsArrived - data.length:",n.length);for(var o=0,r=0;r<n.length;r++)o=n[r],d(o),l.log("WebRtcClient::onPeerIdsArrived - Trying to create offer to client id",o),p[o].createConnectionOffer(function(e,n){l.log("WebRtcClient::onPeerIdsArrived - Offer created, sending it to the other client",n),s.callRpc("offerConnection",[e,n])});0===n.length&&l.log("> Announce returned 0 client ids, not connecting")},a.run=function(e,n){l.log("WebRtcClient::run"),window.onbeforeunload=a.shutdown,s.exposeRpcMethod("handleRtcOffer",a,a.handleRtcOffer),s.exposeRpcMethod("handleRtcAnswer",a,a.handleRtcAnswer),s.exposeRpcMethod("handleIceCandidate",a,a.handleIceCandidate),y(e,function(){l.log("WebRtcClient::run - Connected to the coordinator"),g(e.announceId,function(){l.log("WebRtcClient::run - connectToPeers returned")}),n&&n(s)})}}function WebRtcConnection(e){var n="/var/lib/spaceify/code/",t="undefined"==typeof window,o=t?require(n+"logger"):window.Logger,r=this,i=new o("WebRtcConnection","selogs"),c=null,a=null,s=null,u=null,l=null,f=null,p=null,d=null,y={optional:[{DtlsSrtpKeyAgreement:!0}]},g=new RTCPeerConnection(e,y),h=null;g.ondatachannel=function(e){var n=e.channel||e;i.log("WebRtcConnection::peerConnection.ondatachannel",e),h=n,h.binaryType="arraybuffer",h.onopen=r.onDataChannelOpen,h.onmessage=r.onMessage};var R=function(e){i.log("WebRtcConnection::onsignalingstatechange",e)},S=function(e){i.log("WebRtcConnection::oniceconnectionstatechange",e),"function"!=p||"disconnected"!=g.iceConnectionState&&"closed"!=g.iceConnectionState||p.onDisconnected(s)},m=function(e){i.log("WebRtcConnection::onicegatheringstatechange",e)},w=function(e){i.log("WebRtcConnection::onIceCanditate - partnerId:",s,", event:",e,"> iceListener was",u),null==e.candidate?i.log("> All Ice candidates listed"):u.onIceCandidate(e.candidate,s)};g.onsignalingstatechange=R,g.oniceconnectionstatechange=S,g.onicegatheringstatechange=m,g.onicecandidate=w,r.close=function(){i.log("WebRtcConnection::close"),h.close(),"closed"!=g.signalingState&&g.close()},r.send=function(e){try{"open"==h.readyState&&h.send(e)}catch(e){i.error(e,!0,!0,i.ERROR)}},r.getBufferedAmount=function(){return h.bufferedAmount},r.sendBinary=function(e){try{"open"==h.readyState&&h.send(e)}catch(e){i.error(e,!0,!0,i.ERROR)}},r.onDataChannelClosed=function(e){i.log("WebRtcConnection::onDataChannelClosed",e),p.onDisconnected(r)},r.onDataChannelOpen=function(e){i.log("WebRtcConnection::onDataChannelOpen",e),h.binaryType="arraybuffer",h.onclose=r.onDataChannelClosed,h.onmessage=r.onMessage,d&&d.onDataChannelOpen(r)},r.onMessage=function(e){try{f&&f.onMessage(e.data,r)}catch(e){i.error(e,!0,!0,i.ERROR)}},r.setId=function(e){c=e},r.getId=function(){return c},r.getPartnerId=function(){return s},r.setPartnerId=function(e){s=e},r.setDataChannelListener=function(e){d=e},r.setListener=function(e){f=e},r.setIceListener=function(e){u=e,i.log("WebRtcConnection::setIceListener",e)},r.setStreamListener=function(e){l=e,g.onaddstream=function(e){r.onStream(e)},g.onremovestream=function(e){r.onRemoveStream(e)}},r.setEventListener=function(e){p=e},r.onStream=function(e){i.log("WebRtcConnection::onStream",e),l.onStream(e.stream,s)},r.onRemoveStream=function(e){i.log("WebRtcConnection::onStream",e),l.onRemoveStream(e.stream,s)},r.addStream=function(e){a=e,g.addStream(e)},r.createConnectionOffer=function(e){var n=null;h=g.createDataChannel("jsonrpcchannel",{reliable:!0}),h.binaryType="arraybuffer",h.onopen=r.onDataChannelOpen,h.onmessage=r.onMessage,g.createOffer(function(t){i.log("WebRtcConnection::peerConnectio.createOffer - Called its callback:",t),n=t,g.setLocalDescription(t,function(){e(g.localDescription,s)},function(e){i.error(e,!0,!0,i.ERROR)},{})},function(e){i.error(e,!0,!0,i.ERROR)})},r.onConnectionAnswerReceived=function(e){i.log("WebRtcConnection::onConnectionAnswerReceived, descriptor:",e),g.setRemoteDescription(new RTCSessionDescription(e),function(){i.log("WebRtcConnection::onConnectionAnswerReceived() - setRemoteDescription returned OK")},function(e){i.error(e,!0,!0,i.ERROR)})},r.onConnectionOfferReceived=function(e,n,t){i.log("WebRtcConnection::onConnectionOfferReceived - Trying to set remote description");var o=new RTCSessionDescription(e);g.setRemoteDescription(o,function(){i.log("WebRtcConnection::onConnectionOfferReceived Remote description set"),g.createAnswer(function(e){g.setLocalDescription(e,function(){t(g.localDescription)},function(e){i.error(e,!0,!0,i.ERROR)})},function(e){i.error(e,!0,!0,i.ERROR)})},function(e){i.error(e,!0,!0,i.ERROR)})},r.onIceCandidateReceived=function(e){g.addIceCandidate(new RTCIceCandidate(e),function(){i.log("WebRtcConnection::onIceCandidateReceived - Adding Ice candidate succeeded")},function(e){i.error(e,!0,!0,i.ERROR)})},r.setPipedTo=function(e){},r.getPipedTo=function(){return null}}function WebSocketConnection(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"logger"):window.Logger,o=n?require(e+"spaceifyerror"):window.SpaceifyError;n&&(global.fs=require("fs"),global.WebSocket=require("websocket").w3cwebsocket);var r=this,i=new o,c=new t("WebSocketConnection","selogs"),a="",s=null,u=null,l=null,f=null,p=null,d=!1,y=!1,g=null,h=null,R=null;r.connect=function(e,t){s=e.id||null,u=e.port||"",y=e.isSecure||!1;var o=e.caCrt||"",f=e.hostname||null,p=y?"wss":"ws";e.subprotocol||"json-rpc";try{a=p+"://"+f+(u?":"+u:"")+(s?"?id="+s:"");var g=n&&y?{tlsOptions:{ca:[fs.readFileSync(o,"utf8")]}}:null;l=new WebSocket(a,"json-rpc",null,null,null,g),l.binaryType="arraybuffer",l.onopen=function(){c.log("WebSocketConnection::onOpen() "+a),d=!0,t(null,!0)},l.onerror=function(e){c.error("WebSocketConnection::onError() "+a,!0,!0,c.ERROR),d=!1,t(i.makeErrorObject("wsc","Failed to open WebsocketConnection.","WebSocketConnection::connect"),null)},l.onclose=function(e,n){w(e,n,r)},l.onmessage=m}catch(e){t(e,null)}},r.setSocket=function(e){try{l=e,l.on("message",S),l.on("close",function(e,n){w(e,n,r)}),d=!0}catch(e){c.error(e,!0,!0,c.ERROR)}},r.setId=function(e){s=e},r.setPipedTo=function(e){p=e},r.setRemoteAddress=function(e){h=e},r.setRemotePort=function(e){g=e},r.setOrigin=function(e){f=e},r.setIsSecure=function(e){y=e},r.setEventListener=function(e){R=e},r.getId=function(){return s},r.getRemoteAddress=function(){return h},r.getRemotePort=function(){return g},r.getOrigin=function(){return f},r.getIsSecure=function(){return y},r.getPipedTo=function(){return p},r.getIsOpen=function(){return d},r.getPort=function(){return u};var S=function(e){try{R&&("utf8"==e.type&&R.onMessage(e.utf8Data,r),"binary"==e.type&&R.onMessage(e.binaryData,r))}catch(e){c.error(e,!0,!0,c.ERROR)}},m=function(e){try{R&&R.onMessage(e.data,r)}catch(e){c.error(e,!0,!0,c.ERROR)}},w=function(e,n,t){c.log("WebSocketConnection::onSocketClosed() "+a);try{d=!1,R&&R.onDisconnected(t.getId())}catch(e){c.error(e,!0,!0,c.ERROR)}};r.send=function(e){try{l.send(e)}catch(e){c.error(e,!0,!0,c.ERROR)}},r.sendBinary=r.send,r.close=function(){try{l.close()}catch(e){c.error(e,!0,!0,c.ERROR)}}}function WebSocketRpcConnection(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"spaceifyerror"):window.SpaceifyError,o=n?require(e+"spaceifyutility"):window.SpaceifyUtility,r=n?require(e+"rpccommunicator"):window.RpcCommunicator,i=n?require(e+"websocketconnection"):window.WebSocketConnection,c=this,a=new t,s=(new o,new r),u=new i;c.connect=function(e,n){u.connect(e,function(e,t){e?n&&n(a.makeErrorObject("wsrpcc","Failed to open WebsocketRpcConnection.","WebSocketRpcConnection::connect"),null):(s.addConnection(u),n&&n(null,!0))})},c.close=function(){},c.getCommunicator=function(){return s},c.getConnection=function(){return u},c.exposeRpcMethod=function(e,n,t){s.exposeRpcMethod(e,n,t)},c.exposeRpcMethodSync=function(e,n,t){s.exposeRpcMethodSync(e,n,t)},c.callRpc=function(e,n,t,o){return s.callRpc(e,n,t,o,u.getId())},c.getIsOpen=function(){return u.getIsOpen()},c.getIsSecure=function(){return u.getIsSecure()},c.getPort=function(){return u.getPort()},c.getId=function(){return u.getId()},c.setConnectionListener=function(e){s.setConnectionListener(e)},c.setDisconnectionListener=function(e){s.setDisconnectionListener(e)}}function WebSocketServer(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"logger"):window.Logger,o=n?require(e+"spaceifyconfig"):window.SpaceifyConfig,r=n?require(e+"spaceifyutility.js"):window.SpaceifyUtility,i=n?require(e+"websocketconnection"):window.WebSocketConnection;n&&(global.fs=require("fs"),global.URL=require("url"),global.http=require("http"),global.https=require("https"),global.WSServer=require("websocket").server);var c=this,a=new o,s=new r,u=new t("WebSocketServer","selogs"),l={},f=!1,p=null,d=null,y=null,g=null,h=null,R=null;c.listen=function(e,n){try{if("id"in l||(l.hostname=e.hostname||null,l.port=e.port||0,l.key=e.key||"",l.crt=e.crt||"",l.caCrt=e.caCrt||"",l.isSecure=e.isSecure||!1,l.keepUp=e.keepUp||"",l.protocol=l.isSecure?"wss":"ws",l.subprotocol=e.subprotocol||"json-rpc",l.id=e.id||s.generateRandomConnectionId({})),u.log(s.replace("WebSocketServer::listen() protocol: ~pr, subprotocol: ~s, hostname: ~h, port: ~po",{"~pr":l.protocol,"~s":l.subprotocol,"~h":l.hostname,"~po":l.port})),f=!1,l.isSecure){var t=fs.readFileSync(l.key),o=fs.readFileSync(l.crt),r=fs.readFileSync(l.caCrt,"utf8");y=https.createServer({key:t,cert:o,ca:r},function(e,n){n.writeHead(501),n.end("Not implemented")})}else y=http.createServer(function(e,n){n.writeHead(501),n.end("Not implemented")});y.listen(l.port,l.hostname,511,function(){l.port=y.address().port,S(),"function"==typeof n&&n(null,!0)}),y.on("error",function(e){u.error("WebSocketServer::onError()",!0,!0,u.ERROR),m(),"function"==typeof n&&n(e,null)}),y.on("close",function(){m()}),d=new WSServer({httpServer:y,autoAcceptConnections:!1,keepalive:!0,keepaliveInterval:6e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4}),d.on("request",function(e){try{var n=new i;n.setSocket(e.accept(l.subprotocol,e.origin)),n.setRemoteAddress(e.remoteAddress),n.setRemotePort(e.remotePort),n.setOrigin(e.origin),n.setIsSecure(l.isSecure);var t=URL.parse(e.resourceURL,!0).query;t&&t.id&&n.setId(t.id),g.addConnection(n),u.log(s.replace("WebSocketServer::request(~lp) protocol: ~p, remoteAddress: ~ra, remotePort: ~rp, origin: ~o, id: ~i",{"~lp":l.port,"~p":l.protocol,"~ra":e.remoteAddress,"~rp":e.remotePort,"~o":e.origin,"~i":n.getId()},"-"))}catch(e){return void u.error(e,!0,!0,u.ERROR)}}),d.on("connect",function(e){}),d.on("close",function(e,n,t){})}catch(e){u.error(e,!0,!0,u.ERROR)}},c.close=function(){try{u.log(s.replace("WebSocketServer::close() protocol: :pr, subprotocol: :s, hostname: :h, port: :po",{":pr":l.protocol,":s":l.subprotocol,":h":l.hostname,":po":l.port})),f=!0,d&&(d.shutDown(),d=null),y&&(y.close(),y=null)}catch(e){u.error(e,!0,!0,u.ERROR)}},c.getPort=function(){return l.port},c.getIsOpen=function(){return!(!y||!d)},c.getIsSecure=function(){return l.isSecure},c.getId=function(){return l.id},c.setEventListener=function(e){g=e};var S=function(){h&&h(l.id)},m=function(){R&&R(l.id),l.keepUp&&null==p&&!f&&(p=setTimeout(function(){p=null,c.listen(l,null)},a.RECONNECT_WAIT))};c.setServerUpListener=function(e){h="function"==typeof e?e:null},c.setServerDownListener=function(e){R="function"==typeof e?e:null}}function WebSocketRpcServer(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"spaceifyconfig"):window.SpaceifyConfig,o=n?require(e+"rpccommunicator"):window.RpcCommunicator,r=n?require(e+"websocketserver"):window.WebSocketServer,i=this,c=(new t,new o),a=new r;a.setEventListener(c);var s=null,u=null;i.listen=function(e,n){c.setConnectionListener(l),c.setDisconnectionListener(f);try{a.listen(e,n)}catch(e){}},i.close=function(){a.close()},i.getCommunicator=function(){return c},i.getServer=function(){return a},i.getPort=function(){return a.getPort()},i.getIsOpen=function(){return a.getIsOpen()},i.getIsSecure=function(){return a.getIsSecure()},i.getId=function(){return a.getId()},i.exposeRpcMethod=function(e,n,t){c.exposeRpcMethod(e,n,t)},i.exposeRpcMethodSync=function(e,n,t){c.exposeRpcMethodSync(e,n,t)},i.nofifyAll=function(e,n){c.nofifyAll(e,n)},i.callRpc=function(){c.callRpc.apply(this,arguments)},i.closeConnection=function(e){c.closeConnection(e)},i.setConnectionListener=function(e){s="function"==typeof e?e:null},i.setDisconnectionListener=function(e){u="function"==typeof e?e:null},i.setServerUpListener=function(e){a.setServerUpListener("function"==typeof e?e:null)},i.setServerDownListener=function(e){a.setServerDownListener("function"==typeof e?e:null)};var l=function(e){"function"==typeof s&&s(e,i.getId(),i.getIsSecure())},f=function(e){"function"==typeof u&&u(e,i.getId(),i.getIsSecure())}}function SpaceifyApplicationManager(){var e,n=this,t=new SpaceifyError,o=new SpaceifyConfig,r=new SpaceifyNetwork,i=new SpaceifyUtility,c=new SpaceifyMessages,a=[],s=0,u=null,l=null;n.installApplication=function(e,n,t,o,r,i){f("installApplication",{package:e,username:n,password:t,force:o},r,i,!0)},n.removeApplication=function(e,n,t){f("removeApplication",{unique_name:e},n,t,!0)},n.purgeApplication=function(e,n,t){f("purgeApplication",{unique_name:e},n,t,!0)},n.startApplication=function(e,n,t){f("startApplication",{unique_name:e},n,t,!0)},n.stopApplication=function(e,n,t){f("stopApplication",{unique_name:e},n,t,!0)},n.restartApplication=function(e,n,t){f("restartApplication",{unique_name:e},n,t,!0)},n.logIn=function(e,n,t){f("logIn",{password:e},n,t,!1)},n.logOut=function(e,n){f("logOut",{},e,n,!1)},n.isAdminLoggedIn=function(e,n){f("isAdminLoggedIn",{},e,n,!0)},n.getCoreSettings=function(e,n){f("getCoreSettings",{},e,n,!0)},n.saveCoreSettings=function(e,n,t){f("saveCoreSettings",{settings:e},n,t,!0)},n.getEdgeSettings=function(e,n){f("getEdgeSettings",{},e,n,!0)},n.saveEdgeSettings=function(e,n,t){f("saveEdgeSettings",{settings:e},n,t,!0)},n.getServiceRuntimeStates=function(e,n){f("getServiceRuntimeStates",{},e,n,!0)},n.getApplications=function(e,n,t){f("getApplications",{types:e},n,t,!0)},n.appStoreGetPackages=function(e,n){var e=JSON.stringify(e),i='Content-Disposition: form-data; name="search";\r\nContent-Type: plain/text; charset=utf-8';r.POST_FORM(o.EDGE_APPSTORE_GET_PACKAGES_URL,[{content:i,data:e}],"application/json",function(e,o){var e=null,r=null;try{o=o.replace(/&quot;/g,'"'),o=o.replace(/\\|^"|"$/g,""),r=JSON.parse(o),r.error&&(e=r.error,r=null)}catch(n){e=t.makeErrorObject("JSON","Failed to get packages: JSON.parse failed","SpaceifyApplicationManager::appStoreGetPackages");
}n(e,r)})};var f=function(n,t,o,r,c){var s={type:n,params:t,origin:o,handler:r,getMessages:c,ms:Date.now(),id:i.randomString(16,!0)};0==a.length?(e=s,p()):a.push(s)},p=function(){e.getMessages?c.connect(n,e.origin):n.connected()};n.connected=function(){s=1;var t={type:e.type};for(var o in e.params)t[o]=e.params[o];r.doOperation(t,function(e,t){u=e,l=t,n.end(1)})},n.fail=function(e){u=e,l=null,n.end(2)},n.end=function(n){if(n+=n,2==n){var t=c.getErrors();u||t.length>0?e.origin.error(u?[u]:t,e.id,Date.now()-e.ms):"function"==typeof e.handler&&e.handler(l,e.id,Date.now()-e.ms),a.length>0&&(e=a.shift(),p())}},n.answer=function(e,n){c.answer(e,n)}}function SpaceifySynchronous(){var e=this,n=0,t=[],o={},r=null,i=null;e.waterFall=function(e,n){if(e&&0!=e.length||"function"!=typeof n){if(!e||0==e.length||"function"!=typeof n)return}else n(o);i=n,t=e,c()};var c=function(){if(0==t.length)return i();var e=t.shift();"async"==e.type?(r=e.params[e.params.length-1],e.params[e.params.length-1]=a,e.method.apply(e.object,e.params)):(o[++n]=e.method.apply(e.object,e.params),c())},a=function(){o[++n]=Array.prototype.slice.call(arguments),"function"==typeof r&&r.apply(this,arguments),c()};e.getResult=function(e){return o[e]?o[e]:null},e.getResults=function(){return o}}function SpaceifyCache(){var e=this,n={},t=6e4,o=new SpaceifyConfig;e.setApplication=function(e){n[e.unique_name]||(n[e.unique_name]={}),n[e.unique_name].manifest=e,n[e.unique_name].isRunning=e.isRunning},e.getApplication=function(e){return e in n?n[e]:null},e.setService=function(e,t){e.service_type==o.HTTP&&(n[t]||(n[t]={}),n[t].services||(n[t].services=[]),n[t].services.push(e))},e.getService=function(e,t){for(var r in n)for(var i=n[r].services?n[r].services:[],c=0;c<i.length;c++){var a=i[c].service_name;if(!t&&e==a&&e!=o.HTTP||t&&t==r&&e==a)return i[c]}return null},e.setManifest=function(e,t){n[e]||(n[e]={}),n[e].manifest=t},e.getManifest=function(e){return n[e]&&n[e].manifest?n[e].manifest:null},e.setRunning=function(e,t){n[e]||(n[e]={}),n[e].isRunning=t,n[e].isRunningStart=Date.now()},e.isRunning=function(e){if(!n[e]||!n[e].hasOwnProperty("isRunning"))return null;var o=Date.now()-n[e].isRunningStart;return o>t?null:n[e].isRunning},e.setApplicationURL=function(e,t){n[e]||(n[e]={}),n[e].urls=t,n[e].urls_start=Date.now()},e.getApplicationURL=function(e){if(!n[e]||!n[e].hasOwnProperty("urls"))return null;var o=Date.now()-n[e].urls_start;return o>t?null:n[e].urls}}function SpaceifyConfig(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"spaceifyunique"):window.SpaceifyUnique,o=this,r=new t;if(n){var i,c=require("fs").readFileSync("/var/lib/spaceify/code/www/libs/config.json","utf8"),a=JSON.parse(c);for(i in a)o[i]=a[i]}else for(i in window.seconfig)o[i]=window.seconfig[i];o.get=function(e){return e in o?o[e]:null},o.makeRealApplicationPaths=function(){if(n){var e,t,i,c=process.cwd();o.API_PATH=o.SPACEIFY_CODE_PATH,o.API_WWW_PATH=o.SPACEIFY_WWW_PATH,o.API_NODE_MODULES_DIRECTORY=o.SPACEIFY_NODE_MODULES_PATH,t=c.split("/"),t[t.length-1]==o.APPLICATION_ROOT?(e=s(c),e&&(i=c.replace("/"+o.APPLICATION_ROOT,"/"),o.VOLUME_PATH=i,o.VOLUME_TLS_PATH=i+o.TLS_DIRECTORY,o.VOLUME_APPLICATION_PATH=i+o.APPLICATION_DIRECTORY,o.VOLUME_APPLICATION_WWW_PATH=i+o.APPLICATION_DIRECTORY+o.WWW_DIRECTORY)):(i=c+"/",e=s(c),e&&(o.VOLUME_PATH=i,o.VOLUME_APPLICATION_PATH=i,o.VOLUME_APPLICATION_WWW_PATH=i+o.WWW_DIRECTORY,o.VOLUME_TLS_PATH=r.getVolPath(e.type,e.unique_name,o)+o.VOLUME_TLS_PATH))}};var s=function(e){var n=null;try{n=require("fs").readFileSync(e+"/"+o.MANIFEST,"utf8"),n=JSON.parse(n)}catch(e){}return n}}function SpaceifyCore(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=!(!n||"undefined"==typeof process.env.IS_REAL_SPACEIFY),o=!("undefined"==typeof window||!window.isSpaceifyNetwork)&&window.isSpaceifyNetwork,r="undefined"!=typeof window&&!window.location.hostname.match(/.*spaceify\.net/),i=n?function(){}:window.SpaceifyNetwork,c=n?require(e+"spaceifyconfig"):window.SpaceifyConfig,a=n?require(e+"websocketrpcconnection"):window.WebSocketRpcConnection,s=this,u=new c,l=new i,f=null,p=!1,d=o||n||r?new a:LoaderUtil.piperClient,y=!!n||l.isSecure(),g=n?e+u.SPACEIFY_CRT_WWW:"";s.startSpacelet=function(e,n){h("startSpacelet",[e],function(e,t,o,r){if(e)n(e,null);else{for(var i=[],c=0;c<t.length;c++)i.push(t[c].service_name);n(null,{services:t,serviceNames:i},o,r)}})},s.registerService=function(e,n,t){h("registerService",[e,n],t)},s.unregisterService=function(e,n,t){h("unregisterService",[e,n],t)},s.getService=function(e,n,t){h("getService",[e,n],t)},s.getServices=function(e,n){h("getServices",[e],n)},s.getOpenServices=function(e,n,t){h("getOpenServices",[e,n],t)},s.getManifest=function(e,n){var t=w()?m().getManifest(e):null;t?n(null,t,-1,0):h("getManifest",[e,!0],function(t,o,r,i){!t&&w()&&m().setManifest(e,o),n(t,o,r,i)})},s.isAdminLoggedIn=function(e){l.doOperation({type:"isAdminLoggedIn"},function(n,t,o,r){e(n?n:null,!n&&t,o,r)})},s.getApplicationStatus=function(e,n){h("getApplicationStatus",[e],n)},s.isApplicationRunning=function(e,n){h("isApplicationRunning",[e],n)},s.getServiceRuntimeStates=function(e,n){h("getServiceRuntimeStates",[e],n)},s.getApplicationData=function(e){var n;h("getApplicationData",[],function(t,o,r,i){if(!t&&w()){for(n=0;n<o.spacelet.length;n++)m().setApplication(o.spacelet[n]);for(n=0;n<o.sandboxed.length;n++)m().setApplication(o.sandboxed[n]);for(n=0;n<o.sandboxed_debian.length;n++)m().setApplication(o.sandboxed_debian[n]);for(n=0;n<o.native_debian.length;n++)m().setApplication(o.native_debian[n])}e(t,o,r,i)})},s.getApplicationURL=function(e,n){h("getApplicationURL",[e],n)},s.setSplashAccepted=function(e){h("setSplashAccepted",[],e)},s.setEventListeners=function(e,n,t,o,r){h("setEventListeners",[e],function(o,i,c,a){if(!o)for(var s=0;s<e.length;s++)d.exposeRpcMethod(e[s],t,n[s]);r(o,i,c,a)})};var h=function(e,n,t){p?R(e,n,t):S(e,n,t)},R=function(e,t,i){o||n||r?d.callRpc(e,t,s,function(e,n,t,o){i(e,n,t,o)}):d.callClientRpc(f,e,t,s,function(e,n){i(e,n)})},S=function(e,i,c){var a,s,h,S=y?u.CORE_PORT_SECURE:u.CORE_PORT;o||n||r?(s=n?t?u.EDGE_IP:u.CONNECTION_HOSTNAME:u.EDGE_HOSTNAME,d.connect({hostname:s,port:S,isSecure:y,caCrt:g},function(n,t,o,r){n?(p=!1,c(n,t,o,r)):(p=!0,R(e,i,c))})):d.connect(LoaderUtil.SERVER_ADDRESS.host,LoaderUtil.SERVER_ADDRESS.port,LoaderUtil.SERVER_ADDRESS.isSsl,LoaderUtil.SERVER_ADDRESS.groupId,function(){h=y?"https":"http",a=l.getEdgeURL(!1,null,!1),d.createWebSocketTunnel({host:a,port:S,protocol:h},null,function(n){f=n,p=!0,R(e,i,c)})})};s.close=function(){d&&d.close&&d.close(),d=null};var m=function(){return!n&&window&&window.spaceifyCache?window.spaceifyCache:null},w=function(){var e=m();return"undefined"!=e&&null!=e}}function SpaceifyMessages(){var e,n=this,t=(new SpaceifyError,new SpaceifyConfig),o=(new SpaceifyUtility,new SpaceifyNetwork),r=null,i=[],c=[],a=null,s=null,u="undefined"==typeof window,l="undefined"!=typeof window.isSpaceifyNetwork&&window.isSpaceifyNetwork,f=!1,p=l||u?new WebSocketRpcConnection:LoaderUtil.piperClient;n.connect=function(C,E){i=[],c=[];var O,b;return a=E,s=C,f?s.connected():void o.doOperation({type:"requestMessageId"},function(i,c){return i?d(i):(e=c,p.exposeRpcMethod("stdout",n,S),p.exposeRpcMethod("fail",n,d),p.exposeRpcMethod("error",n,y),p.exposeRpcMethod("warning",n,g),p.exposeRpcMethod("notify",n,h),p.exposeRpcMethod("message",n,R),p.exposeRpcMethod("question",n,m),p.exposeRpcMethod("questionTimedOut",n,w),p.exposeRpcMethod("end",n,v),void(l||u?p.connect({hostname:t.EDGE_HOSTNAME,port:t.APPMAN_MESSAGE_PORT_SECURE,isSecure:!0},function(n,t){return n?d(n):(f=!0,p.callRpc("confirm",[e]),void s.connected())}):p.connect(LoaderUtil.SERVER_ADDRESS.host,LoaderUtil.SERVER_ADDRESS.port,LoaderUtil.SERVER_ADDRESS.isSsl,LoaderUtil.SERVER_ADDRESS.groupId,function(){O=o.getProtocol(!1,null),b=o.getEdgeURL(!1,null,!1),p.createWebSocketTunnel({host:b,port:port,protocol:O},null,function(n){r=n,f=!0,piperClient.callClientRpc(r,"confirm",[e],this,function(e,n){s.connected()})})})))})},n.isConnected=function(){return f},n.getErrors=function(){return i},n.getWarnings=function(){return c};var d=function(e,n,t){f=!1,a.fail&&a.fail(e),s.fail(e),"function"==typeof t&&t(null,!0)},y=function(e,n,t){i.push(e),"function"==typeof t&&t(null,!0)},g=function(e,n,t,o){g.push({message:e,code:n}),a.warning&&a.warning(e,n),"function"==typeof o&&o(null,!0)},h=function(e,n,t,o){a.notify&&a.notify(e,n,t,o),"function"==typeof o&&o(null,!0)},R=function(e,n,t){a.message&&a.message(e),"function"==typeof t&&t(null,!0)},S=function(e,n,t){a.stdout&&a.stdout(e),"function"==typeof t&&t(null,!0)},m=function(e,n,t,o,r,i){a.question&&a.question(e,n,t,o),"function"==typeof i&&i(null,!0)},w=function(e,n,t,o,r){a.questionTimedOut&&a.questionTimedOut(e,n,t),"function"==typeof r&&r(null,!0)},v=function(e,n,t){s.ready(1),"function"==typeof t&&t(null,!0)};n.sendAnswer=function(n,t){l||u?p.callRpc("answer",[e,n,t]):p.callClientRpc(r,"answer",[e,n,t])}}function SpaceifyNet(){var e=this,n=0,t={spacelet:{},sandboxed:{},sandboxed_debian:{},native_debian:{},spaceletCount:0,sandboxedCount:0,sandboxedDebianCount:0,nativeDebianCount:0},o=new SpaceifyCore,r=new SpaceifyConfig,i=new SpaceifyUtility,c=new SpaceifyNetwork;e.showLoading=function(e){e?(0==n&&$("#loading").show(),n++):(n=Math.max(0,--n),0==n&&$("#loading").hide())},e.showError=function(e){a(e,"error")},e.showSuccess=function(e){a(e,"success")};var a=function(e,n){var t;(t=$("#alerting")).length>0&&t.remove(),t=$('<span class="edgeAlert '+n+'" id="alerting">'+e+"</span>"),$(document.body).append(t),t.css("left",($(window).width()-t.width())/2),t.css("visibility","visible"),window.setTimeout(function(){t.remove()},5e3)};e.onEnterPress=function(e){var n=null==typeof e?window.event.keyCode:e.keyCode;return 13==n||10==n},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};var s=function(e){return angular.element(document.getElementById(e)).scope()};e.setSplashAccepted=function(){try{o.setSplashAccepted(function(e,n){n&&1==n&&window.location.reload(!0)})}catch(e){}},e.loadCertificate=function(){return document.getElementById("certIframe").src=c.getEdgeURL(!1,!1,!0)+"spaceify.crt",!0},e.loadAppstorePage=function(){var e=c.getEdgeURL(!0,null,!0);spaceifyLoader.loadPage(e+r.APPSTORE_INDEX_FILE,e+r.APPSTORE,e)},e.loadLaunchPage=function(){var e=c.getEdgeURL(!0,null,!0);spaceifyLoader.loadPage(e+r.INDEX_FILE,e,e)},e.showInstalledApplications=function(n){$("#spacelet").empty(),$("#sandboxed").empty(),$("#sandboxedDebian").empty(),$("#nativeDebian").empty();var t,r=[];o.getApplicationData(function(o,i){if(!i)return"function"==typeof n&&n();for(t=0;t<i.spacelet.length;t++)r.push({object:e,method:e.renderTile,params:[i.spacelet[t],null],type:"async"});for(t=0;t<i.sandboxed.length;t++)r.push({object:e,method:e.renderTile,params:[i.sandboxed[t],null],type:"async"});for(t=0;t<i.sandboxed_debian.length;t++)r.push({object:e,method:e.renderTile,params:[i.sandboxed_debian[t],null],type:"async"});for(t=0;t<i.native_debian.length;t++)r.push({object:e,method:e.renderTile,params:[i.native_debian[t],null],type:"async"});(new SpaceifySynchronous).waterFall(r,function(){"function"==typeof n&&n()})})},e.renderTile=function(e,n){var t,a,l,f,p,d,y,g;e.hasTile?o.getApplicationURL(e.unique_name,function(o,i){l=c.isSecure()?i.securePort:i.port,p=c.getEdgeURL(!1,!1,!0),f=i.implementsWebServer&&l?c.getEdgeURL(!1,l,!0):c.externalResourceURL(e.unique_name),d=r.TILEFILE,g="apptile_"+e.unique_name.replace("/","_"),s("edgeBody").addTile({type:"appTile",container:e.type,manifest:e,id:g,callback:function(){a={},a.sp_host=encodeURIComponent(f),a.sp_path=encodeURIComponent(d),a.spe_host=encodeURIComponent(p),t=document.getElementById(g),t.src=f+d+c.remakeQueryString(a,{},{},"",!0),n()}})}):((y=i.getApplicationIcon(e,!1))?(f=c.externalResourceURL(e.unique_name),d=y):(f=c.getEdgeURL(!1,!1,!0),d="images/icon.png"),g="iconimage_"+e.unique_name.replace("/","_"),s("edgeBody").addTile({type:"tile",container:e.type,manifest:e,id:g,sp_src:f+d,callback:function(){spaceifyLoader.loadData(document.getElementById(g),n)}})),u(e)},e.removeTile=function(e){var n=e.unique_name.replace(/\//,"_");$("#"+n).remove(),l(e)};var u=function(e){e.type==r.SPACELET?(t.spacelet[e.unique_name]=e,t.spaceletCount++):e.type==r.SANDBOXED?(t.sandboxed[e.unique_name]=e,t.sandboxedCount++):e.type==r.SANDBOXED_DEBIAN?(t.sandboxed_debian[e.unique_name]=e,t.sandboxedDebianCount++):e.type==r.NATIVE_DEBIAN&&(t.native_debian[e.unique_name]=e,t.nativeDebianCount++)},l=function(e){e.type==r.SPACELET?(delete t.spacelet[e.unique_name],t.spaceletCount--):e.type==r.SANDBOXED?(delete t.sandboxed[e.unique_name],t.sandboxedCount--):e.type==r.SANDBOXED_DEBIAN?(delete t.sandboxed_debian[e.unique_name],t.sandboxedDebianCount--):e.type==r.NATIVE_DEBIAN&&(delete t.native_debian[e.unique_name],t.nativeDebianCount--)};e.getApplications=function(){return t}}function SpaceifyNetwork(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"spaceifyerror"):window.SpaceifyError,o=n?require(e+"spaceifyconfig"):window.SpaceifyConfig,r=n?require(e+"spaceifyutility"):window.SpaceifyUtility,i=this,c=new t,a=new o,s=new r;i.getEdgeURL=function(e,n,t){"boolean"==typeof e&&(e=e?"https:":"undefined"!=typeof window?location.protocol:"http:");var o=i.getProtocol(!0,e),r="undefined"!=typeof window?window.location.hostname:a.EDGE_HOSTNAME;return o+r+(n?":"+n:"")+(t?"/":"")},i.externalResourceURL=function(e,n){return i.getEdgeURL(!!n&&n,!1,!0)+e+"/"},i.getPort=function(e,n,t){return i.isSecure()||t?n:e},i.isSecure=function(){var e=i.getProtocol(!1);return"http:"!=e},i.getProtocol=function(e,n){if("undefined"==typeof window)return n+(e?"://":":");var t,o,r=n?n:location.protocol;return"blob:"==r&&(window.parent?(t=""+window.parent.location,t=t.replace(/^blob:/,""),r=null!==(o=t.match(/^http.?:/))?o[0]:"http:"):r="http:"),("http:"==r?"http":"https")+(e?"://":":")},i.parseQuery=function(e){var n,t,o,r={};if(e=decodeURIComponent(e),e=e.replace(/#.*$/,""),n=e.split("?"),1==n.length&&"?"!=e.charAt(0))return r;n=n.length<2?n[0]:n[1],o=n.split("&");for(var i=0,c=o.length;i<c;i++)o[i]&&(t=o[i].split("="),r[t[0]]=2==t.length?t[1]:null);return r},i.remakeQueryString=function(e,n,t,o,r){var i,c,a,s="";for(i in n)i in e&&delete e[i];for(i in t)e[i]=t[i];for(i in e)r?(a=decodeURIComponent(e[i]),a=encodeURIComponent(a)):a=e[i],s+=(""!=s?"&":"")+i+"="+a;return o?(o=decodeURIComponent(o),(c=o.match(/(?:#.*)/,""))&&(c=c[0]),o=o.replace(/\?.*$/,"")):(c="",o=""),o=o+(s?"?"+s:"")+(c?c:"")},i.isSpaceifyNetwork=function(e,n){var t=new window.XMLHttpRequest;t.open("HEAD",window.location.protocol+"//10.0.0.1/templates/test.txt",!0),t.timeout=e,t.onreadystatechange=function(){4==t.readyState&&n(t.status>=200&&t.status<304)},t.send()},i.parseURL=function(e){for(var n={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},t=n.parser[n.strictMode?"strict":"loose"].exec(e),o={},r=14;r--;)o[n.key[r]]=t[r]||"";return o[n.q.name]={},o[n.key[12]].replace(n.q.parser,function(e,t,r){t&&(o[n.q.name][t]=r)}),o},i.implementsWebServer=function(e){return!(!e.implements||e.implements.indexOf(a.WEB_SERVER)==-1)},i.isPortInUse=function(e,n){if(!e)return n(null,!0);var t=require("net"),o=t.createServer();o.once("error",function(e){n("EADDRINUSE"!=e.code?e:null,!0)}),o.once("listening",function(){o.once("close",function(){n(null,!1)}),o.close()}),o.listen(e)},i.GET=function(e,n,t){var o=Date.now(),r=s.randomString(16,!0),i=u();i.onreadystatechange=function(){l(i,r,o,n)},i.open("GET",e,!0),i.responseType=t?t:"",i.send()},i.POST_FORM=function(e,n,t,o){if("undefined"!=typeof spaceifyLoader)spaceifyLoader.postData(e,n,t,o);else{for(var r="---------------------------"+Date.now().toString(16),i="",c=0;c<n.length;c++)i+="\r\n--"+r+"\r\n",i+=n[c].content,i+="\r\n\r\n"+n[c].data+"\r\n";i+="\r\n--"+r+"--";var a=u();a.open("POST",e,!0),a.responseType=t?t:"text",a.setRequestHeader("Content-Type","multipart/form-data; boundary="+r),a.onreadystatechange=function(){l(a,s.randomString(16,!0),Date.now(),o)},a.send(i)}},i.doOperation=function(e,n){var t,o,r,s=null;try{o="Content-Disposition: form-data; name=operation;\r\nContent-Type: application/json; charset=utf-8",r=i.getEdgeURL(!0,null,!0)+a.OPERATION,i.POST_FORM(r,[{content:o,data:JSON.stringify(e)}],"json",function(e,o,r,i){try{"string"!=typeof o&&(o=JSON.stringify(o)),o=o.replace(/&quot;/g,'"'),o=o.replace(/\\|^"|"$/g,""),t=JSON.parse(o)}catch(e){t={err:c.makeErrorObject("doOperation1","Invalid JSON received.","SpaceifyNetwork::doOperation")}}t.err?s=t.err:t.error&&(s=t.error),n(s,t.data,r,i)})}catch(e){n(e,null)}};var u=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},l=function(e,n,t,o){4==e.readyState&&o(200!=e.status?e.status:null,200==e.status?e.response:null,n,Date.now()-t)};i.setCookie=function(e,n,t){var o="";if(t){var r=Date.now()+1e3*t,i=new Date(r);o="expires="+i.toGMTString()}document.cookie=e+"="+n+(""!=o?"; "+o:"")},i.getCookie=function(e){for(var n=e+"=",t=document.cookie.split(";"),o=0;o<t.length;o++){for(var r=t[o];" "==r.charAt(0);)r=r.substring(1);if(r.indexOf(n)!=-1)return r.substring(n.length,r.length)}return""},i.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"}}function SpaceifyService(){function e(e,n,t,r){var i,c="object"==typeof e?e.service_name:e;n[c]||(n[c]=new o(c,!1,new u),n[c].setConnectionListener(_),n[c].setDisconnectionListener(P)),"object"==typeof e?(i=t?e.securePort:e.port,A(n[c],i,t,function(){"function"==typeof r&&r(null,n[c])})):p.getService(c,"",function(e,o){!o||e?(n[c].getIsOpen()||P(-1,c,t),"function"==typeof r&&r(I,null)):(i=t?o.securePort:o.port,A(n[c],i,t,function(){"function"==typeof r&&r(null,n[c])}))})}var n="/var/lib/spaceify/code/",t="undefined"==typeof window,o=t?require(n+"service"):window.Service,r=t?require(n+"spaceifycore"):window.SpaceifyCore,i=t?require(n+"spaceifyerror"):window.SpaceifyError,c=t?require(n+"websocketrpcserver"):null,a=t?require(n+"spaceifyconfig"):window.SpaceifyConfig,s=t?require(n+"spaceifynetwork"):window.SpaceifyNetwork,u=t?require(n+"websocketrpcconnection"):window.WebSocketRpcConnection,l=t?require(n+"fibrous"):function(e){return e},f=this,p=new r,d=new i,y=new a,g=new s;y.makeRealApplicationPaths();var h={},R={},S={},m={},w=!0,v=!0,C={},E=n+y.SPACEIFY_CRT_WWW,O=y.VOLUME_TLS_PATH+y.SERVER_KEY,b=y.VOLUME_TLS_PATH+y.SERVER_CRT,I=d.makeErrorObject("not_open","Connection is not ready.","SpaceifyService::connect");f.connect=function(n,o,r){var i="object"==typeof n?n.service_name:n;return i==y.HTTP?r(I,null):("function"==typeof o?(r=o,o=!t&&g.isSecure()):o=t?o:g.isSecure(),void e(n,o?R:h,o,r))};var A=function(e,n,t,o){return e.getIsOpen()?o():void e.getConnection().connect({hostname:y.EDGE_HOSTNAME,port:n,isSecure:t,caCrt:E},o)};f.disconnect=function(e,n){var t;e?service_name.constructor!==Array&&(t=[e]):t=Object.keys(h);for(var o=0;o<t.length;o++)t[o]in h&&h[t[o]].getConnection().close(),t[o]in R&&R[t[o]].getConnection().close()};var _=function(e,n,t){},P=function(e,n,t){if(v){var o=n+(t?"T":"F");if(!(o in C)){var r=t?R[n]:h[n];C[o]=setTimeout(T,y.RECONNECT_WAIT,e,n,t,o,r)}}},T=function(e,n,t,o,r){p.getService(n,"",function(i,c){delete C[o],c?A(r,t?c.securePort:c.port,t,function(){}):P(e,n,t)})};f.getRequiredService=function(e){return h[e]?h[e]:null},f.getRequiredServiceSecure=function(e){return R[e]?R[e]:null},f.keepConnectionUp=function(e){v="boolean"==typeof e&&e},f.listen=l(function(e,n,t,r,i,a){"undefined"==typeof i&&(i=!0),"undefined"==typeof a&&(a=!0),S[e]||(S[e]=new o(e,!0,new c)),m[e]||(m[e]=new o(e,!0,new c)),i&&L.sync(S[e],t,!1),a&&L.sync(m[e],r,!0),t&&r||(i&&(t=S[e].getServer().getPort()),a&&(r=m[e].getServer().getPort()),console.log("    LISTEN -----> "+e+" - port: "+t+", secure port: "+r)),p.sync.registerService(e,{unique_name:n,port:t,securePort:r})});var L=l(function(e,n,t){e.getIsOpen()||e.getServer().sync.listen({hostname:null,port:n,isSecure:t,key:O,crt:b,caCrt:E,keepUp:w})});f.close=function(e){var n;"undefined"==typeof service_names?n=Object.keys(S):"undefined"!=typeof service_names&&e.constructor!==Array&&(n=[service_names]);for(var t=0;t<n.length;t++)n[t]in S&&S[n[t]].getServer().close(),n[t]in m&&m[n[t]].getServer().close()},f.getProvidedService=function(e){return S[e]?S[e]:null},f.getProvidedServiceSecure=function(e){return m[e]?m[e]:null},f.keepServerUp=function(e){w="boolean"==typeof e&&e}}function SpaceifyUtility(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=n?require(e+"logger"):window.Logger,o=n?require(e+"language"):{},r=n?require(e+"spaceifyconfig"):window.SpaceifyConfig;n&&(global.os=require("os"),global.fs=require("fs"),global.path=require("path"),global.mkdirp=require("mkdirp"),global.AdmZip=require("adm-zip"),global.request=require("request"),global.spawn=require("child_process").spawn);var i=n?require(e+"fibrous"):function(e){return e},c=this,a=o,s=new r,u=new t("SpaceifyUtility","selogs");c.loadRemoteFile=i(function(e){var n;try{n=request.sync.get(e,{encoding:null,rejectUnauthorized:!1,agent:!1})}catch(e){throw a.E_LOAD_REMOTE_FILE_FAILED_TO_INITIATE_HTTP_GET.pre("SpaceifyUtility::loadRemoteFile",e)}if(200!=n.statusCode)throw a.E_LOAD_REMOTE_FILE_FAILED_TO_LOAD_REMOTE_FILE.preFmt("SpaceifyUtility::loadRemoteFile",{"~file":e,"~code":n.statusCode});return n}),c.loadRemoteFileToLocalFile=i(function(e,n,t,o){try{var r=c.sync.loadRemoteFile(e);return 200==r.statusCode&&c.sync.writeFile(n,t,r.body),!0}catch(e){if(o)throw a.E_LOAD_REMOTE_FILE_TO_LOCAL_FILE_FAILED.pre("SpaceifyUtility::loadRemoteFileToLocalFile",e)}return!1}),c.isLocal=i(function(e,n){try{var t=fs.sync.stat(e);if(t&&"file"==n&&t.isFile())return!0;if(t&&"directory"==n&&t.isDirectory())return!0}catch(e){}return!1}),c.getPathType=i(function(e){try{var n=fs.sync.stat(e);if(n&&n.isFile())return"file";if(n&&n.isDirectory())return"directory"}catch(e){}return"undefined"}),c.deleteDirectory=i(function(e,n){try{var t=fs.sync.stat(e);"undefined"!=typeof t&&t.isDirectory()&&(fs.sync.readdir(e).forEach(function(t,o){var r=e+"/"+t;fs.sync.stat(r).isDirectory()?c.sync.deleteDirectory(r,n):fs.sync.unlink(r)}),fs.sync.rmdir(e))}catch(e){if(n)throw a.E_DELETE_DIRECTORY_FAILED.pre("SpaceifyUtility::deleteDirectory",e)}}),c.copyDirectory=i(function(e,n,t,o){try{e+=e.search(/\/$/)!=-1?"":"/",n+=n.search(/\/$/)!=-1?"":"/";var r=fs.sync.stat(e);if("undefined"==typeof r||!r.isDirectory()||o.indexOf(e)!=-1)return;var i=parseInt("0"+(511&r.mode).toString(8),8);mkdirp.sync(n,i),fs.sync.readdir(e).forEach(function(a,s){var u=e+a,l=n+a;if(r=fs.sync.stat(u),r.isDirectory())c.sync.copyDirectory(u+"/",l+"/",t,o);else{i=parseInt("0"+(511&r.mode).toString(8),8);var f=fs.createReadStream(u,{autoClose:!0}),p=fs.createWriteStream(l,{mode:i});f.pipe(p)}})}catch(e){if(t)throw a.E_COPY_DIRECTORY_FAILED.pre("SpaceifyUtility::copyDirectory",e)}}),c.moveDirectory=i(function(e,n,t){try{c.sync.copyDirectory(e,n,!0,[]),c.sync.deleteDirectory(e,!0)}catch(e){if(t)throw a.E_MOVE_DIRECTORY_FAILED.pre("SpaceifyUtility::moveDirectory",e)}}),c.deleteFile=i(function(e,n){try{var t=fs.sync.stat(e);"undefined"==typeof t||t.isDirectory()||fs.sync.unlink(e)}catch(e){if(n)throw a.E_DELETE_FILE_FAILED.pre("SpaceifyUtility::deleteFile",e)}}),c.copyFile=i(function(e,n,t){try{var o=fs.sync.stat(e);if("undefined"!=typeof o&&!o.isDirectory()){var r=parseInt("0"+(511&o.mode).toString(8),8),i=fs.createReadStream(e,{autoClose:!0}),c=fs.createWriteStream(n,{mode:r});i.pipe(c)}}catch(e){if(t)throw a.E_COPY_FILE_FAILED.pre("SpaceifyUtility::copyFile",e)}}),c.moveFile=i(function(e,n,t){try{c.sync.copyFile(e,n,!0),c.sync.deleteFile(e,!0)}catch(e){if(t)throw a.E_MOVE_FILE_FAILED.pre("SpaceifyUtility::moveFile",e)}}),c.zipDirectory=i(function(e,n){e+=""!=e&&e.search(/\/$/)==-1?"/":"";try{c.execute.sync("zip",["-r","-q",n,".","-i","*"],{cwd:e},null)}catch(e){throw a.E_ZIP_DIRECTORY_FAILED.pre("SpaceifyUtility::zipDirectory",e)}}),c.getFileFromZip=function(e,n,t,o){var r=new RegExp(n+"$","i"),i=new AdmZip(e),a=i.getEntries();for(var s in a)if(a[s].entryName.search(r)!=-1)return t&&i.extractAllTo(t,!0),i.readAsText(a[s].entryName);return o&&c.sync.deleteFile(e),null},c.unZip=function(e,n,t){var o=new AdmZip(e);return o.extractAllTo(n,!0),t&&c.sync.deleteFile(e),!0},c.writeFile=i(function(e,n,t){mkdirp.sync(e),fs.sync.writeFile(e+n,t)}),c.preparePath=function(e){return e+(e.match(/^$/)||e.match(/\/$/)?"":"/")},c.postForm=i(function(e,n){var t;try{t=request.sync.post(e,n)}catch(e){throw a.E_POST_FORM_FAILED_TO_INITIATE_HTTP_POST.pre("SpaceifyUtility::postForm",e)}if(200!=t.statusCode)throw a.E_POST_FORM_FAILED_TO_POST_FORM.preFmt("SpaceifyUtility::postForm",{"~url":e,"~code":t.statusCode});return t}),c.postPublish=function(e,n,t,o,r){u.force(a.PACKAGE_POSTING),request({url:s.REGISTRY_PUBLISH_URL,headers:{"content-type":"multipart/form-data"},method:"POST",multipart:[{"Content-Disposition":'form-data; name="username"',body:n},{"Content-Disposition":'form-data; name="password"',body:t},{"Content-Disposition":'form-data; name="release"',body:o},{"Content-Disposition":'form-data; name="package"; filename="'+s.PUBLISH_ZIP+'"',"Content-Type":"application/zip",body:fs.readFileSync(e)}]},function(e,n,t){r(e?e:null,e?null:200!=n.statusCode?n.statusCode:t)})},c.postRegister=function(e,n,t,o){request.post({url:s.EDGE_REGISTER_URL,headers:{"content-type":"multipart/form-data"},multipart:[{"Content-Disposition":'form-data; name="edge_id"',body:e},{"Content-Disposition":'form-data; name="edge_name"',body:n},{"Content-Disposition":'form-data; name="edge_password"',body:t}]},function(e,n,t){o(e?e:null,e?null:200!=n.statusCode?n.statusCode:t)})};c.parseURLFromURLObject=function(e,n,t,o){return e.hostname=n+(o?":"+o:""),e.protocol=t,e.format(e)},c.parseMultiPartData=function(e,n,t){var o,r,i,a,s,u,l={},f={};try{if(c.parseMultipartLine(e,l),!(o=l.boundary))throw"";for(r="--"+o,i="--"+o+"--",n=n.split("\r\n"),n.shift();n.length>0;){for(s=0,u={body:""},a=n.shift();n.length>0&&a!=r&&a!=i;)""==a?s++:0==s?c.parseMultipartLine(a,u):u.body+=a,a=n.shift();u.name&&(f[u.name]=u)}}catch(e){if(t)throw e}return f},c.parseMultipartLine=function(e,n){for(var t=e.split(";"),o=0;o<t.length;o++)if(t[o]){var r=t[o].match(/[:=]/);if(r){var i=t[o].substr(0,r.index),c=t[o].substr(r.index+1);n[i.trim().toLowerCase()]=c.trim()}else n[t[o].trim()]=""}},c.loadJSON=i(function(e,n,t){var o=null;try{o=fs.sync.readFile(e,{encoding:"utf8"}),n&&(o=c.parseJSON(o,t))}catch(e){if(o=null,t)throw a.E_LOAD_JSON_FAILED.pre("SpaceifyUtility::loadJSON",e)}return o}),c.saveJSON=i(function(e,n,t){var o=!1;try{var r=JSON.stringify(n,null,2);fs.sync.writeFile(e,r,{encoding:"utf8"}),o=!0}catch(e){if(t)throw a.E_SAVE_JSON_FAILED.pre("SpaceifyUtility::saveJSON",e)}return o}),c.parseJSON=function(e,t){var o;try{o=JSON.parse(e)}catch(e){if(t)throw n?a.E_PARSE_JSON_FAILED.pre("SpaceifyUtility::parseJSON",e):c.makeErrorObject("JSON","Failed to parse JSON.","SpaceifyUtility::parseJSON")}return o},c.replaces=function(e,n){for(var t=n.length-1;t>=0;t--){var o=new RegExp("%"+t,"g");e=e.replace(o,"undefined"==typeof n[t]?"?":n[t])}return e},c.replace=function(e,n,t){var o,r=t?t:"";for(o in n)"undefined"!=typeof n[o]&&(e=e.replace(o,n[o]));return e=e.replace(/\s~[a-zA-Z0-9]*\s/g," "+r+" "),e=e.replace(/~[a-zA-Z0-9]+\s/g," "+r+" "),e=e.replace(/\s~[a-zA-Z0-9]+/g,r),e=e.replace(/~[a-zA-Z0-9]+/g,r)},c.execute=function(e,n,t,o,r){var i=!1,c="",a="",s=spawn(e,n,t);s.stdout.on("data",function(e){o&&o(!1,e),c+=e}),s.stderr.on("data",function(e){o&&o(!0,e),a+=e}),s.on("error",function(e){i||(r(e,null),i=!0)}),s.on("close",function(e){i||(r(null,{code:e,signal:null,stdout:c,stderr:a}),i=!0)}),s.on("exit",function(e,n){i||(r(null,{code:e,signal:n,stdout:c,stderr:a}),i=!0)})},c.ucfirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},c.randomString=function(e,n){var t,o="";o=n?"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789":"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!$#%&/(){}[]<>|=+?*,.;:-_";var r="";for(t=e;t>0;--t)r+=o[Math.round(Math.random()*(o.length-1))];return r},c.generateRandomConnectionId=function(e){for(var n;;)if(n=Math.floor(4294967296*Math.random()),!e.hasOwnProperty(n))break;return n},c.bytesToHexString=function(e){for(var n=[],t=0;t<e.length;t++)n.push((e[t]>>>4).toString(16)),n.push((15&e[t]).toString(16));return n.join("")},c.getLocalDateTime=function(){var e;return e=new Date,e=e.getFullYear()+"-"+("00"+(e.getMonth()+1)).slice(-2)+"-"+("00"+e.getDate()).slice(-2)+" "+("00"+e.getHours()).slice(-2)+":"+("00"+e.getMinutes()).slice(-2)+":"+("00"+e.getSeconds()).slice(-2)},c.isObjectEmpty=function(e){return"object"!=typeof e||0==Object.keys(e).length},c.assoc=function(e,n,t){return n in e?e[n]=[t]:e[key].push(t),e},c.toBuffer=function(e){return e instanceof Buffer?e:e instanceof Array||e instanceof Object?new Buffer(JSON.stringify(e),"utf8"):"string"==typeof e?new Buffer(e,"utf8"):new Buffer(e.toString(),"utf8")},c.getApplicationIcon=function(e,n){var t=null;if(e&&e.images)for(var o=0;o<e.images.length;o++)if(e.images[o].file.search(!0)){t=(n?"/":"")+"images/"+("directory"in e.images[o]?e.images[o].directory+"/":"")+e.images[o].file;break}return t}}function Spacelet(){var e=this,n=new SpaceifyCore,t=new SpaceifyService,o=new SpaceifyNetwork;e.start=function(e,o,r){try{n.startSpacelet(o,function(n,o){if(n)"function"==typeof e?e(n,!1):e&&e.fail&&e.fail(n);else for(var r=0;r<o.serviceNames.length;r++)t.connect(o.serviceNames[r],r+1!=o.serviceNames.length?null:function(n,t){"function"==typeof e?e(null,!0):e&&e.start&&e.start()})})}catch(n){"function"==typeof e?e(n,!1):e&&e.fail&&e.fail(n)}},e.getRequiredService=function(e){return t.getRequiredService(e)},e.getRequiredServiceSecure=function(e){return t.getRequiredServiceSecure(e)},e.isSpaceifyNetwork=function(e,n){o.isSpaceifyNetwork(e,n)}}function SpaceifyApplication(){var e="/var/lib/spaceify/code/",n="undefined"==typeof window,t=!(!n||"undefined"==typeof process.env.IS_REAL_SPACEIFY),o=n?require(e+"logger"):window.Logger,r=n?require(e+"webserver"):function(){},i=n?require(e+"spaceifycore"):window.SpaceifyCore,c=n?require(e+"spaceifyconfig"):window.SpaceifyConfig,a=n?require(e+"spaceifyutility"):window.SpaceifyUtility,s=n?require(e+"spaceifyservice"):window.SpaceifyService,u=n?require(e+"fibrous"):function(e){return e},l=this,f=new r,p=new r,d=new c,y=new a,g=new i,h=new s,R=new o("SpaceifyApplication","selogs");d.makeRealApplicationPaths();var S=null,m=null,w=t?80:null,v=t?443:null;l.start=function(){n?C.apply(l,arguments):l.connect.apply(l,arguments)};var C=function(e,n){u.run(function(){var o,r,i,c,a,s=!1,u=!1,l=!0,R=!0;m=e,n=n||{},a=!(!n.webservers&&!n.webServers),a&&(o=n.webservers||n.webServers,s="http"in o&&o.http,u="https"in o&&o.https),(n.websocketservers||n.webSocketServers)&&(o=n.websocketservers||n.webSocketServers,l="secure"in o&&o.secure,R="unsecure"in o&&o.unsecure);try{if(S=y.sync.loadJSON(d.VOLUME_APPLICATION_PATH+d.MANIFEST,!0,!0),S.provides_services)for(var C=S.provides_services,E=0;E<C.length;E++)C.service_type!=d.ALIEN&&(r=t?d.FIRST_SERVICE_PORT+E:null,i=t?d.FIRST_SERVICE_PORT_SECURE+E:null,h.sync.listen(C[E].service_name,S.unique_name,r,i,R,l));if(S.requires_services&&(I.sync(S.requires_services,0,!1),I.sync(S.requires_services,0,!0)),a){var b={hostname:d.ALL_IPV4_LOCAL,key:d.VOLUME_TLS_PATH+d.SERVER_KEY,
crt:d.VOLUME_TLS_PATH+d.SERVER_CRT,caCrt:d.API_WWW_PATH+d.SPACEIFY_CRT,wwwPath:d.VOLUME_APPLICATION_WWW_PATH,indexFile:d.INDEX_FILE,serverName:S.name+" Server"};c=!1,s&&!f.getIsOpen()&&(b.isSecure=!1,b.port=w,b.mappedPort=t?process.env.PORT_80:null,f.setSessionManager(null,d.SESSION_TOKEN_NAME),f.listen.sync(b),w=f.getPort(),c=!0),u&&!p.getIsOpen()&&(b.isSecure=!0,b.port=v,b.mappedPort=t?process.env.PORT_443:null,p.setSessionManager(null,d.SESSION_TOKEN_NAME),p.listen.sync(b),v=p.getPort(),c=!0),c&&!t&&(g.sync.registerService("http",{unique_name:S.unique_name,port:w,securePort:v}),console.log("    LISTEN -----> "+d.HTTP+" - port: "+w+", secure port: "+v))}m&&m.start&&"function"==typeof m.start&&m.start(),console.log(d.APPLICATION_INITIALIZED,"---",S.unique_name)}catch(e){O.sync(e)}},function(e,n){})};l.connect=function(e,n,t){try{m=e,n.constructor!==Array&&(n=[n]),g.getOpenServices(n,!1,function(e,n){if(e)throw e;E(m,n)})}catch(e){"function"==typeof m?m(e,!1):m&&m.fail&&"function"==typeof m.fail&&m.fail(e)}};var E=function(e,n){var t=n.shift();return m=e,"undefined"==typeof t?void("function"==typeof m?m(null,!0):m&&m.start&&"function"==typeof m.start&&m.start()):void h.connect(t.service_name,function(e,t){E(m,n)})},O=u(function(e){R.error([";;",e,"::"],!0,!0,R.ERROR),console.log(S.unique_name+d.APPLICATION_UNINITIALIZED),b.sync(e)}),b=u(function(e){f.close(),p.close(),h.disconnect(),h.close(),g.close(),m&&m.fail&&"function"==typeof m.fail&&m.fail(e)}),I=function(e,n,t,o){n==e.length?o():h.connect(e[n++].service_name,t,function(r,i){I(e,n,t,o)})};l.getOwnUrl=function(e){if(!n)return null;var t=(e?"https://":"http://")+d.EDGE_HOSTNAME+":"+(e?v:w);return t},l.getManifest=function(){return S},l.getRequiredService=function(e){return h.getRequiredService(e)},l.getRequiredServiceSecure=function(e){return h.getRequiredServiceSecure(e)},l.getProvidedService=function(e){return h.getProvidedService(e)},l.getProvidedServiceSecure=function(e){return h.getProvidedServiceSecure(e)}}function SpaceifyError(e){var n="/var/lib/spaceify/code/",t="undefined"==typeof window,o=t?require(n+"spaceifyconfig"):window.SpaceifyConfig,r=this;new o;r.path=e&&e.path?e.path:"",r.code=e&&e.code?e.code:"",r.message=e&&e.message?e.message:"";var i=", ",c=", ",a=" ";r.set=function(e){r.path=e.path||"",r.code=e.code||"",r.message=e.message||""},r.getAsObject=function(){return{code:r.code,codes:[r.code],message:r.message,messages:[r.message],path:r.path,paths:[r.path]}},r.getMessage=function(){return r.message},r.getCode=function(){return r.code},r.getPath=function(){return r.path},r.pre=function(e){r.path=e;var n=Array.prototype.slice.call(arguments);return n[0]=r.getAsObject(),r.make.apply(this,n)},r.preFmt=function(e,n){return r.path=e,r.makeFmt(r.getAsObject(),n)},r.make=function(){var e,n="",t=[],o="",r=[],s="",u=[];for(e=0;e<arguments.length;e++){var l=arguments[e];l.messages?(t=t.concat(l.paths),r=r.concat(l.codes),u=u.concat(l.messages)):(t.push(l.path?l.path:""),r.push(l.code?l.code:""),u.push(l.message?l.message:l.toString()))}for(e=0;e<u.length;e++)r[e]&&(o+=(""!=o?i:"")+r[e]),t[e]&&(n+=(""!=n?c:"")+t[e]),s+=(""!=s?a:"")+u[e];return{code:o,message:s,path:n,codes:r,paths:t,messages:u}},r.makeFmt=function(e,n){return e.message=r.replace(e.message,n),e.messages&&e.messages.length>0&&(e.messages[0]=e.message),r.make(e)},r.makeErrorObject=function(e,n,t){var o="undefined"!=typeof e?e:"",r="undefined"!=typeof t?t:"",i="undefined"!=typeof n?n:"";return{code:o,codes:[o],message:i,messages:[i],path:r,paths:[r]}},r.errorFromObject=function(e){return"string"==typeof e&&(e=JSON.parse(e)),r.make(r.makeErrorObject(e.code,e.message,e.path))},r.typeToErrorObject=function(e){return e?"string"==typeof e?e=r.makeErrorObject("",e,""):e.codes||e.messages||e.paths||(e=r.make(e)):e=r.makeErrorObject("###","###","###"),e},r.errorToString=function(e,n,t){var o="",i="",c="",s="";if("string"==typeof e)o+=e;else if(e.message&&!e.messages)o+=e.message;else if(e.pop)for(;e.length>0;)o+=(""!=o?a:"")+r.errorToString(e.shift());else if(e.messages)for(var u=0;u<e.messages.length;u++)i=t&&e.codes[u]?e.codes[u]:null,c=n&&e.paths[u]?e.paths[u]:null,s=r.ucfirst(e.messages[u]),s=r.endWithDot(s),o+=""!=o?" ":"",o+=c?c:"",o+=i?(c?" - ":"")+i:"",o+=(i||c?" ":"")+s;return o},r.replace=function(e,n,t){var o=t?t:"";for(var r in n)"undefined"!=typeof n[r]&&(e=e.replace(r,n[r]));return e=e.replace(/\s~[a-zA-Z0-9]*\s/g," "+o+" "),e=e.replace(/~[a-zA-Z0-9]*\s/g," "+o+" "),e=e.replace(/\s~[a-zA-Z0-9]*/g,o),e=e.replace(/~[a-zA-Z0-9]+/g,o)},r.ucfirst=function(e){return e=e.trim(),e.charAt(0).toUpperCase()+e.slice(1)},r.endWithDot=function(e){return e=e.trim(),"."!=e.charAt(e.length-1)&&(e+="."),e}}function Service(e,n,t){var o="/var/lib/spaceify/code/",r="undefined"==typeof window,i=r?require(o+"spaceifyconfig"):window.SpaceifyConfig,c=r?require(o+"spaceifyutility"):window.SpaceifyUtility,a=(r?require(o+"fibrous"):function(e){return e},this),s=(new i,new c,null),u=null,l=[],f=[];a.REQUIRED=0,a.PROVIDED=1;var p=function(n){for(var t=0;t<l.length;t++)l[t](n,e,a.getIsSecure())},d=function(n){for(var t=0;t<f.length;t++)f[t](n,e,a.getIsSecure())},y=function(n){s&&s(n,e,a.getIsSecure())},g=function(n){u&&g(n,e,a.getIsSecure())};a.setConnectionListener=function(e){"function"==typeof e&&l.push(e)},a.setDisconnectionListener=function(e){"function"==typeof e&&f.push(e)},a.setServerUpListener=function(e){s="function"==typeof e?e:null},a.setServerDownListener=function(e){u="function"==typeof e?e:null},a.getPort=function(){return t.getPort()},a.getIsOpen=function(){return t.getIsOpen()},a.getServiceName=function(){return e},a.getType=function(){return n?a.PROVIDED:a.REQUIRED},a.getId=function(){return t.getId()},a.getServer=function(){return n?t:null},a.getConnection=function(){return n?null:t},a.getIsSecure=function(){return t.getIsSecure()},a.exposeRpcMethod=function(e,n,o){t.exposeRpcMethod(e,n,o)},a.exposeRpcMethodSync=function(e,n,o){t.exposeRpcMethodSync(e,n,o)},a.callRpc=function(){t.callRpc.apply(this,arguments)},t.setConnectionListener(p),t.setDisconnectionListener(d),n&&(t.setServerUpListener(y),t.setServerDownListener(g))}function SpaceifyUnique(){var e=this;e.getUniqueDirectory=function(e,n){return e=e.toLowerCase(),e=e.replace(/[^a-z0-9\/_]/g,"/"),e=e.replace(/^\/+/,""),e+=e.search(/\/$/)!=-1?"":"/",n&&(e=e.replace(/\/$/,"")),e},e.getSystemctlServiceName=function(e){return e.replace(/_\//g,"")+".service"},e.getBasePath=function(e,n,t){return t.APP_TYPE_PATHS[e]},e.getAppPath=function(n,t,o){return o.APP_TYPE_PATHS[n]+e.getUniqueDirectory(t)+o.VOLUME_DIRECTORY+o.APPLICATION_DIRECTORY},e.getVolPath=function(n,t,o){return o.APP_TYPE_PATHS[n]+e.getUniqueDirectory(t)+o.VOLUME_DIRECTORY},e.getWwwPath=function(n,t,o){return e.getAppPath(n,t,o)+o.WWW_DIRECTORY}}"undefined"!=typeof exports&&(module.exports=Logger),"undefined"!=typeof exports&&(module.exports=BinaryRpcCommunicator),"undefined"!=typeof exports&&(module.exports=CallbackBuffer),"undefined"!=typeof exports&&(module.exports=RpcCommunicator),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate;"undefined"==typeof window&&(module.exports=WebSocketConnection),"undefined"==typeof window&&(module.exports=WebSocketRpcConnection),"undefined"!=typeof exports&&(module.exports=WebSocketServer),"undefined"==typeof window&&(module.exports=WebSocketRpcServer),"undefined"!=typeof exports&&(module.exports=SpaceifySynchronous),"undefined"!=typeof exports&&(module.exports=SpaceifyConfig),"undefined"!=typeof exports&&(module.exports=SpaceifyCore),"undefined"!=typeof exports&&(module.exports=SpaceifyMessages),"undefined"!=typeof exports&&(module.exports=SpaceifyNetwork),"undefined"!=typeof exports&&(module.exports=SpaceifyService),"undefined"!=typeof exports&&(module.exports=SpaceifyUtility),"undefined"!=typeof exports&&(module.exports=new SpaceifyApplication),"undefined"!=typeof exports&&(module.exports=SpaceifyError),"undefined"!=typeof exports&&(module.exports=Service),"undefined"!=typeof exports&&(module.exports=SpaceifyUnique);

window.seconfig={"SPACEIFY_PATH":"/var/lib/spaceify/","SPACEIFY_CODE_PATH":"/var/lib/spaceify/code/","SPACEIFY_DATA_PATH":"/var/lib/spaceify/data/","SPACEIFY_WWW_PATH":"/var/lib/spaceify/code/www/","SPACEIFY_NODE_MODULES_PATH":"/var/lib/spaceify/code/node_modules/","SPACEIFY_WWW_ERRORS_PATH":"/var/lib/spaceify/code/www/errors/","SPACEIFY_TLS_PATH":"/var/lib/spaceify/data/tls/","SPACEIFY_DATABASE_FILE":"/var/lib/spaceify/data/db/spaceify.db","SPACEIFY_TEMP_SESSIONID":"/var/lib/spaceify/data/db/session.id","SPACEIFY_REGISTRATION_FILE":"/var/lib/spaceify/data/db/edge.id","SPACEIFY_REGISTRATION_FILE_TMP":"/tmp/edge.id","SPACEIFY_MANIFEST_RULES_FILE":"/var/lib/spaceify/data/manifest/manifest.rules","SPACELETS_PATH":"/var/lib/spaceify/data/spacelets/","SANDBOXED_PATH":"/var/lib/spaceify/data/sandboxed/","SANDBOXED_DEBIAN_PATH":"/var/lib/spaceify/data/sandboxed_debian/","NATIVE_DEBIAN_PATH":"/var/lib/spaceify/data/native_debian/","APP_TYPE_PATHS":{"spacelet":"/var/lib/spaceify/data/spacelets/","sandboxed":"/var/lib/spaceify/data/sandboxed/","sandboxed_debian":"/var/lib/spaceify/data/sandboxed_debian/","native_debian":"/var/lib/spaceify/data/native_debian/"},"INSTALLED_PATH":"/var/lib/spaceify/data/installed/","DOCS_PATH":"/var/lib/spaceify/data/docs/","VERSION_FILE":"/var/lib/spaceify/versions","WWW_DIRECTORY":"www/","API_PATH":"/api/","API_WWW_PATH":"/var/lib/spaceify/code/www/","API_NODE_MODULES_DIRECTORY":"/var/lib/spaceify/code/node_modules/","APPLICATION_ROOT":"application","APPLICATION_PATH":"/application/","APPLICATION_DIRECTORY":"application/","VOLUME_PATH":"/volume/","VOLUME_DIRECTORY":"volume/","VOLUME_APPLICATION_PATH":"/volume/application/","VOLUME_APPLICATION_WWW_PATH":"/volume/application/www/","VOLUME_TLS_PATH":"/volume/tls/","SYSTEMD_PATH":"/lib/systemd/system/","START_SH_FILE":"application/start.sh","WORK_PATH":"/tmp/package/","PACKAGE_PATH":"package/","SOURCES_DIRECTORY":"sources/","LOCALES_PATH":"/var/lib/spaceify/code/www/locales/","DEFAULT_LOCALE":"en_US","SPACEIFY_INJECT":"/var/lib/spaceify/code/www/lib/inject/spaceify.csv","LEASES_PATH":"/var/lib/spaceify/data/dhcp-data","IPTABLES_PATH":"/var/lib/spaceify/data/ipt-data","IPTABLES_PIPER":"/var/lib/spaceify/data/dev/iptpiper","IPTABLES_PIPEW":"/var/lib/spaceify/data/dev/iptpipew","TLS_DIRECTORY":"tls/","TLS_SCRIPTS_PATH":"/var/lib/spaceify/data/scripts/","UBUNTU_DISTRO_NAME":"ubuntu","RASPBIAN_DISTRO_NAME":"raspbian","UBUNTU_DOCKER_IMAGE":"spaceifyubuntu","RASPBIAN_DOCKER_IMAGE":"spaceifyraspbian","CUSTOM_DOCKER_IMAGE":"custom_","EDGE_IP":"10.0.0.1","EDGE_HOSTNAME":"edge.spaceify.net","EDGE_SHORT_HOSTNAME":"e.n","EDGE_SUBNET":"10.0.0.0/16","ALL_IPV4_LOCAL":"0.0.0.0","CONNECTION_HOSTNAME":"localhost","APPLICATION_SUBNET":"172.17.0.0/16","EDGE_PORT_HTTP":80,"EDGE_PORT_HTTPS":443,"CORE_PORT":2947,"CORE_PORT_SECURE":4947,"APPMAN_PORT":2948,"APPMAN_PORT_SECURE":4948,"APPMAN_MESSAGE_PORT":2950,"APPMAN_MESSAGE_PORT_SECURE":4950,"OPERATION":"templates/operation.html","ADMIN_LOGIN_PATH":{"file":"/var/lib/spaceify/code/www/appstore/login.html","content_type":"html"},"APPSTORE":"appstore/","APPSTORE_INDEX_FILE":"appstore/index.html","APPSTORE_INDEX_PATH":{"file":"/var/lib/spaceify/code/www/appstore/index.html","content_type":"html"},"REGISTRY_HOSTNAME":"spaceify.org","REGISTRY_URL":"https://spaceify.org","REGISTRY_PUBLISH_URL":"https://spaceify.org/ajax/upload.php?type=package&fileid=package","REGISTRY_INSTALL_URL":"https://spaceify.org/install.php","EDGE_APPSTORE_GET_PACKAGES_URL":"https://spaceify.org/appstore/getpackages.php","EDGE_REGISTER_URL":"https://spaceify.net/edge/register.php","EDGE_LOGIN_URL":"https://spaceify.net/edge/login.php","EDGE_GET_RESOURCE_URL":"spaceify.org/appstore/getresource.php?resource=","ERROR_PATHS":{"302":{"file":"/var/lib/spaceify/code/www/errors/302.html","content_type":"html"},"404":{"file":"/var/lib/spaceify/code/www/errors/404.html","content_type":"html"},"500":{"file":"/var/lib/spaceify/code/www/errors/500.html","content_type":"html"},"501":{"file":"/var/lib/spaceify/code/www/errors/501.html","content_type":"html"}},"GITHUB_HOSTNAME":"github.com","MAC_REGX":"^([0-9A-F]{2}[:-]){5}([0-9A-F]{2})$","IP_REGX":"^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$","JAVASCRIPT":"javascript","CSS":"css","FILE":"file","INJECT_TYPES":["javascript","css","file"],"UTF8":"utf","ASCII":"ascii","BASE64":"base64","ANY":"any","ALL":"all","SPACELET":"spacelet","SANDBOXED":"sandboxed","SANDBOXED_DEBIAN":"sandboxed_debian","NATIVE_DEBIAN":"native_debian","APP_TYPES":["spacelet","sandboxed","sandboxed_debian","native_debian"],"OPEN":"open","OPEN_LOCAL":"open_local","STANDARD":"standard","ALIEN":"alien","HTTP":"http","SERVICE_TYPES":["standard","open_local","open","alien","http"],"EXT_COMPRESSED":".zip","PACKAGE_DELIMITER":"@","PX":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","MANIFEST":"spaceify.manifest","README_MD":"readme.md","PACKAGE_ZIP":"package.zip","PUBLISH_ZIP":"publish.zip","SPM_ERRORS_JSON":"spm_errors.json","SPM_HELP":"spm.help","DOCKERFILE":"Dockerfile","MANIFEST_RULES":"manifest.rules","VERSIONS":"versions","INDEX_FILE":"index.html","SERVER_NAME":"Spaceify Web Server","TILEFILE":"tile.html","WEB_SERVER":"WEB_SERVER","APPLICATION_INITIALIZED":"*** application initialized","APPLICATION_UNINITIALIZED":"*** application uninitialized","IMAGE_DIRECTORY":"www/images/","IMAGE_TYPES":["image/jpg","image/gif","image/png"],"FIRST_SERVICE_PORT":2777,"FIRST_SERVICE_PORT_SECURE":3777,"SERVER_CRT":"server.crt","SERVER_KEY":"server.key","SPACEIFY_CRT":"spaceify.crt","SPACEIFY_CRT_WWW":"www/spaceify.crt","RECONNECT_WAIT":10000,"APPLICATION_CATEGORIES":["audio","astronomy","business","chemistry","children","computer_programming","communication","computer-aided_manufacturing","data_management","economy","editing","educational","entertainment","fysics","lifestyle","games","genealogy","government","graphics","health","home","industrial","knowledge_representation","language","legal","library_and_information_science","magazines","mathematics","meteorology","multimedia","music","navigation","news","personal_information_managers","productivity","religious","science","simulation","social","sport","theatre","transport","video","weather","word_processors","workflow"],"SESSION_COOKIE_PUBSUB_PATH":"/var/lib/spaceify/data/db/session_cookies.pub","SPACEIFY_REPOSITORY":"deb [ arch=all,amd64,i386 ] http://spaceify.net/repo stable/spaceify main","SPACEIFY_APPLICATION_REPOSITORY_LIST":"/etc/apt/sources.list.d/spaceifyapplication.list","EVENT_SPACELET_INSTALLED":"spaceletInstalled","EVENT_SPACELET_REMOVED":"spaceletRemoved","EVENT_SPACELET_STARTED":"spaceletStarted","EVENT_SPACELET_STOPPED":"spaceletStopped","EVENT_SANDBOXED_INSTALLED":"sandboxedInstalled","EVENT_SANDBOXED_REMOVED":"sandboxedRemoved","EVENT_SANDBOXED_STARTED":"sandboxedStarted","EVENT_SANDBOXED_STOPPED":"sandboxedStopped","EVENT_SANDBOXED_DEBIAN_INSTALLED":"sandboxedDebianInstalled","EVENT_SANDBOXED_DEBIAN_REMOVED":"sandboxedDebianRemoved","EVENT_SANDBOXED_DEBIAN_STARTED":"sandboxedDebianStarted","EVENT_SANDBOXED_DEBIAN_STOPPED":"sandboxedDebianStopped","EVENT_NATIVE_DEBIAN_INSTALLED":"nativeDebianInstalled","EVENT_NATIVE_DEBIAN_REMOVED":"nativeDebianRemoved","EVENT_NATIVE_DEBIAN_STARTED":"nativeDebianStarted","EVENT_NATIVE_DEBIAN_STOPPED":"nativeDebianStopped","EVENT_EDGE_SETTINGS_CHANGED":"EdgeSettingsChanged","EVENT_CORE_SETTINGS_CHANGED":"CoreSettingsChanged","SESSION_TOKEN_NAME":"x-edge-session","SESSION_TOKEN_NAME_COOKIE":"xedgesession"};

window.selogs={"global":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Application":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"ApplicationManager":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"AppManService":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"BinaryRpcCommunicator":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Core":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Database":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"DHCPDLog":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"DockerContainer":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"DockerHelper":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"DockerImage":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"EdgeSpaceifyNet":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"HttpService":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Iptables":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Main":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Manager":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Messaging":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"PubSub":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"RpcCommunicator":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SecurityModel":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Service":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyApplication":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyApplicationManager":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyConfig":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyCore":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyError":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyMessages":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyNet":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyNetwork":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyService":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SpaceifyUtility":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"Spacelet":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"SPM":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":true},"ValidateApplication":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebOperation":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebRtcClient":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebRtcConnection":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebServer":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebSocketConnection":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebSocketRpcConnection":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebSocketRpcServer":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false},"WebSocketServer":{"log":false,"dir":false,"info":false,"error":false,"warn":false,"all":false}};

