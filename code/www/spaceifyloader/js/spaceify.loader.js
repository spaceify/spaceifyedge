function HttpParser(){var e=this,n=null,o=null,t=new Object,c=null;e.getStatusCode=function(){return parseInt(c)},e.getContentBegin=function(){return n},e.getHeaderValueAsInt=function(e){if(e=e.toLowerCase(),t.hasOwnProperty(e))return parseInt(t[e])},e.getHeaderValue=function(e){if(e=e.toLowerCase(),t.hasOwnProperty(e))return t[e]};var i=function(e){for(var o=0;o<e.byteLength;o+=1)if(o+4<e.byteLength&&13==e[o]&&10==e[o+1]&&13==e[o+2]&&10==e[o+3]){n=o+4,console.log(e[n]);break}},l=function(e){t={},o=n?String.fromCharCode.apply(null,e.subarray(0,n)):String.fromCharCode.apply(null,e),console.log("Trying to parse header: "+o);var i=o.split("\n"),l=i[0].split(" ");c=l[1];for(var r=1;r<i.length;r++){var s=i[r].indexOf(":");if(s>-1){var a=i[r].substring(0,s);a=a.toLowerCase();var d="";i[r].length>s&&(d=i[r].substring(s+1).trim()),t[a]=a in t?t[a]+", "+d:d}}console.dir(t)};e.parse=function(e){i(e),l(e)}}function PiperClient(){var e=this,n=new Object,o=new Object,t=null,c=null,i=new sp.CommunicationClient,l=null,r=null;e.setCookies=function(e){r=e},e.getCookies=function(){return r},e.sendTcpBinary=function(e,n){i.sendBinaryToClient(e,n)},e.createTcpPipe=function(o,t,l,r){var s=o+t;for(var a in n)if(n[a].hostnameAndPort==s)return n[a].listener=l,void r(a);i.createPipe(c,function(c){console.log("pipe ready for TCP"),i.callClientRpc(c,"pipeTcp",[o,t],e,function(){console.log("Tcp Pipe ready to "+o+":"+t),n[c]={listener:l,hostnameAndPort:s},r(c)})})},e.exposeRpcMethod=function(e,n,o){i.exposeRpcMethod(e,n,o)},e.callClientRpc=function(e,n,o,t,c){i.callClientRpc(e,n,o,t,c)},e.createWebSocketPipe=function(n,t,l){i.createPipe(c,function(c){console.log("pipe ready for Websocket"),i.callClientRpc(c,"pipeWebSocket",[n],e,function(){console.log("Websocket Pipe ready to "+n.host+":"+n.port),o[c]=t,l(c)})})},e.setBinaryListener=function(e){l=e},e.onBinary=function(e,o,t){console.log("PiperClient::onBinary() from: "+o),n.hasOwnProperty(t)&&n[t].listener(e)},e.onClientDisconnected=function(e){},e.onClientConnected=function(e){e&&(console.log("PieperClient::onClientConnected() "+JSON.stringify(e)),"piper"==e.getClientType()&&(console.log("piper found, trying to build a pipe to it"),i.createPipe(e.getClientId(),function(){console.log("pipe ready"),c=e.getClientId(),t&&t()})))},e.sendBinary=function(e){i.sendBinaryToClient(c,e)},e.connect=function(n,o,c){t=c,i.setClientListener(e),i.setBinaryListener(e),i.connectWithOptions({host:n,port:o,isSsl:!0},"screen","jounigroupx",function(){console.log("Hub Connection succeeded")})}}function SpXMLHttpRequest(){var e=this,n=null,o=null,t=null,c=null,i=null,l=null,r=null,s=new Array,a=new HttpParser;e.UNSENT=0,e.OPENED=1,e.HEADERS_RECEIVED=2,e.LOADING=3,e.DONE=4,e.responseText="";var d=[];e.open=function(e,c,i){o=e,n=c,t=i},e.onBinary=function(o){var t=new Uint8Array(o);if(c)s.push(t),i+=t.byteLength;else{if(a.parse(t),console.log("SpXMLHttpRequest::onBinary() HTTP server replied with statusCode "+a.getStatusCode()),301==a.getStatusCode()||302==a.getStatusCode())return n=a.getHeaderValue("Location"),console.log("SpXMLHttpRequest::onBinary() redirecting to : "+n),void e.send();if(c=a.getHeaderValueAsInt("Content-Length"),l=a.getHeaderValue("Content-Type"),c){var d=t.subarray(a.getContentBegin());s.push(d),i=s[0].byteLength}}if(console.log(i+" / "+c+" bytes of "+n+" received"),c&&c==i){r?e.response=new Blob(s,{type:r}):e.response=new Blob(s,{type:l});for(var u=0;u<s.length;u++)s[u]&&(e.responseText+=ab2str(s[u]));e.readyState=4,e.status=200,e.onreadystatechange()}},e.overrideMimeType=function(e){r=e},e.send=function(t){var c="localhost",i="localhost",l="80";if(n.indexOf("//")!=-1){var r=new URL(n);"10.0.0.1"==r.hostname&&(r.hostname="localhost"),c=r.host,r.hostname&&(i=r.hostname),r.port&&(l=r.port),n=r.toString()}else"/"!=n.charAt(0)&&(n="/"+n);var s=o+" "+n+" HTTP/1.1\r\nHost: "+c,a=getSession("sessionCookies");a&&(s=s+"\r\nCookie: "+a);for(var u=0;u<d.length;u++)s+="\r\n"+d[u].header+": "+d[u].value;d=[],t&&(s+="\r\nContent-Length: "+t.length+"\r\n",s+=t),s+="\r\n\r\n";var f=toab(s);console.log("SpXMLHttpRequest::send() making request: "+s),piperClient.createTcpPipe(i,l,e.onBinary,function(e){piperClient.sendTcpBinary(e,f)})},e.setRequestHeader=function(e,n){d.push({header:e,value:n})},e.getResponseHeader=function(e){return a.getHeaderValue(e)}}function Utf8ArrayToStr(e){var n,o,t,c,i,l;for(n="",t=e.length||e.byteLength,o=0;o<t;)switch(c=e[o++],c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n+=String.fromCharCode(c);break;case 12:case 13:i=e[o++],n+=String.fromCharCode((31&c)<<6|63&i);break;case 14:i=e[o++],l=e[o++],n+=String.fromCharCode((15&c)<<12|(63&i)<<6|(63&l)<<0)}return n}function ab2str(e){return Utf8ArrayToStr(e)}function str2ab(e){for(var n=new ArrayBuffer(2*e.length),o=new Uint16Array(n),t=0,c=e.length;t<c;t++)o[t]=e.charCodeAt(t);return n}function toab(e){for(var n=new ArrayBuffer(e.length),o=new Uint8Array(n),t=0,c=e.length;t<c;t++)o[t]=e.charCodeAt(t);return n}function SpaceifyLoader(){var e=this,n=null,o=null,t=!1,c=null,i=null,l=0;e.loadData=function(e,t){var c,i,l,r,s=new SpXMLHttpRequest;return e.getAttribute("sp_src")?(c="sp_src",l="src"):e.getAttribute("spe_src")?(c="spe_src",l="src"):e.getAttribute("sp_href")?(c="sp_href",l="href"):e.getAttribute("spe_href")&&(c="spe_href",l="href"),r=e.getAttribute(c),i="spe_src"==c||"spe_href"==c?o:n,r.indexOf("//")==-1&&i&&(r=new URL(r,i).toString()),r?(s.onreadystatechange=function(){if(4==s.readyState){var n=s.response;e.onload=function(n){window.URL.revokeObjectURL(e[l])},e[l]=window.URL.createObjectURL(n),e.removeAttribute(c),t()}},s.open("GET",r,!0),s.responseType="blob",void s.send()):void t()},e.postData=function(e,n,o,t){var c="X-Edge-Session",i=new SpXMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState)if(setSession("sessionCookies",i.getResponseHeader("Set-Cookie")),setSession(c,i.getResponseHeader(c)),200!=i.status)t(i.status,null);else if(i.response instanceof Blob){var e=new FileReader;e.onload=function(n){t(null,e.result)},e.readAsText(i.response.data,"UTF-8")}else t(null,JSON.stringify(i.response))};for(var l="---------------------------"+Date.now().toString(16),r="",s=0;s<n.length;s++)r+="\r\n--"+l+"\r\n",r+=n[s].content,r+="\r\n\r\n"+n[s].data+"\r\n";r+="\r\n--"+l+"--",i.withCredentials=!0,i.open("POST",e,!0),i.setRequestHeader(c,getSession(c)),i.responseType=o?o:"text",i.setRequestHeader("Content-Type","multipart/form-data; boundary="+l),i.send(r)},e.loadPage=function(e,n,o){var t="X-Edge-Session",c=new SpXMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState){setSession("sessionCookies",c.getResponseHeader("Set-Cookie")),setSession(t,c.getResponseHeader(t));var e=document.open("text/html","replace");e.write(c.responseText),e.close(),e.loadPageSpHost=n,e.loadPageSpeHost=o}},c.withCredentials=!0,c.open("GET",e,!0),c.setRequestHeader(t,getSession(t)),c.send(null)},e.getAllElements=function(){var e=Array.prototype.slice.call(document.querySelectorAll("[sp_src]")),n=Array.prototype.slice.call(document.querySelectorAll("[spe_src]")),o=Array.prototype.slice.call(document.querySelectorAll("[sp_href]")),t=Array.prototype.slice.call(document.querySelectorAll("[spe_href]"));i=t.concat(o,n,e),console.log("SpaceifyLoader::loadAll() :: Number of elements with sp_src:",e.length,"spe_src:",n.length,"sp_href:",o.length,"spe_href:",t.length)},e.loadAllElements=function(){l=0,r()},e.hasElements=function(){return!!(i&&i.length>0)};var r=function(){l<i.length&&e.loadData(i[l],function(){l++,r()})};e.parseQuery=function(e){var n,o,t,c={};e=decodeURIComponent(e),n=e.split("?"),n=n.length<2?n[0]:n[1],t=n.split("&");for(var i=0,l=t.length;i<l;i++)t[i]&&(o=t[i].split("="),c[o[0]]=2==o.length?o[1]:null);return c},e.setSpHosts=function(e,t){n=e,o=t},e.connect=function(e,n,o){piperClient.connect(e,n,function(){c&&c(),o()})},e.setConnectionListener=function(e){c=e,t&&e()}}function getNetworkInfo(e){window.isSpaceifyNetwork=!1;var n=new XMLHttpRequest;n.open("HEAD",window.location.protocol+"//10.0.0.1/templates/test.txt",!0),n.timeout=1e3,n.onreadystatechange=function(){4==n.readyState&&(window.isSpaceifyNetwork=n.status>=200&&n.status<304,e())},n.send()}function prepareLoader(e,n){spaceifyLoader.setSpHosts(e,n),window.isSpaceifyNetwork?SpXMLHttpRequest=window.XMLHttpRequest:(window.isSpaceifyNetwork=!1,spaceifyLoader.connect(SERVER_ADDRESS.host,SERVER_ADDRESS.port,function(){}))}function loadPageOrElements(e){spaceifyLoader.getAllElements(),spaceifyLoader.hasElements()?spaceifyLoader.loadAllElements():spaceifyLoader.loadPage(e.sp_host+e.sp_path,e.sp_host,e.spe_host)}!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("window.WebSocket")):"function"==typeof define&&define.amd?define(["window.WebSocket"],n):"object"==typeof exports?exports.sp=n(require("window.WebSocket")):e.sp=n(e["window.WebSocket"])}(this,function(e){return function(e){function n(t){if(o[t])return o[t].exports;var c=o[t]={exports:{},id:t,loaded:!1};return e[t].call(c.exports,c,c.exports,n),c.loaded=!0,c.exports}var o={};return n.m=e,n.c=o,n.p="",n(0)}([function(e,n,o){e.exports={Client:o(1),WebRtcEndpoint:o(2),WebRtcConnector:o(8),CommunicationClient:o(3),GameClient:o(10),RpcCommunicator:o(4),WebRtcConnection:o(9),WebSocketRpcConnection:o(11),CallBackbuffer:o(5),WebrtcClient:o(12),WebSocketConnection:o(6)}},function(e,n,o){function t(e,n,o){var t=this,c=e,i=n,l=!1,r=!1,s=null,a=new Array;t.isArrivedBeforeUs=function(){return o},t.setClientId=function(e){c=e},t.setClientType=function(e){i=e},t.setWebRtc=function(e){l=e},t.setPreferredConnectionId=function(e){s=e},t.getClientId=function(){return c},t.getClientType=function(){return i},t.isWebRtc=function(){return l},t.getPreferredConnectionId=function(){return s},t.isLocalHub=function(){return r},t.setLocalHub=function(e){r=e},t.addPipeId=function(e){a.push(e)},t.getBinaryConnectionId=function(){return pipeId},t.getConnectionType=function(){return l?"WebRtc":r?"Local Hub":"Cloud"}}e.exports=t},function(e,n,o){(function(n){function t(){var e=this,t=null,c=null,i=null,l=null;t=n.RTCPeerConnection,c=n.RTCSessionDescription,i=n.RTCIceCandidate,l=o(3);var r=null,s=new l;s.setClientListener(e),s.setConnectionTypeListener(e),s.setBinaryListener(e);var a=null,d=null,u=null;e.connect=function(e,n,o,t,c){s.connect(e,n,o,t,function(e){r=e,c()})},e.notifyClients=function(e,n,o){console.log("WebRtcEndpoint::notifyClients()");var t=s.getClientsByType(e);for(var c in t)s.notifyClient(c,n,o)},e.notifyClient=function(e,n,o){s.notifyClient(e,n,o)},e.callClientRpc=function(e,n,o,t,c){s.callClientRpc(e,n,o,t,c)},e.exposeRpcMethod=function(e,n,o){s.exposeRpcMethod(e,n,o)},e.getBufferedAmount=function(e){return s.getBufferedAmount(e)},e.sendBinary=function(e,n){s.sendBinaryToClient(e,n)},e.onClientConnected=function(e,n,o){console.log("WebRtcEndpoint::onClientConnected() "+e.getClientId()+" "+e.getClientType()),"undefined"!=typeof t&&e.isArrivedBeforeUs()&&s.upgradeConnectionToWebRtc(e.getClientId())},e.onClientDisconnected=function(e,n,o){console.log("WebRtcEndpoint::onClientDisconnected() '"+e.getClientId()+"'"),d&&d.listener.call(d.object,e.getClientId())},e.onConnectionTypeUpdated=function(e,n){console.log("WebRtcEndpoint::onConnectionTypeUpdated() clientType: "+e.getClientType()),null!=a&&"WebRtc"==n&&a.listener.call(a.object,e.getClientId())},e.onBinary=function(e,n){console.log("WebRtcEndpoint::onBinary() from clientId: "+n),null!=u&&u.listener.call(u.object,e,n)},e.setClientConnectionListener=function(e,n){a={object:e,listener:n}},e.setClientDisconnectionListener=function(e,n){d={object:e,listener:n}},e.setBinaryListener=function(e,n){u={object:e,listener:n}}}e.exports=t}).call(n,function(){return this}())},function(e,n,o){function t(){var e=this,n=null,t=null,c=null,i=null;n=o(4),t=o(6),c=o(1),i=o(8);var l=null,r=null,s=null,a=new Object,d=null,u=null,f=null,p=null,g=null,C=new n,h=new t,y=new Object,R=new Object,m=new Object,w=(new n,null);e.addRtcConnection=function(e){console.log("CommunicationClient::addRtcConnection()"),C.addConnection(e),y.hasOwnProperty(e.getId())&&y[e.getId()].setWebRtc(!0),f&&f.onConnectionTypeUpdated(y[e.getId()],y[e.getId()].getConnectionType())},e.onRtcDisconnected=function(e){console.log("CommunicationClient::onRtcDisconnected()"),C.onDisconnected(e)},e.getConnectionType=function(e){return y[e].getConnectionType()},e.onBinary=function(e,n){console.log("CommunicationClient::onBinary(), bytelength: "+e.byteLength),p&&(m.hasOwnProperty(n)?p.onBinary(e,m[n],n):p.onBinary(e,n))},e.upgradeConnectionToWebRtc=function(e){console.log("CommunicationClient::upgradeConnectionToWebRtc() + peerId: "+e),y[e].isWebRtc()||w.connectToPeer(e)},e.createPipe=function(n,o){console.log("CommunicationClient::createPipe() + peerId: "+n);var c,i=new t;i.connect(l,function(){console.log("Pipe connected to the websocket server"),c=C.addConnection(i),C.callRpc("constructPipe",[n,d],e,function(){console.log("CommunicationClient::createPipe() pipe construction ready"),y.hasOwnProperty(n)&&(y[n].addPipeId(c),m[c]=n),o(c)},c)})},e.requestPipe=function(n,o,c,i){console.log("CommunicationClient::requestPipe()");var r=new t,s=null;r.connect(l,function(){console.log("Pipe connected to the websocket server"),s=C.addConnection(r),C.callRpc("registerAsPipe",[n],e,function(e,n){console.log("registerAsPipe returned"),y.hasOwnProperty(o)&&(y[o].addPipeId(s),m[s]=o),i(null,"Ok")},s)})},e.pipeToExternalConnection=function(e,n){var o=C.addConnection(n);C.setupPipe(e,o)},e.setClientListener=function(e){u=e},e.setConnectionTypeListener=function(e){f=e},e.setBinaryListener=function(e){p=e};var b=function(e,n,o){var t=null;return y.hasOwnProperty(e)?t=y[e]:(t=new c(e,n,o),y[e]=t),R.hasOwnProperty(n)||(R[n]=new Object),R[n][e]=t,t},v=function(e){delete R[y[e].getClientType()][e],delete y[e]},S=function(n,o){console.log("CommunicationClient::updateConnectedClients()");var t=g;n&&(t=n),C.callRpc("getConnectedClients",[s],e,function(e,c){console.log("CommunicationClient::getConnectedClientsFromHub() got answer from hub: "+JSON.stringify(c));var i=null;for(var l in c)y.hasOwnProperty(l)?n&&(y[l].setLocalHub(!0),y[l].setPreferredConnectionId(t)):(i=null==n?b(c[l].clientId,c[l].clientType,!0):b(c[l].clientId,c[l].clientType,!1),!n&&u&&i.getClientId()!=d&&u.onClientConnected(i));o()},t)},I=function(n,o){if(console.log("CommunicationCLient::connectToLocalHubs()"),null!=n){var c=null,i=null,l=null;for(var u in n){c=n[u].port;for(var f=0;f<n[u].localIps.length;f++){i=n[u].localIps[f];var p={host:i,port:c,id:d},g=null;l=new t,l.connect(p,function(){console.log("Connected to local hub at ip: "+i+" port: "+c),g=C.addConnection(l),a[g]=g,S(g,function(){C.callRpc("registerAsClient",[d,r,s],e,function(e,n){console.log("CommunicationClient::connectToLocalHubs() registered as client at local hub at ip: "+i+" port: "+c)})})})}}o()}},T=function(n){console.log("Getting list of local hubs from the server"),C.callRpc("getLocalHubs",[],e,function(e,o){console.log("Following local hubs are available: "+JSON.stringify(o)),o?I(o,n):n()},g)};e.sendBinaryToClient=function(e,n){console.log("CommunicationClient::sendBinaryToClient() clientId: "+e),C.sendBinary(n,e)},e.notifyClient=function(e,n,o){console.log("CommunicationClient::notifyClient() clientId: "+e+" method: "+n),y.hasOwnProperty(e)?y[e].isWebRtc()?(console.log("Notifying client through WebRtc"),o.push(d),C.callRpc(n,o,null,null,e)):y[e].isLocalHub()?(console.log("Notifying client through local hub"),C.callRpc("callClientRpc",[e,n,o],null,null,y[e].getPreferredConnectionId())):(console.log("Notifying client through the server"),C.callRpc("callClientRpc",[e,n,o],null,null,g)):(console.log("Making a RPC notification over pipe"),o.push(d),C.callRpc(n,o,null,null,e))},e.callClientRpc=function(e,n,o,t,c){console.log("CommunicationClient::callClientRpc() clientId: "+e+" method: "+n),y.hasOwnProperty(e)?y[e].isWebRtc()?(console.log("Calling client RPC through WebRtc"),o.push(d),C.callRpc(n,o,t,c,e)):y[e].isLocalHub()?(console.log("Calling client RPC through local hub"),C.callRpc("callClientRpc",[e,n,o],t,c,y[e].getPreferredConnectionId())):(console.log("Notifying client RPC through the server"),C.callRpc("callClientRpc",[e,n,o],t,c,g)):(console.log("Making a RPC call over pipe"),o.push(d),C.callRpc(n,o,t,c,e))},e.exposeRpcMethod=function(e,n,o){C.exposeRpcMethod(e,n,o)},e.getBufferedAmount=function(e){return y[e].isWebRtc()?C.getConnection(e).getBufferedAmount():0},e.getClientsByType=function(e){return R[e]},e.connectWithOptions=function(n,o,t,c){r=o,s=t,C.setBinaryListener(e),n.hasOwnProperty("id")||(n.id=null),l=n,h.connect(l,function(){console.log("connected to the websocket server"),g=C.addConnection(h),w=new i(C,g,WEBRTC_CONFIG),w.setConnectionListener(e),C.callRpc("registerAsClient",[null,r,s],e,function(e,n){console.log("Server replied to registerAsClient call: '"+n+"'"),d=n,S(null,function(){T(function(){c(n)})})},g)})},e.connect=function(n,o,t,c,i){return l={host:n,port:o,id:null},e.connectWithOptions(l,t,c,i)},e.onClientConnected=function(e,n,o){if(console.log("CommunicationClient::onClientConnected() from connectionId: "+n),console.log("CommunicationClient::onClientConnected() localHubs was:"),console.dir(a),console.log("CommunicationClient::onClientConnected() '"+JSON.stringify(e)+"'"),a.hasOwnProperty(n)){if(e.clientId==d)return;return console.log("CommunicationClient::onClientConnected() client connected through localhub, clientId: "+e.clientId),y[e.clientId].setLocalHub(!0),void y[e.clientId].setPreferredConnectionId(n)}if(!y.hasOwnProperty(e.clientId)){var t=b(e.clientId,e.clientType,!1);u&&t.getClientId()!=d&&u.onClientConnected(t)}},e.onClientDisconnected=function(e,n,o){console.log("CommunicationClient::onClientDisconnected() '"+JSON.stringify(e)+"'"),y.hasOwnProperty(e.clientId)&&u&&e.clientId!=d&&(u.onClientDisconnected(y[e.clientId]),v(e.clientId))},e.onHubConnected=function(e,n,o){console.log("CommunicationClient::onHubConnected() '"+JSON.stringify(e)+"'")},e.onHubDisconnected=function(e,n,o){console.log("CommunicationClient::onHubDisconnected() '"+JSON.stringify(e)+"'")},C.exposeRpcMethod("onClientConnected",e,e.onClientConnected),C.exposeRpcMethod("onClientDisconnected",e,e.onClientDisconnected),C.exposeRpcMethod("onHubConnected",e,e.onHubConnected),C.exposeRpcMethod("onHubDisconnected",e,e.onHubDisconnected),C.exposeRpcMethod("requestPipe",e,e.requestPipe)}e.exports=t},function(e,n,o){function t(){var e=this,n=null;n=o(5);var t=1,c=new Object,i=null,l=null,r=null,s=new n,a=new Object,d=0,u=null;e.exposeRpcMethod=function(e,n,o){try{c[e]={object:n,method:o}}catch(e){console.log(e)}},e.setConnectionListener=function(e,n){i={object:e,listener:n}},e.setDisconnectionListener=function(e,n){l={object:e,listener:n}},e.setBinaryListener=function(e){r=e},e.connectionExists=function(e){return!("undefined"==typeof e||!a.hasOwnProperty(e))||!("undefined"!=typeof e||!a.hasOwnProperty(u))},e.getConnection=function(e){return a[e]},e.callRpc=function(n,o,c,i,l){if(e.connectionExists(l))try{"function"==typeof i?(s.pushBack(t,c,i),console.log("RpcCommunicator::callRpc() pushed back callback"),"undefined"!=typeof l?f({jsonrpc:"2.0",method:n,params:o,id:""+t},l):f({jsonrpc:"2.0",method:n,params:o,id:""+t},u),console.log("RpcCommunicator::callRpc() sendMessage returned"),t++):"undefined"!=typeof l?f({jsonrpc:"2.0",method:n,params:o},l):f({jsonrpc:"2.0",method:n,params:o},u)}catch(e){console.log(e)}},e.notifyAll=function(e,n){try{for(var o in a)console.log("RpcCommunicator::notifyAll() sending message to "+o),f({jsonrpc:"2.0",method:e,params:n,id:null},o);console.log("RpcCommunicator::notifyAll() sending messages completed")}catch(e){console.log(e)}},e.getBufferedAmount=function(e){return a[e].getBufferedAmount()},e.sendBinary=function(e,n){try{a[n].sendBinary(e)}catch(e){console.log(e)}};var f=function(e,n){try{a[n].send(JSON.stringify(e))}catch(e){console.log(e)}};e.sendMessage=f;var p=function(e,n,o,t){try{if(e){f({jsonrpc:"2.0",error:e,id:o});var c="undefined"!=typeof e.code?e.code:"",i="undefined"!=typeof e.path?e.path:"",l="undefined"!=typeof e.message?e.message:"";console.log("Exception in executing a RPC method: "+c+" EngineIoCommunicator::onMessage() >> "+i+" "+l)}else f({jsonrpc:"2.0",result:n,id:o},t)}catch(e){console.log(e)}},g=function(e,n){try{if(!e.jsonrpc||"2.0"!=e.jsonrpc||!e.method)return void f({jsonrpc:"2.0",error:{code:-32600,message:"Invalid JSON-RPC."},id:null},n);if("[object Array]"!==Object.prototype.toString.call(e.params))return void f({jsonrpc:"2.0",error:{code:-32602,message:"Parameters must be sent inside an array."},id:e.id},n);if(!c.hasOwnProperty(e.method))return null!=e.id?void f({jsonrpc:"2.0",error:{code:-32601,message:"Method "+e.method+" not found."},id:e.id},n):void f({jsonrpc:"2.0",error:{code:-32601,message:"Method "+e.method+" not found."},id:null},n);var o=c[e.method];"undefined"==typeof e.params&&(e.params=new Array),null!=e.id?(e.params.push(n),e.params.push(function(o,t){p(o,t,e.id,n)}),o.method.apply(o.object,e.params)):(e.params.push(n),e.params.push(function(e,n){}),o.method.apply(o.object,e.params))}catch(e){console.log(e)}},C=function(e){console.log(e);try{var n=null,o=null;"undefined"!=typeof e.error&&(n=e.error),"undefined"!=typeof e.result&&(o=e.result),e.id?s.callMethodAndPop(e.id,n,o):console.log("RpcCommunicator::handleReturnValue() error: "+JSON.stringify(n))}catch(e){console.log(e)}},h=function(e,n){try{e.method?g(e,n):C(e)}catch(e){console.log(e)}},y=function(){d++;for(var e=d;;)if(e=Math.floor(4294967296*Math.random()),!a.hasOwnProperty(e))break;return e};e.setupPipe=function(e,n){console.log("RpcCommunicator::setupPipe() between: "+e+" and "+n),a.hasOwnProperty(e)&&a.hasOwnProperty(n)&&(a[e].setPipedTo(n),a[n].setPipedTo(e))},e.onMessage=function(e,n){try{var o=n.getPipedTo();if(null!=o)return console.log("RPCCommunicator::onMessage() relaying a piped message"),void a[o].send(e);if(e instanceof ArrayBuffer)return void(r&&r.onBinary(e,n.getId()));var t;try{t=JSON.parse(e)}catch(e){return void f({jsonrpc:"2.0",error:{code:-32700,message:"Invalid JSON."},id:null},n.getId())}h(t,n.getId())}catch(e){console.log(e)}},e.addConnection=function(n){try{return console.log("RpcCommunicator::addConnection, connectionid was "+n.getId()),n.getId()||n.setId(y()),a[n.getId()]=n,n.setListener(e),i&&i.listener.call(i.object,n.getId()),u=n.getId(),n.getId()}catch(e){console.log(e)}},e.onDisconnected=function(n){try{e.closeConnection(n),l&&l.listener.call(l.object,n)}catch(e){console.log(e)}},e.closeConnection=function(e){try{e in a&&(a[e].close(),delete a[e])}catch(e){console.log(e)}}}e.exports=t},function(e,n,o){function t(e){var n=this,o=new Object;n.pushBack=function(e,n,t){o[e]=[n,t]},n.callMethodAndPop=function(e,n,t){if(!o.hasOwnProperty(e))throw{error:"CallbackBuffer::callMethodAndPop(). Callback not found"};o[e][1].call(o[e][0],n,t,e),delete o[e]}}e.exports=t},function(e,n,o){function t(){var e=this,n=null;n=o(7),n="undefined"!=typeof window?window.WebSocket:n.w3cwebsocket;var t=null,c=null,i=null,l=null,r=null,s=null,a=null;e.connect=function(o,c){o.protocol=o.isSsl?"wss":"ws";try{var i=o.protocol+"://"+o.host+":"+o.port+"/json-rpc";o.id&&(i+="?id="+o.id),t=new n(i,"json-rpc"),t.binaryType="arraybuffer",t.onopen=function(){c(null)},t.onmessage=u,t.onclose=function(n,o){f(n,o,e)}}catch(e){console.log(e)}},e.setSocket=function(n){console.log("WebSocketConnection::setSocket()");try{t=n,t.on("message",d),t.on("close",function(n,o){f(n,o,e)})}catch(e){console.log(e)}},e.setId=function(e){c=e},e.setPipedTo=function(e){a=e},e.getPipedTo=function(){return a},e.setRemoteAddress=function(e){i=e},e.setRemotePort=function(e){l=e},e.setOrigin=function(e){r=e},e.setListener=function(e){s=e},e.getId=function(){return c},e.getRemoteAddress=function(){return i},e.getRemotePort=function(){return l},e.getOrigin=function(){return r};var d=function(n){console.log("WebSocketConnection::onMessage() "+JSON.stringify(n));try{s&&("utf8"==n.type&&s.onMessage(n.utf8Data,e),"binary"==n.type&&s.onMessage(n.binaryData,e))}catch(e){console.log(e)}},u=function(n){try{s&&s.onMessage(n.data,e)}catch(e){console.log(e)}},f=function(e,n,o){try{s&&s.onDisconnected(o.getId())}catch(e){console.log(e)}};e.send=function(e){try{t.send(e)}catch(e){console.log(e)}},e.sendBinary=e.send,e.close=function(){try{t.close()}catch(e){console.log(e)}}}e.exports=t},function(n,o){n.exports=e},function(e,n,o){function t(e,n,t){var c=this,i=null;i=o(9);var l=new Object,r=null;c.setConnectionListener=function(e){r=e},c.onIceCandidate=function(o,t){console.log("iceCandidate got, sending it to the other client"),e.callRpc("callClientRpc",[t,"handleIceCandidate",[o]],c,null,n)};var s=function(e){l[e]=new i(t),l[e].setPartnerId(e),l[e].setId(e),l[e].setIceListener(c),l[e].setStreamListener(c),l[e].setConnectionListener(c),l[e].setDataChannelListener(c)};c.shutdown=function(e){console.log("WebRtcConnector::onbeforeunload");for(var n in l)l.hasOwnProperty(n)&&(l[n].close(),delete l[n])},c.handleRtcOffer=function(o,t,i){console.log("WebRtcConnector::handleRtcOffer() descriptor: "+o),l.hasOwnProperty(t)||s(t),l[t].onConnectionOfferReceived(o,t,function(o){console.log("WebRtcConnector::handleRtcOffer() onConnectionOfferReceived returned"),console.log("Trying to call handleRtcAnswer on partner "+t),e.callRpc("callClientRpc",[t,"handleRtcAnswer",[o]],c,null,n),console.log("handleRtcAnswer call done on partner "+t)})},c.handleRtcAnswer=function(e,n,o){console.log("WebRtcConnector::handleRtcAnswer()"),l[n].onConnectionAnswerReceived(e)},c.handleIceCandidate=function(e,n,o){console.log("WebRtcConnector::handleIceCandidate()"),l.hasOwnProperty(n)||s(n),l[n].onIceCandidateReceived(e)},c.onDisconnected=function(e){if(console.log("WebRtcConnector::onDisconnected() "),l.hasOwnProperty(e)){var n=l[e];r.onRtcDisconnected(n.getId()),n.close(),delete l[e]}},c.onDataChannelOpen=function(e){console.log("WebRtcConnecter::onDataChannelOpen() "),r.addRtcConnection(e)},c.onStream=function(e,n){console.log("WebRtcConnector::onStream()")},c.onRemoveStream=function(e,n){console.log("WebRtcConnector::onRemoveStream()"),c.onDisconnected(n)},c.connectToPeer=function(o){return console.log("WebRtcConnector::connectToPeer() partnerId: "+o),l.hasOwnProperty(o)?void console.log("WebRtcConnector::connectToPeer() connection to partnerId: "+o+" already exists or is under construction, not connecting again"):(s(o),void l[o].createConnectionOffer(function(t){console.log("Offer created, sending it to the other client "+o),e.callRpc("callClientRpc",[o,"handleRtcOffer",[t]],c,null,n)}))},"undefined"!=typeof window&&(window.onbeforeunload=c.shutdown),e.exposeRpcMethod("handleRtcOffer",c,c.handleRtcOffer),e.exposeRpcMethod("handleRtcAnswer",c,c.handleRtcAnswer),e.exposeRpcMethod("handleIceCandidate",c,c.handleIceCandidate)}"undefined"!=typeof window&&(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),e.exports=t},function(e,n,o){(function(n){function o(e){var o=null,t=null,c=null;"undefined"==typeof window?(o=n.RTCPeerConnection,t=n.RTCSessionDescription,c=n.RTCIceCandidate):(o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,c=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate);var i=this,l=null,r=null,s=null,a=null,d=null,u=null,f=null,p=null,g={optional:[{DtlsSrtpKeyAgreement:!0}]},C=new o(e,g),h=null;C.ondatachannel=function(e){var n=e.channel||e;console.log("ondatachannel "+e),h=n,h.binaryType="arraybuffer",h.onopen=i.onDataChannelOpen,h.onmessage=i.onMessage};var y=function(e){console.info("signaling state change:",e)},R=function(e){console.info("ice connection state change:",e),!u||"disconnected"!=C.iceConnectionState&&"closed"!=C.iceConnectionState||u.onDisconnected(r)},m=function(e){console.info("ice gathering state change:",e)},w=function(e){console.log("WebRtcConnection::onIceCanditate() partnerId: "+r+" event: "+e),console.log("iceListener oli "+s),null==e.candidate?console.log("All Ice candidates listed"):s.onIceCandidate(e.candidate,r)};C.onsignalingstatechange=y,C.oniceconnectionstatechange=R,C.onicegatheringstatechange=m,C.onicecandidate=w,i.close=function(){console.log("WebRtcConnection::close"),"closed"==C.signalingState&&"closing"==C.signalingState||C.close()},i.send=function(e){try{"open"==h.readyState&&h.send(e)}catch(e){console.log(e)}},i.getBufferedAmount=function(){return h.bufferedAmount},i.sendBinary=function(e){try{"open"==h.readyState&&h.send(e)}catch(e){console.log(e)}},i.onDataChannelClosed=function(e){console.log("WebRtcConnection::onDataChannelClosed "+e),u.onDisconnected(i)},i.onDataChannelOpen=function(e){console.log("WebRtcConnection::onDataChannelOpen "+e),h.binaryType="arraybuffer",h.onclose=i.onDataChannelClosed,h.onmessage=i.onMessage,d&&d.onDataChannelOpen(i)},i.onMessage=function(e){try{p&&p.onMessage(e.data,i)}catch(e){console.log(e)}},i.setId=function(e){l=e},i.getId=function(){return l},i.getPartnerId=function(){return r},i.setPartnerId=function(e){r=e},i.setDataChannelListener=function(e){d=e},i.setListener=function(e){p=e},i.setIceListener=function(e){s=e,console.log("WebRtcConnection::setIceListener()"+e)},i.setStreamListener=function(e){a=e,C.onaddstream=function(e){i.onStream(e)},C.onremovestream=function(e){i.onRemoveStream(e)}},i.setConnectionListener=function(e){u=e},i.onStream=function(e){console.log("WebRtcConnection::onStream"+e),a.onStream(e.stream,r)},i.onRemoveStream=function(e){console.log("WebRtcConnection::onStream"+e),a.onRemoveStream(e.stream,r)},i.addStream=function(e){f=e,C.addStream(e)},i.createConnectionOffer=function(e){var n=null;h=C.createDataChannel("jsonrpcchannel",{reliable:!0}),h.binaryType="arraybuffer",h.onopen=i.onDataChannelOpen,h.onmessage=i.onMessage,C.createOffer(function(o){console.log("peerConnection::createOffer called its callback: "+o),n=o,C.setLocalDescription(o,function(){e(C.localDescription,r)},function(e){console.log("WebRtcConnection::createConnectionOffer() setLocalDescription error")},{})},function(e){console.log(e)})},i.onConnectionAnswerReceived=function(e){console.log("WebRtcConnection::onConnectionAnswerReceived(), descriptor: "+e),C.setRemoteDescription(new t(e),function(){console.log("WebRtcConnection::onConnectionAnswerReceived() setRemoteDescription returned OK")},function(e){console.log("WebRtcConnection::onConnectionAnswerReceived() setRemoteDescription returned error "+e)})},i.onConnectionOfferReceived=function(e,n,o){console.log("WebRtcConnection::onConnectionOfferReceived"),console.log("WebRtcConnection::onConnectionOfferReceived trying to set remote description");var c=new t(e);C.setRemoteDescription(c,function(){console.log("WebRtcConnection::onConnectionOfferReceived remote description set"),C.createAnswer(function(e){C.setLocalDescription(e,function(){o(C.localDescription)},function(e){console.log(e)})},function(e){console.log(e)})},function(e){console.log("WebRtcConnection::onConnectionOfferReceived setting remote description failed "+e)})},i.onIceCandidateReceived=function(e){C.addIceCandidate(new c(e),function(){console.log("WebRtcConnection::onIceCandidateReceived adding Ice candidate succeeded")},function(e){console.log("WebRtcConnection::onIceCandidateReceived adding Ice candidate failed "+e)})},i.setPipedTo=function(e){},i.getPipedTo=function(){return null}}e.exports=o}).call(n,function(){return this}())},function(e,n,o){(function(n){function t(e){var n=null,o=[];return location.search.substr(1).split("&").forEach(function(t){o=t.split("="),o[0]===e&&(n=decodeURIComponent(o[1]))}),n}function c(e){for(var n=e+"=",o=document.cookie.split(";"),t=0;t<o.length;t++){for(var c=o[t];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(n))return c.substring(n.length,c.length);
}return null}function i(){var e=this,i=null,l=null,r=null;"undefined"==typeof window?(i=n.RTCPeerConnection,l=n.RTCSessionDescription,r=n.RTCIceCandidate):(i=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,l=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,r=window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate);var s=null;s=o(3);var a="http://spaceify.net/games/",d=new Array,u=!1,f=null,p=-1,g=1,C=1e3,h=null,y=null,R=new s;R.setClientListener(e),R.setConnectionTypeListener(e);var m=null,w=null,b=null,v=null,S=null;e.connect=function(n,o,t,c,i){R.exposeRpcMethod("getRtt",e,e.getRtt),R.connect(n,o,t,c,function(e){y=e,i()})},e.connectAsScreen=function(n,o,t,i){var l=a+n+"/connectiondetails",r=c(n+"_groupid");null!=r&&(l+="/"+r);var s=new XMLHttpRequest;console.log("Trying to make a xmlhttprequest to "+l),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){console.log("Received from xhmlhttprequest: "+s.responseText);var n=JSON.parse(s.responseText);u=n.logging,f=n.loggerUrl,p=n.loggerMeasurementInterval,C=n.loggerBatchSize,o.innerHTML=n.controllerUrl,t.src=n.qrCodeUrl,e.connect(n.hubHost,n.hubPort,"screen",n.groupId,i)}},s.open("GET",l,!0),s.send()},e.connectAsController=function(n){var o=t("id"),i=t("host"),l=t("port");g=c("loggingId"),console.log("GameClient::loggingId "+g),g||(g=Math.floor(1e4*Math.random())),e.connect(i,l,"controller",o,n)},e.notifyScreens=function(e,n){console.log("GameClient::notifyScreens(), screens were: "+JSON.stringify(o));var o=R.getClientsByType("screen");for(var t in o)R.notifyClient(t,e,n)},e.callClientRpc=function(e,n,o,t,c){R.callClientRpc(e,n,o,t,c)},e.notifyController=function(e,n,o){console.log("GameClient::notifyController(), id: "+e),R.notifyClient(e,n,o)},e.exposeRpcMethod=function(e,n,o){R.exposeRpcMethod(e,n,o)},e.sendLogs=function(){var e=new XMLHttpRequest;console.log("Trying to send logs to "+f);var n=JSON.stringify(d);d.splice(0,d.length),e.open("POST",f,!0),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(n)},e.getRtt=function(e,n,o,t){g&&t(null,[g,e,R.getConnectionType(n)])},e.getRttReturned=function(n,o){console.log("GameClient::getRttReturned() loggingId: "+o[0]+" rtt: "+(Date.now()-o[1])+" connectionType: "+o[2]),d.push({loggingId:o[0],timestamp:o[1],rtt:Date.now()-o[1],connectionType:o[2]}),d.length>=C&&e.sendLogs()},e.measureRtts=function(){console.log("GameClient::measureRtts");var n=R.getClientsByType("controller");for(var o in n)console.log("GameClient::measureRtts "+o),R.callClientRpc(o,"getRtt",[Date.now()],e,e.getRttReturned)},e.onClientConnected=function(n,o,t){console.log("GameClient::onClientConnected() "+n.getClientId()+" "+n.getClientType()),!h&&u&&(h=setInterval(e.measureRtts,p)),"screen"==n.getClientType()&&(b&&b.listener.call(b.object,n.getClientId()),"undefined"!=typeof i&&R.upgradeConnectionToWebRtc(n.getClientId())),"controller"==n.getClientType()&&m&&m.listener.call(m.object,n.getClientId())},e.onClientDisconnected=function(e,n,o){console.log("GameClient::onClientDisconnected() '"+e.getClientId()+"'"),"screen"==e.getClientType()&&v&&v.listener.call(v.object,e.getClientId()),"controller"==e.getClientType()&&w&&w.listener.call(w.object,e.getClientId())},e.onConnectionTypeUpdated=function(e,n){console.log("GameClient::onConnectionTypeUpdated() clientType: "+e.getClientType()),null!=S&&"screen"==e.getClientType()&&S.listener.call(S.object,n,e.getClientId())},e.setControllerConnectionListener=function(e,n){m={object:e,listener:n}},e.setControllerDisconnectionListener=function(e,n){w={object:e,listener:n}},e.setScreenConnectionListener=function(e,n){b={object:e,listener:n}},e.setScreenDisconnectionListener=function(e,n){v={object:e,listener:n}},e.setScreenConnectionTypeListener=function(e,n){S={object:e,listener:n}}}e.exports=i}).call(n,function(){return this}())},function(e,n,o){function t(){var e=this,n=null,t=null;n=o(4),t=o(6);var c=new t,i=new n;e.callRpc=function(e,n,o,t){return i.callRpc(e,n,o,t)},e.connect=function(e,n){console.log("WebSocketRpcConnection::connect()"),c.connect(e,function(){console.log("WebsocketRpcConnection Connected"),i.addConnection(c),console.log("WebsocketRpcConnection added to communicator"),n(null,null)})},e.close=function(){},e.getCommunicator=function(){return i}}e.exports=t},function(e,n,o){function t(e,n){var t=this,c=null,i=null,l=null;c=o(9),i=o(6),l=o(4);var r=new i,s=new l,a=new Object,d=null;t.setConnectionListener=function(e){d=e},t.onIceCandidate=function(e,n){console.log("iceCandidate got, sending it to the other client"),s.callRpc("offerIce",[e,n])};var u=function(e){a[e]=new c(n),a[e].setPartnerId(e),a[e].setIceListener(t),a[e].setStreamListener(t),a[e].setConnectionListener(t),a[e].setDataChannelListener(t)};t.shutdown=function(e){console.log("WebRtcClient::onbeforeunload");for(var n in a)a.hasOwnProperty(n)&&(a[n].close(),delete a[n])},t.handleRtcOffer=function(e,n,o){console.log("WebRtcClient::handleRtcOffer() descriptor: "+e),a.hasOwnProperty(n)||u(n),a[n].onConnectionOfferReceived(e,o,function(e){console.log("WebRtcClient::handleRtcOffer() onConnectionOfferReceived returned"),s.callRpc("acceptConnectionOffer",[e,n])})},t.handleRtcAnswer=function(e,n,o){console.log("WebRtcClient::handleRtcAnswer()"),a[n].onConnectionAnswerReceived(e)},t.handleIceCandidate=function(e,n,o){console.log("WebRtcClient::handleIceCandidate()"),a.hasOwnProperty(n)||u(n),a[n].onIceCandidateReceived(e)};var f=function(n){console.log("WebRtcClient::connectToCoordinator()"),console.log("Websocket connecting to the coordinator"),r.connect(e,function(){console.log("Websocket Connected to the Coordinator"),console.log("Creating RPCCommunicator for the Websocket"),s.addConnection(r),n()})};t.onDisconnected=function(e){if(console.log("WebRtcClient::onDisconnected() "),a.hasOwnProperty(e)){var n=a[e];d.onDisconnected(n.getId()),n.close(),delete a[e]}},t.onDataChannelOpen=function(e){console.log("WebRtcClient::onDataChannelOpen() "),d.addConnection(e)},t.onStream=function(e,n){console.log("WebRtcClient::onStream()")},t.onRemoveStream=function(e,n){console.log("WebRtcClient::onRemoveStream()"),t.onDisconnected(n)};var p=function(e,n){console.log("WebRtcClient::connectToPeers()"),console.log("Announcing to the Coordinator"),s.callRpc("announce",[e],t,t.onPeerIdsArrived)};t.onPeerIdsArrived=function(e,n,o){console.log("WebRtcClient::onPeerIdsArrived(), data.length: "+n.length);for(var t=0,c=0;c<n.length;c++)t=n[c],u(t),console.log("Trying to create offer to client id "+t),a[t].createConnectionOffer(function(e,n){console.log("Offer created, sending it to the other client "+n),s.callRpc("offerConnection",[e,n])});0===n.length&&console.log("Announce returned 0 client ids, not connecting")},t.run=function(e,n){console.log("WebRtcClient::run()"),window.onbeforeunload=t.shutdown,s.exposeRpcMethod("handleRtcOffer",t,t.handleRtcOffer),s.exposeRpcMethod("handleRtcAnswer",t,t.handleRtcAnswer),s.exposeRpcMethod("handleIceCandidate",t,t.handleIceCandidate),f(function(){console.log("WebRtcClient::run() connected to the coordinator"),p(e,function(){console.log("WebRtcClient::run() connectToPeers returned")}),n&&n(s)})}}navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.exports=t}])}),"undefined"!=typeof exports&&(module.exports=HttpParser);var getSession=function(e){return console.log("GETTING GETTING",e,sessionStorage.getItem(e)),sessionStorage.getItem(e)?sessionStorage.getItem(e):""},setSession=function(e,n){console.log("SETTING SETTING",e,n),n||(n=""),sessionStorage.setItem(e,n.trim())},SERVER_ADDRESS={host:"spaceify.net",port:1980},WEBRTC_CONFIG={iceServers:[{url:"stun:kandela.tv"},{url:"turn:kandela.tv",username:"webrtcuser",credential:"jeejeejee"}]},piperClient=new PiperClient,spaceifyLoader=new SpaceifyLoader,contentLoader=spaceifyLoader;window.onload=function(){var e,n,o=spaceifyLoader.parseQuery(window.location.href);o.sp_host||(e=n=window.location.protocol+"//"+window.location.hostname+"/","undefined"!=typeof document.loadPageSpHost&&(e=document.loadPageSpHost),"undefined"!=typeof document.loadPageSpeHost&&(n=document.loadPageSpeHost),o={sp_host:e,spe_host:n,sp_path:"index.html"}),getNetworkInfo(function(){window.isSpaceifyNetwork?(prepareLoader(o.sp_host,o.spe_host),loadPageOrElements(o)):(spaceifyLoader.setConnectionListener(function(){loadPageOrElements(o)}),prepareLoader(o.sp_host,o.spe_host))})};