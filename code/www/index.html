<!doctype html>
<html ng-app-spaceify>
	<head body-directive>
		<!-- -->
		<meta charset="utf-8">
		<meta name="product" content="Spaceify">
		<meta name="author" content="Spaceify Oy">
		<meta name="description" content="Spaceify Edge User interface">
		<meta name="viewport" content="width=100%, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">

		<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
		<link href="css/spaceify.edge.css" rel="stylesheet" type="text/css">
		<!-- REMOTE >>>>>>>>>>
		<link sp_href="css/spaceify.edge.css" rel="stylesheet" type="text/css">
		<<<<<<<<<< REMOTE -->
		<link rel="stylesheet" href="fonts/roboto/roboto.css">
		<link rel="stylesheet" href="css/skeleton/normalize.css">
		<link rel="stylesheet" href="css/skeleton/skeleton.css">

		<title ng-bind="$root.getString('title')">Loading...</title>
		<!-- -->

		<!-- -->
		<script src="js/spaceify.edge.js"></script>
		<!-- REMOTE >>>>>>>>>>
		<script src="js/spaceify.loader.js" defer></script>
		<script sp_src="js/spaceify.edge.js"></script>
		<<<<<<<<<< REMOTE -->
		<!-- -->

		<script>
		var net = null;
		var core = null;
		var sync = null;
		var config = null;

		function angularReady()
			{
			window.spaceifyCache = new SpaceifyCache();

			net = new SpaceifyNet();
			core = new SpaceifyCore();
			config = new SpaceifyConfig();
			sync = new SpaceifySynchronous();

			net.showInstalledApplications(function()
				{
				var apps = net.getApplications();

				$("#spacelet, #spaceletHeader").css("display", (apps.spaceletCount > 0 ? "block" : "none"));
				$("#sandboxed, #sandboxedHeader").css("display", (apps.sandboxedCount > 0 ? "block" : "none"));
				$("#sandboxedDebian, #sandboxedDebianHeader").css("display", (apps.sandboxedDebianCount > 0 ? "block" : "none"));
				$("#nativeDebian, #nativeDebianHeader").css("display", (apps.nativeDebianCount > 0 ? "block" : "none"));

				jQuery("#userUtilities, #userUtilitiesHeader, #adminUtilities, #adminUtilitiesHeader, #edgeBody").css("display", "block");

				core.setEventListeners(	[
					config.EVENT_SPACELET_INSTALLED,
					config.EVENT_SPACELET_REMOVED,
					config.EVENT_SANDBOXED_INSTALLED,
					config.EVENT_SANDBOXED_REMOVED,
					config.EVENT_SANDBOXED_DEBIAN_INSTALLED,
					config.EVENT_SANDBOXED_DEBIAN_REMOVED,
					config.EVENT_NATIVE_DEBIAN_INSTALLED,
					config.EVENT_NATIVE_DEBIAN_REMOVED
					],
					[
					spaceletInstalled,
					spaceletRemoved,
					sandboxedInstalled,
					sandboxedRemoved,
					sandboxedDebianInstalled,
					sandboxedDebianRemoved,
					nativeDebianInstalled,
					nativeDebianRemoved
					],
					this, null, function(err, data, id, ms) { });
				});
			}

			// EXPOSED RPC METHODS -- -- -- -- -- -- -- -- -- -- //
		function spaceletInstalled(result, connObj, callback)
			{
			renderTile(result.manifest);
			$("#spacelet, #spaceletHeader").css("display", "block");
			callback(null, true);
			}

		function spaceletRemoved(result, connObj, callback)
			{
			var apps = removeTile(result.manifest);
			$("#spacelet, #spaceletHeader").css("display", (apps.spaceletCount > 0 ? "block" : "none"));
			callback(null, true);
			}

		function sandboxedInstalled(result, connObj, callback)
			{
			renderTile(result.manifest);
			$("#sandboxed, #sandboxedHeader").css("display", "block");
			callback(null, true);
			}

		function sandboxedRemoved(result, connObj, callback)
			{
			var apps = removeTile(result.manifest);
			$("#sandboxed, #sandboxedHeader").css("display", (apps.sandboxedCount > 0 ? "block" : "none"));
			callback(null, true);
			}

		function sandboxedDebianInstalled(result, connObj, callback)
			{
			renderTile(result.manifest);
			$("#sandboxedDebian, #sandboxedDebianHeader").css("display", "block");
			callback(null, true);
			}

		function sandboxedDebianRemoved(result, connObj, callback)
			{
			var apps = removeTile(result.manifest);
			$("#sandboxedDebian, #sandboxedDebianHeader").css("display", (apps.sandboxedDebianCount > 0 ? "block" : "none"));
			callback(null, true);
			}

		function nativeDebianInstalled(result, connObj, callback)
			{
			renderTile(result.manifest);
			$("#nativeDebian, #nativeDebianHeader").css("display", "block");
			callback(null, true);
			}

		function nativeDebianRemoved(result, connObj, callback)
			{
			var apps = removeTile(result.manifest);
			$("#nativeDebian, #nativeDebianHeader").css("display", (apps.nativeDebianCount > 0 ? "block" : "none"));
			callback(null, true);
			}

			// -- -- -- -- -- -- -- -- -- -- //
		function renderTile(manifest)
			{
			net.renderTile(manifest, function(){ });
			}

		function removeTile(manifest)
			{
			net.removeTile(manifest);
			return net.getApplications();
			}
		</script>
	</head>

	<body class="edgeBody" id="edgeBody" ng-controller="bodyController" body-directive style="display: none;">

		<div id="top_bar" class="top_bar">
			<a id="logolink" class="logolink" routerLink="/intro"><img id="appstorelogo" class="appstorelogo" src="images/icon-80p.png" alt="" /></a>
			<div id="logoname" class="logoname">Spaceify Edge</div>
		</div>
		<div class="large_background_footer">&nbsp;</div>

		<div id="content_container">
			<div class="container">
				<div class="row">
					<div class="twelve columns">

						<!-- VIEW -->
						<the-tiles></the-tiles>

						<!-- SPACELETS -- -- -- -- -- -- -- -- -- -- -->
						<h5 class="edgeH5" id="spaceletHeader" style="display: none;">{{ getString('spacelets') }}</h5>
						<div class="tiles" id="spacelet" style="display: none;"></div>
						<div class="breaker"></div>

						<!-- SANDBOXED -- -- -- -- -- -- -- -- -- -- -->
						<h5 class="edgeH5" id="sandboxedHeader" style="display: none;">{{ getString('sandboxed') }}</h5>
						<div class="tiles" id="sandboxed" style="display: none;"></div>
						<div class="breaker"></div>

						<!-- SANDBOXED DEBIAN -- -- -- -- -- -- -- -- -- -- -->
						<h5 class="edgeH5" id="sandboxedDebianHeader" style="display: none;">{{ getString('sandboxed_debian') }}</h5>
						<div class="tiles" id="sandboxedDebian" style="display: none;"></div>
						<div class="breaker"></div>

						<!-- NATIVE DEBIAN -->
						<h5 class="edgeH5" id="nativeDebianHeader" style="display: none;">{{ getString('native_debian') }}</h5>
						<div class="tiles" id="nativeDebian" style="display: none;"></div>
						<div class="breaker"></div>

						<!-- UTILITIES -- -- -- -- -- -- -- -- -- -- -->
						<h5 class="edgeH5" id="userUtilitiesHeader" style="display: none;">{{ getString('user_utilities') }}</h5>
						<div class="tiles" id="userUtilities" style="display: none;">

							<!-- CERTIFICATE TILE -->
							<div class="edgeTile pointer" onclick="net.loadCertificate();">
								<div class="edgeTileImage">
									<img width="128" height="128" src="images/certificate.png" id="installCertificateId">
									<!-- REMOTE >>>>>>>>>>
									<img width="128" height="128" sp_src="images/certificate.png" id="installCertificateId">
									<<<<<<<<<< REMOTE -->
								</div>

								<div class="edgeTileInfo">
									<div class="edgeTitle text bold">{{ getString("install_certificate_title") }}</div>
								</div>
							</div>

						</div>
						<div class="breaker"></div>

						<!-- ADMIN -- -- -- -- -- -- -- -- -- -- -->
						<h5 class="edgeH5" id="adminUtilitiesHeader" style="display: none;">{{ getString('admin_utilities') }}</h5>
						<div class="tiles" id="adminUtilities" style="display: none;">

							<!-- LOG IN || ADMIN TILE -->
							<div class="edgeTile pointer" onclick="net.openAdminPages();">
								<div class="edgeTileImage">
									<img width="128" height="128" src="images/admin.png" id="adminLogInId">
									<!-- REMOTE >>>>>>>>>>
									<img width="128" height="128" sp_src="images/admin.png" id="adminLogInId">
									<<<<<<<<<< REMOTE -->
								</div>

								<div class="edgeTileInfo">
									<div class="edgeTitle text bold">{{ getString("admin_tile_title") }}</div>
								</div>
							</div>

						</div>
						<div class="breaker"></div>

						<!-- MISC -- -- -- -- -- -- -- -- -- -- -->
						<iframe id="certIframe" src="" class="edgeCertIframe" scrolling="no" frameborder="0"></iframe>

					</div>
				</div>
			</div>
		</div>

		<div id="footer" class="footer">
			<div class="section_w70">
				<div class="footerContentLeft smaller">
					<img class="floatLeft" id="32pxc" src="./images/by-nc-nd_eu.png" width="91" height="32">
					<span class="floatLeft">Copyright &copy; 2014-2016 Spaceify.org</span>
				</div>
			</div>
		</div>

	</body>
</html>
